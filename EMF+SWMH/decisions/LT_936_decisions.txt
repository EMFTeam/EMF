# -*- ck2.decisions -*-

decisions = {
	kievan_rus_local_traditions = {
		is_high_prio = yes
		only_independent = yes
		ai_check_interval = 60

		potential = {
			has_landed_title = k_ruthenia
			has_landed_title = c_kiev
			OR = {
				AND = {
					religion = norse_pagan
					emf_can_convert_religion = yes
				}
				culture = norse
			}
			dynasty = 705
			year <= 1000
			start_date >= 936.8.7
			is_alternate_start = no
		}
		allow = {
			independent = yes
			war = no
			is_incapable = no
			year <= 1000
			prestige >= 300
			capital_scope = {
				county = { title = c_kiev }
			}
		}
		effect = {
			prestige = -300
			slavic_pagan = { save_event_target_as = target_religion }
			if = {
				limit = { culture = norse }
				culture = russian
			}
			if = {
				limit = {
					NOT = { religion = slavic_pagan }
					emf_can_convert_religion = yes
				}
				emf_character_set_religion_to_target_religion = yes
			}
			any_close_relative = {
				limit = {
					is_alive = yes
					ai = yes
				}
				if = {
					limit = { culture = norse }
					culture = russian
				}
				if = {
					limit = {
						NOT = { religion = slavic_pagan }
						emf_can_convert_religion = yes
					}
					emf_character_set_religion_to_target_religion = yes
				}
			}
		}
	}
	shiite_caliphate_cairo_decision = {
		is_high_prio = yes
		only_independent = yes
		ai_check_interval = 60

		potential = {
			has_landed_title = d_ismaili
			has_landed_title = k_egypt
			c_cairo = { owner_under_ROOT = yes }
			b_cairo = { has_holder = no }
			#796 = { # SWMH's Cairo has 7 holding slots
			#	NOT = { num_of_max_settlements = 7 }
			#}
			is_alternate_start = no
			NOT = { has_global_flag = established_cairo }
		}
		allow = {
			prestige = 500
			custom_tooltip = {
				text = NEEDS_500_GOLD_COST
				wealth = 500
			}
			has_landed_title = d_ismaili
			has_landed_title = k_egypt
			c_cairo = { owner_under_ROOT = yes }
		}
		effect = {
			set_global_flag = established_cairo
			wealth = -500
			if = {
				limit = {
					capital_scope = {
						NOT = { province = 796 }
					}
				}
				custom_tooltip = { text = cairo_decision_TT }
			}
			if = {
				limit = {
					NOT = { has_landed_title = c_cairo }
				}
				c_cairo = {
					show_scope_change = no
					grant_title_no_opinion = ROOT
				}
			}
			c_cairo = {
				set_name = "PROV796"
			}
			796 = {
				show_scope_change = no
				if = {
					limit = {
						num_of_max_settlements < 6
					}
					add_holding_slot = 2
				}
				else_if = {
					limit = {
						num_of_max_settlements == 6
					}
					add_holding_slot = 1
				}
				build_holding = {
					title = b_cairo
					type = castle
					holder = ROOT
				}
				hidden_tooltip = {
					b_cairo = { 
						make_capital_holding = yes
						ROOT = { capital = PREV } 
						add_building = ca_wall_1
						add_building = ca_wall_q_1
						add_building = ca_wall_2
						add_building = ca_wall_q_2
						add_building = ca_keep_1
						add_building = ca_keep_2
						add_building = ca_militia_barracks_1
						add_building = ca_militia_barracks_2
						add_building = ca_training_grounds_1
						add_building = ca_barracks_1
						add_building = ca_barracks_2
						add_building = ca_stable_1
						add_building = ca_town_1
						add_building = ca_town_2
					}
				}
			}
		}
	}
	establishing_habsburg = {
		is_high_prio = yes
		only_independent = yes
		ai_check_interval = 60

		potential = {
			dynasty = 664
			culture_group = central_germanic
			has_landed_title = c_aargau
			c_aargau = {
				location = {
					num_of_max_settlements < 7
				}
			}
			is_alternate_start = no
			NOT = { has_global_flag = established_habsburg }
		}
		allow = {
			custom_tooltip = {
				text = NEEDS_500_GOLD_COST
				wealth = 500
			}
		}
		effect = {
			wealth = -500
			prestige = 500
			custom_tooltip = { text = establishing_habsburg_family }
			#c_aargau = {
			#	location = {
			#		build_holding = {
			#			title = b_habsburg
			#			type = castle
			#			holder = ROOT
			#		}
			#	}
			#}
			hidden_tooltip = {
				# TODO: It'd be nice to auto-form a proper cadet branch for the von Habsburg dynasty here.
				tooltip = { dynasty = 51 }
				any_child_even_if_dead = {
					if = {
						limit = { dynasty = ROOT }
						dynasty = 51
					}
					any_child_even_if_dead = {
						if = {
							limit = { dynasty = ROOT }
							dynasty = 51
						}
						any_child_even_if_dead = {
							if = {
								limit = { dynasty = ROOT }
								dynasty = 51
							}
							any_child_even_if_dead = {
								limit = { dynasty = ROOT }
								dynasty = 51
							}
						}
					}
				}
				hidden_effect = { dynasty = 51 }
				b_habsburg = { 
					add_building = ca_wall_q_1
					add_building = ca_wall_q_2
					add_building = ca_wall_1
					add_building = ca_wall_2
					add_building = ca_keep_1
					add_building = ca_keep_2
					add_building = ca_militia_barracks_1
					add_building = ca_militia_barracks_2
					add_building = ca_training_grounds_1
					add_building = ca_barracks_1
					add_building = ca_barracks_2
					add_building = ca_stable_1
					add_building = ca_town_1
					add_building = ca_town_2
				}
			}
		}
	}
}
