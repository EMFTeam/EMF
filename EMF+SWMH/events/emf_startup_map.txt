# -*- ck2.events -*-


namespace = emf_startup

# emf_startup.30 [Isis]
#
# SWMH map dynamic de jure changes
character_event = {
	id = emf_startup.30
	
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		has_landed_title = e_hip
	}
	
	immediate = {
		character_event = { id = emf_startup.31 } # SWMH regional levy balance
		if = {
			limit = {
				NOR = {
					e_hre = { has_holder = yes }
					e_hre_french = { has_holder = yes }
				}
			}
			
			# HRE stem duchies do not make sense as de jure entities if the HRE
			# doesn't exist. Also, this strengthens the initial setup significantly,
			# promoting much less screwed-up border-gorey outcomes with the proto-HRE.
			#
			# The stem duchies are all reactivated and restored upon HRE formation.
			
			k_lotharingia = { de_jure_liege = e_hre }
			k_germany = { de_jure_liege = e_hre }
			
			# Make Lotharingia de jure ... (part of it already is on SWMH, hence referencing duchies directly)
			any_landed_title = {
				limit = {
					tier = DUKE
					OR = {
						title = d_trier
						title = d_luxembourg
						title = d_pfalz
						title = d_upper_lorraine
						title = d_barleduc
						title = d_alsace
					}
				}
				de_jure_liege = k_lotharingia # JIC
				set_title_flag = upper_lorraine
			}
			any_landed_title = {
				limit = {
					tier = DUKE
					OR = {
						title = d_brabant
						title = d_liege
						title = d_hainaut
						title = d_limburg
						title = d_koln
						title = d_berg
					}
				}
				de_jure_liege = k_lotharingia # JIC
				set_title_flag = lower_lorraine
			}
			k_upper_lorraine = {
				any_direct_de_jure_vassal_title = { # JIC
					de_jure_liege = k_lotharingia
					set_title_flag = lower_lorraine
				}
				activate_title = { title = THIS status = no }
			}
			k_lower_lorraine = {
				any_direct_de_jure_vassal_title = { # JIC
					de_jure_liege = k_lotharingia
					set_title_flag = lower_lorraine
				}
				activate_title = { title = THIS status = no }
			}
			
			# Make Frisia part of Lotharingia
			k_frisia = {
				any_direct_de_jure_vassal_title = {
					de_jure_liege = k_lotharingia
					set_title_flag = frisia
				}
				activate_title = { title = THIS status = no }
			}
			
			# Make Germany de jure ...
			k_saxony = {
				any_direct_de_jure_vassal_title = {
					de_jure_liege = k_germany
					set_title_flag = saxony
				}
				activate_title = { title = THIS status = no }
			}
			k_franconia = {
				any_direct_de_jure_vassal_title = {
					de_jure_liege = k_germany
					set_title_flag = franconia
				}
				activate_title = { title = THIS status = no }
			}
			k_schwaben = {
				any_direct_de_jure_vassal_title = {
					de_jure_liege = k_germany
					set_title_flag = schwaben
				}
				activate_title = { title = THIS status = no }
			}
			
			# All the HRE stem duchies (though k_frisia will live on) but k_carinthia
			# have been absorbed. Ideally, HRE stem duchies shouldn't exist while the
			# HRE doesn't exist. We, obviously, must melt it into k_bavaria.
			
			k_carinthia = {
				any_direct_de_jure_vassal_title = {
					de_jure_liege = k_bavaria
					set_title_flag = carinthia
				}
				activate_title = { title = THIS status = no }
			}
		}
	}
}

# emf_startup.31 [Isis]
#
# Persian/Levant/African troop balance modifiers (counteract overrepresentation of Europe in terms of levy output in SWMH)
character_event = {
	id = emf_startup.31
	
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		has_landed_title = e_hip
	}
	
	immediate = {
		any_province = {
			limit = {
				region = emf_region_levy_boost
				has_owner = yes
			}
			add_province_modifier = {
				name = emf_levy_boost_local
				hidden = yes
				duration = -1
			}
		}
	}
}
