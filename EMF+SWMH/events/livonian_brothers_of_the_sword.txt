# -*- ck2.events -*-

namespace = emf_holy_orders

# Formation of the Livonian Brothers of the Sword (SWMH)

character_event = {
	id = emf_holy_orders.110

	is_triggered_only = yes
	hide_window = yes

	only_playable = yes
	religion_group = christian
	has_global_flag = christian_crusades_unlocked

	trigger = {
		emf_western_christian_religion = yes
		is_heretic = no
		year < 1236
		NOR = {
			is_title_active = d_livonian_brothers_of_the_sword
			is_title_active = d_livonian_order # Should not be active at the same time, ideally
		}
		any_demesne_title = {
			tier = COUNT
			kingdom = { title = k_terra } # TODO: convert to a region, e.g. emf_region_livonian_order
		}
		has_random_dejure_or_title_names = no
	}

	immediate = {
		if = {
			limit = { k_teutonic_state = { has_holder = yes } }
			k_teutonic_state = { owner = { save_event_target_as = emf_rel } }
		}
		else_if = {
			limit = { k_teutonic_order = { has_holder = yes } }
			k_teutonic_order = { owner = { save_event_target_as = emf_rel } }
		}
		else = {
			save_event_target_as = emf_rel
		}
		d_livonian_brothers_of_the_sword = {
			unsafe_religion = event_target:emf_rel
		}
		if = {
			limit = { has_religion_feature = religion_matriarchal }
			create_character = {
				random_traits = yes
				dynasty = actually_culture
				religion = ROOT
				culture = ROOT
				female = yes
				attributes = { martial = 9 }
			}
		}
		else_if = {
			limit = {
				OR = {
					gender_equality_trigger = yes
					has_religion_feature = religion_equal
					has_religion_feature = religion_feature_bon
				}
			}
			create_character = {
				random_traits = yes
				dynasty = actually_culture
				religion = ROOT
				culture = ROOT
				female = 50
				attributes = { martial = 9 }
			}
		}
		else = {
			create_character = {
				random_traits = yes
				dynasty = actually_culture
				religion = ROOT
				culture = ROOT
				female = no
				attributes = { martial = 9 }
			}
		}
		new_character = {
			random = { chance = 67 add_trait = brave }
			random = { chance = 75 add_trait = zealous }
			random = { chance = 33 add_trait = humble }
			random = { chance = 33 add_trait = chaste }
			random = { chance = 33 add_trait = temperate }
			random = { chance = 50 add_trait = charitable }
			clear_education_trait = yes
			random_list = {
				20 = { add_trait = tough_soldier }
				30 = { add_trait = skilled_tactician }
				40 = { add_trait = brilliant_strategist }
				5  = { add_trait = martial_cleric }
				10 = { add_trait = scholarly_theologian }
				15 = { add_trait = mastermind_theologian }
			}
			add_trait = holy_warrior
			health = 2
			emf_new_character_noble = yes
			d_livonian_brothers_of_the_sword = {
				activate_title = { title = THIS status = yes }
				grant_title = PREV
			}
			set_defacto_liege = THIS
		}
	}
}
