
namespace = emf_core

# emf_core.0 [Player]
#
# on_death handler for player characters. Inherits intrigue
# menu character flag state for now. Cushy.
character_event = {
	id = emf_core.0
	desc = HIDE_EVENT
	hide_window = yes
	is_triggered_only = yes
	
	ai = no

	immediate = {
		current_heir = {
			if = {
				limit = { ROOT = { has_character_flag = emf_toggle_customization_off } }
				set_character_flag = emf_toggle_customization_off
			}
			if = {
				limit = { ROOT = { has_character_flag = toggle_employment } }
				set_character_flag = toggle_employment
			}
			if = {
				limit = { ROOT = { has_character_flag = holy_war_check } }
				set_character_flag = holy_war_check
			}
			if = {
				limit = { ROOT = { has_character_flag = enable_marriage_decisions } }
				set_character_flag = enable_marriage_decisions
			}
			if = {
				limit = { ROOT = { has_character_flag = loan_decisions } }
				set_character_flag = loan_decisions
			}
		}
	}
	
	option = { name = OK }
}


# emf_core.10 [Player]
#
# do_not_disturb cleanup (allowed for at least 2 years) for players,
# called on_yearly_pulse.
character_event = {
	id = emf_core.10
	hide_window = yes
	is_triggered_only = yes
	
	ai = no

	trigger = {
		not = { trait = in_hiding }
		had_character_flag = { flag = do_not_disturb days = 730 }
	}
	
	immediate = {
		clr_character_flag = do_not_disturb
	}
}


# emf_core.20
#
# Remove ahistorical empires
character_event = {
	id = emf_core.20
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		any_title = {
			limit = {
				tier = empire
				is_titular = no
				nor = {
					title = e_hre
					title = e_byzantium
					title = e_persia
					title = e_null # Might already be de jure
				}
			}

			# Transfer de jure vassal kingdoms to e_null
			any_direct_de_jure_vassal_title = {
				de_jure_liege = e_null
			}

			# If we can deactivate the empire title without side effects, do so
			if = {
				limit = { has_holder = no }
				activate_title = { title = THIS status = no }
			}
		}
	}
}


# For emf_core.30-emf_core.31, see emf_hre_map.txt
