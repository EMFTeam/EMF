# -*- ck2.events -*-

namespace = PlusFaction

#reserved: PlusFaction.400 to PlusFaction.499

##################################
# FACTION DEMANDS EVENTS
# Original Faction System by Wiz
# Re-Written by Rylock
##################################

# Liege responds to demand from faction
letter_event = {
	id = PlusFaction.400
	border = GFX_event_letter_frame_war

	desc = {
		text = EVTDESC_PlusFaction_400A
		trigger = { FROM = { has_flag = demands_lower_CA } }
	}
	desc = {
		text = EVTDESC_PlusFaction_400B
		trigger = { FROM = { has_flag = demands_lower_TO } }
	}
	desc = {
		text = EVTDESC_PlusFaction_400E
		trigger = { FROM = { has_flag = demands_surrender_title } }
	}
	desc = {
		text = EVTDESC_PlusFaction_400H
		trigger = { FROM = { has_flag = demands_share_wealth } }
	}
	desc = {
		text = EVTDESC_PlusFaction_400J
		trigger = { FROM = { has_flag = demands_revert_succession } }
	}
	desc = {
		text = EVTDESC_PlusFaction_400L
		trigger = { FROM = { has_flag = demands_lower_feudal_obligations } }
	}
	desc = {
		text = EVTDESC_PlusFaction_400M
		trigger = { FROM = { has_flag = demands_lower_tribal_obligations } }
	}
	desc = {
		text = EVTDESC_PlusFaction_400N
		trigger = { FROM = { has_flag = demands_lower_city_obligations } }
	}
	desc = {
		text = EVTDESC_PlusFaction_400O
		trigger = { FROM = { has_flag = demands_lower_temple_obligations } }
	}

	is_triggered_only = yes

	immediate = {
		any_vassal = {
			limit = { pf_from_faction_backer_trigger = yes }
			reverse_opinion = { who = ROOT modifier = made_ultimatum years = 5 }
		}

		primary_title = { save_event_target_as = liege_primary }

		# recall demanded title info
		if = {
			limit = { FROM = { has_flag = demands_surrender_title } }
			random_demesne_title = {
				limit = { FROM = { has_flag = faction_demand_@PREV } }
				save_event_target_as = faction_demanded_title
				FROM = { clr_flag = faction_demand_@PREV }
			}
			random_vassal = {
				limit = {
					event_target:faction_demanded_title = { always = yes }
					FROM = { has_flag = faction_demand_@PREV }
				}
				save_event_target_as = faction_demanded_title_for
				FROM = { clr_flag = faction_demand_@PREV }
			}
			random_demesne_title = {
				limit = {
					NOT = { event_target:faction_demanded_title = { always = yes } }
					can_be_given_away = yes
					tier = COUNT
					is_feudal = yes
					location = { is_capital = no }
					ROOT = {
						capital_scope = {
							duchy = {
								NOT = { de_jure_vassal_or_below = PREVPREVPREV }
							}
						}
					}
					location = {
						NOT = {
							any_neighbor_province = {
								owner = { character = ROOT }
							}
						}
					}

				}
				save_event_target_as = faction_demanded_title
			}
			random_demesne_title = {
				limit = {
					NOT = { event_target:faction_demanded_title = { always = yes } }
					can_be_given_away = yes
					tier = COUNT
					is_feudal = yes
					location = { is_capital = no }
					ROOT = {
						capital_scope = {
							duchy = {
								NOT = { de_jure_vassal_or_below = PREVPREVPREV }
							}
						}
					}
					location = {
						NOT = {
							any_neighbor_province = {
								owner_under_ROOT = yes
							}
						}
					}

				}
				save_event_target_as = faction_demanded_title
			}
			random_demesne_title = {
				limit = {
					NOT = { event_target:faction_demanded_title = { always = yes } }
					can_be_given_away = yes
					tier = COUNT
					is_feudal = yes
					location = { is_capital = no }
					ROOT = {
						capital_scope = {
							duchy = {
								NOT = { de_jure_vassal_or_below = PREVPREVPREV }
							}
						}
					}
					location = {
						any_neighbor_province = {
							owner = {
								is_liege_or_above = ROOT
							}
						}
					}

				}
				save_event_target_as = faction_demanded_title
			}
			random_demesne_title = {
				limit = {
					NOT = { event_target:faction_demanded_title = { always = yes } }
					can_be_given_away = yes
					tier = COUNT
					is_feudal = yes
					location = { is_capital = no }
					ROOT = {
						capital_scope = {
							duchy = {
								NOT = { de_jure_vassal_or_below = PREVPREVPREV }
							}
						}
					}

				}
				save_event_target_as = faction_demanded_title
			}
			random_demesne_title = {
				limit = {
					NOT = { event_target:faction_demanded_title = { always = yes } }
					can_be_given_away = yes
					tier = COUNT
					is_feudal = yes
					location = { is_capital = no }
					location = {
						NOT = {
							any_neighbor_province = {
								owner = { character = ROOT }
							}
						}
					}

				}
				save_event_target_as = faction_demanded_title
			}
			random_demesne_title = {
				limit = {
					NOT = { event_target:faction_demanded_title = { always = yes } }
					can_be_given_away = yes
					tier = COUNT
					is_feudal = yes
					location = { is_capital = no }
					location = {
						NOT = {
							any_neighbor_province = {
								owner_under_ROOT = yes
							}
						}
					}

				}
				save_event_target_as = faction_demanded_title
			}
			random_demesne_title = {
				limit = {
					NOT = { event_target:faction_demanded_title = { always = yes } }
					can_be_given_away = yes
					tier = COUNT
					is_feudal = yes
					location = { is_capital = no }
					location = {
						any_neighbor_province = {
							owner = {
								is_liege_or_above = ROOT
							}
						}
					}
				}
				save_event_target_as = faction_demanded_title
			}
			random_demesne_title = {
				limit = {
					NOT = { event_target:faction_demanded_title = { always = yes } }
					can_be_given_away = yes
					tier = COUNT
					is_feudal = yes
					location = { is_capital = no }

				}
				save_event_target_as = faction_demanded_title
			}
			random_demesne_title = {
				limit = {
					NOT = { event_target:faction_demanded_title = { always = yes } }
					can_be_given_away = yes
					tier = COUNT
					location = { is_capital = no }

				}
				save_event_target_as = faction_demanded_title
			}
			if = {
				limit = { NOT = { event_target:faction_demanded_title_for = { always = yes } } }
				FROM = { save_event_target_as = faction_demanded_title_for }
			}
		}
	}

	option = {
		name = EVTDEMANDYES #Agree to the demand
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0.5
				FROM = {
					OR = {
						has_flag = demands_council_life_terms
						has_flag = demands_revert_succession
					}
				}
			}
			modifier = {
				factor = 0.2
				FROM = {
					OR = {
						has_flag = demands_lower_CA
						has_flag = demands_lower_TO
					}
				}
			}
			modifier = {
				factor = 2
				FROM = { has_flag = demands_share_wealth }
				wealth = 250
			}
			modifier = {
				factor = 2
				FROM = { has_flag = demands_surrender_title }
				over_max_demesne_size = 1
			}
			modifier = {
				factor = 2.5
				FROM = { has_flag = demands_surrender_title }
				over_max_demesne_size = 2
			}
			modifier = {
				factor = 1.25
				trait = craven
			}
			modifier = {
				factor = 1.25
				trait = humble
			}
			modifier = {
				factor = 1.25
				trait = kind
			}
			modifier = {
				factor = 1.25
				trait = charitable
			}
			modifier = {
				factor = 1.25
				trait = patient
			}
			modifier = {
				factor = 1.25
				trait = content
			}
		}

		log = "[Root.GetBestName] has caved to the regular faction demand of [From.GetBestName]."

		#liege loses prestige
		if = {
			limit = { lower_real_tier_than = KING }
			prestige = -100
		}
		if = {
			limit = { real_tier = KING }
			prestige = -250
		}
		if = {
			limit = { real_tier = EMPEROR }
			prestige = -500
		}

		#faction demands implemented
		if = {
			limit = { FROM = { has_flag = demands_lower_CA } }
			pf_lower_CA_effect = yes
		}
		if = {
			limit = { FROM = { has_flag = demands_lower_TO } }
			pf_lower_TO_effect = yes
		}
		if = {
			limit = {
				FROM = { has_flag = demands_surrender_title }
				NOT = { has_landed_title = event_target:faction_demanded_title }
			}
			random_demesne_title = {
				limit = {
					tier = COUNT
					can_be_given_away = yes
					location = { is_capital = no }
				}
				grant_title = FROM
				hidden_tooltip = {
					add_weak_pressed_claim = ROOT
					FROM = {
						if = {
							limit = { NOT = { is_liege_or_above = ROOT } }
							set_defacto_liege = ROOT
							emf_liege_change = yes
						}
					}
				}
			}
		}
		if = {
			limit = {
				FROM = { has_flag = demands_surrender_title }
				has_landed_title = event_target:faction_demanded_title
			}
			event_target:faction_demanded_title = {
				grant_title = event_target:faction_demanded_title_for
				hidden_tooltip = {
					add_weak_pressed_claim = ROOT
					event_target:faction_demanded_title_for = {
						if = {
							limit = { NOT = { is_liege_or_above = ROOT } }
							set_defacto_liege = ROOT
							emf_liege_change = yes
						}
					}
				}
			}
		}
		if = {
			limit = { FROM = { has_flag = demands_share_wealth } }
			any_vassal = {
				limit = {
					NOT = { has_flag = will_join_civil_war }
					pf_from_faction_backer_trigger = yes
				}
				if = { limit = { real_tier = KING }  wealth = 100 ROOT = { wealth = -100 } }
				if = { limit = { real_tier = DUKE }  wealth = 50  ROOT = { wealth = -50 } }
				if = { limit = { real_tier = COUNT } wealth = 25  ROOT = { wealth = -25 } }
				if = { limit = { real_tier = BARON } wealth = 10  ROOT = { wealth = -10 } }
			}
		}
		if = {
			limit = { FROM = { has_flag = demands_revert_succession } }
			primary_title = {
				pf_revert_succession_law_effect = yes
			}
		}
		if = {
			limit = { FROM = { has_flag = demands_lower_feudal_obligations } }
			pf_lower_feudal_obligations_effect = yes
		}
		if = {
			limit = { FROM = { has_flag = demands_lower_tribal_obligations } }
			pf_lower_tribal_obligations_effect = yes
		}
		if = {
			limit = { FROM = { has_flag = demands_lower_city_obligations } }
			pf_lower_city_obligations_effect = yes
		}
		if = {
			limit = { FROM = { has_flag = demands_lower_temple_obligations } }
			pf_lower_temple_obligations_effect = yes
		}

		if = {
			limit = { FROM = { leads_faction = faction_court } }
			custom_tooltip = { text = COURTFACTIONMOODPLUS }
		}
		if = {
			limit = { FROM = { leads_faction = faction_prosperity } }
			custom_tooltip = { text = PROSPERITYFACTIONMOODPLUS }
		}
		if = {
			limit = { FROM = { leads_faction = faction_glory } }
			custom_tooltip = { text = GLORYFACTIONMOODPLUS }
		}
		if = {
			limit = { FROM = { leads_faction = faction_tradition } }
			custom_tooltip = { text = TRADITIONFACTIONMOODPLUS }
		}
		hidden_tooltip = {
			any_vassal = {
				clr_flag = civil_war_faction_leader
				clr_flag = civil_war_faction_member
				if = {
					limit = { pf_from_faction_backer_trigger = no }
					clr_flag = will_join_civil_war
				}
				if = {
					limit = { pf_from_faction_backer_trigger = yes }
					character_event = { id = PlusFaction.401 } #notify
				}
			}
			character_event = { id = PlusFaction.200 days = 1 } #recalculate faction moods
		}
	}
	option = {
		name = EVTDEMANDNO #Refuse the demand
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0.1
				has_regent = yes
			}
			modifier = {
				factor = 1.5
				FROM = {
					OR = {
						has_flag = demands_council_life_terms
						has_flag = demands_revert_succession
					}
				}
			}
			modifier = {
				factor = 1.8
				FROM = {
					OR = {
						has_flag = demands_lower_CA
						has_flag = demands_lower_TO
					}
				}
			}
			modifier = {
				factor = 1.25
				trait = brave
			}
			modifier = {
				factor = 1.25
				trait = proud
			}
			modifier = {
				factor = 1.25
				trait = envious
			}
			modifier = {
				factor = 1.25
				trait = greedy
			}
			modifier = {
				factor = 1.25
				trait = wroth
			}
			modifier = {
				factor = 1.25
				trait = ambitious
			}
			modifier = {
				factor = 5
				FROM = {
					leads_faction = faction_court
					NOT = { faction_power = { faction = faction_court power = 0.75 } }
				}
			}
			modifier = {
				factor = 5
				FROM = {
					leads_faction = faction_prosperity
					NOT = { faction_power = { faction = faction_prosperity power = 0.75 } }
				}
			}
			modifier = {
				factor = 5
				FROM = {
					leads_faction = faction_glory
					NOT = { faction_power = { faction = faction_glory power = 0.75 } }
				}
			}
			modifier = {
				factor = 5
				FROM = {
					leads_faction = faction_tradition
					NOT = { faction_power = { faction = faction_tradition power = 0.75 } }
				}
			}
			modifier = {
				factor = 0.5
				FROM = {
					leads_faction = faction_court
					faction_power = { faction = faction_court power = 1.00 }
				}
			}
			modifier = {
				factor = 0.5
				FROM = {
					leads_faction = faction_prosperity
					faction_power = { faction = faction_prosperity power = 1.00 }
				}
			}
			modifier = {
				factor = 0.5
				FROM = {
					leads_faction = faction_glory
					faction_power = { faction = faction_glory power = 1.00 }
				}
			}
			modifier = {
				factor = 0.5
				FROM = {
					leads_faction = faction_tradition
					faction_power = { faction = faction_tradition power = 1.00 }
				}
			}
			modifier = {
				factor = 0.25
				FROM = {
					leads_faction = faction_court
					faction_power = { faction = faction_court power = 1.99 }
				}
			}
			modifier = {
				factor = 0.25
				FROM = {
					leads_faction = faction_prosperity
					faction_power = { faction = faction_prosperity power = 1.99 }
				}
			}
			modifier = {
				factor = 0.25
				FROM = {
					leads_faction = faction_glory
					faction_power = { faction = faction_glory power = 1.99 }
				}
			}
			modifier = {
				factor = 0.25
				FROM = {
					leads_faction = faction_tradition
					faction_power = { faction = faction_tradition power = 1.99 }
				}
			}
			modifier = {
				factor = 0.1
				FROM = {
					leads_faction = faction_court
					faction_power = { faction = faction_court power = 2.99 }
				}
			}
			modifier = {
				factor = 0.1
				FROM = {
					leads_faction = faction_prosperity
					faction_power = { faction = faction_prosperity power = 2.99 }
				}
			}
			modifier = {
				factor = 0.1
				FROM = {
					leads_faction = faction_glory
					faction_power = { faction = faction_glory power = 2.99 }
				}
			}
			modifier = {
				factor = 0.1
				FROM = {
					leads_faction = faction_tradition
					faction_power = { faction = faction_tradition power = 2.99 }
				}
			}
		}

		log = "[Root.GetBestName] has refused the regular faction demand of [From.GetBestName] -- this should start a civil war."

		#inform faction members of refusal
		hidden_tooltip = {
			any_vassal = {
				limit = { pf_from_faction_backer_trigger = yes }
				letter_event = { id = PlusFaction.402 }
			}
		}

		#start the war
		FROM = { set_flag = original_war_liege }
		if = {
			limit = {
				FROM = { leads_faction = faction_court }
			}
			set_flag = faction_court_war
			FROM = {
				pf_setup_rebel_effect = yes
				hidden_tooltip = {
					any_faction_backer = {
						faction = faction_court
						pf_setup_rebel_effect = yes
					}
				}
				if = {
					limit = { has_flag = demands_lower_CA }
					war = {
						target = ROOT
						casus_belli = emf_faction_overthrow_CA
						faction = faction_court
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = { has_flag = demands_lower_TO }
					war = {
						target = ROOT
						casus_belli = emf_faction_overthrow_TO
						faction = faction_court
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						OR = {
							has_flag = demands_surrender_title
							has_flag = demands_share_wealth
						}
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_overthrow
						faction = faction_court
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						OR = {
							has_flag = demands_lower_feudal_obligations
							has_flag = demands_lower_tribal_obligations
							has_flag = demands_lower_city_obligations
							has_flag = demands_lower_temple_obligations
						}
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_overthrow_obligations
						faction = faction_court
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_aztec_elective } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_aztec_elective
						thirdparty_title = event_target:liege_primary
						faction = faction_court
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_byzantine_elective } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_byzantine_elective
						thirdparty_title = event_target:liege_primary
						faction = faction_court
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_dynastic_elective } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_dynastic_elective
						thirdparty_title = event_target:liege_primary
						faction = faction_court
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_eldership } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_eldership
						thirdparty_title = event_target:liege_primary
						faction = faction_court
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_elective_gavelkind } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_elective_gavelkind
						thirdparty_title = event_target:liege_primary
						faction = faction_court
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_feudal_elective } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_feudal_elective
						thirdparty_title = event_target:liege_primary
						faction = faction_court
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_gavelkind } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_gavelkind
						thirdparty_title = event_target:liege_primary
						faction = faction_court
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_hre_elective } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_hre_elective
						thirdparty_title = event_target:liege_primary
						faction = faction_court
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_mirath } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_mirath
						thirdparty_title = event_target:liege_primary
						faction = faction_court
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_pictish_elective } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_pictish_elective
						thirdparty_title = event_target:liege_primary
						faction = faction_court
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_primogeniture } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_primogeniture
						thirdparty_title = event_target:liege_primary
						faction = faction_court
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_seniority } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_seniority
						thirdparty_title = event_target:liege_primary
						faction = faction_court
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_tanistry } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_tanistry
						thirdparty_title = event_target:liege_primary
						faction = faction_court
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_turkish_succession } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_turkish_succession
						thirdparty_title = event_target:liege_primary
						faction = faction_court
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_ultimogeniture } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_ultimogeniture
						thirdparty_title = event_target:liege_primary
						faction = faction_court
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_agnatic_succession } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_gender_succ_agnatic
						thirdparty_title = event_target:liege_primary
						faction = faction_court
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_cognatic_succession } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_gender_succ_cognatic
						thirdparty_title = event_target:liege_primary
						faction = faction_court
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_true_cognatic_succession } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_gender_succ_true_cognatic
						thirdparty_title = event_target:liege_primary
						faction = faction_court
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_enatic_cognatic_succession } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_gender_succ_enatic_cognatic
						thirdparty_title = event_target:liege_primary
						faction = faction_court
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_enatic_succession } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_gender_succ_enatic
						thirdparty_title = event_target:liege_primary
						faction = faction_court
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROM = { leads_faction = faction_prosperity }
			}
			set_flag = faction_prosperity_war
			FROM = {
				pf_setup_rebel_effect = yes
				hidden_tooltip = {
					any_faction_backer = {
						faction = faction_prosperity
						pf_setup_rebel_effect = yes
					}
				}
				if = {
					limit = { has_flag = demands_lower_CA }
					war = {
						target = ROOT
						casus_belli = emf_faction_overthrow_CA
						faction = faction_prosperity
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = { has_flag = demands_lower_TO }
					war = {
						target = ROOT
						casus_belli = emf_faction_overthrow_TO
						faction = faction_prosperity
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						OR = {
							has_flag = demands_surrender_title
							has_flag = demands_share_wealth
						}
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_overthrow
						faction = faction_prosperity
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						OR = {
							has_flag = demands_lower_feudal_obligations
							has_flag = demands_lower_tribal_obligations
							has_flag = demands_lower_city_obligations
							has_flag = demands_lower_temple_obligations
						}
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_overthrow_obligations
						faction = faction_prosperity
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_aztec_elective } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_aztec_elective
						thirdparty_title = event_target:liege_primary
						faction = faction_prosperity
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_byzantine_elective } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_byzantine_elective
						thirdparty_title = event_target:liege_primary
						faction = faction_prosperity
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_dynastic_elective } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_dynastic_elective
						thirdparty_title = event_target:liege_primary
						faction = faction_prosperity
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_eldership } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_eldership
						thirdparty_title = event_target:liege_primary
						faction = faction_prosperity
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_elective_gavelkind } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_elective_gavelkind
						thirdparty_title = event_target:liege_primary
						faction = faction_prosperity
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_feudal_elective } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_feudal_elective
						thirdparty_title = event_target:liege_primary
						faction = faction_prosperity
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_gavelkind } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_gavelkind
						thirdparty_title = event_target:liege_primary
						faction = faction_prosperity
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_hre_elective } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_hre_elective
						thirdparty_title = event_target:liege_primary
						faction = faction_prosperity
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_mirath } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_mirath
						thirdparty_title = event_target:liege_primary
						faction = faction_prosperity
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_pictish_elective } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_pictish_elective
						thirdparty_title = event_target:liege_primary
						faction = faction_prosperity
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_primogeniture } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_primogeniture
						thirdparty_title = event_target:liege_primary
						faction = faction_prosperity
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_seniority } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_seniority
						thirdparty_title = event_target:liege_primary
						faction = faction_prosperity
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_tanistry } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_tanistry
						thirdparty_title = event_target:liege_primary
						faction = faction_prosperity
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_turkish_succession } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_turkish_succession
						thirdparty_title = event_target:liege_primary
						faction = faction_prosperity
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_ultimogeniture } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_ultimogeniture
						thirdparty_title = event_target:liege_primary
						faction = faction_prosperity
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_agnatic_succession } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_gender_succ_agnatic
						thirdparty_title = event_target:liege_primary
						faction = faction_prosperity
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_cognatic_succession } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_gender_succ_cognatic
						thirdparty_title = event_target:liege_primary
						faction = faction_prosperity
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_true_cognatic_succession } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_gender_succ_true_cognatic
						thirdparty_title = event_target:liege_primary
						faction = faction_prosperity
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_enatic_cognatic_succession } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_gender_succ_enatic_cognatic
						thirdparty_title = event_target:liege_primary
						faction = faction_prosperity
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_enatic_succession } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_gender_succ_enatic
						thirdparty_title = event_target:liege_primary
						faction = faction_prosperity
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROM = { leads_faction = faction_glory }
			}
			set_flag = faction_glory_war
			FROM = {
				pf_setup_rebel_effect = yes
				hidden_tooltip = {
					any_faction_backer = {
						faction = faction_glory
						pf_setup_rebel_effect = yes
					}
				}
				if = {
					limit = { has_flag = demands_lower_CA }
					war = {
						target = ROOT
						casus_belli = emf_faction_overthrow_CA
						faction = faction_glory
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = { has_flag = demands_lower_TO }
					war = {
						target = ROOT
						casus_belli = emf_faction_overthrow_TO
						faction = faction_glory
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						OR = {
							has_flag = demands_surrender_title
							has_flag = demands_share_wealth
						}
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_overthrow
						faction = faction_glory
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						OR = {
							has_flag = demands_lower_feudal_obligations
							has_flag = demands_lower_tribal_obligations
							has_flag = demands_lower_city_obligations
							has_flag = demands_lower_temple_obligations
						}
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_overthrow_obligations
						faction = faction_glory
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_aztec_elective } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_aztec_elective
						thirdparty_title = event_target:liege_primary
						faction = faction_glory
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_byzantine_elective } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_byzantine_elective
						thirdparty_title = event_target:liege_primary
						faction = faction_glory
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_dynastic_elective } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_dynastic_elective
						thirdparty_title = event_target:liege_primary
						faction = faction_glory
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_eldership } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_eldership
						thirdparty_title = event_target:liege_primary
						faction = faction_glory
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_elective_gavelkind } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_elective_gavelkind
						thirdparty_title = event_target:liege_primary
						faction = faction_glory
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_feudal_elective } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_feudal_elective
						thirdparty_title = event_target:liege_primary
						faction = faction_glory
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_gavelkind } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_gavelkind
						thirdparty_title = event_target:liege_primary
						faction = faction_glory
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_hre_elective } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_hre_elective
						thirdparty_title = event_target:liege_primary
						faction = faction_glory
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_mirath } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_mirath
						thirdparty_title = event_target:liege_primary
						faction = faction_glory
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_pictish_elective } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_pictish_elective
						thirdparty_title = event_target:liege_primary
						faction = faction_glory
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_primogeniture } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_primogeniture
						thirdparty_title = event_target:liege_primary
						faction = faction_glory
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_seniority } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_seniority
						thirdparty_title = event_target:liege_primary
						faction = faction_glory
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_tanistry } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_tanistry
						thirdparty_title = event_target:liege_primary
						faction = faction_glory
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_turkish_succession } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_turkish_succession
						thirdparty_title = event_target:liege_primary
						faction = faction_glory
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_ultimogeniture } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_ultimogeniture
						thirdparty_title = event_target:liege_primary
						faction = faction_glory
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_agnatic_succession } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_gender_succ_agnatic
						thirdparty_title = event_target:liege_primary
						faction = faction_glory
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_cognatic_succession } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_gender_succ_cognatic
						thirdparty_title = event_target:liege_primary
						faction = faction_glory
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_true_cognatic_succession } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_gender_succ_true_cognatic
						thirdparty_title = event_target:liege_primary
						faction = faction_glory
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_enatic_cognatic_succession } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_gender_succ_enatic_cognatic
						thirdparty_title = event_target:liege_primary
						faction = faction_glory
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_enatic_succession } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_gender_succ_enatic
						thirdparty_title = event_target:liege_primary
						faction = faction_glory
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
			}
		}
		if = {
			limit = {
				FROM = { leads_faction = faction_tradition }
			}
			set_flag = faction_tradition_war
			FROM = {
				pf_setup_rebel_effect = yes
				hidden_tooltip = {
					any_faction_backer = {
						faction = faction_tradition
						pf_setup_rebel_effect = yes
					}
				}
				if = {
					limit = { has_flag = demands_lower_CA }
					war = {
						target = ROOT
						casus_belli = emf_faction_overthrow_CA
						faction = faction_tradition
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = { has_flag = demands_lower_TO }
					war = {
						target = ROOT
						casus_belli = emf_faction_overthrow_TO
						faction = faction_tradition
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						OR = {
							has_flag = demands_surrender_title
							has_flag = demands_share_wealth
						}
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_overthrow
						faction = faction_tradition
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						OR = {
							has_flag = demands_lower_feudal_obligations
							has_flag = demands_lower_tribal_obligations
							has_flag = demands_lower_city_obligations
							has_flag = demands_lower_temple_obligations
						}
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_overthrow_obligations
						faction = faction_tradition
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_aztec_elective } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_aztec_elective
						thirdparty_title = event_target:liege_primary
						faction = faction_tradition
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_byzantine_elective } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_byzantine_elective
						thirdparty_title = event_target:liege_primary
						faction = faction_tradition
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_dynastic_elective } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_dynastic_elective
						thirdparty_title = event_target:liege_primary
						faction = faction_tradition
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_eldership } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_eldership
						thirdparty_title = event_target:liege_primary
						faction = faction_tradition
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_elective_gavelkind } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_elective_gavelkind
						thirdparty_title = event_target:liege_primary
						faction = faction_tradition
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_feudal_elective } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_feudal_elective
						thirdparty_title = event_target:liege_primary
						faction = faction_tradition
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_gavelkind } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_gavelkind
						thirdparty_title = event_target:liege_primary
						faction = faction_tradition
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_hre_elective } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_hre_elective
						thirdparty_title = event_target:liege_primary
						faction = faction_tradition
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_mirath } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_mirath
						thirdparty_title = event_target:liege_primary
						faction = faction_tradition
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_pictish_elective } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_pictish_elective
						thirdparty_title = event_target:liege_primary
						faction = faction_tradition
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_primogeniture } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_primogeniture
						thirdparty_title = event_target:liege_primary
						faction = faction_tradition
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_seniority } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_seniority
						thirdparty_title = event_target:liege_primary
						faction = faction_tradition
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_tanistry } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_tanistry
						thirdparty_title = event_target:liege_primary
						faction = faction_tradition
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_turkish_succession } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_turkish_succession
						thirdparty_title = event_target:liege_primary
						faction = faction_tradition
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_ultimogeniture } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_succ_ultimogeniture
						thirdparty_title = event_target:liege_primary
						faction = faction_tradition
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_agnatic_succession } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_gender_succ_agnatic
						thirdparty_title = event_target:liege_primary
						faction = faction_tradition
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_cognatic_succession } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_gender_succ_cognatic
						thirdparty_title = event_target:liege_primary
						faction = faction_tradition
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_true_cognatic_succession } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_gender_succ_true_cognatic
						thirdparty_title = event_target:liege_primary
						faction = faction_tradition
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_enatic_cognatic_succession } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_gender_succ_enatic_cognatic
						thirdparty_title = event_target:liege_primary
						faction = faction_tradition
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
				if = {
					limit = {
						has_flag = demands_revert_succession
						ROOT = { primary_title = { has_flag = former_enatic_succession } }
					}
					war = {
						target = ROOT
						casus_belli = emf_faction_gender_succ_enatic
						thirdparty_title = event_target:liege_primary
						faction = faction_tradition
					}
					hidden_tooltip = { ROOT = { character_event = { id = PlusFaction.4000 } } }
					break = yes
				}
			}
		}
	}
}

# PlusFaction.4000 -- completion event for PlusFaction.400's war option
character_event = {
	id = PlusFaction.4000

	is_triggered_only = yes
	hide_window = yes

	immediate = {
		# check for faction members that mysteriously couldn't join war (truce?)
		any_opinion_modifier_target = {
			limit = {
				reverse_has_opinion_modifier = { who = PREV modifier = revolting_against_me }
				in_revolt = no
			}
			log = "ASSERT: just declared civil war but expected rebel is seemingly not in the revolt. PF state dump pre-cleanup:"
			pf_log_state_effect = yes
			pf_teardown_rebel_effect = yes
		}

		# inform remaining vassals
		any_vassal = { letter_event = { id = PlusFaction.403 } }
	}
}

# Faction informed that liege agreed to the demand
character_event = {
	id = PlusFaction.401
	picture = GFX_evt_council
	border = GFX_event_normal_frame_war

	desc = {
		text = EVTDESC_PlusFaction_401A
		trigger = { NOT = { has_flag = will_join_civil_war } }
	}
	desc = {
		text = EVTDESC_PlusFaction_401B
		trigger = { has_flag = will_join_civil_war }
	}

	is_triggered_only = yes

	option = {
		name = EXCELLENT
		if = {
			limit = { has_flag = will_join_civil_war }
			clr_flag = will_join_civil_war
			reverse_opinion = { who = FROMFROM modifier = opinion_grateful months = 60 }
			break = yes
		}
		if = {
			limit = { has_opinion_modifier = { who = FROM modifier = ultimatum_refused } }
			hidden_tooltip = {
				remove_opinion = { who = FROM modifier = ultimatum_refused }
			}
		}
		opinion = { who = FROM modifier = faction_pleased multiplier = 10 years = 10 }
		if = {
			limit = { NOT = { character = FROMFROM } }
			opinion = { who = FROMFROM modifier = faction_pleased multiplier = 4 years = 10 }
		}
		if = {
			limit = { character = FROMFROM }
			if = {
				limit = { FROM = { lower_real_tier_than = KING } }
				prestige = 50
			}
			if = {
				limit = { FROM = { real_tier = KING } }
				prestige = 100
			}
			if = {
				limit = { FROM = { real_tier = EMPEROR } }
				prestige = 250
			}
			hidden_tooltip = {
				character_event = { id = PlusFaction.399 days = 1 } #clear flags
				pf_clear_demands_flags_effect = yes
			}
		}
	}
}

# Faction informed that liege refused the demand
letter_event = {
	id = PlusFaction.402
	desc = EVTDESC_PlusFaction_402
	border = GFX_event_letter_frame_war

	is_triggered_only = yes

	option = {
		name = EVTOPTA_PlusFaction_402
		if = {
			limit = { NOT = { has_flag = will_join_civil_war } }
			opinion = { who = FROM modifier = ultimatum_refused years = 10 }
		}
		hidden_tooltip = {
			if = {
				limit = { has_flag = will_join_civil_war }
				FROM = { letter_event = { id = PlusFaction.405 } } #notify
			}
			if = {
				limit = { character = FROMFROM }
				character_event = { id = PlusFaction.399 days = 1 } #clear flags
			}
		}
	}
}

# Remaining vassals asked to support liege in civil war
letter_event = {
	id = PlusFaction.403
	desc = EVTDESC_PlusFaction_403
	border = GFX_event_letter_frame_war

	is_triggered_only = yes
	only_playable = yes

	trigger = {
		is_landed = yes
		pf_war_trait_trigger = no
	}

	immediate = {
		clr_flag = civil_war_faction_leader
		clr_flag = civil_war_faction_member
		clr_flag = will_join_civil_war
	}

	option = {
		name = EVTOPTA_PlusFaction_403 #I support my liege
		trigger = {
			is_adult = yes
			prisoner = no
			NOR = {
				is_incapable = yes
				AND = {
					FROMFROM = { supported_claimant = { character = ROOT } }
					has_flag = supported_pretender_faction
				}
			}
		}
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0
				OR = {
					is_rival = FROM
					NOT = { opinion = { who = FROM value = -50 } }
					has_truce = FROM
					has_non_aggression_pact_with = FROM
					has_opinion_modifier = { who = FROM modifier = opinion_coerced_into_leaving_faction }
					has_opinion_modifier = { who = FROM modifier = opinion_subjugated }
					has_opinion_modifier = { who = FROM modifier = opinion_subjugated_other_rel }
				}
			}
			modifier = {
				factor = 10
				FROM = { current_heir = { character = ROOT } }
			}
			modifier = {
				factor = 5
				OR = {
					is_allied_with = FROM
					has_non_aggression_pact_with = FROM
					dynasty = FROM
					is_close_relative = FROM
					is_rival = FROMFROM
				}
			}
			modifier = {
				factor = 1.5
				trait = content
			}
			modifier = {
				factor = 3
				opinion = { who = FROM value = 25 }
			}
			modifier = {
				factor = 3
				opinion = { who = FROM value = 50 }
			}
			modifier = {
				factor = 3
				opinion = { who = FROM value = 75 }
			}
		}
		add_trait = pf_loyalist
		hidden_tooltip = {
			liege = {
				opinion = { who = ROOT modifier = pf_loyal_to_me }
				reverse_opinion = { who = ROOT modifier = pf_loyal_toward }
				letter_event = { id = PlusFaction.404 } #notify
			}
		}
	}
	option = {
		name = EVTOPTB_PlusFaction_403 #I intend to stay out of this
		trigger = {
			prisoner = no
			is_incapable = no
		}
		ai_chance = {
			factor = 100
			modifier = {
				factor = 2
				trait = craven
			}
			modifier = {
				factor = 0.5
				trait = brave
			}
			modifier = {
				factor = 3
				NOT = { opinion = { who = FROM value = 0 } }
			}
			modifier = {
				factor = 3
				NOT = { opinion = { who = FROM value = -25 } }
			}
			modifier = {
				factor = 1.25
				opinion = { who = FROMFROM value = 25 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = FROMFROM value = 50 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = FROMFROM value = 75 }
			}
			modifier = {
				factor = 2
				OR = {
					dynasty = FROMFROM
					is_close_relative = FROMFROM
					is_allied_with = FROMFROM
					has_non_aggression_pact_with = FROMFROM
					is_friend = FROMFROM
				}
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = FROMFROM value = 0 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = FROMFROM value = -25 } }
			}
			modifier = {
				factor = 0.5
				NOT = { opinion = { who = FROMFROM value = -50 } }
			}
			modifier = {
				factor = 0.5
				NOT = { opinion = { who = FROMFROM value = -75 } }
			}
		}
		add_trait = pf_neutral
		hidden_tooltip = {
			liege = {
				opinion = { who = ROOT modifier = pf_neutral_to_me }
				reverse_opinion = { who = ROOT modifier = pf_neutral_toward }
			}
		}
	}
	option = {
		name = EVTOPTC_PlusFaction_403 #I am imprisoned
		trigger = {
			prisoner = yes
		}
	}
	option = {
		name = EVTOPTD_PlusFaction_403 #I am NOT up to such a fight...
		trigger = {
			prisoner = no
			is_incapable = yes
		}
		tooltip_info = incapable
	}
}

# Liege informed of vassal's loyalty
letter_event = {
	id = PlusFaction.404
	desc = EVTDESC_PlusFaction_404
	border = GFX_event_letter_frame_war

	is_triggered_only = yes
	ai = no

	trigger = {
		#only significant vassals
		FROM = {
			OR = {
				higher_tier_than = COUNT
				relative_power_to_liege = 0.1
			}
		}
	}

	option = {
		name = EXCELLENT
		tooltip = {
			FROM = { add_trait = pf_loyalist }
		}
	}
}

# Liege informed that vassal is standing with the faction
letter_event = {
	id = PlusFaction.405
	desc = EVTDESC_PlusFaction_405
	border = GFX_event_letter_frame_war

	is_triggered_only = yes
	ai = no

	trigger = {
		#only significant vassals
		FROM = {
			OR = {
				higher_tier_than = COUNT
				relative_power_to_liege = 0.1
			}
		}
	}

	option = {
		name = CURSES
		tooltip = {
			FROM = { add_trait = pf_rebel }
		}
	}
}

# Faction leader starts civil war
letter_event = {
	id = PlusFaction.406
	desc = EVTDESC_PlusFaction_406
	border = GFX_event_letter_frame_war

	is_triggered_only = yes

	immediate = {
		any_vassal = {
			limit = { pf_from_faction_backer_trigger = yes }
			if = {
				limit = { has_flag = will_join_civil_war }
				character_event = { id = PlusFaction.407 }
			}
		}

		#start the war
		FROM = { set_flag = original_war_liege }
		if = {
			limit = {
				FROM = { leads_faction = faction_court }
			}
			hidden_tooltip = {
				set_flag = faction_court_war
				FROM = {
					pf_setup_rebel_effect = yes
					any_faction_backer = {
						faction = faction_court
						pf_setup_rebel_effect = yes
					}
				}
			}
			reverse_war = {
				target = FROM
				casus_belli = emf_faction_overthrow
				faction = faction_court
			}
		}
		if = {
			limit = {
				FROM = { leads_faction = faction_prosperity }
			}
			hidden_tooltip = {
				set_flag = faction_prosperity_war
				FROM = {
					pf_setup_rebel_effect = yes
					any_faction_backer = {
						faction = faction_prosperity
						pf_setup_rebel_effect = yes
					}
				}
			}
			reverse_war = {
				target = FROM
				casus_belli = emf_faction_overthrow
				faction = faction_prosperity
			}
		}
		if = {
			limit = {
				FROM = { leads_faction = faction_glory }
			}
			hidden_tooltip = {
				set_flag = faction_glory_war
				FROM = {
					pf_setup_rebel_effect = yes
					any_faction_backer = {
						faction = faction_glory
						pf_setup_rebel_effect = yes
					}
				}
			}
			reverse_war = {
				target = FROM
				casus_belli = emf_faction_overthrow
				faction = faction_glory
			}
		}
		if = {
			limit = {
				FROM = { leads_faction = faction_tradition }
			}
			hidden_tooltip = {
				set_flag = faction_tradition_war
				FROM = {
					pf_setup_rebel_effect = yes
					any_faction_backer = {
						faction = faction_tradition
						pf_setup_rebel_effect = yes
					}
				}
			}
			reverse_war = {
				target = FROM
				casus_belli = emf_faction_overthrow
				faction = faction_tradition
			}
		}

		any_opinion_modifier_target = {
			limit = {
				reverse_has_opinion_modifier = { who = PREV modifier = revolting_against_me }
				in_revolt = no
			}
			log = "ASSERT: just declared civil war but expected rebel is seemingly not in the revolt. PF state dump pre-cleanup:"
			pf_log_state_effect = yes
			pf_teardown_rebel_effect = yes
		}
	}

	option = {
		name = EVTOPTA_PlusFaction_406
		#inform remaining vassals
		hidden_tooltip = {
			any_vassal = {
				letter_event = { id = PlusFaction.403 }
			}
		}
	}
}

# Bounce event for notification from faction supporters
character_event = {
	id = PlusFaction.407

	hide_window = yes
	is_triggered_only = yes

	immediate = {
		FROM = { letter_event = { id = PlusFaction.405 } } #notify
	}
}


##################################
# FACTION CIVIL WAR EVENTS
##################################

### PICKING SIDES BEFORE THE CIVIL WAR BEGINS

# Vassal invited to join a faction's planned civil war
letter_event = {
	id = PlusFaction.415
	border = GFX_event_letter_frame_war

	desc = {
		text = EVTDESC_PlusFaction_415A
		trigger = { FROM = { has_flag = demands_lower_CA } }
	}
	desc = {
		text = EVTDESC_PlusFaction_415B
		trigger = { FROM = { has_flag = demands_lower_TO } }
	}
	desc = {
		text = EVTDESC_PlusFaction_415E
		trigger = { FROM = { has_flag = demands_surrender_title } }
	}
	desc = {
		text = EVTDESC_PlusFaction_415H
		trigger = { FROM = { has_flag = demands_share_wealth } }
	}
	desc = {
		text = EVTDESC_PlusFaction_415J
		trigger = { FROM = { has_flag = demands_revert_succession } }
	}
	desc = {
		text = EVTDESC_PlusFaction_415K
		trigger = { FROM = { has_flag = demands_council_life_terms } }
	}
	desc = {
		text = EVTDESC_PlusFaction_415L
		trigger = { FROM = { has_flag = demands_lower_feudal_obligations } }
	}
	desc = {
		text = EVTDESC_PlusFaction_415M
		trigger = { FROM = { has_flag = demands_lower_tribal_obligations } }
	}
	desc = {
		text = EVTDESC_PlusFaction_415N
		trigger = { FROM = { has_flag = demands_lower_city_obligations } }
	}
	desc = {
		text = EVTDESC_PlusFaction_415O
		trigger = { FROM = { has_flag = demands_lower_temple_obligations } }
	}
	desc = {
		text = EVTDESC_PlusFaction_415P
		trigger = { FROM = { has_flag = demands_seniority } }
	}
	desc = {
		text = EVTDESC_PlusFaction_415Q
		trigger = { FROM = { has_flag = demands_primogeniture } }
	}
	desc = {
		text = EVTDESC_PlusFaction_415R
		trigger = { FROM = { has_flag = demands_gavelkind } }
	}
	desc = {
		text = EVTDESC_PlusFaction_415S
		trigger = { FROM = { has_flag = demands_feudal_elective } }
	}
	desc = {
		text = EVTDESC_PlusFaction_415T
		trigger = { FROM = { pf_has_demands_trigger = no } }
	}

	is_triggered_only = yes
	only_playable = yes

	trigger = {
		is_landed = yes
		pf_war_trait_trigger = no
	}

	option = {
		name = EVTOPTA_PlusFaction_415 #join the rebellion
		trigger = {
			prisoner = no
			is_incapable = no
			is_adult = yes
			liege = {
				NOR = {
					reverse_has_truce = ROOT
					has_non_aggression_pact_with = ROOT
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_coerced_into_leaving_faction }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated_other_rel }
				}
			}
		}
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0
				liege = { current_heir = { character = ROOT } }
			}
			modifier = {
				factor = 0.5
				liege = {
					OR = {
						is_allied_with = ROOT
						has_non_aggression_pact_with = ROOT
						dynasty = ROOT
						is_close_relative = ROOT
					}
				}
			}
			modifier = {
				factor = 5
				liege = { is_rival = ROOT }
			}
			modifier = {
				factor = 1.5
				trait = ambitious
			}
			modifier = {
				factor = 1.25
				OR = {
					is_allied_with = FROM
					has_non_aggression_pact_with = FROM
					is_close_relative = FROM
				}
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = FROM value = 0 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = FROM value = -25 } }
			}
			modifier = {
				factor = 0.5
				NOT = { opinion = { who = FROM value = -50 } }
			}
			modifier = {
				factor = 0.5
				NOT = { opinion = { who = FROM value = -75 } }
			}
			modifier = {
				factor = 1.25
				opinion = { who = FROM value = 25 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = FROM value = 50 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = FROM value = 75 }
			}
			modifier = {
				factor = 0
				opinion = { who = liege value = 0 }
			}
			modifier = {
				factor = 3
				NOT = { opinion = { who = liege value = -25 } }
			}
			modifier = {
				factor = 3
				NOT = { opinion = { who = liege value = -50 } }
			}
			modifier = {
				factor = 3
				NOT = { opinion = { who = liege value = -75 } }
			}
		}
		set_flag = will_join_civil_war
		if = {
			limit = {
				FROM = {
					has_flag = demands_seniority
					leads_faction = faction_succ_seniority
				}
			}
			join_faction = {
				faction = faction_succ_seniority
				faction_leader = FROM
				ignore_requirements = yes
			}
			break = yes
		}
		if = {
			limit = {
				FROM = {
					has_flag = demands_primogeniture
					leads_faction = faction_succ_primogeniture
				}
			}
			join_faction = {
				faction = faction_succ_primogeniture
				faction_leader = FROM
				ignore_requirements = yes
			}
			break = yes
		}
		if = {
			limit = {
				FROM = {
					has_flag = demands_gavelkind
					leads_faction = faction_succ_gavelkind
				}
			}
			join_faction = {
				faction = faction_succ_gavelkind
				faction_leader = FROM
				ignore_requirements = yes
			}
			break = yes
		}
		if = {
			limit = {
				FROM = {
					has_flag = demands_feudal_elective
					leads_faction = faction_succ_feudal_elective
				}
			}
			join_faction = {
				faction = faction_succ_feudal_elective
				faction_leader = FROM
				ignore_requirements = yes
			}
			break = yes
		}
		if = {
			limit = { FROM = { leads_faction = faction_court } }
			join_faction = {
				faction = faction_court
				faction_leader = FROM
				ignore_requirements = yes
			}
			break = yes
		}
		if = {
			limit = { FROM = { leads_faction = faction_prosperity } }
			join_faction = {
				faction = faction_prosperity
				faction_leader = FROM
				ignore_requirements = yes
			}
			break = yes
		}
		if = {
			limit = { FROM = { leads_faction = faction_glory } }
			join_faction = {
				faction = faction_glory
				faction_leader = FROM
				ignore_requirements = yes
			}
			break = yes
		}
		if = {
			limit = { FROM = { leads_faction = faction_tradition } }
			join_faction = {
				faction = faction_tradition
				faction_leader = FROM
				ignore_requirements = yes
			}
			break = yes
		}
	}
	option = {
		name = EVTOPTB_PlusFaction_415 #refuse
		trigger = {
			prisoner = no
			is_incapable = no
			is_adult = yes
			liege = {
				NOR = {
					reverse_has_truce = ROOT
					has_non_aggression_pact_with = ROOT
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_coerced_into_leaving_faction }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated_other_rel }
				}
			}
			NOT = { # But not an offer that they couldn't refuse
				FROM = { has_character_modifier = emf_faction_rebel_antichrist }
			}
		}
		ai_chance = {
			factor = 100
			modifier = {
				factor = 2
				trait = craven
			}
			modifier = {
				factor = 2
				trait = content
			}
			modifier = {
				factor = 1.25
				trait = humble
			}
		}
		reverse_opinion = { who = FROM modifier = opinion_disappointed years = 5 }
	}
	option = {
		trigger = {
			NAND = {
				prisoner = no
				is_incapable = no
				is_adult = yes
				liege = {
					NOR = {
						reverse_has_truce = ROOT
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_coerced_into_leaving_faction }
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated }
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated_other_rel }
					}
				}
			}
		}
		name = {
			text = EVTOPTC_PlusFaction_415_prisoner #I am imprisoned
			trigger = {
				prisoner = yes
			}
		}
		name = {
			text = EVTOPTC_PlusFaction_415_incapable #I am NOT up to such a fight...
			trigger = {
				prisoner = no
				is_incapable = yes
			}
		}
		name = {
			text = EVTOPTC_PlusFaction_415_child #I am a child
			trigger = {
				prisoner = no
				is_incapable = no
				is_adult = no
			}
		}
		name = {
			text = EVTOPTC_PlusFaction_415_truce #I cannot
			trigger = {
				prisoner = no
				is_incapable = no
				is_adult = yes
				liege = {
					OR = {
						reverse_has_truce = ROOT
						has_non_aggression_pact_with = ROOT
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_coerced_into_leaving_faction }
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated }
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated_other_rel }
					}
				}
			}
		}
	}
}

# Player who refused to fulfill their promise loses prestige
letter_event = {
	id = PlusFaction.416
	desc = EVTDESC_PlusFaction_416
	border = GFX_event_letter_frame_war

	is_triggered_only = yes

	option = {
		name = OK
		clr_flag = civil_war_faction_member
		clr_flag = will_join_civil_war
		reverse_opinion = { who = FROM modifier = opinion_very_disappointed years = 10 }
		prestige = -250
	}
}

# PlusFaction.440 -- daily "jumpstart" decision tick for faction_send_ultimatum and faction_begin_civil_war
character_event = {
	id = PlusFaction.440

	is_triggered_only = yes
	hide_window = yes

	only_playable = yes

	trigger = {
		has_flag = civil_war_faction_leader
		check_variable = { which = "pf_jumpstart_days_left" value = 1 }
	}

	immediate = {
		if = {
			limit = {
				OR = {
					AND = {
						has_flag = demands_seniority
						leads_faction = faction_succ_seniority
						liege = {
							NOT = {
								any_vassal = {
									has_flag = will_join_civil_war
									NOT = { in_faction = faction_succ_seniority }
								}
							}
						}
						faction_power = { faction = faction_succ_seniority power = 0.75 }
					}
					AND = {
						has_flag = demands_primogeniture
						leads_faction = faction_succ_primogeniture
						liege = {
							NOT = {
								any_vassal = {
									has_flag = will_join_civil_war
									NOT = { in_faction = faction_succ_primogeniture }
								}
							}
						}
						faction_power = { faction = faction_succ_primogeniture power = 0.75 }
					}
					AND = {
						has_flag = demands_gavelkind
						leads_faction = faction_succ_gavelkind
						liege = {
							NOT = {
								any_vassal = {
									has_flag = will_join_civil_war
									NOT = { in_faction = faction_succ_gavelkind }
								}
							}
						}
						faction_power = { faction = faction_succ_gavelkind power = 0.75 }
					}
					AND = {
						has_flag = demands_feudal_elective
						leads_faction = faction_succ_feudal_elective
						liege = {
							NOT = {
								any_vassal = {
									has_flag = will_join_civil_war
									NOT = { in_faction = faction_succ_feudal_elective }
								}
							}
						}
						faction_power = { faction = faction_succ_feudal_elective power = 0.75 }
					}
					AND = {
						pf_not_regular_faction_war_trigger = no
						OR = {
							AND = {
								leads_faction = faction_court
								liege = {
									NOT = {
										any_vassal = {
											has_flag = will_join_civil_war
											NOT = { in_faction = faction_court }
										}
									}
								}
								faction_power = { faction = faction_court power = 0.75 }
							}
							AND = {
								leads_faction = faction_prosperity
								liege = {
									NOT = {
										any_vassal = {
											has_flag = will_join_civil_war
											NOT = { in_faction = faction_prosperity }
										}
									}
								}
								faction_power = { faction = faction_prosperity power = 0.75 }
							}
							AND = {
								leads_faction = faction_glory
								liege = {
									NOT = {
										any_vassal = {
											has_flag = will_join_civil_war
											NOT = { in_faction = faction_glory }
										}
									}
								}
								faction_power = { faction = faction_glory power = 0.75 }
							}
							AND = {
								leads_faction = faction_tradition
								liege = {
									NOT = {
										any_vassal = {
											has_flag = will_join_civil_war
											NOT = { in_faction = faction_tradition }
										}
									}
								}
								faction_power = { faction = faction_tradition power = 0.75 }
							}
						}
					}
				}
			}
			if = {
				limit = {
					is_decision_potential = faction_send_ultimatum
					is_decision_allowed = faction_send_ultimatum
				}
				pf_send_ultimatum_effect = yes
				break = yes
			}
			if = {
				limit = {
					is_decision_potential = faction_begin_civil_war
					is_decision_allowed = faction_begin_civil_war
				}
				pf_begin_civil_war_effect = yes
				break = yes
			}
		}

		change_variable = { which = "pf_jumpstart_days_left" value = -1 }
		repeat_event = { id = PlusFaction.440 days = 1 }
	}
}

### THE CIVIL WAR ENDS

# The victorious side rewards their supporters & punishes opponents
character_event = {
	id = PlusFaction.450
	desc = EVTDESC_PlusFaction_450A
	picture = GFX_evt_council
	border = GFX_event_normal_frame_war

	is_triggered_only = yes
	hide_from = yes

	trigger = {
		has_any_opinion_modifier = opinion_civil_war_supporter
	}

	immediate = {
		# Release all supporters who are prisoners
		any_opinion_modifier_target = {
			limit = {
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_civil_war_supporter }
				prisoner = yes
				host = {
					OR = {
						character = ROOT
						is_liege_or_above = ROOT
					}
				}
			}
			prisoner = no
		}
	}

	option = {
		name = EVTOPTA_PlusFaction_450 #They will be granted tax privileges
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.5
				trait = greedy
			}
			modifier = {
				factor = 2.0
				trait = charitable
			}
		}

		# Tax penalty applied to the ruler's provinces
		any_demesne_title = {
			limit = { tier = COUNT }
			hidden_tooltip = {
				location = {
					remove_province_modifier = tax_privileges
					remove_province_modifier = tax_reduction
				}
			}
			location = {
				add_province_modifier = {
					name = tax_reduction
					duration = 3650
				}
			}
		}

		# Tax penalty applied to any vassals who opposed ruler or who chose to be neutral
		hidden_tooltip = {
			any_vassal = {
				limit = {
					num_of_count_titles = 1
					OR = {
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_civil_war_loser }
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_civil_war_neutral }
					}
				}
				character_event = { id = PlusFaction.451 } #notify
			}
		}

		# Tax reward applied to any vassals who supported ruler
		any_vassal = {
			limit = {
				num_of_count_titles = 1
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_civil_war_supporter }
			}
			custom_tooltip = {
				text = CUSTOMTOOLTIP39
				hidden_tooltip = {
					if = {
						limit = { NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_very_grateful } } }
						opinion = { who = ROOT modifier = opinion_pleased months = 120 }
					}
					character_event = { id = PlusFaction.452 } #notify
				}
			}
		}
	}
	option = {
		name = EVTOPTB_PlusFaction_450 #Glory and Honor
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.5
				trait = content
			}
			modifier = {
				factor = 2.0
				trait = ambitious
			}
			modifier = {
				factor = 0.5
				trait = proud
			}
			modifier = {
				factor = 2.0
				trait = humble
			}
			modifier = {
				factor = 0
				OR = {
					AND = {
						tier = DUKE
						NOT = { prestige = 500 }
					}
					AND = {
						tier = KING
						NOT = { prestige = 750 }
					}
					AND = {
						tier = EMPEROR
						NOT = { prestige = 1000 }
					}
				}
			}
		}
		# Ruler takes a prestige penalty
		if = {
			limit = { lower_real_tier_than = DUKE }
			prestige = -250
		}
		if = {
			limit = { real_tier = DUKE }
			prestige = -500
		}
		if = {
			limit = { real_tier = KING }
			prestige = -750
		}
		if = {
			limit = { real_tier = EMPEROR }
			prestige = -1000
		}

		# All opponents receive a prestige penalty
		hidden_tooltip = {
			any_vassal = {
				limit = {
					OR = {
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_civil_war_loser }
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_civil_war_neutral }
					}
				}
				character_event = { id = PlusFaction.453 } #notify
			}
		}

		# All supporters receive a prestige bonus
		any_vassal = {
			limit = {
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_civil_war_supporter }
			}
			custom_tooltip = {
				text = CUSTOMTOOLTIP40
				hidden_tooltip = {
					if = {
						limit = { NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_very_grateful } } }
						opinion = { who = ROOT modifier = opinion_pleased months = 120 }
					}
					character_event = { id = PlusFaction.454 } #notify
				}
			}
		}
	}
	option = {
		name = EVTOPTC_PlusFaction_450 #Nothing
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0.1
				OR = {
					trait = humble
					trait = content
					trait = charitable
					trait = just
				}
			}
			modifier = {
				factor = 1.5
				trait = arbitrary
			}
			modifier = {
				factor = 1.5
				trait = wroth
			}
			modifier = {
				factor = 2.0
				trait = cruel
			}
			modifier = {
				factor = 5.0
				trait = lunatic
			}
			modifier = {
				factor = 5.0
				trait = possessed
			}
		}
		custom_tooltip = {
			text = CUSTOMTOOLTIP27
			hidden_tooltip = {
				any_vassal = {
					limit = {
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_civil_war_supporter }
					}
					if = {
						limit = { NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_very_grateful } } }
						remove_opinion = { who = ROOT modifier = opinion_very_grateful }
					}
					character_event = { id = PlusFaction.455 } #notify
				}
			}
		}
	}
}

# Notify vassal of tax reduction penalty
character_event = {
	id = PlusFaction.451
	picture = GFX_evt_council
	border = GFX_event_normal_frame_war

	desc = {
		text = EVTDESC_PlusFaction_451A
		trigger = { reverse_has_opinion_modifier = { who = FROM modifier = opinion_civil_war_loser } }
	}
	desc = {
		text = EVTDESC_PlusFaction_451B
		trigger = { NOT = { reverse_has_opinion_modifier = { who = FROM modifier = opinion_civil_war_loser } } }
	}

	is_triggered_only = yes

	trigger = {
		independent = no
	}

	immediate = {
		any_demesne_title = {
			limit = { tier = COUNT }
			location = {
				remove_province_modifier = tax_privileges
				remove_province_modifier = tax_reduction
			}
		}
	}

	option = {
		name = CURSES
		if = {
			limit = { reverse_has_opinion_modifier = { who = FROM modifier = opinion_civil_war_loser } }
			any_demesne_title = {
				limit = { tier = COUNT }
				location = {
					add_province_modifier = {
						name = "tax_reduction"
						duration = 3650
					}
				}
			}
		}
		if = {
			limit = { NOT = { reverse_has_opinion_modifier = { who = FROM modifier = opinion_civil_war_loser } } }
			any_demesne_title = {
				limit = { tier = COUNT }
				location = {
					add_province_modifier = {
						name = "tax_reduction"
						duration = 1825
					}
				}
			}
		}
	}
}

# Notify loyal vassal of tax privilege reward
character_event = {
	id = PlusFaction.452
	desc = EVTDESC_PlusFaction_452
	picture = GFX_evt_council
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	trigger = {
		independent = no
	}

	immediate = {
		any_demesne_title = {
			limit = { tier = COUNT }
			location = {
				remove_province_modifier = tax_privileges
				remove_province_modifier = tax_reduction
			}
		}
	}

	option = {
		name = EXCELLENT
		any_demesne_title = {
			limit = { tier = COUNT }
			location = {
				add_province_modifier = {
					name = tax_privileges
					duration = 3650
				}
			}
		}
	}
}

# Notify vassal of prestige penalty
character_event = {
	id = PlusFaction.453
	picture = GFX_evt_council
	border = GFX_event_normal_frame_war

	desc = {
		text = EVTDESC_PlusFaction_453A
		trigger = { reverse_has_opinion_modifier = { who = FROM modifier = opinion_civil_war_loser } }
	}
	desc = {
		text = EVTDESC_PlusFaction_453B
		trigger = { NOT = { reverse_has_opinion_modifier = { who = FROM modifier = opinion_civil_war_loser } } }
	}

	is_triggered_only = yes

	trigger = {
		independent = no
	}

	option = {
		name = CURSES
		if = {
			limit = { reverse_has_opinion_modifier = { who = FROM modifier = opinion_civil_war_loser } }
			if = {
				limit = { real_tier = BARON }
				prestige = -100
			}
			if = {
				limit = { real_tier = COUNT }
				prestige = -250
			}
			if = {
				limit = { real_tier = DUKE }
				prestige = -500
			}
			if = {
				limit = { real_tier = KING }
				prestige = -750
			}
		}
		if = {
			limit = { NOT = { reverse_has_opinion_modifier = { who = FROM modifier = opinion_civil_war_loser } } }
			if = {
				limit = { real_tier = BARON }
				prestige = -50
			}
			if = {
				limit = { real_tier = COUNT }
				prestige = -100
			}
			if = {
				limit = { real_tier = DUKE }
				prestige = -250
			}
			if = {
				limit = { real_tier = KING }
				prestige = -400
			}
		}
	}
}

# Notify loyal vassal of prestige reward
character_event = {
	id = PlusFaction.454
	desc = EVTDESC_PlusFaction_454
	picture = GFX_evt_council
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	trigger = {
		independent = no
	}

	option = {
		name = EXCELLENT
		if = {
			limit = { real_tier = BARON }
			prestige = 100
		}
		if = {
			limit = { real_tier = COUNT }
			prestige = 250
		}
		if = {
			limit = { real_tier = DUKE }
			prestige = 500
		}
		if = {
			limit = { real_tier = KING }
			prestige = 750
		}
	}
}

# Notify loyal vassal that there will be no reward
character_event = {
	id = PlusFaction.455
	desc = EVTDESC_PlusFaction_455
	picture = GFX_evt_council
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	trigger = {
		independent = no
	}

	option = {
		name = EVTOPTA_PlusFaction_455 #Treachery!
		opinion = {
			who = FROM
			modifier = opinion_upset
			months = 120
			multiplier = 2
		}
	}
}


### WAR MAINTENANCE EVENTS

# will_join_civil_war flag removal
character_event = {
	id = PlusFaction.460

	hide_window = yes
	has_flag = will_join_civil_war

	trigger = {
		OR = {
			pf_pending_civil_war_trigger = no
			pf_war_trait_trigger = yes
			had_flag = { flag = will_join_civil_war days = 60 }
			is_ruler = no
			independent = yes
			is_incapable = yes
		}
	}

	mean_time_to_happen = {
		days = 1
	}

	immediate = {
		clr_flag = will_join_civil_war
	}
}

# civil_war_faction_leader flag removal
character_event = {
	id = PlusFaction.461

	hide_window = yes
	has_flag = civil_war_faction_leader

	trigger = {
		OR = {
			NOR = {
				AND = {
					pf_leader_trigger = yes
					pf_not_regular_faction_war_trigger = no
				}
				AND = {
					leads_faction = faction_succ_seniority
					has_flag = demands_seniority
				}
				AND = {
					leads_faction = faction_succ_primogeniture
					has_flag = demands_primogeniture
				}
				AND = {
					leads_faction = faction_succ_gavelkind
					has_flag = demands_gavelkind
				}
				AND = {
					leads_faction = faction_succ_feudal_elective
					has_flag = demands_feudal_elective
				}
#				AND = {
#					leads_faction = faction_pretender
#					has_flag = preparing_claimant_faction_war
#				}
			}
			had_flag = { flag = civil_war_faction_leader days = 60 }
		}
	}

	mean_time_to_happen = {
		days = 1
	}

	immediate = {
		clr_flag = civil_war_faction_leader
	}
}

# civil_war_faction_member flag removal
character_event = {
	id = PlusFaction.462

	hide_window = yes
	has_flag = civil_war_faction_member

	trigger = {
		OR = {
			pf_pending_civil_war_trigger = no
			pf_war_trait_trigger = yes
			had_flag = { flag = civil_war_faction_member days = 60 }
			is_ruler = no
			independent = yes
			is_incapable = yes
		}
	}

	mean_time_to_happen = {
		days = 1
	}

	immediate = {
		clr_flag = civil_war_faction_member
	}
}

## preparing_claimant_faction_war flag removal
#character_event = {
#	id = PlusFaction.463
#
#	hide_window = yes
#	has_flag = preparing_claimant_faction_war
#
#	trigger = {
#		OR = {
#			NOT = { leads_faction = faction_pretender }
#			NOT = { has_flag = civil_war_faction_leader }
#			independent = yes
#			liege = { pf_war_flag_trigger = yes }
#		}
#	}
#
#	mean_time_to_happen = {
#		days = 1
#	}
#
#	immediate = {
#		clr_flag = preparing_claimant_faction_war
#	}
#}
#
## preparing_religious_faction_war flag removal
#character_event = {
#	id = PlusFaction.464
#
#	hide_window = yes
#	has_flag = preparing_religious_faction_war
#
#	trigger = {
#		OR = {
#			NOT = { leads_faction = faction_religious }
#			NOT = { has_flag = civil_war_faction_leader }
#			independent = yes
#			liege = { pf_war_flag_trigger = yes }
#		}
#	}
#
#	mean_time_to_happen = {
#		days = 1
#	}
#
#	immediate = {
#		clr_flag = preparing_religious_faction_war
#	}
#}


### SUCCESSION FACTIONS

# Ultimatum made to liege
letter_event = {
	id = PlusFaction.470

	desc = {
		text = EVTDESC_PlusFaction_470_seniority
		trigger = { FROM = { has_flag = demands_seniority } }
	}
	desc = {
		text = EVTDESC_PlusFaction_470_primogeniture
		trigger = { FROM = { has_flag = demands_primogeniture } }
	}
	desc = {
		text = EVTDESC_PlusFaction_470_gavelkind
		trigger = { FROM = { has_flag = demands_gavelkind } }
	}
	desc = {
		text = EVTDESC_PlusFaction_470_feudal_elective
		trigger = { FROM = { has_flag = demands_feudal_elective } }
	}

	is_triggered_only = yes

	immediate = {
		FROM = {
			if = {
				limit = { has_flag = demands_seniority }
				faction_succ_seniority = { set_flag = succession_title }
			}
			if = {
				limit = { has_flag = demands_primogeniture }
				faction_succ_primogeniture = { set_flag = succession_title }
			}
			if = {
				limit = { has_flag = demands_gavelkind }
				faction_succ_gavelkind = { set_flag = succession_title }
			}
			if = {
				limit = { has_flag = demands_feudal_elective }
				faction_succ_feudal_elective = { set_flag = succession_title }
			}
		}
		any_demesne_title = {
			limit = { has_flag = succession_title }
			clr_flag = succession_title
			save_event_target_as = succession_title
		}
	}

	option = {
		name = EVTOPTA8000 #Accept
		ai_chance = {
			factor = 20
			modifier = {
				factor = 0
				FROM = { has_flag = demands_seniority }
				NOT = { FROM = { faction_power = { faction = faction_succ_seniority power = 0.5 } } }
			}
			modifier = {
				factor = 0
				FROM = { has_flag = demands_primogeniture }
				NOT = { FROM = { faction_power = { faction = faction_succ_primogeniture power = 0.5 } } }
			}
			modifier = {
				factor = 0
				FROM = { has_flag = demands_gavelkind }
				NOT = { FROM = { faction_power = { faction = faction_succ_gavelkind power = 0.5 } } }
			}
			modifier = {
				factor = 0
				FROM = { has_flag = demands_feudal_elective }
				NOT = { FROM = { faction_power = { faction = faction_succ_feudal_elective power = 0.5 } } }
			}
			modifier = {
				factor = 1.25
				is_weak_trigger = yes
			}
			modifier = {
				factor = 1.25
				trait = craven
			}
			modifier = {
				factor = 1.25
				trait = humble
			}
			modifier = {
				factor = 1.25
				trait = kind
			}
			modifier = {
				factor = 1.25
				trait = charitable
			}
			modifier = {
				factor = 1.25
				trait = patient
			}
			modifier = {
				factor = 1.25
				trait = content
			}
		}

		hidden_tooltip = {
			FROM = {
				if = {
					limit = { has_flag = demands_seniority }
					hidden_tooltip = {
						log = "INFO: PlusFaction.470: [Root.GetTitledName] ([Root.GetID]/[Root.PrimaryTitle.GetID]) has caved to the Seniority Succession in [succession_title.GetBaseName] ([succession_title.GetID]) faction demand of [This.GetTitledName] ([This.GetID]/[This.PrimaryTitle.GetID])."
					}
					ROOT = {
						any_vassal = {
							limit = { NOT = { in_faction = faction_succ_seniority } }
							character_event = { id = PlusFaction.473 }
						}
					}
					letter_event = { id = PlusFaction.471 }
					any_faction_backer = {
						faction = faction_succ_seniority
						letter_event = { id = PlusFaction.472 }
					}
				}
				if = {
					limit = { has_flag = demands_primogeniture }
					hidden_tooltip = {
						log = "INFO: PlusFaction.470: [Root.GetTitledName] ([Root.GetID]/[Root.PrimaryTitle.GetID]) has caved to the Primogeniture Succession in [succession_title.GetBaseName] ([succession_title.GetID]) faction demand of [This.GetTitledName] ([This.GetID]/[This.PrimaryTitle.GetID])."
					}
					ROOT = {
						any_vassal = {
							limit = { NOT = { in_faction = faction_succ_primogeniture } }
							character_event = { id = PlusFaction.473 }
						}
					}
					letter_event = { id = PlusFaction.471 }
					any_faction_backer = {
						faction = faction_succ_primogeniture
						letter_event = { id = PlusFaction.472 }
					}
				}
				if = {
					limit = { has_flag = demands_gavelkind }
					hidden_tooltip = {
						log = "INFO: PlusFaction.470: [Root.GetTitledName] ([Root.GetID]/[Root.PrimaryTitle.GetID]) has caved to the Gavelind Succession in [succession_title.GetBaseName] ([succession_title.GetID]) faction demand of [This.GetTitledName] ([This.GetID]/[This.PrimaryTitle.GetID])."
					}
					ROOT = {
						any_vassal = {
							limit = { NOT = { in_faction = faction_succ_gavelkind } }
							character_event = { id = PlusFaction.473 }
						}
					}
					letter_event = { id = PlusFaction.471 }
					any_faction_backer = {
						faction = faction_succ_gavelkind
						letter_event = { id = PlusFaction.472 }
					}
				}
				if = {
					limit = { has_flag = demands_feudal_elective }
					hidden_tooltip = {
						log = "INFO: PlusFaction.470: [Root.GetTitledName] ([Root.GetID]/[Root.PrimaryTitle.GetID]) has caved to the Feudal Elective Succession in [succession_title.GetBaseName] ([succession_title.GetID]) faction demand of [This.GetTitledName] ([This.GetID]/[This.PrimaryTitle.GetID])."
					}
					ROOT = {
						any_vassal = {
							limit = { NOT = { in_faction = faction_succ_feudal_elective } }
							character_event = { id = PlusFaction.473 }
						}
					}
					letter_event = { id = PlusFaction.471 }
					any_faction_backer = {
						faction = faction_succ_feudal_elective
						letter_event = { id = PlusFaction.472 }
					}
				}
			}
		}
		FROM = {
			if = {
				limit = { has_flag = demands_seniority }
				pf_clear_demands_flags_effect = yes
				faction_succ_seniority = { # The target (title) of the faction
					add_law_w_cooldown = succ_seniority
				}
			}
			if = {
				limit = { has_flag = demands_primogeniture }
				pf_clear_demands_flags_effect = yes
				faction_succ_primogeniture = { # The target (title) of the faction
					add_law_w_cooldown = succ_primogeniture
				}
			}
			if = {
				limit = { has_flag = demands_gavelkind }
				pf_clear_demands_flags_effect = yes
				faction_succ_gavelkind = { # The target (title) of the faction
					add_law_w_cooldown = succ_gavelkind
				}
			}
			if = {
				limit = { has_flag = demands_feudal_elective }
				pf_clear_demands_flags_effect = yes
				faction_succ_feudal_elective = { # The target (title) of the faction
					add_law_w_cooldown = succ_feudal_elective
				}
			}
		}
	}
	option = {
		name = EVTOPTB8005 #Refuse
		ai_chance = {
			factor = 80
			modifier = {
				factor = 1.25
				is_strong_trigger = yes
			}
			modifier = {
				factor = 1.25
				trait = brave
			}
			modifier = {
				factor = 1.25
				trait = proud
			}
			modifier = {
				factor = 1.25
				trait = envious
			}
			modifier = {
				factor = 1.25
				trait = greedy
			}
			modifier = {
				factor = 1.25
				trait = wroth
			}
			modifier = {
				factor = 1.25
				trait = ambitious
			}
			modifier = {
				factor = 0.75
				FROM = { has_flag = demands_seniority }
				FROM = { faction_power = { faction = faction_succ_seniority power = 1.0 } }
			}
			modifier = {
				factor = 0.5
				FROM = { has_flag = demands_seniority }
				FROM = { faction_power = { faction = faction_succ_seniority power = 1.5 } }
			}
			modifier = {
				factor = 0.5
				FROM = { has_flag = demands_seniority }
				FROM = { faction_power = { faction = faction_succ_seniority power = 2.0 } }
			}
			modifier = {
				factor = 0.5
				FROM = { has_flag = demands_seniority }
				FROM = { faction_power = { faction = faction_succ_seniority power = 3.0 } }
			}
			modifier = {
				factor = 0.5
				FROM = { has_flag = demands_seniority }
				FROM = { faction_power = { faction = faction_succ_seniority power = 4.0 } }
			}
			modifier = {
				factor = 0.75
				FROM = { has_flag = demands_primogeniture }
				FROM = { faction_power = { faction = faction_succ_primogeniture power = 1.0 } }
			}
			modifier = {
				factor = 0.5
				FROM = { has_flag = demands_primogeniture }
				FROM = { faction_power = { faction = faction_succ_primogeniture power = 1.5 } }
			}
			modifier = {
				factor = 0.5
				FROM = { has_flag = demands_primogeniture }
				FROM = { faction_power = { faction = faction_succ_primogeniture power = 2.0 } }
			}
			modifier = {
				factor = 0.5
				FROM = { has_flag = demands_primogeniture }
				FROM = { faction_power = { faction = faction_succ_primogeniture power = 3.0 } }
			}
			modifier = {
				factor = 0.5
				FROM = { has_flag = demands_primogeniture }
				FROM = { faction_power = { faction = faction_succ_primogeniture power = 4.0 } }
			}
			modifier = {
				factor = 0.75
				FROM = { has_flag = demands_gavelkind }
				FROM = { faction_power = { faction = faction_succ_gavelkind power = 1.0 } }
			}
			modifier = {
				factor = 0.5
				FROM = { has_flag = demands_gavelkind }
				FROM = { faction_power = { faction = faction_succ_gavelkind power = 1.5 } }
			}
			modifier = {
				factor = 0.5
				FROM = { has_flag = demands_gavelkind }
				FROM = { faction_power = { faction = faction_succ_gavelkind power = 2.0 } }
			}
			modifier = {
				factor = 0.5
				FROM = { has_flag = demands_gavelkind }
				FROM = { faction_power = { faction = faction_succ_gavelkind power = 3.0 } }
			}
			modifier = {
				factor = 0.5
				FROM = { has_flag = demands_gavelkind }
				FROM = { faction_power = { faction = faction_succ_gavelkind power = 4.0 } }
			}
			modifier = {
				factor = 0.75
				FROM = { has_flag = demands_feudal_elective }
				FROM = { faction_power = { faction = faction_succ_feudal_elective power = 1.0 } }
			}
			modifier = {
				factor = 0.5
				FROM = { has_flag = demands_feudal_elective }
				FROM = { faction_power = { faction = faction_succ_feudal_elective power = 1.5 } }
			}
			modifier = {
				factor = 0.5
				FROM = { has_flag = demands_feudal_elective }
				FROM = { faction_power = { faction = faction_succ_feudal_elective power = 2.0 } }
			}
			modifier = {
				factor = 0.5
				FROM = { has_flag = demands_feudal_elective }
				FROM = { faction_power = { faction = faction_succ_feudal_elective power = 3.0 } }
			}
			modifier = {
				factor = 0.5
				FROM = { has_flag = demands_feudal_elective }
				FROM = { faction_power = { faction = faction_succ_feudal_elective power = 4.0 } }
			}
		}

		FROM = {
			if = {
				limit = { has_flag = demands_seniority }
				hidden_tooltip = {
					log = "INFO: PlusFaction.470: [Root.GetTitledName] ([Root.GetID]/[Root.PrimaryTitle.GetID]) has refused the Seniority Succession in [succession_title.GetBaseName] ([succession_title.GetID]) faction demand of [This.GetTitledName] ([This.GetID]/[This.PrimaryTitle.GetID]) -- this should start a war."
				}
				tooltip = { any_faction_backer = { faction = faction_succ_seniority } }
			}
			if = {
				limit = { has_flag = demands_primogeniture }
				hidden_tooltip = {
					log = "INFO: PlusFaction.470: [Root.GetTitledName] ([Root.GetID]/[Root.PrimaryTitle.GetID]) has refused the Primogeniture Succession in [succession_title.GetBaseName] ([succession_title.GetID]) faction demand of [This.GetTitledName] ([This.GetID]/[This.PrimaryTitle.GetID]) -- this should start a war."
				}
				tooltip = { any_faction_backer = { faction = faction_succ_primogeniture } }
			}
			if = {
				limit = { has_flag = demands_gavelkind }
				hidden_tooltip = {
					log = "INFO: PlusFaction.470: [Root.GetTitledName] ([Root.GetID]/[Root.PrimaryTitle.GetID]) has refused the Gavelkind Succession in [succession_title.GetBaseName] ([succession_title.GetID]) faction demand of [This.GetTitledName] ([This.GetID]/[This.PrimaryTitle.GetID]) -- this should start a war."
				}
				tooltip = { any_faction_backer = { faction = faction_succ_gavelkind } }
			}
			if = {
				limit = { has_flag = demands_feudal_elective }
				hidden_tooltip = {
					log = "INFO: PlusFaction.470: [Root.GetTitledName] ([Root.GetID]/[Root.PrimaryTitle.GetID]) has refused the Feudal Elective Succession in [succession_title.GetBaseName] ([succession_title.GetID]) faction demand of [This.GetTitledName] ([This.GetID]/[This.PrimaryTitle.GetID]) -- this should start a war."
				}
				tooltip = { any_faction_backer = { faction = faction_succ_feudal_elective } }
			}
		}

		#inform faction members of refusal
		hidden_tooltip = {
			any_vassal = {
				limit = {
					OR = {
						AND = {
							FROM = { leads_faction = faction_succ_seniority }
							in_faction = faction_succ_seniority
						}
						AND = {
							FROM = { leads_faction = faction_succ_primogeniture }
							in_faction = faction_succ_primogeniture
						}
						AND = {
							FROM = { leads_faction = faction_succ_gavelkind }
							in_faction = faction_succ_gavelkind
						}
						AND = {
							FROM = { leads_faction = faction_succ_feudal_elective }
							in_faction = faction_succ_feudal_elective
						}
					}
				}
				letter_event = { id = PlusFaction.474 }
			}
		}

		set_flag = faction_succession_war
		FROM = { set_flag = original_war_liege }

		#start the war
		if = {
			limit = { FROM = { has_flag = demands_seniority } }
			hidden_tooltip = {
				FROM = {
					pf_setup_rebel_effect = yes
					any_faction_backer = {
						faction = faction_succ_seniority
						pf_setup_rebel_effect = yes
					}
				}
			}
			reverse_war = {
				target = FROM
				casus_belli = emf_faction_succ_seniority
				thirdparty_title = event_target:succession_title
				faction = faction_succ_seniority
			}
		}
		if = {
			limit = { FROM = { has_flag = demands_primogeniture } }
			hidden_tooltip = {
				FROM = {
					pf_setup_rebel_effect = yes
					any_faction_backer = {
						faction = faction_succ_primogeniture
						pf_setup_rebel_effect = yes
					}
				}
			}
			reverse_war = {
				target = FROM
				casus_belli = emf_faction_succ_primogeniture
				thirdparty_title = event_target:succession_title
				faction = faction_succ_primogeniture
			}
		}
		if = {
			limit = { FROM = { has_flag = demands_gavelkind } }
			hidden_tooltip = {
				FROM = {
					pf_setup_rebel_effect = yes
					any_faction_backer = {
						faction = faction_succ_gavelkind
						pf_setup_rebel_effect = yes
					}
				}
			}
			reverse_war = {
				target = FROM
				casus_belli = emf_faction_succ_gavelkind
				thirdparty_title = event_target:succession_title
				faction = faction_succ_gavelkind
			}
		}
		if = {
			limit = { FROM = { has_flag = demands_feudal_elective } }
			hidden_tooltip = {
				FROM = {
					pf_setup_rebel_effect = yes
					any_faction_backer = {
						faction = faction_succ_feudal_elective
						pf_setup_rebel_effect = yes
					}
				}
			}
			reverse_war = {
				target = FROM
				casus_belli = emf_faction_succ_feudal_elective
				thirdparty_title = event_target:succession_title
				faction = faction_succ_feudal_elective
			}
		}

		any_opinion_modifier_target = {
			limit = {
				reverse_has_opinion_modifier = { who = PREV modifier = revolting_against_me }
				in_revolt = no
			}
			log = "ASSERT: just declared civil war but expected rebel is seemingly not in the revolt. PF state dump pre-cleanup:"
			pf_log_state_effect = yes
			pf_teardown_rebel_effect = yes
		}

		#inform remaining vassals
		hidden_tooltip = {
			any_vassal = {
				letter_event = { id = PlusFaction.403 }
			}
		}
	}
}

# Demand accepted - Inform faction leader
letter_event = {
	id = PlusFaction.471
	desc = EVTDESC_PlusFaction_471

	is_triggered_only = yes

	option = {
		name = EXCELLENT
		clr_flag = civil_war_faction_leader
	}
}

# Demand accepted - Inform faction backer
letter_event = {
	id = PlusFaction.472
	desc = EVTDESC_PlusFaction_472

	show_from_from = yes

	is_triggered_only = yes

	option = {
		name = GOOD
		clr_flag = civil_war_faction_member
		clr_flag = will_join_civil_war
		reverse_opinion = {
			modifier = opinion_grateful
			who = FROMFROM
			years = 10
		}
	}
}

# Demand accepted - Inform other vassals
character_event = {
	id = PlusFaction.473
	desc = EVTDESC_PlusFaction_473
	picture = GFX_evt_council
	border = GFX_event_normal_frame_intrigue

	show_from_from = yes

	is_triggered_only = yes

	option = {
		name = I_SEE
		clr_flag = civil_war_faction_member
		clr_flag = will_join_civil_war
	}
}

# Demand rejected
letter_event = {
	id = PlusFaction.474
	desc = EVTDESC_PlusFaction_474

	is_triggered_only = yes

	option = {
		name = EVTOPTA8100 #Then war it is!
		clr_flag = civil_war_faction_leader
		clr_flag = civil_war_faction_member
		clr_flag = will_join_civil_war
	}
}

