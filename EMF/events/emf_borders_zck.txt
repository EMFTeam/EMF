# -*- ck2 -*-
# Generated from ZCK source code; compiler version: v0.0-10

namespace = emf_borders
character_event = {
	id = emf_borders.0
	hide_window = yes
	only_playable = yes
	is_patrician = no
	war = no
	ai = yes
	trigger = {
		controls_religion = no
		holy_order = no
		is_merchant_republic = no
		OR = {
			any_demesne_title = {
				tier = baron
				dejure_liege_title = {
					not = { holder = ROOT }
				}
			}
			any_vassal = {
				tier = baron
				capital_holding = {
					dejure_liege_title = {
						not = { holder = ROOT }
					}
				}
			}
		}
	}
	immediate = {
		any_demesne_title = {
			limit = {
				tier = baron
				dejure_liege_title = {
					not = { holder = ROOT }
				}
			}
			dejure_liege_title = {
				owner = {
					grant_title_no_opinion = PREVPREV
				}
			}
		}
		any_vassal = {
			limit = {
				tier = baron
				capital_holding = {
					dejure_liege_title = {
						not = { holder = ROOT }
					}
				}
			}
			capital_holding = {
				dejure_liege_title = {
					owner = {
						set_defacto_vassal = PREVPREVPREV
					}
				}
			}
			character_event = {
				id = emf_borders.1
			}
		}
	}
}
character_event = {
	id = emf_borders.1
	is_triggered_only = yes
	hide_window = yes
	only_rulers = yes
	is_patrician = no
	war = no
	ai = yes
	trigger = {
		tier = baron
		capital_holding = {
			location = {
				ROOT = {
					any_demesne_title = {
						location = {
							not = { province = PREVPREVPREV }
						}
					}
				}
			}
		}
	}
	immediate = {
		capital_holding = {
			location = {
				save_event_target_as = cap_prov
			}
		}
		any_demesne_title = {
			limit = {
				location = {
					not = { province = event_target:cap_prov }
				}
			}
			dejure_liege_title = {
				owner = {
					grant_title_no_opinion = PREVPREV
				}
			}
		}
	}
}
character_event = {
	id = emf_borders.5
	is_triggered_only = yes
	hide_window = yes
	only_independent = yes
	war = no
	ai = yes
	trigger = {
		higher_tier_than = DUKE
		primary_title = {
			capital_scope = {
				de_jure_liege_or_above = PREVPREV
				not = { has_province_flag = emf_capital_connected }
				owner = {
					is_liege_or_above = ROOT
					war = no
					ai = yes
				}
			}
		}
	}
	immediate = {
		capital_scope = {
			county = {
				save_event_target_as = old_cap
			}
		}
		primary_title = {
			capital_scope = {
				county = {
					save_event_target_as = new_cap
				}
				owner = {
					save_event_target_as = revokee
				}
			}
		}
		if = {
			limit = {
				num_of_count_titles == 1
			}
			any_demesne_title = {
				set_title_flag = emf_borders_prior_tmp
			}
			set_character_flag = emf_crier_no_title_creation
			primary_title = {
				create_title = {
					tier = emperor
					landless = yes
					custom_created = yes
					base_title = THIS
					culture = ROOT
					holder = ROOT
				}
			}
			clr_character_flag = emf_crier_no_title_creation
			random_demesne_title = {
				limit = {
					not = { has_title_flag = emf_borders_prior_tmp }
				}
				set_title_flag = emf_autodestroy
			}
			any_demesne_title = {
				limit = {
					has_title_flag = emf_borders_prior_tmp
				}
				clr_title_flag = emf_borders_prior_tmp
			}
		}
		event_target:old_cap = {
			any_de_jure_vassal = {
				limit = {
					tier = baron
					vassal_of = ROOT
				}
				set_defacto_liege = event_target:revokee
				emf_liege_change = yes
			}
			gain_title = {
				target = event_target:revokee
				type = grant
			}
			remove_claim = ROOT
			any_direct_de_jure_vassal_title = {
				limit = {
					holder = ROOT
				}
				gain_title = {
					target = event_target:revokee
					type = grant
				}
				remove_claim = ROOT
			}
		}
		event_target:new_cap = {
			any_de_jure_vassal = {
				limit = {
					tier = baron
					vassal_of = event_target:revokee
				}
				set_defacto_liege = ROOT
				emf_liege_change = yes
			}
			gain_title = {
				target = ROOT
				type = revoke
			}
			remove_claim = event_target:revokee
			any_direct_de_jure_vassal_title = {
				limit = {
					owner = {
						OR = {
							character = event_target:revokee
							AND = {
								is_liege_or_above = event_target:revokee
								PREV = {
									is_allowed_holding_type = ROOT
								}
							}
						}
					}
				}
				gain_title = {
					target = event_target:revokee
					type = revoke
				}
				remove_claim = event_target:revokee
			}
		}
		random_demesne_title = {
			limit = {
				has_title_flag = emf_autodestroy
			}
			emf_unsafe_destroy_title = yes
		}
		capital = event_target:new_cap
	}
}
