# -*- ck2 -*-

namespace = emf_seljuk

##################################
# Rise of the Seljuks
##################################

# All of the Seljuk-related events in mongol_events.txt have been moved here, because they are heavily customized and/or
# not at all present in vanilla.

# emf_seljuk.0 -- Seljuk appears and begins his first adventure [ normal version wherein he is spawned ]
character_event = {
    id = emf_seljuk.0

    hide_window = yes

    religion = hip_religion

    trigger = {
        has_landed_title = e_hip
        NOR = {
            has_global_flag = emf_seljuk_historical_start
            has_global_flag = emf_seljuk_invaded
            has_global_flag = emf_seljuk_spawned
            has_game_rule = { name = turkic_invasions value = off }
            has_game_rule = { name = adventurers value = none }
            has_global_flag = seljuk_spawned # FIXME TMP-SAVE-COMPAT: not set in Hydra3 and beyond, drop after Hydra
        }
        OR = {
            AND = {
                NOT = { has_game_rule = { name = turkic_invasions value = random } }
                year = 965
                NOT = { year = 985 }
            }
            AND = {
                has_game_rule = { name = turkic_invasions value = random }
                year = 809
                NOT = { year = 1200 }
            }
        }
        OR = {
            c_merv = { owner = { top_liege = { emf_seljuk_valid_initial_invasion_target_ruler = yes } } }
            c_dihistan = { owner = { top_liege = { emf_seljuk_valid_initial_invasion_target_ruler = yes } } }
            c_tus = { owner = { top_liege = { emf_seljuk_valid_initial_invasion_target_ruler = yes } } }
        }
    }

    mean_time_to_happen = {
        months = 24
        modifier = {
            factor = 0.5
            year = 970
            NOT = { has_game_rule = { name = turkic_invasions value = random } }
        }
        modifier = {
            factor = 0.25
            year = 975
            NOT = { has_game_rule = { name = turkic_invasions value = random } }
        }
    }

    immediate = {
        # Pick the target
        random_independent_ruler = {
            limit = {
                NOR = {
                    event_target:seljuk_target_ruler = { always = yes }
                    emf_seljuk_valid_initial_invasion_target_ruler = yes
                }
                c_tus = { owner_under_PREV = yes }
            }
            save_event_target_as = seljuk_target_ruler
            c_tus = { location = { save_event_target_as = seljuk_target_province } }
        }
        random_independent_ruler = {
            limit = {
                NOR = {
                    event_target:seljuk_target_ruler = { always = yes }
                    emf_seljuk_valid_initial_invasion_target_ruler = yes
                }
                c_merv = { owner_under_PREV = yes }
            }
            save_event_target_as = seljuk_target_ruler
            c_merv = { location = { save_event_target_as = seljuk_target_province } }
        }
        random_independent_ruler = {
            limit = {
                NOR = {
                    event_target:seljuk_target_ruler = { always = yes }
                    emf_seljuk_valid_initial_invasion_target_ruler = yes
                }
                c_dihistan = { owner_under_PREV = yes }
            }
            save_event_target_as = seljuk_target_ruler
            c_dihistan = { location = { save_event_target_as = seljuk_target_province } }
        }

        # Select origin
        if = {
            limit = { has_global_flag = SWMH }
            random_province = {
                limit = {
                    NOT = { event_target:seljuk_origin = { always = yes } }
                    NOT = { owner = { same_realm = event_target:seljuk_target_ruler } }
                    culture = oghuz
                    NOT = { event_target:seljuk_target_province = { distance = { where = PREV value = 300 } } }
                }
                save_event_target_as = seljuk_origin
            }
            random_province = {
                limit = {
                    NOT = { event_target:seljuk_origin = { always = yes } }
                    NOT = { owner = { same_realm = event_target:seljuk_target_ruler } }
                    culture = oghuz
                    NOT = { event_target:seljuk_target_province = { distance = { where = PREV value = 600 } } }
                }
                save_event_target_as = seljuk_origin
            }
            c_buzachi = {
                location = {
                    if = {
                        limit = {
                            NOT = { event_target:seljuk_origin = { always = yes } }
                            NOT = { owner = { same_realm = event_target:seljuk_target_ruler } }
                        }
                        save_event_target_as = seljuk_origin
                    }
                }
            }
            random_province = {
                limit = {
                    NOT = { event_target:seljuk_origin = { always = yes } }
                    NOT = { owner = { same_realm = event_target:seljuk_target_ruler } }
                    NOT = { event_target:seljuk_target_province = { distance = { where = PREV value = 300 } } }
                }
                save_event_target_as = seljuk_origin
            }
            random_province = {
                limit = {
                    NOT = { event_target:seljuk_origin = { always = yes } }
                    NOT = { owner = { same_realm = event_target:seljuk_target_ruler } }
                    NOT = { event_target:seljuk_target_province = { distance = { where = PREV value = 600 } } }
                }
                save_event_target_as = seljuk_origin
            }
            random_province = {
                limit = {
                    NOT = { event_target:seljuk_origin = { always = yes } }
                    NOT = { event_target:seljuk_target_province = { distance = { where = PREV value = 300 } } }
                }
                save_event_target_as = seljuk_origin
            }
        }
        else = {
            random_province = {
                limit = {
                    NOT = { event_target:seljuk_origin = { always = yes } }
                    NOT = { owner = { same_realm = event_target:seljuk_target_ruler } }
                    culture_group = altaic
                    NOT = { event_target:seljuk_target_province = { distance = { where = PREV value = 300 } } }
                }
                save_event_target_as = seljuk_origin
            }
            random_province = {
                limit = {
                    NOT = { event_target:seljuk_origin = { always = yes } }
                    NOT = { owner = { same_realm = event_target:seljuk_target_ruler } }
                    culture_group = altaic
                    NOT = { event_target:seljuk_target_province = { distance = { where = PREV value = 600 } } }
                }
                save_event_target_as = seljuk_origin
            }
            random_province = {
                limit = {
                    NOT = { event_target:seljuk_origin = { always = yes } }
                    NOT = { owner = { same_realm = event_target:seljuk_target_ruler } }
                    NOT = { event_target:seljuk_target_province = { distance = { where = PREV value = 300 } } }
                }
                save_event_target_as = seljuk_origin
            }
            random_province = {
                limit = {
                    NOT = { event_target:seljuk_origin = { always = yes } }
                    NOT = { owner = { same_realm = event_target:seljuk_target_ruler } }
                    NOT = { event_target:seljuk_target_province = { distance = { where = PREV value = 600 } } }
                }
                save_event_target_as = seljuk_origin
            }
            random_province = {
                limit = {
                    NOT = { event_target:seljuk_origin = { always = yes } }
                    NOT = { event_target:seljuk_target_province = { distance = { where = PREV value = 300 } } }
                }
                save_event_target_as = seljuk_origin
            }
        }

        if = {
            limit = { NOT = { event_target:seljuk_origin = { always = yes } } }
            log = "ASSERT: emf_seljuk.0: failed to find an origin province in which Seljuk can spawn his troops"
            break = yes
        }

        # Now create Seljuk
        if = {
            limit = { has_global_flag = SWMH }
            create_character = {
                random_traits = no
                historical = yes
                dynasty = 613 # Seljuk
                name = "Seljuk"
                culture = oghuz # SWMH-specific
                religion = sunni
                age = 30
                attributes = {
                    martial = 12
                    diplomacy = 8
                    stewardship = 5
                    intrigue = 4
                    learning = 3
                }
                health = 7
                trait = brilliant_strategist
            }
        }
        else = {
            create_character = {
                random_traits = no
                historical = yes
                dynasty = 613 # Seljuk
                name = "Seljuk"
                culture = turkish
                religion = sunni
                age = 30
                attributes = {
                    martial = 12
                    diplomacy = 8
                    stewardship = 5
                    intrigue = 4
                    learning = 3
                }
                health = 7
                trait = brilliant_strategist
            }
        }
        new_character = {
            add_trait = wroth
            add_trait = cruel
            add_trait = proud
            add_trait = zealous
            add_trait = ambitious
            add_trait = adventurer
            emf_new_character_noble = yes
            set_character_flag = seljuk_himself
            log = "INFO: emf_seljuk.0: Seljuk (#[This.GetID]) has successfully spawned"
            character_event = { id = emf_seljuk.1 } # spawn family & court
            character_event = { id = emf_seljuk.3 } # create adventurer title & launch invasion
        }
    }
}

# Spawn Seljuk's children and extra courtiers
character_event = {
    id = emf_seljuk.1

    hide_window = yes
    is_triggered_only = yes

    immediate = {
        # Create his sons
        create_character = {
            name="Arslan Esra'íl"
            random_traits = yes
            dynasty = ROOT
            religion = ROOT
            culture = ROOT
            female = no
            age = 5
        }
        new_character = {
            set_father = ROOT
        }
        create_character = {
            name="Yunus"
            random_traits = yes
            dynasty = ROOT
            religion = ROOT
            culture = ROOT
            female = no
            age = 1
        }
        new_character = {
            set_father = ROOT
        }
        create_character = {
            name="Miká'íl"
            random_traits = yes
            dynasty = ROOT
            religion = ROOT
            culture = ROOT
            female = no
            age = 0
        }
        new_character = {
            set_father = ROOT
        }
        # Create some extra courtiers
        emf_create_courtiers = yes
    }
    after = {
        set_global_flag = emf_seljuk_spawned
    }
}

# emf_seljuk.2 -- A Seljuk is alive and begins his first conquest [ uses historical characters & their progeny ]
#character_event = {
#    id = emf_seljuk.2

#    hide_window = yes

#    religion = hip_religion
#    has_global_flag = emf_seljuk_historical_start

#    trigger = {
#        has_landed_title = e_hip
#        NOR = {
#            has_global_flag = emf_seljuk_invaded
#            has_game_rule = { name = turkic_invasions value = off }
#            has_game_rule = { name = adventurers value = none }
#            year = 1100
#        }
#        OR = {
#            c_merv = { owner = { top_liege = { emf_seljuk_valid_initial_invasion_target_ruler = yes } } }
#            c_dihistan = { owner = { top_liege = { emf_seljuk_valid_initial_invasion_target_ruler = yes } } }
#            c_tus = { owner = { top_liege = { emf_seljuk_valid_initial_invasion_target_ruler = yes } } }
#        }
#    }

#    mean_time_to_happen = {
#        months = 120
#        modifier = {
#            factor = 0.5
#            year = 1020
#            NOT = { has_game_rule = { name = turkic_invasions value = random } }
#        }
#        modifier = {
#            factor = 0.25
#            year = 975
#            NOT = { has_game_rule = { name = turkic_invasions value = random } }
#        }
#    }

#    immediate = {

# emf_seljuk.3 -- launch initial invasion
character_event = {
    id = emf_seljuk.3

    is_triggered_only = yes
    hide_window = yes

    immediate = {
        log = "--> origin province (troops spawn here): [seljuk_origin.GetName] (#[seljuk_origin.GetID]/[seljuk_origin.County.GetID])"
        log = "--> target ruler: [seljuk_target_ruler.GetTitledFirstName] [seljuk_target_ruler.GetOnlyDynastyName] (#[seljuk_target_ruler.GetID]/[seljuk_target_ruler.PrimaryTitle.GetID])"
        log = "--> target duchy: [seljuk_target_province.Duchy.GetBaseName] ([seljuk_target_province.Duchy.GetID])"
        wealth = 500
        prestige = 500
        # Give adventurer title and start war
        event_target:seljuk_origin = {
            ROOT = {
                set_defacto_liege = THIS
                create_title = {
                    tier = DUKE
                    landless = yes
                    temporary = yes
                    culture = THIS
                    name = "CLAIMANT_ADVENTURE"
                    holder = THIS
                }
                emf_switch_to_feudal_gov = yes
                set_character_flag = duchy_adventurer
                set_character_flag = emf_seljuk_invader
                spawn_unit = {
                    province = PREV
                    home = PREV
                    owner = THIS
                    troops = {
                        horse_archers = { 2700 2700 }
                        light_cavalry = { 1600 1600 }
                        light_infantry = { 541 541 }
                        heavy_infantry = { 210 210 }
                        knights = { 47 47 }
                    }
                    attrition = 0.25
                    cannot_inherit = yes
                    maintenance_multiplier = 0
                    earmark = seljuk_event_troops
                }
                spawn_unit = {
                    province = PREV
                    home = PREV
                    owner = THIS
                    match_character = event_target:seljuk_target_ruler
                    match_mult = 0.4
                    match_min = 500
                    match_max = 10000
                    attrition = 0.25
                    disband_on_peace = yes
                    earmark = seljuk_duchy_adventure
                }
                spawn_unit = {
                    province = PREV
                    home = PREV
                    owner = THIS
                    match_character = event_target:seljuk_target_ruler
                    match_mult = 0.4
                    match_min = 500
                    match_max = 10000
                    attrition = 0.25
                    disband_on_peace = yes
                    earmark = seljuk_duchy_adventure
                }
                spawn_unit = {
                    province = PREV
                    home = PREV
                    owner = THIS
                    match_character = event_target:seljuk_target_ruler
                    match_mult = 0.4
                    match_min = 500
                    match_max = 10000
                    attrition = 0.25
                    disband_on_peace = yes
                    earmark = seljuk_duchy_adventure
                }
                spawn_unit = {
                    province = PREV
                    home = PREV
                    owner = THIS
                    match_character = event_target:seljuk_target_ruler
                    match_mult = 0.4
                    match_min = 500
                    match_max = 10000
                    attrition = 0.25
                    disband_on_peace = yes
                    earmark = seljuk_duchy_adventure
                }
                spawn_unit = {
                    province = PREV
                    home = PREV
                    owner = THIS
                    match_character = event_target:seljuk_target_ruler
                    match_mult = 0.4
                    match_min = 500
                    match_max = 10000
                    attrition = 0.25
                    disband_on_peace = yes
                    earmark = seljuk_duchy_adventure
                }
                spawn_unit = {
                    province = PREV
                    home = PREV
                    owner = THIS
                    match_character = event_target:seljuk_target_ruler
                    match_mult = 0.4
                    match_min = 500
                    match_max = 10000
                    attrition = 0.25
                    disband_on_peace = yes
                    earmark = seljuk_duchy_adventure
                }
                spawn_unit = {
                    province = PREV
                    home = PREV
                    owner = THIS
                    match_character = event_target:seljuk_target_ruler
                    match_mult = 0.4
                    match_min = 500
                    match_max = 10000
                    attrition = 0.25
                    disband_on_peace = yes
                    earmark = seljuk_duchy_adventure
                }
                war = {
                    target = event_target:seljuk_target_ruler
                    casus_belli = duchy_adventure
                    thirdparty_title = event_target:seljuk_target_province
                    tier = DUKE
                    infamy = 0
                }
                character_event = { id = emf_seljuk.4 days = 1 } # Ensure that the war was declared and didn't invalidate
            }
        }
    }
}

# emf_seljuk.4 -- war ping event for Seljuks' initial invasion w/ reasonable exile behavior if the war failed
character_event = {
    id = emf_seljuk.4

    is_triggered_only = yes
    hide_window = yes

    immediate = {
        if = {
            limit = { any_war = { using_cb = duchy_adventure } }
            log = "INFO: emf_seljuk.4: the initial Seljuk duchy adventure war was successfully declared"
            set_global_flag = emf_seljuk_invaded
        }
        else = {
            log = "ERROR: emf_seljuk.4: the initial Seljuk duchy adventure war was not successfully declared, or it invalidated right away!"
            disband_event_forces = seljuk_duchy_adventure
            disband_event_forces = seljuk_event_troops
            any_courtier = { limit = { prisoner = yes } prisoner = no }
            if = {
                limit = { NOT = { has_global_flag = emf_seljuk_historical_start } }
                event_target:seljuk_target_ruler = {
                    primary_title = { set_global_flag = emf_seljuk_spawned_and_failed_to_declare_war_on_@THIS }
                }
                event_target:seljuk_target_province = {
                    duchy = { set_global_flag = emf_seljuk_spawned_and_failed_to_declare_war_for_@THIS }
                }
                clr_global_flag = emf_seljuk_spawned # so that he can potentially spawn again and do it all over
                any_dynasty_member = {
                    limit = { NOT = { character = ROOT } }
                    set_father = 0
                    set_mother = 0
                    dynasty = father_bastard
                    death = { death_reason = death_missing }
                }
                any_courtier = { banish = yes }
                primary_title = { emf_unsafe_destroy_title = yes }
                dynasty = father_bastard
                death = { death_reason = death_missing }
            }
            else = {
                random_independent_ruler = {
                    limit = {
                        NOT = { event_target:emf_exile_court = { always = yes } }
                        mercenary = yes
                        religion = ROOT
                        culture = ROOT
                    }
                    save_event_target_as = emf_exile_court
                }
                random_independent_ruler = {
                    limit = {
                        NOT = { event_target:emf_exile_court = { always = yes } }
                        mercenary = yes
                        religion = ROOT
                        culture_group = ROOT
                    }
                    save_event_target_as = emf_exile_court
                }
                random_playable_ruler = {
                    limit = {
                        NOT = { event_target:emf_exile_court = { always = yes } }
                        religion = ROOT
                        culture = ROOT
                        capital_scope = {
                            NAND = {
                                c_merv = { location = { distance = { where = PREVPREV value = 700 } } }
                                c_tus = { location = { distance = { where = PREVPREV value = 700 } } }
                                c_dihistan = { location = { distance = { where = PREVPREV value = 700 } } }
                            }
                        }
                    }
                    save_event_target_as = emf_exile_court
                }
                random_playable_ruler = {
                    limit = {
                        NOT = { event_target:emf_exile_court = { always = yes } }
                        religion = ROOT
                        culture_group = ROOT
                        capital_scope = {
                            NAND = {
                                c_merv = { location = { distance = { where = PREVPREV value = 700 } } }
                                c_tus = { location = { distance = { where = PREVPREV value = 700 } } }
                                c_dihistan = { location = { distance = { where = PREVPREV value = 700 } } }
                            }
                        }
                    }
                    save_event_target_as = emf_exile_court
                }
                random_playable_ruler = {
                    limit = {
                        NOT = { event_target:emf_exile_court = { always = yes } }
                        religion = ROOT
                        culture = ROOT
                    }
                    save_event_target_as = emf_exile_court
                }
                random_playable_ruler = {
                    limit = {
                        NOT = { event_target:emf_exile_court = { always = yes } }
                        religion = ROOT
                        culture_group = ROOT
                    }
                    save_event_target_as = emf_exile_court
                }
                random_playable_ruler = {
                    limit = {
                        NOT = { event_target:emf_exile_court = { always = yes } }
                        religion = ROOT
                    }
                    save_event_target_as = emf_exile_court
                }
                random_playable_ruler = {
                    limit = { NOT = { event_target:emf_exile_court = { always = yes } } }
                    save_event_target_as = emf_exile_court
                }
                any_courtier = { limit = { is_ruler = no } move_character = event_target:emf_exile_court }
                any_courtier = { banish = yes }
                primary_title = { emf_unsafe_destroy_title = yes }
                move_character = event_target:emf_exile_court
                event_target:emf_exile_court = {
                    log = "--> the Seljuk initial invasion entourage took up exile in the court of [This.GetTitledFirstName] [This.GetOnlyDynastyName] of the [This.PrimaryTitle.GetFullName] (#[This.GetID]/[This.PrimaryTitle.GetID])"
                }
            }
        }
    }
}

# TODO: make this event differentiate the case of a spawned Seljuk winning his first war & a historical Seljuk via the
#       emf_seljuk_historical_start global flag.
#
# Seljuk is successful!
# Fired from the duchy_adventure CB
narrative_event = {
    id = emf_seljuk.5
    title = EVTNAME60206
    desc = EVTDESC60206
    picture = GFX_evt_mongols
    border = GFX_event_narrative_frame_war

    is_triggered_only = yes

    major = yes

    immediate = {
        set_character_flag = seljuk_reinforcements
        set_global_flag = seljuk_wins_first_war

        prestige = 500
        piety = 100

        if = {
            limit = { independent = no }
            set_defacto_liege = ROOT
            emf_liege_change = yes
        }

        capital_scope = {
            ROOT = {
                spawn_unit = {
                    province = PREV
                    home = PREV
                    owner = THIS
                    troops = {
                        light_infantry = { 2250 2250 }
                        light_cavalry = { 2000 2000 }
                        horse_archers = { 1500 1500 }
                        knights = { 50 50 }
                    }
                    attrition = 0.25
                    maintenance_multiplier = 0
                    earmark = seljuk_event_troops
                }
                spawn_unit = {
                    province = PREV
                    home = PREV
                    owner = THIS
                    troops = {
                        light_infantry = { 2250 2250 }
                        light_cavalry = { 2000 2000 }
                        horse_archers = { 1500 1500 }
                        knights = { 50 50 }
                    }
                    attrition = 0.25
                    maintenance_multiplier = 0
                    earmark = seljuk_event_troops
                }
                spawn_unit = {
                    province = PREV
                    home = PREV
                    owner = THIS
                    troops = {
                        light_infantry = { 2250 2250 }
                        light_cavalry = { 2000 2000 }
                        horse_archers = { 1500 1500 }
                        knights = { 50 50 }
                    }
                    attrition = 0.25
                    maintenance_multiplier = 0
                    earmark = seljuk_event_troops
                }
                spawn_unit = {
                    province = PREV
                    home = PREV
                    owner = THIS
                    troops = {
                        light_infantry = { 2250 2250 }
                        light_cavalry = { 2000 2000 }
                        horse_archers = { 1500 1500 }
                        knights = { 50 50 }
                    }
                    attrition = 0.25
                    maintenance_multiplier = 0
                    earmark = seljuk_event_troops
                }
                spawn_unit = {
                    province = PREV
                    home = PREV
                    owner = THIS
                    troops = {
                        light_infantry = { 2250 2250 }
                        light_cavalry = { 2000 2000 }
                        horse_archers = { 1500 1500 }
                        knights = { 50 50 }
                    }
                    attrition = 0.25
                    maintenance_multiplier = 0
                    earmark = seljuk_event_troops
                }
                spawn_unit = {
                    province = PREV
                    home = PREV
                    owner = THIS
                    troops = {
                        light_infantry = { 2250 2250 }
                        light_cavalry = { 2000 2000 }
                        horse_archers = { 1500 1500 }
                        knights = { 50 50 }
                    }
                    attrition = 0.25
                    maintenance_multiplier = 0
                    earmark = seljuk_event_troops
                }
            }
        }

        log = "INFO: emf_seljuk.5: Seljuks wins their first war!"
    }

    option = {
        name = EVTOPTA60206
        trigger = {
            has_character_flag = seljuk_himself
        }
    }
    option = {
        name = EVTOPTB60206
        trigger = {
            NOT = { has_character_flag = seljuk_himself }
            OR = {
                culture = turkish
                culture = turkmen
                culture = oghuz
                culture = karluk
                culture = cuman
                culture = pecheneg
            }
        }
    }
    option = {
        name = EVTOPTC60206
        trigger = {
            NOT = { has_character_flag = seljuk_himself }
            NOT = {
                OR = {
                    culture = turkish
                    culture = turkmen
                    culture = oghuz
                    culture = karluk
                    culture = cuman
                    culture = pecheneg
                }
            }
        }
    }
}

# Seljuk's successor revitalizes the new state
character_event = {
    id = emf_seljuk.6
    desc = EVTDESC60207
    picture = GFX_evt_mongols
    border = GFX_event_normal_frame_war

    only_independent = yes
    religion_group = muslim
    war = no
    has_global_flag = seljuk_spawned

    trigger = {
        dynasty = 613 # Seljuk
        year = 980

        higher_tier_than = duke

        martial = 7
        NOT = { has_earmarked_regiments = seljuk_event_troops }

        NOR = {
            year = 1100
            realm_size = 150
            trait = blinded
            trait = eunuch
            trait = infirm
            trait = content
            trait = craven
            trait = depressed
            trait = imbecile
            has_character_flag = seljuk_himself
            has_character_flag = seljuk_reinforcements
        }
    }

    mean_time_to_happen = {
        months = 240
        modifier = {
            factor = 0.5
            martial = 9
        }
        modifier = {
            factor = 0.5
            martial = 11
        }
        modifier = {
            factor = 0.5
            martial = 13
        }
    }

    immediate = {
        set_character_flag = seljuk_reinforcements

        piety = 250

        capital_scope = {
            ROOT = {
                spawn_unit = {
                    province = PREV
                    home = PREV
                    owner = THIS
                    troops = {
                        light_infantry = { 2250 2250 }
                        light_cavalry = { 2000 2000 }
                        horse_archers = { 1500 1500 }
                        knights = { 50 50 }
                    }
                    attrition = 0.25
                    maintenance_multiplier = 0
                    earmark = seljuk_event_troops
                    cannot_inherit = yes
                }
                spawn_unit = {
                    province = PREV
                    home = PREV
                    owner = THIS
                    troops = {
                        light_infantry = { 2250 2250 }
                        light_cavalry = { 2000 2000 }
                        horse_archers = { 1500 1500 }
                        knights = { 50 50 }
                    }
                    attrition = 0.25
                    maintenance_multiplier = 0
                    earmark = seljuk_event_troops
                    cannot_inherit = yes
                }
                spawn_unit = {
                    province = PREV
                    home = PREV
                    owner = THIS
                    troops = {
                        light_infantry = { 2250 2250 }
                        light_cavalry = { 2000 2000 }
                        horse_archers = { 1500 1500 }
                        knights = { 50 50 }
                    }
                    attrition = 0.25
                    maintenance_multiplier = 0
                    earmark = seljuk_event_troops
                    cannot_inherit = yes
                }
                spawn_unit = {
                    province = PREV
                    home = PREV
                    owner = THIS
                    troops = {
                        light_infantry = { 2250 2250 }
                        light_cavalry = { 2000 2000 }
                        horse_archers = { 1500 1500 }
                        knights = { 50 50 }
                    }
                    attrition = 0.25
                    maintenance_multiplier = 0
                    earmark = seljuk_event_troops
                    cannot_inherit = yes
                }
                if = {
                    limit = {
                        martial = 9
                    }
                    spawn_unit = {
                        province = PREV
                        home = PREV
                        owner = THIS
                        troops = {
                            light_infantry = { 2250 2250 }
                            light_cavalry = { 2000 2000 }
                            horse_archers = { 1500 1500 }
                            knights = { 50 50 }
                        }
                        attrition = 0.25
                        maintenance_multiplier = 0
                        earmark = seljuk_event_troops
                        cannot_inherit = yes
                    }
                }
                if = {
                    limit = {
                        martial = 11
                    }
                    spawn_unit = {
                        province = PREV
                        home = PREV
                        owner = THIS
                        troops = {
                            light_infantry = { 2250 2250 }
                            light_cavalry = { 2000 2000 }
                            horse_archers = { 1500 1500 }
                            knights = { 50 50 }
                        }
                        attrition = 0.25
                        maintenance_multiplier = 0
                        earmark = seljuk_event_troops
                        cannot_inherit = yes
                    }
                }
                if = {
                    limit = {
                        martial = 13
                    }
                    spawn_unit = {
                        province = PREV
                        home = PREV
                        owner = THIS
                        troops = {
                            light_infantry = { 2250 2250 }
                            light_cavalry = { 2000 2000 }
                            horse_archers = { 1500 1500 }
                            knights = { 50 50 }
                        }
                        attrition = 0.25
                        maintenance_multiplier = 0
                        earmark = seljuk_event_troops
                        cannot_inherit = yes
                    }
                }
            }
        }
    }

    option = {
        name = EVTOPTA60207
    }
}

# Event troops no longer needed
character_event = {
    id = emf_seljuk.7
    desc = EVTDESC60208
    picture = GFX_evt_mongols
    border = GFX_event_normal_frame_war

    only_independent = yes
    war = no
    has_character_flag = seljuk_reinforcements

    trigger = {
        tier = EMPEROR
        has_earmarked_regiments = seljuk_event_troops
        realm_size = 150
    }

    mean_time_to_happen = {
        years = 5
    }

    option = {
        name = EVTOPTA60208
        disband_event_forces = seljuk_event_troops
    }
}

# Prompt AI to use the manifest destiny CB
character_event = {
    id = emf_seljuk.8

    hide_window = yes

    only_independent = yes
    min_age = 16
    capable_only = yes
    prisoner = no
    war = no
    ai = yes

    trigger = {
        OR = {
            AND = {
                dynasty = 613 # Seljuks
                NOT = { year = 1200 }
            }
            dynasty = 800 # Timurids
        }
        wealth = 0
        mercenary = no
        is_tributary = no
        is_ill = no
        has_regent = no
        NOR = {
            realm_size = 300
            trait = content
            trait = humble
            trait = craven
            trait = maimed
            trait = depressed
            trait = infirm
            is_inaccessible_trigger = yes
        }
        any_independent_ruler = {
            is_merchant_republic = no
            reverse_realm_levy_diff = { who = ROOT value = 10000 }
            any_realm_title = {
                tier = COUNT
                location = {
                    region = emf_region_manifest_destiny
                    any_neighbor_province = { owner_under_ROOT = yes }
                }
            }
            NOR = {
                dynasty = ROOT
                same_realm = ROOT
                reverse_has_truce = ROOT
                is_allied_with = ROOT
                has_non_aggression_pact_with = ROOT
                reverse_opinion = { who = ROOT value = 25 }
                pays_tribute_to = ROOT
                ROOT = { pays_tribute_to = PREV }
            }
        }
    }

    mean_time_to_happen = {
        months = 12
    }

    immediate = {
        # First priority
        random_independent_ruler = {
            limit = {
                is_merchant_republic = no
                reverse_realm_levy_diff = { who = ROOT value = 10000 }
                any_realm_title = {
                    tier = COUNT
                    location = {
                        region = emf_region_manifest_destiny_tier_1
                        any_neighbor_province = { owner_under_ROOT = yes }
                    }
                }
                NOR = {
                    dynasty = ROOT
                    same_realm = ROOT
                    reverse_has_truce = ROOT
                    is_allied_with = ROOT
                    has_non_aggression_pact_with = ROOT
                    reverse_opinion = { who = ROOT value = 25 }
                    pays_tribute_to = ROOT
                    ROOT = { pays_tribute_to = PREV }
                }
            }
            save_event_target_as = target_ruler
            random_realm_title = {
                limit = {
                    tier = COUNT
                    location = {
                        region = emf_region_manifest_destiny_tier_1
                        any_neighbor_province = { owner_under_ROOT = yes }
                    }
                }
                kingdom = {
                    ROOT = {
                        war = {
                            casus_belli = manifest_destiny_invasion
                            target = PREVPREVPREV
                            thirdparty_title = PREV
                            infamy = 0
                        }
                    }
                }
                break = yes
            }
        }
        # Second priority
        random_independent_ruler = {
            limit = {
                is_merchant_republic = no
                reverse_realm_levy_diff = { who = ROOT value = 10000 }
                any_realm_title = {
                    tier = COUNT
                    location = {
                        region = emf_region_manifest_destiny_tier_2
                        any_neighbor_province = { owner_under_ROOT = yes }
                    }
                }
                NOR = {
                    dynasty = ROOT
                    same_realm = ROOT
                    reverse_has_truce = ROOT
                    is_allied_with = ROOT
                    has_non_aggression_pact_with = ROOT
                    reverse_opinion = { who = ROOT value = 25 }
                    pays_tribute_to = ROOT
                    ROOT = { pays_tribute_to = PREV }
                }
            }
            save_event_target_as = target_ruler
            random_realm_title = {
                limit = {
                    tier = COUNT
                    location = {
                        region = emf_region_manifest_destiny_tier_2
                        any_neighbor_province = { owner_under_ROOT = yes }
                    }
                }
                kingdom = {
                    ROOT = {
                        war = {
                            casus_belli = manifest_destiny_invasion
                            target = PREVPREVPREV
                            thirdparty_title = PREV
                            infamy = 0
                        }
                    }
                }
                break = yes
            }
        }
        # Third priority
        random_independent_ruler = {
            limit = {
                is_merchant_republic = no
                reverse_realm_levy_diff = { who = ROOT value = 10000 }
                any_realm_title = {
                    tier = COUNT
                    location = {
                        region = emf_region_manifest_destiny_tier_3
                        any_neighbor_province = { owner_under_ROOT = yes }
                    }
                }
                NOR = {
                    dynasty = ROOT
                    same_realm = ROOT
                    reverse_has_truce = ROOT
                    is_allied_with = ROOT
                    has_non_aggression_pact_with = ROOT
                    reverse_opinion = { who = ROOT value = 25 }
                    pays_tribute_to = ROOT
                    ROOT = { pays_tribute_to = PREV }
                }
            }
            save_event_target_as = target_ruler
            random_realm_title = {
                limit = {
                    tier = COUNT
                    location = {
                        region = emf_region_manifest_destiny_tier_3
                        any_neighbor_province = { owner_under_ROOT = yes }
                    }
                }
                kingdom = {
                    ROOT = {
                        war = {
                            casus_belli = manifest_destiny_invasion
                            target = PREVPREVPREV
                            thirdparty_title = PREV
                            infamy = 0
                        }
                    }
                }
                break = yes
            }
        }
    }
}

# Oghuz ruler becomes Turkmen after becoming non-nomadic
character_event = {
    id = emf_seljuk.10
    desc = EVTDESC60220
    picture = GFX_evt_mongols

    only_playable = yes
    culture = oghuz
    min_age = 16
    prisoner = no
    capable_only = yes
    war = no
    has_global_flag = SWMH

    trigger = {
        is_nomadic = no
        OR = {
            independent = yes
            liege = { culture = turkmen }
            liege = { culture = turkish }
            NOT = {
                any_liege = {
                    OR = {
                        culture = turkish
                        culture = turkmen
                        culture = oghuz
                    }
                }
            }
        }
        NOR = {
            is_inaccessible_trigger = yes
            has_character_flag = refuse_culture_conversion
            any_liege = { has_character_flag = refuse_culture_conversion }
        }
    }

    mean_time_to_happen = {
        years = 25
        modifier = {
            factor = 2.0
            NOT = { age = 30 }
        }
        modifier = {
            factor = 0.5
            liege = { culture = turkmen }
        }
        modifier = {
            factor = 0.5
            capital_scope = { culture = turkmen }
        }
        modifier = {
            factor = 0.5
            independent = no
            liege = { independent = no }
            NOT = { any_liege = { NOT = { culture = turkmen } } }
        }
    }

    option = {
        name = EVTOPTA60220 # Convert
        culture = turkmen
        capital_scope = {
            if = {
                limit = {
                    ROOT = { higher_tier_than = BARON }
                    culture = oghuz
                }
                culture = turkmen
            }
        }
        hidden_tooltip = {
            any_courtier = {
                limit = {
                    is_ruler = no
                    culture = oghuz
                    prisoner = no
                    is_incapable = no
                }
                culture = turkmen
            }
            any_vassal = {
                limit = {
                    is_playable = no
                    culture = oghuz
                    prisoner = no
                    is_incapable = no
                }
                culture = turkmen
                any_courtier = {
                    limit = {
                        is_ruler = no
                        culture = oghuz
                        prisoner = no
                        is_incapable = no
                    }
                    culture = turkmen
                }
            }
        }
    }
    option = {
        name = EVTOPTB60220 # Refuse
        trigger = { ai = no }
        set_character_flag = refuse_culture_conversion
    }
}

# Turkmen ruler becomes Turkish if in Anatolia
character_event = {
    id = emf_seljuk.11
    desc = EVTDESC60221
    picture = GFX_evt_mongols

    only_playable = yes
    culture = turkmen
    min_age = 16
    prisoner = no
    capable_only = yes
    war = no
    has_global_flag = SWMH

    trigger = {
        year = 1200
        is_nomadic = no
        is_tribal = no
        capital_scope = { region = world_asia_minor }
        OR = {
            liege = { culture = turkish }
            independent = yes
            NOT = { any_liege = { culture = turkmen } }
        }
        NOR = {
            is_inaccessible_trigger = yes
            has_character_flag = refuse_culture_conversion
            any_liege = { has_character_flag = refuse_culture_conversion }
        }
    }

    mean_time_to_happen = {
        years = 25
        modifier = {
            factor = 2.0
            NOT = { age = 30 }
        }
        modifier = {
            factor = 0.5
            liege = { culture = turkish }
        }
        modifier = {
            factor = 0.5
            capital_scope = { culture = turkish }
        }
        modifier = {
            factor = 0.5
            independent = no
            liege = { independent = no }
            NOT = { any_liege = { NOT = { culture = turkish } } }
        }
    }

    option = {
        name = EVTOPTA60220 # Convert
        culture = turkish
        capital_scope = {
            if = {
                limit = {
                    ROOT = { higher_tier_than = BARON }
                    culture = turkmen
                }
                culture = turkish
            }
        }
        hidden_tooltip = {
            any_courtier = {
                limit = {
                    is_ruler = no
                    culture = turkmen
                    prisoner = no
                    is_incapable = no
                }
                culture = turkish
            }
            any_vassal = {
                limit = {
                    is_playable = no
                    culture = turkmen
                    prisoner = no
                    is_incapable = no
                }
                culture = turkish
                any_courtier = {
                    limit = {
                        is_ruler = no
                        culture = turkmen
                        prisoner = no
                        is_incapable = no
                    }
                    culture = turkish
                }
            }
        }
    }
    option = {
        name = EVTOPTB60220 # Refuse
        trigger = { ai = no }
        set_character_flag = refuse_culture_conversion
    }
}
