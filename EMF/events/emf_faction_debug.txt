
namespace = emf_faction


character_event = { # Check for stray war traits/TOMs <Debug MTTH on ALL characters>
	id = emf_faction.1000
	
	hide_window = yes

	trigger = {
		OR = {
			AND = { # Stray rebel state
				OR = {
					trait = rebel
					has_any_opinion_modifier = revolting_against
				}
				pf_in_revolt_trigger = no
			}
			AND = { # Stray neutral/loyalist state
				OR = {
					trait = loyalist
					trait = neutral
				}
				liege = {
					OR = {
						character = PREV
						any_war = {
							defender = { character = PREVPREV }
							pf_cb_trigger = yes
						}
					}
				}
			}
			AND = { # Stray liege state
				OR = {
					has_any_opinion_modifier = revolting_against_me
					has_any_opinion_modifier = supported_civil_war
					has_any_opinion_modifier = neutral_civil_war
				}
				NOT = {
					any_war = {
						defender = { character = ROOT }
						pf_cb_trigger = yes
					}
				}
			}
		}
		NOT = { has_character_flag = pf_error }
	}

	mean_time_to_happen = {
		days = 1
	}

	immediate = {
		set_character_flag = pf_error
		log = "emf_faction.1000: ERROR: character has stray civil war state: dump follows:"
		pf_log_state_effect = yes
	}
}


letter_event = { # Court
	id = emf_faction.1010
	desc = emf_faction.1010.desc

	is_triggered_only = yes

	option = {
		name = emf_faction.1010.opt.a # Standard revolt
		FROM = {
			random_vassal = {
				limit = { leads_faction = faction_court }
				hidden_tooltip = { set_variable = { which = faction_votes value = 1 } }
				character_event = { id = PlusFaction.344 }
			}
		}
	}
	option = {
		name = emf_faction.1010.opt.b # Angry revolt
		FROM = {
			hidden_tooltip = {
				any_vassal = {
					limit = { is_playable = yes }
					opinion = { who = PREV modifier = opinion_hate multiplier = 4 years = 1 }
				}
			}
			random_vassal = {
				limit = { leads_faction = faction_court }
				hidden_tooltip = { set_variable = { which = faction_votes value = 1 } }
				character_event = { id = PlusFaction.344 }
			}
		}
	}
	option = { name = CANCEL }
}


letter_event = { # Prosperity
	id = emf_faction.1011
	desc = emf_faction.1010.desc

	is_triggered_only = yes

	option = {
		name = emf_faction.1010.opt.a # Standard revolt
		FROM = {
			random_vassal = {
				limit = { leads_faction = faction_prosperity }
				hidden_tooltip = { set_variable = { which = faction_votes value = 1 } }
				character_event = { id = PlusFaction.344 }
			}
		}
	}
	option = {
		name = emf_faction.1010.opt.b # Angry revolt
		FROM = {
			hidden_tooltip = {
				any_vassal = {
					limit = { is_playable = yes }
					opinion = { who = PREV modifier = opinion_hate multiplier = 4 years = 1 }
				}
			}
			random_vassal = {
				limit = { leads_faction = faction_prosperity }
				hidden_tooltip = { set_variable = { which = faction_votes value = 1 } }
				character_event = { id = PlusFaction.344 }
			}
		}
	}
	option = { name = CANCEL }
}


letter_event = { # Glory
	id = emf_faction.1012
	desc = emf_faction.1010.desc

	is_triggered_only = yes

	option = {
		name = emf_faction.1010.opt.a # Standard revolt
		FROM = {
			random_vassal = {
				limit = { leads_faction = faction_glory }
				hidden_tooltip = { set_variable = { which = faction_votes value = 1 } }
				character_event = { id = PlusFaction.344 }
			}
		}
	}
	option = {
		name = emf_faction.1010.opt.b # Angry revolt
		FROM = {
			hidden_tooltip = {
				any_vassal = {
					limit = { is_playable = yes }
					opinion = { who = PREV modifier = opinion_hate multiplier = 4 years = 1 }
				}
			}
			random_vassal = {
				limit = { leads_faction = faction_glory }
				hidden_tooltip = { set_variable = { which = faction_votes value = 1 } }
				character_event = { id = PlusFaction.344 }
			}
		}
	}
	option = { name = CANCEL }
}


letter_event = { # Tradition
	id = emf_faction.1013
	desc = emf_faction.1010.desc

	is_triggered_only = yes

	option = {
		name = emf_faction.1010.opt.a # Standard revolt
		FROM = {
			random_vassal = {
				limit = { leads_faction = faction_tradition }
				hidden_tooltip = { set_variable = { which = faction_votes value = 1 } }
				character_event = { id = PlusFaction.344 }
			}
		}
	}
	option = {
		name = emf_faction.1010.opt.b # Angry revolt
		FROM = {
			hidden_tooltip = {
				any_vassal = {
					limit = { is_playable = yes }
					opinion = { who = PREV modifier = opinion_hate multiplier = 4 years = 1 }
				}
			}
			random_vassal = {
				limit = { leads_faction = faction_tradition }
				hidden_tooltip = { set_variable = { which = faction_votes value = 1 } }
				character_event = { id = PlusFaction.344 }
			}
		}
	}
	option = { name = CANCEL }
}


##### ONE-OFF TESTING ######

