namespace = emf_mongol

#######################################
# NEW MONGOL EVENTS
#######################################

### MAINTENANCE EVENTS

# Apply flags at game start
character_event = {
	id = emf_mongol.100
	
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		year = 1181
		NOT = { year = 1242 }
	}
	
	immediate = {
		any_character = {
			limit = { dynasty = 11100 } # Genghis Khan's dynasty
			if = {
				limit = {
					OR = {
						character = 125502
						father_even_if_dead = { character = 125502 }
					}
				}
				set_character_flag = line_of_jochi
			}
			if = {
				limit = {
					OR = {
						character = 93062
						father_even_if_dead = { character = 93062 }
					}
				}
				set_character_flag = line_of_chagatai
			}
			if = {
				limit = {
					OR = {
						character = 172005
						father_even_if_dead = { character = 172005 }
					}
				}
				set_character_flag = line_of_ogodei
			}
			if = {
				limit = {
					OR = {
						character = 125520
						father_even_if_dead = { character = 125520 }
					}
				}
				set_character_flag = line_of_tolui
			}
		}
	}
}

# Maintaining the lines of Genghis's sons
character_event = {
	id = emf_mongol.101
	
	hide_window = yes
	is_triggered_only = yes
	
	culture = mongol
	
	trigger = {
		dynasty = 11100
		num_of_children = 1
		OR = {
			has_character_flag = line_of_jochi
			has_character_flag = line_of_chagatai
			has_character_flag = line_of_ogodei
			has_character_flag = line_of_tolui
		}
	}
	
	immediate = {
		any_child = {
			limit = {
				is_female = no
				NOR = {
					trait = bastard
					has_character_flag = line_of_jochi
					has_character_flag = line_of_chagatai
					has_character_flag = line_of_ogodei
					has_character_flag = line_of_tolui
				}
			}
			if = {
				limit = { ROOT = { has_character_flag = line_of_jochi } }
				set_character_flag = line_of_jochi
			}
			if = {
				limit = { ROOT = { has_character_flag = line_of_chagatai } }
				set_character_flag = line_of_chagatai
			}
			if = {
				limit = { ROOT = { has_character_flag = line_of_ogodei } }
				set_character_flag = line_of_ogodei
			}
			if = {
				limit = { ROOT = { has_character_flag = line_of_tolui } }
				set_character_flag = line_of_tolui
			}
		}
	}
}

### MONGOL EMPIRE SPLITS UP

# Khan dies with a large enough empire to split up among sons/brothers
narrative_event = {
	id = emf_mongol.200
	title = EVTNAME_emf_mongol_200
	desc = EVTDESC_emf_mongol_200
	picture = GFX_evt_mongols
	
	is_triggered_only = yes
	major = yes
	
	ai = yes
	culture = mongol
	only_playable = yes
	only_independent = yes
	
	trigger = {
		has_landed_title = e_mongol_empire
		num_of_count_titles_in_realm = 75
		
		# Has at least twenty provinces for Golden Horde
		any_realm_province = {
			count = 20
			emf_golden_holde_province = yes
		}
		
		# Has at least twenty provinces for Il-Khanate
		any_realm_province = {
			count = 20
			emf_il_khanate_province = yes
		}
		
		# Has at least three valid heirs
		any_dynasty_member = {
			count = 3
			emf_valid_mongol_heir_for_ROOT = yes
		}
	}

	immediate = {
		# First attempt to give titles to historical people
		# Starting with Jochi & descendants
		if = {
			limit = { has_character_flag = is_temujin }
			random_dynasty_member = {
				limit = {
					has_character_flag = line_of_jochi
					emf_valid_mongol_heir_for_ROOT = yes
					NOT = {
						any_dynasty_member = {
							has_character_flag = line_of_jochi
							is_older_than = PREV
							emf_valid_mongol_heir_for_ROOT = yes
						}
					}
				}
				save_event_target_as = first_mongol_heir
			}
			random_dynasty_member = {
				limit = {
					has_character_flag = line_of_tolui
					emf_valid_mongol_heir_for_ROOT = yes
					NOT = {
						any_dynasty_member = {
							has_character_flag = line_of_tolui
							is_older_than = PREV
							emf_valid_mongol_heir_for_ROOT = yes
						}
					}
				}
				save_event_target_as = second_mongol_heir
			}
			random_dynasty_member = {
				limit = {
					has_character_flag = line_of_chagatai
					emf_valid_mongol_heir_for_ROOT = yes
					NOT = {
						any_dynasty_member = {
							has_character_flag = line_of_chagatai
							is_older_than = PREV
							emf_valid_mongol_heir_for_ROOT = yes
						}
					}
				}
				save_event_target_as = third_mongol_heir
			}
		}
		if = {
			limit = {
				OR = {
					has_character_flag = line_of_jochi
					has_character_flag = line_of_chagatai
					has_character_flag = line_of_ogodei
					has_character_flag = line_of_tolui
				}
			}
			random_dynasty_member = {
				limit = {
					ROOT = { NOT = { has_character_flag = line_of_jochi } }
					has_character_flag = line_of_jochi
					emf_valid_mongol_heir_for_ROOT = yes
					NOT = {
						any_dynasty_member = {
							has_character_flag = line_of_jochi
							is_older_than = PREV
							emf_valid_mongol_heir_for_ROOT = yes
						}
					}
				}
				save_event_target_as = first_mongol_heir
			}
			random_dynasty_member = {
				limit = {
					ROOT = { NOT = { has_character_flag = line_of_tolui } }
					has_character_flag = line_of_tolui
					emf_valid_mongol_heir_for_ROOT = yes
					NOT = {
						any_dynasty_member = {
							has_character_flag = line_of_tolui
							is_older_than = PREV
							emf_valid_mongol_heir_for_ROOT = yes
						}
					}
				}
				save_event_target_as = second_mongol_heir
			}
			random_dynasty_member = {
				limit = {
					ROOT = { NOT = { has_character_flag = line_of_chagatai } }
					has_character_flag = line_of_chagatai
					emf_valid_mongol_heir_for_ROOT = yes
					NOT = {
						any_dynasty_member = {
							has_character_flag = line_of_chagatai
							is_older_than = PREV
							emf_valid_mongol_heir_for_ROOT = yes
						}
					}
				}
				save_event_target_as = third_mongol_heir
			}
		}
		
		# Otherwise assign areas
		if = {
			limit = { NOT = { event_target:first_mongol_heir = { is_alive = yes } } }
			# Give Golden Horde to someone who's already a king in that region
			random_dynasty_member = {
				limit = {
					tier = KING
					emf_valid_mongol_heir_for_ROOT = yes
					capital_scope = { emf_golden_holde_province = yes }
					emf_child_or_heir_grandchild_of_ROOT = yes
					NOR = {
						character = event_target:second_mongol_heir
						character = event_target:third_mongol_heir
						any_dynasty_member = {
							tier = KING
							is_older_than = PREV
							emf_valid_mongol_heir_for_ROOT = yes
							capital_scope = { emf_golden_holde_province = yes }
							emf_child_or_heir_grandchild_of_ROOT = yes
							NOR = {
								character = event_target:second_mongol_heir
								character = event_target:third_mongol_heir
							}
						}
					}
				}
				save_event_target_as = first_mongol_heir
			}
			random_dynasty_member = {
				limit = {
					NOT = { event_target:first_mongol_heir = { is_alive = yes } }
					tier = KING
					emf_valid_mongol_heir_for_ROOT = yes
					capital_scope = { emf_golden_holde_province = yes }
					NOR = {
						character = event_target:second_mongol_heir
						character = event_target:third_mongol_heir
						any_dynasty_member = {
							tier = KING
							is_older_than = PREV
							emf_valid_mongol_heir_for_ROOT = yes
							capital_scope = { emf_golden_holde_province = yes }
							NOR = {
								character = event_target:second_mongol_heir
								character = event_target:third_mongol_heir
							}
						}
					}
				}
				save_event_target_as = first_mongol_heir
			}
		}
		if = {
			limit = { NOT = { event_target:first_mongol_heir = { is_alive = yes } } }
			# Give Golden Horde to someone who's already a duke in that region
			random_dynasty_member = {
				limit = {
					tier = DUKE
					emf_valid_mongol_heir_for_ROOT = yes
					capital_scope = { emf_golden_holde_province = yes }
					emf_child_or_heir_grandchild_of_ROOT = yes
					NOR = {
						character = event_target:second_mongol_heir
						character = event_target:third_mongol_heir
						any_dynasty_member = {
							tier = DUKE
							is_older_than = PREV
							emf_valid_mongol_heir_for_ROOT = yes
							capital_scope = { emf_golden_holde_province = yes }
							emf_child_or_heir_grandchild_of_ROOT = yes
							NOR = {
								character = event_target:second_mongol_heir
								character = event_target:third_mongol_heir
							}
						}
					}
				}
				save_event_target_as = first_mongol_heir
			}
			random_dynasty_member = {
				limit = {
					NOT = { event_target:first_mongol_heir = { is_alive = yes } }
					tier = DUKE
					emf_valid_mongol_heir_for_ROOT = yes
					capital_scope = { emf_golden_holde_province = yes }
					NOR = {
						character = event_target:second_mongol_heir
						character = event_target:third_mongol_heir
						any_dynasty_member = {
							tier = DUKE
							is_older_than = PREV
							emf_valid_mongol_heir_for_ROOT = yes
							capital_scope = { emf_golden_holde_province = yes }
							NOR = {
								character = event_target:second_mongol_heir
								character = event_target:third_mongol_heir
							}
						}
					}
				}
				save_event_target_as = first_mongol_heir
			}
		}
		if = {
			limit = { NOT = { event_target:first_mongol_heir = { is_alive = yes } } }
			# Otherwise give Golden Horde to heir or eldest available heir
			current_heir = {
				if = {
					limit = {
						NOR = {
							character = event_target:second_mongol_heir
							character = event_target:third_mongol_heir
						}
					}
					save_event_target_as = first_mongol_heir
				}
			}
			random_dynasty_member = {
				limit = {
					NOT = { event_target:first_mongol_heir = { is_alive = yes } }
					emf_valid_mongol_heir_for_ROOT = yes
					NOR = {
						character = event_target:second_mongol_heir
						character = event_target:third_mongol_heir
						emf_child_or_heir_grandchild_of_ROOT = yes
						any_dynasty_member = {
							is_older_than = PREV
							emf_valid_mongol_heir_for_ROOT = yes
							emf_child_or_heir_grandchild_of_ROOT = yes
							NOR = {
								character = event_target:second_mongol_heir
								character = event_target:third_mongol_heir
							}
						}
					}
				}
				save_event_target_as = first_mongol_heir
			}
			random_dynasty_member = {
				limit = {
					NOT = { event_target:first_mongol_heir = { is_alive = yes } }
					emf_valid_mongol_heir_for_ROOT = yes
					NOR = {
						character = event_target:second_mongol_heir
						character = event_target:third_mongol_heir
						any_dynasty_member = {
							is_older_than = PREV
							emf_valid_mongol_heir_for_ROOT = yes
							NOR = {
								character = event_target:second_mongol_heir
								character = event_target:third_mongol_heir
							}
						}
					}
				}
				save_event_target_as = first_mongol_heir
			}
		}
		if = {
			limit = { NOT = { event_target:second_mongol_heir = { is_alive = yes } } }
			# Give Il-Khanate to someone who's already a king in that region
			random_dynasty_member = {
				limit = {
					tier = KING
					emf_valid_mongol_heir_for_ROOT = yes
					capital_scope = { emf_il_khanate_province = yes }
					emf_child_or_heir_grandchild_of_ROOT = yes
					NOR = {
						character = event_target:first_mongol_heir
						character = event_target:third_mongol_heir
						any_dynasty_member = {
							tier = KING
							is_older_than = PREV
							emf_valid_mongol_heir_for_ROOT = yes
							capital_scope = { emf_il_khanate_province = yes }
							emf_child_or_heir_grandchild_of_ROOT = yes
							NOR = {
								character = event_target:first_mongol_heir
								character = event_target:third_mongol_heir
							}
						}
					}
				}
				save_event_target_as = second_mongol_heir
			}
			random_dynasty_member = {
				limit = {
					NOT = { event_target:second_mongol_heir = { is_alive = yes } }
					tier = KING
					emf_valid_mongol_heir_for_ROOT = yes
					capital_scope = { emf_il_khanate_province = yes }
					NOR = {
						character = event_target:first_mongol_heir
						character = event_target:third_mongol_heir
						any_dynasty_member = {
							tier = KING
							is_older_than = PREV
							emf_valid_mongol_heir_for_ROOT = yes
							capital_scope = { emf_il_khanate_province = yes }
							NOR = {
								character = event_target:first_mongol_heir
								character = event_target:third_mongol_heir
							}
						}
					}
				}
				save_event_target_as = second_mongol_heir
			}
		}
		if = {
			limit = { NOT = { event_target:second_mongol_heir = { is_alive = yes } } }
			# Give Il-Khanate to someone who's already a duke in that region
			random_dynasty_member = {
				limit = {
					tier = DUKE
					emf_valid_mongol_heir_for_ROOT = yes
					capital_scope = { emf_il_khanate_province = yes }
					emf_child_or_heir_grandchild_of_ROOT = yes
					NOR = {
						character = event_target:first_mongol_heir
						character = event_target:third_mongol_heir
						any_dynasty_member = {
							tier = DUKE
							is_older_than = PREV
							emf_valid_mongol_heir_for_ROOT = yes
							capital_scope = { emf_il_khanate_province = yes }
							emf_child_or_heir_grandchild_of_ROOT = yes
							NOR = {
								character = event_target:first_mongol_heir
								character = event_target:third_mongol_heir
							}
						}
					}
				}
				save_event_target_as = second_mongol_heir
			}
			random_dynasty_member = {
				limit = {
					NOT = { event_target:second_mongol_heir = { is_alive = yes } }
					tier = DUKE
					emf_valid_mongol_heir_for_ROOT = yes
					capital_scope = { emf_il_khanate_province = yes }
					NOR = {
						character = event_target:first_mongol_heir
						character = event_target:third_mongol_heir
						any_dynasty_member = {
							tier = DUKE
							is_older_than = PREV
							emf_valid_mongol_heir_for_ROOT = yes
							capital_scope = { emf_il_khanate_province = yes }
							NOR = {
								character = event_target:first_mongol_heir
								character = event_target:third_mongol_heir
							}
						}
					}
				}
				save_event_target_as = second_mongol_heir
			}
		}
		if = {
			limit = { NOT = { event_target:second_mongol_heir = { is_alive = yes } } }
			# Otherwise give Il-Khanate to heir or eldest available heir
			current_heir = {
				if = {
					limit = {
						NOR = {
							character = event_target:first_mongol_heir
							character = event_target:third_mongol_heir
						}
					}
					save_event_target_as = second_mongol_heir
				}
			}
			random_dynasty_member = {
				limit = {
					NOT = { event_target:second_mongol_heir = { is_alive = yes } }
					emf_valid_mongol_heir_for_ROOT = yes
					emf_child_or_heir_grandchild_of_ROOT = yes
					NOR = {
						character = event_target:first_mongol_heir
						character = event_target:third_mongol_heir
						any_dynasty_member = {
							is_older_than = PREV
							emf_valid_mongol_heir_for_ROOT = yes
							emf_child_or_heir_grandchild_of_ROOT = yes
							NOR = {
								character = event_target:first_mongol_heir
								character = event_target:third_mongol_heir
							}
						}
					}
				}
				save_event_target_as = second_mongol_heir
			}
			random_dynasty_member = {
				limit = {
					NOT = { event_target:second_mongol_heir = { is_alive = yes } }
					emf_valid_mongol_heir_for_ROOT = yes
					NOR = {
						character = event_target:first_mongol_heir
						character = event_target:third_mongol_heir
						any_dynasty_member = {
							is_older_than = PREV
							emf_valid_mongol_heir_for_ROOT = yes
							NOR = {
								character = event_target:first_mongol_heir
								character = event_target:third_mongol_heir
							}
						}
					}
				}
				save_event_target_as = second_mongol_heir
			}
		}
		if = {
			limit = { NOT = { event_target:third_mongol_heir = { is_alive = yes } } }
			# Give Chagatai to someone who's already a king in that region
			random_dynasty_member = {
				limit = {
					tier = KING
					emf_valid_mongol_heir_for_ROOT = yes
					capital_scope = { region = emf_region_mongol_east }
					emf_child_or_heir_grandchild_of_ROOT = yes
					NOR = {
						character = event_target:first_mongol_heir
						character = event_target:second_mongol_heir
						any_dynasty_member = {
							tier = KING
							is_older_than = PREV
							emf_valid_mongol_heir_for_ROOT = yes
							capital_scope = { region = emf_region_mongol_east }
							emf_child_or_heir_grandchild_of_ROOT = yes
							NOR = {
								character = event_target:first_mongol_heir
								character = event_target:second_mongol_heir
							}
						}
					}
				}
				save_event_target_as = third_mongol_heir
			}
			random_dynasty_member = {
				limit = {
					NOT = { event_target:third_mongol_heir = { is_alive = yes } }
					tier = KING
					emf_valid_mongol_heir_for_ROOT = yes
					capital_scope = { region = emf_region_mongol_east }
					NOR = {
						character = event_target:first_mongol_heir
						character = event_target:second_mongol_heir
						any_dynasty_member = {
							tier = KING
							is_older_than = PREV
							emf_valid_mongol_heir_for_ROOT = yes
							capital_scope = { region = emf_region_mongol_east }
							NOR = {
								character = event_target:first_mongol_heir
								character = event_target:second_mongol_heir
							}
						}
					}
				}
				save_event_target_as = third_mongol_heir
			}
		}
		if = {
			limit = { NOT = { event_target:third_mongol_heir = { is_alive = yes } } }
			# Give Chagatai to someone who's already a duke in that region
			random_dynasty_member = {
				limit = {
					tier = DUKE
					emf_valid_mongol_heir_for_ROOT = yes
					capital_scope = { region = emf_region_mongol_east }
					emf_child_or_heir_grandchild_of_ROOT = yes
					NOR = {
						character = event_target:first_mongol_heir
						character = event_target:second_mongol_heir
						any_dynasty_member = {
							tier = DUKE
							is_older_than = PREV
							emf_valid_mongol_heir_for_ROOT = yes
							capital_scope = { region = emf_region_mongol_east }
							emf_child_or_heir_grandchild_of_ROOT = yes
							NOR = {
								character = event_target:first_mongol_heir
								character = event_target:second_mongol_heir
							}
						}
					}
				}
				save_event_target_as = third_mongol_heir
			}
			random_dynasty_member = {
				limit = {
					NOT = { event_target:third_mongol_heir = { is_alive = yes } }
					tier = DUKE
					emf_valid_mongol_heir_for_ROOT = yes
					capital_scope = { region = emf_region_mongol_east }
					NOR = {
						character = event_target:first_mongol_heir
						character = event_target:second_mongol_heir
						any_dynasty_member = {
							tier = DUKE
							is_older_than = PREV
							emf_valid_mongol_heir_for_ROOT = yes
							capital_scope = { region = emf_region_mongol_east }
							NOR = {
								character = event_target:first_mongol_heir
								character = event_target:second_mongol_heir
							}
						}
					}
				}
				save_event_target_as = third_mongol_heir
			}
		}
		if = {
			limit = { NOT = { event_target:third_mongol_heir = { is_alive = yes } } }
			# Otherwise give Chagatai to heir or eldest available heir
			current_heir = {
				if = {
					limit = {
						NOR = {
							character = event_target:first_mongol_heir
							character = event_target:second_mongol_heir
						}
					}
					save_event_target_as = third_mongol_heir
				}
			}
			random_dynasty_member = {
				limit = {
					NOT = { event_target:third_mongol_heir = { is_alive = yes } }
					emf_valid_mongol_heir_for_ROOT = yes
					emf_child_or_heir_grandchild_of_ROOT = yes
					NOR = {
						character = event_target:first_mongol_heir
						character = event_target:second_mongol_heir
						any_dynasty_member = {
							is_older_than = PREV
							emf_valid_mongol_heir_for_ROOT = yes
							emf_child_or_heir_grandchild_of_ROOT = yes
							NOR = {
								character = event_target:first_mongol_heir
								character = event_target:second_mongol_heir
							}
						}
					}
				}
				save_event_target_as = third_mongol_heir
			}
			random_dynasty_member = {
				limit = {
					NOT = { event_target:third_mongol_heir = { is_alive = yes } }
					emf_valid_mongol_heir_for_ROOT = yes
					NOR = {
						character = event_target:first_mongol_heir
						character = event_target:second_mongol_heir
						any_dynasty_member = {
							is_older_than = PREV
							emf_valid_mongol_heir_for_ROOT = yes
							NOR = {
								character = event_target:first_mongol_heir
								character = event_target:second_mongol_heir
							}
						}
					}
				}
				save_event_target_as = third_mongol_heir
			}
		}
		
		# Stop any wars and disband the initial mongol forces
		any_war = {
			limit = {
				OR = {
					attacker = { character = ROOT }
					defender = { character = ROOT }
				}
			}
			end_war = invalid
		}
		disband_event_forces = horde_invasion
		
		# Fire the follow-up event
		current_heir = { character_event = { id = emf_mongol.201 days = 1 } }
	}
	
	option = {
		name = EVTOPTA_emf_mongol_200
		trigger = { character = ROOT }
	}
	option = {
		name = EVTOPTB_emf_mongol_200
		trigger = {
			NOT = { character = ROOT }
			OR = {
				culture = mongol
				same_realm = ROOT
			}
		}
	}
	option = {
		name = EVTOPTC_emf_mongol_200
		trigger = {
			NOR = {
				character = ROOT
				culture = mongol
				same_realm = ROOT
			}
		}
	}
}

# Bounce event to assign territories
character_event = {
	id = emf_mongol.201
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		e_golden_horde = { capital_scope = { county = { save_event_target_as = golden_horde_capital } } }
		e_il-khanate = { capital_scope = { county = { save_event_target_as = il_khanate_capital } } }
		e_chagatai = { capital_scope = { county = { save_event_target_as = chagatai_capital } } }
		
		# Ensure first heir gets a county in Golden Horde
		if = {
			limit = {
				event_target:first_mongol_heir = {
					NOT = { any_demesne_title = { location = { emf_golden_holde_province = yes } } }
				}
			}
			event_target:golden_horde_capital = {
				if = {
					limit = { owner_under_ROOT = yes }
					grant_title = event_target:first_mongol_heir
				}
			}
		}
		if = {
			limit = {
				event_target:first_mongol_heir = {
					NOT = { any_demesne_title = { location = { emf_golden_holde_province = yes } } }
				}
			}
			random_realm_title = {
				limit = {
					tier = COUNT
					location = { emf_golden_holde_province = yes }
					holder_scope = { character = ROOT }
				}
				grant_title = event_target:first_mongol_heir
			}
		}
		if = {
			limit = {
				event_target:first_mongol_heir = {
					NOT = { any_demesne_title = { location = { emf_golden_holde_province = yes } } }
				}
			}
			random_realm_title = {
				limit = {
					tier = COUNT
					location = { emf_golden_holde_province = yes }
					owner_under_ROOT = yes
				}
				grant_title = event_target:first_mongol_heir
			}
		}
	
		# Ensure second heir gets a county in Il-Khanate
		if = {
			limit = {
				event_target:second_mongol_heir = {
					NOT = { any_demesne_title = { location = { emf_il_khanate_province = yes } } }
				}
			}
			random_realm_title = {
				limit = {
					title = event_target:il_khanate_capital
					owner_under_ROOT = yes
				}
				grant_title = event_target:second_mongol_heir
			}
		}
		if = {
			limit = {
				event_target:second_mongol_heir = {
					NOT = { any_demesne_title = { location = { emf_il_khanate_province = yes } } }
				}
			}
			random_realm_title = {
				limit = {
					tier = COUNT
					location = { emf_il_khanate_province = yes }
					holder_scope = { character = ROOT }
				}
				grant_title = event_target:second_mongol_heir
			}
		}
		if = {
			limit = {
				event_target:second_mongol_heir = {
					NOT = { any_demesne_title = { location = { emf_il_khanate_province = yes } } }
				}
			}
			random_realm_title = {
				limit = {
					tier = COUNT
					location = { emf_il_khanate_province = yes }
					owner_under_ROOT = yes
				}
				grant_title = event_target:second_mongol_heir
			}
		}
		
		# Ensure third heir gets a county in Chagatai
		if = {
			limit = {
				event_target:third_mongol_heir = {
					NOT = { any_demesne_title = { location = { region = emf_region_mongol_east } } }
				}
			}
			random_realm_title = {
				limit = {
					title = event_target:chagatai_capital
					owner_under_ROOT = yes
				}
				grant_title = event_target:third_mongol_heir
			}
		}
		if = {
			limit = {
				event_target:third_mongol_heir = {
					NOT = { any_demesne_title = { location = { region = emf_region_mongol_east } } }
				}
			}
			random_realm_title = {
				limit = {
					tier = COUNT
					location = { region = emf_region_mongol_east }
					holder_scope = { character = ROOT }
				}
				grant_title = event_target:third_mongol_heir
			}
		}
		if = {
			limit = {
				event_target:third_mongol_heir = {
					NOT = { any_demesne_title = { location = { region = emf_region_mongol_east } } }
				}
			}
			random_realm_title = {
				limit = {
					tier = COUNT
					location = { region = emf_region_mongol_east }
					owner_under_ROOT = yes
				}
				grant_title = event_target:third_mongol_heir
			}
		}
	
		# Heirs that have lands in another's territory should give them up
		event_target:first_mongol_heir = {
			any_demesne_title = {
				limit = {
					NOT = { tier = EMPEROR }
					OR = {
						location = { emf_il_khanate_province = yes }
						capital_scope = { emf_il_khanate_province = yes }
					}
				}
				grant_title = event_target:second_mongol_heir
			}
			any_demesne_title = {
				limit = {
					NOT = { tier = EMPEROR }
					OR = {
						location = { region = emf_region_mongol_east }
						capital_scope = { region = emf_region_mongol_east }
					}
				}
				grant_title = event_target:third_mongol_heir
			}
		}
		event_target:second_mongol_heir = {
			any_demesne_title = {
				limit = {
					NOT = { tier = EMPEROR }
					OR = {
						location = { emf_golden_holde_province = yes }
						capital_scope = { emf_golden_holde_province = yes }
					}
				}
				grant_title = event_target:first_mongol_heir
			}
			any_demesne_title = {
				limit = {
					NOT = { tier = EMPEROR }
					OR = {
						location = { region = emf_region_mongol_east }
						capital_scope = { region = emf_region_mongol_east }
					}
				}
				grant_title = event_target:third_mongol_heir
			}
		}
		event_target:third_mongol_heir = {
			any_demesne_title = {
				limit = {
					NOT = { tier = EMPEROR }
					OR = {
						location = { emf_golden_holde_province = yes }
						capital_scope = { emf_golden_holde_province = yes }
					}
				}
				grant_title = event_target:first_mongol_heir
			}
			any_demesne_title = {
				limit = {
					NOT = { tier = EMPEROR }
					OR = {
						location = { emf_il_khanate_province = yes }
						capital_scope = { emf_il_khanate_province = yes }
					}
				}
				grant_title = event_target:second_mongol_heir
			}
		}
	
		# Create the new horde titles
		activate_title = { title = e_golden_horde status = yes }
		e_golden_horde = {
			copy_title_laws = e_mongol_empire
			grant_title = event_target:first_mongol_heir
			make_primary_title = yes
		}
		event_target:first_mongol_heir = {
			if = {
				limit = { has_dlc = "Horse Lords" }
				set_government_type = nomadic_government
				steal_population_scaled = { target = ROOT percentage = 0.50 }
			}
			if = {
				limit = { NOT = { has_dlc = "Horse Lords" } }
				set_government_type = tribal_government
			}
		}

		activate_title = { title = e_il-khanate status = yes }
		e_il-khanate = {
			copy_title_laws = e_mongol_empire
			grant_title = event_target:second_mongol_heir
			make_primary_title = yes
		}
		event_target:second_mongol_heir = {
			if = {
				limit = { has_dlc = "Horse Lords" }
				set_government_type = nomadic_government
				steal_population_scaled = { target = ROOT percentage = 0.40 }
			}
			if = {
				limit = { NOT = { has_dlc = "Horse Lords" } }
				set_government_type = tribal_government
			}
		}

		activate_title = { title = e_chagatai status = yes }
		e_chagatai = {
			copy_title_laws = e_mongol_empire
			grant_title = event_target:third_mongol_heir
			make_primary_title = yes
		}
		event_target:third_mongol_heir = {
			if = {
				limit = { has_dlc = "Horse Lords" }
				set_government_type = nomadic_government
				steal_population_scaled = { target = ROOT percentage = 0.10 }
			}
			if = {
				limit = { NOT = { has_dlc = "Horse Lords" } }
				set_government_type = tribal_government
			}
		}
	
		# Divvy up the vassals
		any_vassal = {
			limit = { capital_scope = { emf_golden_holde_province = yes } }
			set_defacto_liege = event_target:first_mongol_heir
			opinion = { who = event_target:first_mongol_heir modifier = opinion_loyal_vassal years = 10 }
		}
		any_vassal = {
			limit = { capital_scope = { emf_il_khanate_province = yes } }
			set_defacto_liege = event_target:second_mongol_heir
			opinion = { who = event_target:second_mongol_heir modifier = opinion_loyal_vassal years = 10 }
		}
		any_vassal = {
			limit = { capital_scope = { region = emf_region_mongol_east } }
			set_defacto_liege = event_target:third_mongol_heir
			opinion = { who = event_target:third_mongol_heir modifier = opinion_loyal_vassal years = 10 }
		}
		
		# If the main heir is not one of the three mongol heirs, give up non-empire tier titles now
		if = {
			limit = {
				NOT = { character = event_target:first_mongol_heir }
				NOT = { character = event_target:second_mongol_heir }
				NOT = { character = event_target:third_mongol_heir }
			}
			any_demesne_title = {
				limit = {
					NOT = { tier = EMPEROR }
					OR = {
						location = { emf_golden_holde_province = yes }
						capital_scope = { emf_golden_holde_province = yes }
					}
				}
				grant_title = event_target:first_mongol_heir
			}
			any_demesne_title = {
				limit = {
					NOT = { tier = EMPEROR }
					OR = {
						location = { emf_il_khanate_province = yes }
						capital_scope = { emf_il_khanate_province = yes }
					}
				}
				grant_title = event_target:second_mongol_heir
			}
			any_demesne_title = {
				limit = {
					NOT = { tier = EMPEROR }
					OR = {
						location = { region = emf_region_mongol_east }
						capital_scope = { region = emf_region_mongol_east }
					}
				}
				grant_title = event_target:third_mongol_heir
			}
		}
		
		# Any remaining children will be asked to swear to a son
		FROM = {
			any_child = {
				limit = {
					is_ruler = no
					prisoner = no
					is_adult = yes
					NOT = { character = event_target:first_mongol_heir }
					NOT = { character = event_target:second_mongol_heir }
					NOT = { character = event_target:third_mongol_heir }
				}
				#character_event = { id = 60003 days = 1 }
			}
		}
		
		# Any mongol generals will be asked to serve a son
		any_courtier = {
			limit = {
				culture = FROM
				is_ruler = no
				is_female = no
				NOT = { character = event_target:first_mongol_heir }
				NOT = { character = event_target:second_mongol_heir }
				NOT = { character = event_target:third_mongol_heir }
				NOT = { is_child_of = FROM }
				OR = {
					trait = brilliant_strategist
					martial = 12
				}
			}
			#character_event = { id = 60003 days = 1 }
		}
		
		# Send events to heirs
		#event_target:first_mongol_heir = { character_event = { id = 60004 } }
		#event_target:second_mongol_heir = { character_event = { id = 60004 } }
		#event_target:third_mongol_heir = { character_event = { id = 60004 } }
		
		if = {
			limit = {
				NOT = { character = event_target:first_mongol_heir }
				NOT = { character = event_target:second_mongol_heir }
				NOT = { character = event_target:third_mongol_heir }
			}
			set_defacto_liege = event_target:first_mongol_heir
		}
		
		e_mongol_empire = {
			unsafe_destroy_landed_title = THIS
			activate_title = { title = THIS status = no }
		}
	}
}

