# -*- ck2.events -*-

namespace = emf_religion

# Religion Events
# Future home of schism events, (possibly) Shiite school traits, and other things

# Raider Trait Gained
character_event = {
	id = emf_religion.0
	desc = emf_religion.0.desc
	picture = GFX_evt_vikings_arriving_oldgods
	border = GFX_event_normal_frame_war

	is_triggered_only = yes
	hide_from = yes

	min_age = 16
	capable_only = yes
	prisoner = no

	trigger = {
		NOT = { trait = raider }
		NOR = {
			religion = norse_pagan
			religion = norse_pagan_reformed
		}
	}

	option = {
		name = emf_religion.0.a
		add_trait = raider
	}
}


# emf_religion.1 -- on_new_holder (creation) for holy orders to ensure they are setup correctly
character_event = {
	id = emf_religion.1

	is_triggered_only = yes
	hide_window = yes

	trigger = {
		FROM = { holy_order = yes }
		NOT = { FROMFROM = { always = yes } }
	}

	immediate = {
		# Ensure independent [NOTE: might not want this for all holy_order=yes titles, but currently we do.]
		if = {
			limit = { independent = no }
			set_defacto_liege = ROOT
			emf_liege_change = yes
		}
		set_government_type = order_government
		emf_create_courtiers = yes
		# Award religious authority
		if = {
			limit = { NOT = { religion_authority = 0.75 } }
			religion_authority = { modifier = religious_order_formed }
		}
		# Ensure wealth
		if = {
			limit = { NOT = { wealth = 500 } }
			clear_wealth = yes
			wealth = 500
		}
	}
}

# emf_religion.2 -- Assignment of syncretic traits on_birth, on_conversion, on new characters spawning, etc.
character_event = {
	id = emf_religion.2

	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		OR = {
			has_religion_feature = religion_syncretic_christian
			has_religion_feature = religion_syncretic_muslim
			has_religion_feature = religion_syncretic_zoroastrian
			has_religion_feature = religion_syncretic_indian
		}
	}
	
	immediate = {
		if = {
			limit = { has_religion_feature = religion_syncretic_christian }
			add_trait = syncretic_christian
		}
		if = {
			limit = { has_religion_feature = religion_syncretic_muslim }
			add_trait = syncretic_muslim
		}
		if = {
			limit = { has_religion_feature = religion_syncretic_zoroastrian }
			add_trait = syncretic_zoroastrian
		}
		if = {
			limit = { has_religion_feature = religion_syncretic_indian }
			add_trait = syncretic_indian
		}
	}
}

# emf_religion.3 -- Activation of Jewish Great Holy Wars, after Christians and Muslims
narrative_event = {
	id = emf_religion.3
	title = EVTNAME_emf_religion_3
	desc = EVTDESC_emf_religion_3
	picture = GFX_evt_synagogue
	border = GFX_event_narrative_frame_religion

	major = yes

	show_ROOT = yes
	hide_new = yes

	only_playable = yes
	min_age = 16
	religion_group = jewish_group

	trigger = {
		NOT = {
			has_alternate_start_parameter = { key = religion_names value = random }
		}
		controls_religion = yes

		NOT = { has_global_flag = jewish_ghws_unlocked }

		OR = {
			has_global_flag = muslim_jihads_unlocked
			has_global_flag = christian_crusades_unlocked
		}
	}

	mean_time_to_happen = {
		months = 120
		modifier = {
			factor = 0
			has_global_flag = emf_debug_fast_ghw_unlock
		}
	}

	immediate = {
		set_global_flag = jewish_ghws_unlocked
	}

	option = {
		name = EVTOPTA_emf_religion_3
		trigger = {
			religion_group = jewish_group
		}
	}

	option = {
		name = EVTOPTB_emf_religion_3
		trigger = {
			NOT = { religion_group = jewish_group }
		}
	}
}

# emf_religion.4 -- Activation of Mazdan Great Holy Wars, after Christians and Muslims
narrative_event = {
	id = emf_religion.4
	title = EVTNAME_emf_religion_4
	desc = EVTDESC_emf_religion_4
	picture = GFX_evt_zoroaster
	border = GFX_event_narrative_frame_religion

	major = yes

	show_ROOT = yes
	hide_new = yes

	only_playable = yes
	min_age = 16
	religion_group = zoroastrian_group

	trigger = {
		NOT = {
			has_alternate_start_parameter = { key = religion_names value = random }
		}
		controls_religion = yes

		NOT = { has_global_flag = zoroastrian_ghws_unlocked }

		OR = {
			has_global_flag = muslim_jihads_unlocked
			has_global_flag = christian_crusades_unlocked
		}
	}

	mean_time_to_happen = {
		months = 120
		modifier = {
			factor = 0
			has_global_flag = emf_debug_fast_ghw_unlock
		}
	}

	immediate = {
		set_global_flag = zoroastrian_ghws_unlocked
	}

	option = {
		name = EVTOPTA_emf_religion_4
		trigger = {
			religion_group = zoroastrian_group
		}
	}

	option = {
		name = EVTOPTB_emf_religion_4
		trigger = {
			NOT = { religion_group = zoroastrian_group }
		}
	}
}

# emf_religion.5 -- Set GHW flags for alternate start worlds in existing saves
character_event = {
	id = emf_religion.5

	is_triggered_only = yes
	hide_window = yes
	
	religion = hip_religion
	
	trigger = {
		has_landed_title = e_hip
		is_alternate_start = yes
		has_alternate_start_parameter = { key = religion_names value = random }
		has_global_flag = ghw_activated
	}
	
	immediate = {
		set_global_flag = jewish_ghws_unlocked
		set_global_flag = zoroastrian_ghws_unlocked
	}
}
