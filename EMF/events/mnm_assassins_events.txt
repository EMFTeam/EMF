###########################################
#                                         #
# M&M Assassins Society Events            #
#                                         #
# ID MNM.6000-MNM.6999		              #
#                                         #
###########################################

namespace = MNM

###BORROWING/DONATING MONEY###

character_event = {
	id = MNM.6000
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		save_event_target_as = grand_master
		FROM = { letter_event = { id = MNM.6001 } }
	}
}

#Borrowing money
letter_event = {
	id = MNM.6001
	desc = EVTDESC_MNM_6001
	border = GFX_event_letter_frame_religion

	is_triggered_only = yes

	immediate = {
		set_variable = { which = assassins_debt value = 0 }
		add_character_modifier = {
			name = assassins_debt
			duration = -1
		}
		set_character_flag = block_payback
	}

	#50
	option = {
		trigger = {
			event_target:grand_master = {
				OR = {
					ai = no
					NOT = { primary_title = { title = d_hashshashin } }
					wealth = 50
				}
			}
		}
		name = EVTOPTA_MNM_6001
		wealth = 50
		hidden_tooltip = { 
			change_variable = { which = assassins_debt value = 50 } 

			character_event = { id = MNM.6009 days = 1000 random = 1000 }

			event_target:grand_master = {
				if = {
					limit = { 
						ai = yes
						primary_title = { title = d_hashshashin } 
					}
					wealth = -50
				}
			}
		}
		clr_character_flag = block_payback

		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				monthly_income = 10
			}
		}
	}

	#250
	option = {
		trigger = {
			event_target:grand_master = {
				OR = {
					ai = no
					NOT = { primary_title = { title = d_hashshashin } }
					wealth = 250
				}
			}
			has_society_currency_minor_trigger = yes
		}
		name = EVTOPTB_MNM_6001
		wealth = 250
		detract_society_currency_minor_effect = yes
		hidden_tooltip = { 
			change_variable = { which = assassins_debt value = 250 } 

			character_event = { id = MNM.6009 days = 1000 random = 1000 }

			event_target:grand_master = {
				if = {
					limit = { 
						ai = yes
						primary_title = { title = d_hashshashin } 
					}
					wealth = -250
				}
			}
		}
		clr_character_flag = block_payback

		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				OR = {
					monthly_income = 20
					NOT = { monthly_income = 10 }
				}
			}
		}
	}

	#500
	option = {
		trigger = {
			event_target:grand_master = {
				OR = {
					ai = no
					NOT = { primary_title = { title = d_hashshashin } }
					wealth = 500
				}
			}
			has_society_currency_medium_trigger = yes
		}
		name = EVTOPTC_MNM_6001
		wealth = 500
		detract_society_currency_medium_effect = yes
		hidden_tooltip = { 
			change_variable = { which = assassins_debt value = 500 } 

			character_event = { id = MNM.6009 days = 1000 random = 1000 }

			event_target:grand_master = {
				if = {
					limit = { 
						ai = yes
						primary_title = { title = d_hashshashin } 
					}
					wealth = -500
				}
			}
		}
		clr_character_flag = block_payback

		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				NOT = { monthly_income = 20 }
			}
		}
	}

	#Opt out
	option = {
		name = EVTOPTD_MNM_6001

		hidden_tooltip = {
			remove_character_modifier = assassins_debt 
		}
		clr_character_flag = block_payback

		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
			}
		}
	}
}

#Transfer debt to heir
character_event = {
	id = MNM.6012
	hide_window = yes

	trigger = {
		has_character_modifier = assassins_debt
	}

	is_triggered_only = yes

	immediate = {
		current_heir = {
			add_character_modifier = {
				name = assassins_debt
				duration = -1
			}

			if = {
				limit = { ROOT = { check_variable = { which = assassins_debt value = 50 } } }
				set_variable = { which = assassins_debt value = 50 }
			}
			if = {
				limit = { ROOT = { check_variable = { which = assassins_debt value = 250 } } }
				set_variable = { which = assassins_debt value = 250 }
			}
			if = {
				limit = { ROOT = { check_variable = { which = assassins_debt value = 500 } } }
				set_variable = { which = assassins_debt value = 500 }
			}

			character_event = { id = MNM.6009 days = 1500 random = 1500 }
		}
	}
}

#Donating
character_event = {
	id = MNM.6004
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		save_event_target_as = grand_master
		FROM = { letter_event = { id = MNM.6005 } }
	}
}

letter_event = {
	id = MNM.6005
	desc = EVTDESC_MNM_6005
	border = GFX_event_letter_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_6005
		wealth = -200
		add_society_currency_minor_effect = yes

		hidden_tooltip = {
			event_target:grand_master = {
				if = {
					limit = {
						ai = no
						has_landed_title = d_hashshashin
					}
					wealth = 100
				}
			}
		}
	}
}

character_event = {
	id = MNM.6009
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		save_event_target_as = in_debt
		random_society_member = {
			limit = { 
				society_rank == 4
				society_member_of = the_assassins
			}
			character_event = { id = MNM.6010 }
		}
	}
}

character_event = {
	id = MNM.6010
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		event_target:in_debt = { letter_event = { id = MNM.6006 } }
	}
}


#Events for demands to pay back loan
letter_event = {
	id = MNM.6006
	border = GFX_event_letter_frame_religion

	desc = {
		trigger = {
			OR = {
				is_variable_equal = { which = assassins_debt value = 50 }
				AND = {
					is_variable_equal = { which = assassins_debt value = 250 }
					NAND = {
						event_target:child_offer = { always = yes }
						event_target:d_hashshashin_holder = { always = yes }
					}
				}
				AND = {
					is_variable_equal = { which = assassins_debt value = 500 }
					NAND = {
						event_target:castle_offer = { always = yes }
						event_target:d_hashshashin_holder = { always = yes }
					}
				}
			}
		}
		text = EVTDESC_MNM_6006_A #Just gold
	}
	desc = {
		trigger = { 
			event_target:child_offer = { always = yes } 
			is_variable_equal = { which = assassins_debt value = 250 }
			event_target:d_hashshashin_holder = { always = yes }
		}
		text = EVTDESC_MNM_6006_B #Gold or child
	}
	desc = {
		trigger = { 
			event_target:castle_offer = { always = yes } 
			is_variable_equal = { which = assassins_debt value = 500 }
			event_target:d_hashshashin_holder = { always = yes }
		}
		text = EVTDESC_MNM_6006_C #Gold or castle
	}

	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = assassins_debt
		check_variable = { which = assassins_debt value = 50 }
	}

	immediate = {
		random_child = {
			limit = {
				is_primary_heir = no
				OR = {
					is_female = no
					ROOT = { gender_equality_trigger = yes }
				}
				is_adult = yes
				useless_character_trigger = no
			}
			save_event_target_as = child_offer
		}
		random_demesne_province = {
			limit = {
				is_capital = no
				has_empty_holding = yes
			}
			save_event_target_as = castle_offer
		}
		random_independent_ruler = {
			limit = {
				has_landed_title = d_hashshashin
				society_member_of = the_assassins
			}
			save_event_target_as = d_hashshashin_holder
		}
	}

	#Pay back 
	option = {
		name = EVTOPTA_MNM_6006

		pay_back_assassins_effect = yes

		remove_assassins_debt_effect = yes
	}

	#Child 
	option = {
		trigger = { 
			is_variable_equal = { which = assassins_debt value = 250 } 
			event_target:child_offer = { always = yes }
			event_target:d_hashshashin_holder = { always = yes }
		}
		name = EVTOPTB_MNM_6006
		custom_tooltip = { text = EVTOPTB_MNM_6006_TOOLTIP }

		event_target:child_offer = {
			move_character = event_target:d_hashshashin_holder
			join_society = the_assassins
			hidden_tooltip = {
				clear_wealth = yes
				end_inaccessibility_effect = yes
				add_trait = disinherited
			}
		}

		remove_assassins_debt_effect = yes
	}

	#Castle
	option = {
		trigger = { 
			is_variable_equal = { which = assassins_debt value = 500 } 
			event_target:castle_offer = { always = yes }
			event_target:d_hashshashin_holder = { always = yes }
		}
		name = EVTOPTC_MNM_6006
		
		wealth = -100

		event_target:castle_offer = {
			build_holding = {
				type = castle
				holder = event_target:d_hashshashin_holder
			}
		}

		remove_assassins_debt_effect = yes
	}

	#Nope
	option = {
		name = EVTOPTD_MNM_6006
		custom_tooltip = { text = EVTOPTD_MNM_6006_TOOLTIP }

		set_character_flag = assassins_refused_to_pay_debt
	}
}


###JOINING & RECRUITMENT EVENTS###

#Does recruit approve of shia?
character_event = {
	id = MNM.6020
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy

	desc = {
		trigger = { NOT = { religion_group = muslim } }
		text = EVTDESC_MNM_6020_A
	}
	desc = {
		trigger = { religion_group = muslim }
		text = EVTDESC_MNM_6020_B
	}

	is_triggered_only = yes

	immediate = {
		if = {
			limit = { NOT = { event_target:assassins_recruiter = { always = yes } } }
			FROMFROM = { save_event_target_as = assassins_recruiter }
		}
		save_event_target_as = assassins_recruitee
		set_character_flag = ongoing_recruitment
	}

	#Acccepting of Shia
	option = {
		name = {
			trigger = { NOT = { religion_group = muslim } }
			text = EVTOPTA_6020_NOTMUSLIM
		}
		
		name = {
			trigger = { religion_group = muslim }
			text = EVTOPTA_6020_MUSLIM
		}

		reverse_opinion = {
			who = event_target:assassins_recruiter
			modifier = opinion_agreed_with_opinion
			years = 5
		}

		set_character_flag = approves_of_shia

		hidden_effect = { event_target:assassins_recruiter = { character_event = { id = MNM.6021 days = 3 } } }

		ai_chance = {
			factor = 20
			modifier = {
				factor = 0
				trait = zealous
				NOT = { secret_religion = shiite }
			}
			modifier = {
				factor = 0
				true_religion_shiite_trigger = no
				OR = {
					controls_religion = yes
					capital_holding = { holding_type = TEMPLE }
				}
			}
			modifier = {
				factor = 1.5
				trait = cynical
			}
			modifier = {
				factor = 1.5
				trait = trusting
			}
			modifier = {
				factor = 1.5
				is_dumb_trigger = yes
			}
			modifier = {
				factor = 1.5
				true_religion_group_muslim_trigger = yes
			}
		}
	}

	#Disapproving of shia
	option = {
		trigger = { true_religion_shiite_trigger = no }

		name = {
			trigger = { NOT = { religion_group = muslim } }
			text = EVTOPTB_6020_NOTMUSLIM
		}
		name = {
			trigger = { religion_group = muslim }
			text = EVTOPTB_6020_MUSLIM
		}

		reverse_opinion = {
			who = event_target:assassins_recruiter
			modifier = opinion_disagreed_with_opinion
			years = 5
		}

		set_character_flag = disapproves_of_shia

		hidden_effect = { event_target:assassins_recruiter = { character_event = { id = MNM.6021 days = 3 } } }

		ai_chance = {
			factor = 80
			modifier = {
				factor = 1.5
				has_pious_trait_trigger = yes
			}
			modifier = {
				factor = 2
				has_crusade_trait_trigger = yes
				NOT = { trait = mujahid }
			}
		}
	}
}

#True religion, or sympathetic?
character_event = {
	id = MNM.6021
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_intrigue

	desc = {
		trigger = { FROM = { has_character_flag = approves_of_shia } }
		text = EVTDESC_MNM_6021_A
	}
	desc = {
		trigger = { FROM = { has_character_flag = disapproves_of_shia } }
		text = EVTDESC_MNM_6021_B
	}

	is_triggered_only = yes

	#Go ahead
	option = {
		trigger = { FROM = { has_character_flag = approves_of_shia } }
		name = EVTOPTA_6021
		custom_tooltip = { text = EVTOPTA_6021_TOOLTIP }

		hidden_effect = {
			FROM = {
				character_event = { id = MNM.6022 days = 14 }
				clr_character_flag = approves_of_shia
			}
		}
		ai_chance = { factor = 100 }
	}

	#Too risky, end
	option = {
		trigger = { FROM = { has_character_flag = approves_of_shia } }
		name = EVTOPTB_6021
		custom_tooltip = { text = EVTOPTB_6021_TOOLTIP }
		hidden_effect = { FROM = { clr_character_flag = approves_of_shia } }
		hidden_effect = { FROM = { clr_character_flag = ongoing_recruitment } }
		ai_chance = { factor = 0 }
	}

	#Dislikes shia, end
	option = {
		trigger = { FROM = { has_character_flag = disapproves_of_shia } }
		name = EVTOPTC_6021
		custom_tooltip = { text = EVTOPTB_6021_TOOLTIP }
		hidden_effect = { FROM = { clr_character_flag = disapproves_of_shia } }
		hidden_effect = { FROM = { clr_character_flag = ongoing_recruitment } }
	}
}

#Talking about fighting for the faith, reaction
character_event = {
	id = MNM.6022
	picture = GFX_evt_shady_meeting
	border = GFX_event_normal_frame_diplomacy

	desc = {
		trigger = { FROM = { NOT = { religion = shiite } } }
		text = EVTDESC_MNM_6022_A
	}
	desc = {
		trigger = { FROM = { religion = shiite } }
		text = EVTDESC_MNM_6022_B
	}

	is_triggered_only = yes

	immediate = {
		if = { 
			limit = { NOT = { event_target:assassins_recruiter = { always = yes } } }
			FROMFROM = { save_event_target_as = assassins_recruiter }
			save_event_target_as = assassins_recruitee
		}
	}
	
	#Willing to join
	option = {
		name = EVTOPTA_6022
		
		reverse_opinion = {
			who = event_target:assassins_recruiter
			modifier = opinion_honorable
			years = 5
		}

		set_character_flag = willing_to_join
		
		hidden_effect = { event_target:assassins_recruiter = { character_event = { id = MNM.6023 days = 1 } } }
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 3
				trait = zealous
			}
			modifier = {
				factor = 1.5
				trait = ambitious
			}
			modifier = {
				factor = 1.5
				has_education_intrigue_trigger = yes
			}
			modifier = {
				factor = 1.5
				has_lifestyle_intrigue_trigger = yes
			}
			modifier = {
				factor = 1.5
				FROM = { diplomacy = 12 }
			}
			modifier = {
				factor = 1.5
				FROM = { intrigue = 12 }
			}
		}
	}

	#Not willing to join
	option = {
		name = EVTOPTB_6022
		
		reverse_opinion = {
			who = event_target:assassins_recruiter
			modifier = opinion_lacks_conviction
			years = 5
		}

		set_character_flag = unwilling_to_join
		
		hidden_effect = { event_target:assassins_recruiter = { character_event = { id = MNM.6023 days = 1 } } }
		
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0.5
				true_religion_shiite_trigger = no
			}
			modifier = {
				factor = 0.5
				trait = craven
			}
			modifier = {
				factor = 0.5
				trait = content
			}
			modifier = {
				factor = 0.5
				trait = cynical
			}
			modifier = {
				factor = 1.5
				FROM = { NOT = { diplomacy = 8 } }
			}
			modifier = {
				factor = 1.5
				FROM = { NOT = { intrigue = 8 } }
			}
		}
	}
}

#Wants to join? Make the offer
character_event = {
	id = MNM.6023
	picture = GFX_evt_shady_meeting
	border = GFX_event_normal_frame_intrigue

	desc = {
		trigger = { FROM = { has_character_flag = willing_to_join } }
		text = EVTDESC_MNM_6023_A
	}
	desc = {
		trigger = { FROM = { has_character_flag = unwilling_to_join } }
		text = EVTDESC_MNM_6023_B
	}

	is_triggered_only = yes

	#Pose the question
	option = {
		trigger = { FROM = { has_character_flag = willing_to_join } }
		name = EVTOPTA_6023
		custom_tooltip = { text = EVTOPTA_6023_TOOLTIP }

		hidden_effect = {
			FROM = {
				character_event = { id = MNM.6024 days = 1 }
				clr_character_flag = willing_to_join
			}
		}

		ai_chance = { factor = 100 }
	}

	#Too risky, end
	option = {
		trigger = { FROM = { has_character_flag = willing_to_join } }
		name = EVTOPTB_6023
		custom_tooltip = { text = EVTOPTB_6021_TOOLTIP }
		hidden_effect = { FROM = { clr_character_flag = willing_to_join } }
		hidden_effect = { FROM = { clr_character_flag = ongoing_recruitment } }
		ai_chance = { factor = 0 }
	}

	#Not interested, end
	option = {
		trigger = { FROM = { has_character_flag = unwilling_to_join } }
		name = EVTOPTC_6023
		custom_tooltip = { text = EVTOPTB_6021_TOOLTIP }
		hidden_effect = { FROM = { clr_character_flag = unwilling_to_join } }
		hidden_effect = { FROM = { clr_character_flag = ongoing_recruitment } }
	}
}

#Offer to join, yes or no?
character_event = {
	id = MNM.6024
	picture = GFX_evt_shady_meeting
	desc = EVTDESC_MNM_6024
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	#Yes
	option = {
		name = EVTOPTA_6024
		custom_tooltip = { text = EVTOPTA_6024_TOOLTIP }

		hidden_effect = { event_target:assassins_recruiter = { character_event = { id = MNM.6026 days = 1 } } }
	}

	#No
	option = {
		name = EVTOPTB_6024
		custom_tooltip = { text = EVTOPTB_6024_TOOLTIP }

		hidden_effect = { event_target:assassins_recruiter = { character_event = { id = MNM.6025 days = 1 } } }
	}
}

#Recruit said no
character_event = {
	id = MNM.6025
	picture = GFX_evt_quarrel
	desc = EVTDESC_MNM_6025
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	option = {
		name = EVTOPTA_6025
		custom_tooltip = { text = EVTOPTB_6021_TOOLTIP }
		hidden_effect = { FROM = { clr_character_flag = ongoing_recruitment } }
	}
}

#Recruit said yes 
character_event = {
	id = MNM.6026
	picture = GFX_evt_whispers
	desc = EVTDESC_MNM_6026
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes
	hide_new = yes

	immediate = {
		if = {
			limit = {
				NOT = {
					any_society_member = {
						society_rank = {
							society = the_assassins
							rank == 3
						}
					}
				}
			}
			random_society_member = {
				limit = {
					society_rank = {
						society = the_assassins
						rank == 4
					}
				}
				create_character = {
					age = 30
					female = no
					random_traits = no
					dynasty = random
					trait = elusive_shadow
					trait = patient
					trait = zealous
					trait = scholar
					trait = chaste
					trait = temperate
				}
				new_character = {
					join_society = the_assassins
					society_rank_up = {
						rank = 2
						society = the_assassins
					}
					if = {
						limit = { NOT = { religion = shiite } }
						set_secret_religion = shiite
					}
				}
			}
		}

		random_society_member = { 
			limit = { 
				society_rank = {
					society = the_assassins
					rank == 3
				}
			}
			save_event_target_as = assassins_inductor
		}
	}

	option = {
		name = EVTOPTA_6026
		custom_tooltip = { text = EVTOPTA_6026_TOOLTIP }

		hidden_effect = { FROM = { character_event = { id = MNM.6027 days = 1 } } }
	}
}

#Confirmation for recruit
character_event = {
	id = MNM.6027
	picture = GFX_evt_whispers
	desc = EVTDESC_MNM_6027
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	option = {
		name = EVTOPTA_6027
		custom_tooltip = { text = EVTOPTA_6027_TOOLTIP }

		hidden_effect = { 
			character_event = { id = MNM.6028 days = 14 random = 7 } 
		}
	}
}

#Joining begins
character_event = {
	id = MNM.6028
	picture = GFX_evt_shadow
	desc = EVTDESC_MNM_6028
	border = GFX_event_normal_frame_intrigue

	hide_from = yes

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			random_society_member = {
				limit = { 
					society_rank = {
						rank == 4
						society = the_assassins
					}
				}
				save_event_target_as = grand_master
			}
		}
		set_character_flag = assassins_attempted_recruitment
	}

	#Allahu akbar!
	option = {
		trigger = { true_religion_shiite_trigger = yes }
		name = EVTOPTA_6028
		custom_tooltip = { text = EVTOPTA_6028_TOOLTIP }

		hidden_effect = { character_event = { id = MNM.6029 days = 1 } }
	}

	#I will convert
	option = {
		trigger = { true_religion_shiite_trigger = no }
		name = EVTOPTB_6028
		custom_tooltip = { text = EVTOPTB_6028_TOOLTIP }

		religion = shiite

		hidden_effect = { character_event = { id = MNM.6029 days = 1 } }
		
		ai_chance = {
			factor = 20

			modifier = {
				true_religion_group_muslim_trigger = yes
				factor = 2
			}
			modifier = {
				independent = yes
				factor = 2
			}
			modifier = {
				trait = brave
				factor = 2
			}
			modifier = {
				trait = honest
				factor = 2
			}
		}
	}

	#I will convert, secretly
	option = {
		trigger = { true_religion_shiite_trigger = no }
		name = EVTOPTC_6028
		custom_tooltip = { text = EVTOPTC_6028_TOOLTIP }
		
		clear_secret_religion = yes
		set_secret_religion = shiite

		hidden_effect = { character_event = { id = MNM.6029 days = 1 } }

		ai_chance = {
			factor = 80
			modifier = {
				trait = craven
				factor = 2
			}
			modifier = {
				trait = deceitful
				factor = 2
			}
		}
	}

	#Nope!
	option = {
		name = EVTOPTD_6028
		custom_tooltip = { text = EVTOPTD_6028_TOOLTIP }

		hidden_effect = { 
			FROM = { character_event = { id = MNM.6039 days = 3 } } #Fail

			if = {
				limit = { event_target:assassins_recruiter = { always = yes } }
				event_target:assassins_recruiter = { set_character_flag = recruitment_fail }
				event_target:grand_master = { character_event = { id = MNM.6040 } }
			}
		} 

		ai_chance = {
			factor = 0
		}
	}
}

#Sign written delcaration of loyalty to grand master
character_event = {
	id = MNM.6029
	picture = GFX_evt_shadow
	desc = EVTDESC_MNM_6029
	border = GFX_event_normal_frame_intrigue

	hide_from = yes

	is_triggered_only = yes

	#Yes
	option = {
		name = EVTOPTA_6029
		custom_tooltip = { text = EVTOPTA_6029_TOOLTIP }

		hidden_effect = { character_event = { id = MNM.6030 days = 1 } }

		ai_chance = {
			factor = 100
		}
	}

	#No
	option = {
		name = EVTOPTB_6029
		custom_tooltip = { text = EVTOPTB_6029_TOOLTIP }

		hidden_effect = { 
			FROM = { character_event = { id = MNM.6039 days = 3 } } #Fail

			if = {
				limit = { event_target:assassins_recruiter = { always = yes } }
				event_target:assassins_recruiter = { set_character_flag = recruitment_fail }
				event_target:grand_master = { character_event = { id = MNM.6040 } } 
			}
		} 

		ai_chance = {
			factor = 0
		}
	}
}

#Inductor will get in contact with you
character_event = {
	id = MNM.6030
	picture = GFX_evt_shadow
	desc = EVTDESC_MNM_6030
	border = GFX_event_normal_frame_intrigue

	hide_from = yes

	is_triggered_only = yes

	option = {
		name = EVTOPTA_6030
		custom_tooltip = { text = EVTOPTA_6030_TOOLTIP }

		hidden_effect = { character_event = { id = MNM.6031 days = 30 random = 6 } } 
	}
}

#Sending event to inductor
character_event = {
	id = MNM.6031
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		if = { 
			limit = { NOT = { event_target:assassins_inductor = { always = yes } } }

			if = {
				limit = {
					NOT = {
						any_society_member = { 
							society_rank = {
								society = the_assassins
								rank == 3
							}
						}
					}
				}
				random_society_member = { 
					limit = {
						society_rank = {
							society = the_assassins
							rank == 4
						}
					}
		
					create_character = {
						age = 30
						female = no
						random_traits = no
						dynasty = random
						trait = elusive_shadow
						trait = patient
						trait = zealous
						trait = scholar
						trait = chaste
						trait = temperate
					}
					new_character = {
						join_society = the_assassins
						society_rank_up = {
							rank = 2
							society = the_assassins
						}
						if = {
							limit = { NOT = { religion = shiite } }
							set_secret_religion = shiite
						}
					}
				}
			}
			random_society_member = { 
				limit = { 
					society_rank = {
						society = the_assassins
						rank == 3
					}
				}
				save_event_target_as = assassins_inductor
			}	
		}
		event_target:assassins_inductor = { 
			set_character_flag = event_MNM_6033
			character_event = { id = MNM.6032 } 
		}
	}
}

#Ping event for inductor
character_event = {
	id = MNM.6032
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		trigger_switch = {
			on_trigger = has_character_flag
			event_MNM_6033 = { FROM = { letter_event = { id = MNM.6033 } } }
			event_MNM_6034 = { FROM = { character_event = { id = MNM.6034 days = 14 } } }
			event_MNM_6035 = { FROM = { character_event = { id = MNM.6035 days = 3 } } }
			event_MNM_6036 = { FROM = { character_event = { id = MNM.6036 days = 5 } } }
			event_MNM_6037 = { FROM = { character_event = { id = MNM.6037 days = 1 } } }
			event_MNM_6038 = { FROM = { character_event = { id = MNM.6038 days = 1 } } }
		}
		clr_character_flag = event_MNM_6033
		clr_character_flag = event_MNM_6034
		clr_character_flag = event_MNM_6035
		clr_character_flag = event_MNM_6036
		clr_character_flag = event_MNM_6037
		clr_character_flag = event_MNM_6038
	}
}

#Invitation to stronghold
letter_event = {
	id = MNM.6033
	desc = EVTDESC_MNM_6033
	border = GFX_event_letter_frame_intrigue

	is_triggered_only = yes

	immediate = {
		FROM = { host = { capital_holding = { save_event_target_as = inductor_rendezvous } } }

		FROM = { 
			host = { 





			capital_holding = { save_event_target_as = inductor_rendezvous } } }

		random_independent_ruler = {
			limit = {
				any_demesne_title = { title = d_hashshashin }
				society_member_of = the_assassins
			}
			capital_holding = { save_event_target_as = inductor_rendezvous }
		}
	}

	option = {
		name = EVTOPTA_6033
		custom_tooltip = { text = EVTOPTA_6033_TOOLTIP }

		hidden_effect = {
			event_target:assassins_inductor = { 
				clr_character_flag = event_MNM_6033
				set_character_flag = event_MNM_6034
				character_event = { id = MNM.6032 } 
			}
		}
	}
}

#Welcome by GM
character_event = {
	id = MNM.6034
	picture = GFX_evt_magnificent_castle
	desc = EVTDESC_MNM_6034
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	option = {
		name = EVTOPTA_6034

		hidden_effect = {
			event_target:assassins_inductor = { 
				clr_character_flag = event_MNM_6034
				set_character_flag = event_MNM_6035
				character_event = { id = MNM.6032 }
			}
		}
	}
}

#Secret ritual
character_event = {
	id = MNM.6035
	picture = GFX_evt_into_the_dungeon
	desc = EVTDESC_MNM_6035
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	option = {
		name = EVTOPTA_6035

		hidden_effect = {
			event_target:assassins_inductor = { 
				clr_character_flag = event_MNM_6035
				set_character_flag = event_MNM_6036
				character_event = { id = MNM.6032 } 
			}
		}
	}
}

#Kill to prove
character_event = {
	id = MNM.6036
	picture = GFX_evt_whispers
	border = GFX_event_normal_frame_intrigue

	desc = {
		trigger = { event_target:assassins_sacrifice = { always = yes } }
		text = EVTDESC_MNM_6036_A
	}
	desc = {
		trigger = { NOT = { event_target:assassins_sacrifice = { always = yes } } }
		text = EVTDESC_MNM_6036_B
	}

	is_triggered_only = yes
	
	immediate = {
		random_courtier_or_vassal = {
			limit = { 
				NOT = { society_member_of = the_assassins }
				trait = cynical 
				religion = shiite
				is_adult = yes
				ai = yes
			}
			save_event_target_as = assassins_sacrifice
		}
		random_courtier_or_vassal = {
			limit = { 
				NOT = { society_member_of = the_assassins }
				true_religion_shiite_trigger = no 
				is_adult = yes
				ai = yes
			}
			save_event_target_as = assassins_sacrifice
		}
		random_courtier_or_vassal = {
			limit = {
				NOT = { society_member_of = the_assassins }
				true_religion_shiite_trigger = no
				trait = zealous
				is_adult = yes
				ai = yes
			}
			save_event_target_as = assassins_sacrifice
		}
		random_courtier_or_vassal = {
			limit = {
				NOT = { society_member_of = the_assassins }
				is_primary_heir = no
				OR = {
					is_lover = ROOT
					is_friend = ROOT
					is_close_relative = ROOT
				}
				OR = {
					true_religion_shiite_trigger = no
					trait = cynical
				}
				is_adult = yes
				ai = yes
			}
			save_event_target_as = assassins_sacrifice
		}
	}

	#do it
	option = {
		name = EVTOPTA_6036

		if = {
			limit = { event_target:assassins_sacrifice = { always = yes } }
			event_target:assassins_sacrifice = { death = { death_reason = death_murder_unknown killer = ROOT } }
		}
		if = {
			limit = { NOT = { event_target:assassins_sacrifice = { always = yes } } }
			custom_tooltip = { text = EVTOPTA_6036_TOOLTIP }
		}

		hidden_effect = {
			event_target:assassins_inductor = { 
				clr_character_flag = event_MNM_6036
				set_character_flag = event_MNM_6037
				character_event = { id = MNM.6032 } 
			}
		}

		ai_chance = { factor = 100 }
	}

	#don't do it, fight your way out
	option = {
		name = EVTOPTB_6036
		custom_tooltip = { text = EVTOPTB_6036_TOOLTIP }
		
		hidden_effect = { 
			random_list = {
				#Getaway
				33 = {
					set_character_flag = escape_successful

					if = { #Saves root for loc nouns
						limit = { NOT = { event_target:assassins_sacrifice = { always = yes } } }
						save_event_target_as = assassins_sacrifice
					}

					modifier = {
						factor = 1.4
						attribute_diff = { character = FROM attribute = intrigue value = 2 }
					}
					modifier = {
						factor = 1.4
						attribute_diff = { character = FROM attribute = intrigue value = 4 }
					}
					modifier = {
						factor = 1.4
						attribute_diff = { character = FROM attribute = intrigue value = 6 }
					}
					modifier = {
						factor = 1.4
						combat_rating_diff = { character = FROM value = 1 }
					}
					modifier = {
						factor = 1.4
						combat_rating_diff = { character = FROM value = 2 }
					}
					modifier = {
						factor = 1.4
						combat_rating_diff = { character = FROM value = 3 }
					}
				}
				#Injured
				33 = {
					set_character_flag = escape_injured
				}
				#Death
				33 = {
					set_character_flag = escape_death
					modifier = {
						factor = 1.4
						FROM = { attribute_diff = { character = ROOT attribute = intrigue value = 2 } }
					}
					modifier = {
						factor = 1.4
						FROM = { attribute_diff = { character = ROOT attribute = intrigue value = 4 } }
					}
					modifier = {
						factor = 1.4
						FROM = { attribute_diff = { character = ROOT attribute = intrigue value = 6 } }
					}
					modifier = {
						factor = 1.4
						FROM = { combat_rating_diff = { character = ROOT value = 1 } }
					}
					modifier = {
						factor = 1.4
						FROM = { combat_rating_diff = { character = ROOT value = 2 } }
					}
					modifier = {
						factor = 1.4
						FROM = { combat_rating_diff = { character = ROOT value = 3 } }
					}
				}
			}

			event_target:assassins_inductor = { 
				clr_character_flag = event_MNM_6036
				set_character_flag = event_MNM_6038
				character_event = { id = MNM.6032 } 
			}
		}

		ai_chance = { factor = 0 }
	}

	#bribe
	option = {
		trigger = { diplomacy = 12 }
		tooltip_info = diplomacy

		name = EVTOPTC_6036
		custom_tooltip = { text = EVTOPTC_6036_TOOLTIP }

		scaled_wealth = { value = -0.5 min = -100 }

		hidden_effect = {
			set_character_flag = escape_bribe 
			event_target:assassins_inductor = { 
				clr_character_flag = event_MNM_6036
				set_character_flag = event_MNM_6038
				character_event = { id = MNM.6032 } 
			}
		}
		ai_chance = { factor = 0 }
	}
}

#You are a member!
character_event = {
	id = MNM.6037
	picture = GFX_evt_society_joining
	desc = EVTDESC_MNM_6037
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	option = {
		name = EVTOPTA_6037

		join_society = the_assassins 
		
		hidden_effect = {
			if = {
				limit = { event_target:assassins_recruiter = { always = yes } }
				event_target:assassins_recruiter = { set_character_flag = recruitment_success }
				event_target:grand_master = { character_event = { id = MNM.6040 } }
			}
		}
	}
}

#You flee
character_event = {
	id = MNM.6038
	picture = GFX_evt_assassination
	border = GFX_event_normal_frame_intrigue

	desc = {
		trigger = { has_character_flag = escape_successful }
		text = EVTDESC_MNM_6038_A
		picture = GFX_evt_assassination
	}
	desc = {
		trigger = { has_character_flag = escape_injured }
		text = EVTDESC_MNM_6038_B
		picture = GFX_evt_bloody_man
	}
	desc = {
		trigger = { has_character_flag = escape_death }
		text = EVTDESC_MNM_6038_C
		picture = GFX_evt_assassination
	}
	desc = {
		trigger = { has_character_flag = escape_bribe }
		text = EVTDESC_MNM_6038_D
		picture = GFX_evt_whispers
	}

	is_triggered_only = yes

	immediate = {
		if = {
			limit = { event_target:assassins_recruiter = { always = yes } }
			event_target:assassins_recruiter = { set_character_flag = recruitment_fail }
			event_target:grand_master = { character_event = { id = MNM.6040 } } 
		}
		clr_character_flag = ongoing_recruitment
	}

	#Escape successfully
	option = {
		trigger = { has_character_flag = escape_successful }
		name = EVTOPTA_6038
		custom_tooltip = { text = EVTOPTA_6038_TOOLTIP }

		clr_character_flag = escape_successful
		
		if = { 
			limit = { event_target:assassins_sacrifice = { NOT = { character = ROOT } } }
			add_friend = event_target:assassins_sacrifice
		}
		
		hidden_effect = {
			random_list = {
				33 = {
					FROM = { add_trait = wounded }
					set_character_flag = assassins_target_assaulted_member
				}
				33 = {
					FROM = { add_maimed_trait_effect = yes }
					set_character_flag = assassins_target_assaulted_member
				}
				33 = {
					FROM = { death = { death_reason = death_murder_unknown killer = ROOT } }
					set_character_flag = assassins_target_killed_member
				}
			}
		}
	}

	#Escaped but got injured
	option = {
		trigger = { has_character_flag = escape_injured }
		name = EVTOPTB_6038
		custom_tooltip = { text = EVTOPTA_6038_TOOLTIP }

		clr_character_flag = escape_injured

		add_maimed_trait_effect = yes

		if = {
			limit = { event_target:assassins_sacrifice = { always = yes } }
			event_target:assassins_sacrifice = { death = { death_reason = death_murder_unknown killer = FROM } }
		}

		hidden_effect = {
			random_list = {
				33 = {
					FROM = { add_trait = wounded }
					set_character_flag = assassins_target_assaulted_member
				}
				33 = {
					FROM = { add_maimed_trait_effect = yes }
					set_character_flag = assassins_target_assaulted_member
				}
				33 = {
					FROM = { death = { death_reason = death_murder_unknown killer = ROOT } }
					set_character_flag = assassins_target_killed_member
				}
			}
		}
	}

	#Escaped but died
	option = {
		trigger = { has_character_flag = escape_death }
		name = EVTOPTC_6038

		death = { death_reason = death_murder_unknown killer = FROM }

		if = {
			limit = { event_target:assassins_sacrifice = { always = yes } }
			event_target:assassins_sacrifice = { death = { death_reason = death_murder_unknown killer = FROM } }
		}

	}

	#Bribe
	option = {
		trigger = { has_character_flag = escape_bribe }
		name = EVTOPTD_6038
		custom_tooltip = { text = EVTOPTA_6038_TOOLTIP }
		clr_character_flag = escape_bribe
	}
}

#Opt out failstate
character_event = {
	id = MNM.6039
	picture = GFX_evt_shadow
	desc = EVTDESC_MNM_6039
	border = GFX_event_normal_frame_intrigue

	hide_from = yes

	is_triggered_only = yes

	option = {
		name = EVTOPTA_6039
		hidden_effect = { clr_character_flag = ongoing_recruitment }
	}
}

#Ping event GM for outcome notification
character_event = {
	id = MNM.6040
	hide_window = yes

	is_triggered_only = yes

	immediate = { event_target:assassins_recruiter = { letter_event = { id = MNM.6041 days = 5 } } }
}

#Outcome of recruitment for recruiter (if there is one)
letter_event = {
	id = MNM.6041
	border = GFX_event_letter_frame_religion

	desc = {
		trigger = { has_character_flag = recruitment_success }
		text = EVTDESC_MNM_6041_A
	}
	desc = {
		trigger = { has_character_flag = recruitment_fail }
		text = EVTDESC_MNM_6041_B
	}

	is_triggered_only = yes

	option = {
		trigger = { has_character_flag = recruitment_success }
		name = EXCELLENT

		clr_character_flag = recruitment_success
		add_society_currency_minor_effect = yes
	}

	option = {
		trigger = { has_character_flag = recruitment_fail }
		name = CURSES

		clr_character_flag = recruitment_fail
	}
}

###MURDER PLOT EVENTS (start on 6100)

#Plotter sees an opportunity - assassinate
character_event = {
	id = MNM.6100
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue

	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_after_temple } }
		text = EVTDESC_MNM_6100_A
		picture = GFX_evt_market_byzantine
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_prison } }
		text = EVTDESC_MNM_6100_B
		picture = GFX_evt_into_the_dungeon
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_hiding } }
		text = EVTDESC_MNM_6100_C
		picture = GFX_evt_shadow
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_seclusion } }
		text = EVTDESC_MNM_6100_D
		picture = GFX_evt_shadow
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_incapable } }
		text = EVTDESC_MNM_6100_E
		picture = GFX_evt_magnificent_castle
	}
	desc = { 
		trigger = { event_target:plot_target = { has_character_flag = assassination_during_feast } }
		text = EVTDESC_MNM_6100_F
		picture = GFX_evt_state_diplomacy
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_while_asleep } }
		text = EVTDESC_MNM_6100_E
		picture = GFX_evt_magnificent_castle
	}
	
	is_part_of_plot = yes
	is_in_society = yes
	capable_only = yes
	prisoner = no
	
	trigger = {
		society_member_of = the_assassins
		OR = {
			has_plot = plot_kill_character
			has_plot = plot_kill_spouse
		}
		plot_target_char = {
			is_murder_quest_target_of_prev_trigger = yes
			OR = {
				at_location = ROOT
				ROOT = { is_inaccessible_trigger = no }
			}
		}
		NOT = { has_character_flag = murder_in_motion }
	}
	
	mean_time_to_happen = {
		months = 4000

		modifier = {
			society_rank = {
				society = the_assassins
				rank == 3
			}
			factor = 3
		}
		modifier = {
			society_rank = {
				society = the_assassins
				rank == 2
			}
			factor = 1.75
		}
		modifier = {
			plot_target_char = { is_inaccessible_trigger = yes }
			factor = 1.5
		}
		modifier = {
			plot_target_char = { prisoner = yes }
			factor = 1.5
		}
		modifier = {
			plot_power = 0.1
			factor = 0.6
		}
		modifier = {
			plot_power = 0.2
			factor = 0.6
		}
		modifier = {
			factor = 0.6
			plot_power = 0.3
		}
		modifier = {
			factor = 0.6
			plot_power = 0.4
		}
		modifier = {
			factor = 0.6
			plot_power = 0.5
		}
		modifier = {
			factor = 0.6
			plot_power = 0.6
		}
		modifier = {
			factor = 0.6
			plot_power = 0.7
		}
		modifier = {
			factor = 0.6
			plot_power = 0.8
		}
		modifier = {
			factor = 0.6
			plot_power = 0.9
		}
		modifier = {
			factor = 0.6
			plot_power = 1
		}
		modifier = {
			factor = 0.3
			plot_power = 1.5
		}
		modifier = {
			factor = 0.3
			plot_power = 2
		}
	}
	
	immediate = {
		plot_target_char = { save_event_target_as = plot_target }
		save_event_target_as = assassin_plot_owner

		#Set the assassination method
		event_target:plot_target = {
			if = {
				limit = {
					NOR = {
						prisoner = yes
						trait = in_hiding
						trait = incapable
						has_character_modifier = in_seclusion
					}
				}
				random_list = {
					40 = { set_character_flag = assassination_after_temple }
					30 = { set_character_flag = assassination_during_feast }
					30 = { set_character_flag = assassination_while_asleep }
				}
			}
			if = {
				limit = { prisoner = yes }
				set_character_flag = assassination_in_prison
			}
			if = {
				limit = { trait = in_hiding }
				set_character_flag = assassination_in_hiding
			}
			if = {
				limit = { has_character_modifier = in_seclusion }
				set_character_flag = assassination_in_seclusion
			}
			if = {
				limit = { trait = incapable }
				set_character_flag = assassination_incapable
			}
		}

		random_society_member = {
			limit = {
				society_rank = {
					rank == 4
					society = the_assassins
				}
			}
			save_event_target_as = grand_master #for loc
		}
	}
	
	#Do it
	option = {
		name = EVTOPTA_MNM_6100
		custom_tooltip = { text = EVTOPTA_MNM_6100_TOOLTIP }
		hidden_effect = { 
			event_target:plot_target = { character_event = { id = MNM.6104 days = 7 } } 
			set_character_flag = murder_in_motion
		}
	}

	#Wait
	option = {
		name = EVTOPTB_MNM_6100
		custom_tooltip = { text = EVTOPTB_MNM_6100_TOOLTIP }
	}
}

#Plot backer sees an opportunity - assassinate
character_event = {
	id = MNM.6101
	picture = GFX_evt_market_byzantine
	border = GFX_event_normal_frame_intrigue

	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_after_temple } }
		text = EVTDESC_MNM_6100_A
		picture = GFX_evt_market_byzantine
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_prison } }
		text = EVTDESC_MNM_6100_B
		picture = GFX_evt_into_the_dungeon
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_hiding } }
		text = EVTDESC_MNM_6100_C
		picture = GFX_evt_shadow
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_seclusion } }
		text = EVTDESC_MNM_6100_D
		picture = GFX_evt_shadow
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_incapable } }
		text = EVTDESC_MNM_6100_E
		picture = GFX_evt_magnificent_castle
	}
	desc = { 
		trigger = { event_target:plot_target = { has_character_flag = assassination_during_feast } }
		text = EVTDESC_MNM_6100_F
		picture = GFX_evt_state_diplomacy
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_while_asleep } }
		text = EVTDESC_MNM_6100_E
		picture = GFX_evt_magnificent_castle
	}

	capable_only = yes
	prisoner = no
	is_part_of_plot = yes
	
	trigger = {
		any_backed_character = {
			plot_target_char = { is_murder_quest_target_of_prev_trigger = yes }
			society_rank = {
				rank == 2
				society = the_assassins
			}
			OR = {
				has_plot = plot_kill_character
				has_plot = plot_kill_spouse
			}
			NOT = { has_character_flag = murder_in_motion }	
		}
		NOT = { has_character_flag = murder_in_motion }
	}

	mean_time_to_happen = {
		months = 4000 

		modifier = {
			society_rank = {
				society = the_assassins
				rank == 3
			}
			factor = 3
		}
		modifier = {
			society_rank = {
				society = the_assassins
				rank == 2
			}
			factor = 1.75
		}

		modifier = {
			plot_target_char = { is_inaccessible_trigger = yes }
			factor = 1.5
		}
		modifier = {
			plot_target_char = { prisoner = yes }
			factor = 1.5
		}
		modifier = {
			plot_power = 0.1
			factor = 0.6
		}
		modifier = {
			plot_power = 0.2
			factor = 0.6
		}
		modifier = {
			factor = 0.6
			plot_power = 0.3
		}
		modifier = {
			factor = 0.6
			plot_power = 0.4
		}
		modifier = {
			factor = 0.6
			plot_power = 0.5
		}
		modifier = {
			factor = 0.6
			plot_power = 0.6
		}
		modifier = {
			factor = 0.6
			plot_power = 0.7
		}
		modifier = {
			factor = 0.6
			plot_power = 0.8
		}
		modifier = {
			factor = 0.6
			plot_power = 0.9
		}
		modifier = {
			factor = 0.6
			plot_power = 1
		}
		modifier = {
			factor = 0.3
			plot_power = 1.5
		}
		modifier = {
			factor = 0.3
			plot_power = 2
		}
	}

	immediate = {
		any_backed_character = {
			limit = {
				plot_target_char = { is_murder_quest_target_of_prev_trigger = yes }
				society_member_of = the_assassins
				OR = {
					has_plot = plot_kill_character
					has_plot = plot_kill_spouse
				}
				NOT = { has_character_flag = murder_in_motion }	
			}
			save_event_target_as = assassin_plot_owner
			plot_target_char = { save_event_target_as = plot_target }
		}
		
		#Set the assassination method
		event_target:plot_target = {
			if = {
				limit = {
					NOR = {
						prisoner = yes
						trait = in_hiding
						trait = incapable
						has_character_modifier = in_seclusion
					}
				}
				random_list = {
					40 = { set_character_flag = assassination_after_temple }
					30 = { set_character_flag = assassination_during_feast }
					30 = { set_character_flag = assassination_while_asleep }
				}
			}
			if = {
				limit = { prisoner = yes }
				set_character_flag = assassination_in_prison
			}
			if = {
				limit = { trait = in_hiding }
				set_character_flag = assassination_in_hiding
			}
			if = {
				limit = { has_character_modifier = in_seclusion }
				set_character_flag = assassination_in_seclusion
			}
			if = {
				limit = { trait = incapable }
				set_character_flag = assassination_incapable
			}
		}

		random_society_member = {
			limit = {
				society_rank = {
					rank == 4
					society = the_assassins
				}
			}
			save_event_target_as = grand_master #for loc
		}
	}

	#Do it
	option = {
		name = EVTOPTA_MNM_6101
		custom_tooltip = { text = EVTOPTA_MNM_6100_TOOLTIP }
		hidden_effect = { 
			set_character_flag = murder_in_motion
			event_target:plot_target = { character_event = { id = MNM.6104 days = 7 } }
			event_target:assassin_plot_owner = { letter_event = { id = MNM.6102 } }
		}
	}
}

#Plot owner recieves a letter informing them about the coming attempt
letter_event = {
	id = MNM.6102
	border = GFX_event_letter_frame_intrigue

	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_after_temple } }
		text = EVTDESC_MNM_6102_A
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_prison } }
		text = EVTDESC_MNM_6102_B
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_hiding } }
		text = EVTDESC_MNM_6102_C
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_seclusion } }
		text = EVTDESC_MNM_6102_D
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_incapable } }
		text = EVTDESC_MNM_6102_D
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_during_feast } }
		text = EVTDESC_MNM_6102_D
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_while_asleep } }
		text = EVTDESC_MNM_6102_D
	}

	is_triggered_only = yes

	option = {
		name = EXCELLENT
		custom_tooltip = { text = EVTOPTA_MNM_6102_TOOLTIP }
	}
}


#Assassination attempt
character_event = {
	id = MNM.6104
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	hide_from = yes

	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_after_temple } }
		text = EVTDESC_MNM_6104_A
		picture = GFX_evt_market_byzantine
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_prison } }
		text = EVTDESC_MNM_6104_B
		picture = GFX_evt_into_the_dungeon
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_hiding } }
		text = EVTDESC_MNM_6104_C
		picture = GFX_evt_shadow
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_seclusion } }
		text = EVTDESC_MNM_6104_D
		picture = GFX_evt_state_diplomacy
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_incapable } }
		text = EVTDESC_MNM_6104_E
		picture = GFX_evt_magnificent_castle
	}
	desc = { 
		trigger = { event_target:plot_target = { has_character_flag = assassination_during_feast } }
		text = EVTDESC_MNM_6104_F
		picture = GFX_evt_state_diplomacy
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_while_asleep } }
		text = EVTDESC_MNM_6104_C
		picture = GFX_evt_shadow
	}


	immediate = {
		FROM = { save_event_target_as = assassin } 
		random_courtier = {
			limit = {
				at_location = ROOT
				prisoner = no
				is_adult = yes
			}
			save_event_target_as = conversationalist
		}
		if = {
			limit = { NOT = { event_target:conversationalist = { always = yes } } }
			random_realm_character = {
				limit = { dynasty = none }
				save_event_target_as = conversationalist
			}
		}
	}

	option = {
		name = EVTOPTA_MNM_6104

		event_target:assassin_plot_owner = { clr_character_flag = murder_in_motion }

		hidden_effect = {
			random_list = {
				60  = { #Die
					random_list = {
						75 = {	#Not discovered
							modifier = {
								event_target:assassin = { intrigue = 12 }
								factor = 1.5
							}
							modifier = {
								event_target:assassin = { intrigue = 15 }
								factor = 1.5
							}
							character_event = { id = MNM.6105 days = 3 }
							tooltip = { add_trait = schemer }
						}
						25 = {	#Discovered
							modifier = {
								event_target:assassin = { NOT = { intrigue = 8 } }
								factor = 1.5
							}
							modifier = {
								event_target:assassin = { NOT = { intrigue = 5 } }
								factor = 1.5
							}
							character_event = { id = MNM.6108 days = 3 }
							event_target:assassin_plot_owner = { character_event = { id = 10 } }
							if = { 
								limit = { NOT = { event_target:assassin = { character = event_target:assassin_plot_owner } } }
								event_target:assassin = { character_event = { id = 10 } }
							}
							tooltip = { add_trait = deceitful }
						}
					}
					modifier = {
						event_target:assassin = {
							society_rank = {
								society = the_assassins
								rank == 2
							}
						}
						factor = 1.75
					}
					modifier = {
						event_target:assassin = {
							society_rank = {
								society = the_assassins
								rank == 3
							}
						}
						factor = 3
					}
					modifier = {
						event_target:assassin = {
							society_rank = {
								society = the_assassins
								rank == 4
							}
						}
						factor = 5
					}
					modifier = {
						factor = 3
						trait = incapable
					}
					modifier = {
						factor = 2
						prisoner = yes
					}
					modifier = {
						factor = 1.3
						FROM = { attribute_diff = { character = ROOT attribute = intrigue value = 2 } }
					}
					modifier = {
						factor = 1.3
						FROM = { attribute_diff = { character = ROOT attribute = intrigue value = 4 } }
					}
					modifier = {
						factor = 1.3
						FROM = { attribute_diff = { character = ROOT attribute = intrigue value = 6 } }
					}
					modifier = {
						factor = 1.3
						FROM = { combat_rating_diff = { character = ROOT value = 1 } }
					}
					modifier = {
						factor = 1.3
						FROM = { combat_rating_diff = { character = ROOT value = 2 } }
					}
					modifier = {
						factor = 1.3
						FROM = { combat_rating_diff = { character = ROOT value = 3 } }
					}
				}
				40 = { #Survive
					random_list = {
						50 = {	#Not discovered
							modifier = {
								event_target:assassin = { intrigue = 12 }
								factor = 1.5
							}
							modifier = {
								event_target:assassin = { intrigue = 15 }
								factor = 1.5
							}
							character_event = { id = MNM.6111 days = 3 }
						}
						25 = {	#Discovered and wounded
							modifier = {
								event_target:assassin = { NOT = { intrigue = 8 } }
								factor = 1.5
							}
							modifier = {
								event_target:assassin = { NOT = { intrigue = 5 } }
								factor = 1.5
							}
							character_event = { id = MNM.6114 days = 3 }
							event_target:assassin_plot_owner = { character_event = { id = 11 } }
							if = { 
								limit = { NOT = { event_target:assassin = { character = event_target:assassin_plot_owner } } }
								event_target:assassin = { character_event = { id = 11 } }
							}
						}
						25 = { #Killed assailant
							modifier = {
								factor = 1.3
								combat_rating_diff = { character = event_target:assassin value = 1 }
							}
							modifier = {
								factor = 1.3
								combat_rating_diff = { character = event_target:assassin value = 2 }
							}
							modifier = {
								factor = 1.3
								combat_rating_diff = { character = event_target:assassin value = 3 }
							}
							character_event = { id = MNM.6117 days = 3 }
							event_target:assassin_plot_owner = { character_event = { id = 11 } }
							if = { 
								limit = { NOT = { event_target:assassin = { character = event_target:assassin_plot_owner } } }
								event_target:assassin = { character_event = { id = 11 } }
							}
						}
					}	
					modifier = {
						factor = 1.3
						attribute_diff = { character = event_target:assassin attribute = intrigue value = 2 }
					}
					modifier = {
						factor = 1.3
						attribute_diff = { character = event_target:assassin attribute = intrigue value = 4 }
					}
					modifier = {
						factor = 1.3
						attribute_diff = { character = event_target:assassin attribute = intrigue value = 6 }
					}
					modifier = {
						factor = 1.3
						combat_rating_diff = { character = event_target:assassin value = 1 }
					}
					modifier = {
						factor = 1.3
						combat_rating_diff = { character = event_target:assassin value = 2 }
					}
					modifier = {
						factor = 1.3
						combat_rating_diff = { character = event_target:assassin value = 3 }
					}
				}
			}
		}
	}
}

#Plot target dies, undiscovered
character_event = {
	id = MNM.6105
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue

	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_after_temple } }
		text = EVTDESC_MNM_6105_A
		picture = GFX_evt_assassination
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_prison } }
		text = EVTDESC_MNM_6105_B
		picture = GFX_evt_into_the_dungeon
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_hiding } }
		text = EVTDESC_MNM_6105_C
		picture = GFX_evt_shadow
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_seclusion } }
		text = EVTDESC_MNM_6105_D
		picture = GFX_evt_assassination
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_incapable } }
		text = EVTDESC_MNM_6105_E
		picture = GFX_evt_shadow
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_during_feast } }
		text = EVTDESC_MNM_6105_D
		picture = GFX_evt_assassination
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_while_asleep } }
		text = EVTDESC_MNM_6105_C
		picture = GFX_evt_shadow
	}

	is_triggered_only = yes
	hide_from = yes

	option = {
		name = EVTOPTA_MNM_6105

		tooltip = { death = { death_reason = death_murder_unknown_hashashin killer = event_target:assassin_plot_owner } }



		hidden_effect = {
			event_target:assassin = { character_event = { id = MNM.6106 } }
		}
	}
}

#Assassin notified of "Plot target dies, undiscovered"
character_event = {
	id = MNM.6106
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue

	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_after_temple } }
		text = EVTDESC_MNM_6106_A
		picture = GFX_evt_assassination
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_prison } }
		text = EVTDESC_MNM_6106_B
		picture = GFX_evt_into_the_dungeon
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_hiding } }
		text = EVTDESC_MNM_6106_C
		picture = GFX_evt_shadow
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_seclusion } }
		text = EVTDESC_MNM_6106_D
		picture = GFX_evt_assassination
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_incapable } }
		text = EVTDESC_MNM_6106_E
		picture = GFX_evt_shadow
	}
	desc = { 
		trigger = { event_target:plot_target = { has_character_flag = assassination_during_feast } }
		text = EVTDESC_MNM_6106_D
		picture = GFX_evt_assassination
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_while_asleep } }
		text = EVTDESC_MNM_6106_C
		picture = GFX_evt_shadow
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_6106
		FROM = { death = { death_reason = death_murder_unknown_hashashin killer = event_target:assassin_plot_owner } } 

		#If quest holder, clear quest and reward
		if = {
			limit = {
				has_quest = quest_the_assassins_assassination
				quest_target = { character = event_target:plot_target }
			} 
			clr_quest = quest_the_assassins_assassination
			sound_effect = assassins_assassinate_character

			if = {
				limit = { event_target:plot_target = { higher_tier_than = DUKE } }
				add_society_currency_major_effect = yes
			}
			if = {
				limit = { event_target:plot_target = { tier = DUKE } } 
				add_society_currency_medium_effect = yes
			}
			if = {
				limit = { event_target:plot_target = { lower_tier_than = DUKE } }
				add_society_currency_minor_effect = yes
			}
		}

		#If this is not your plot, give standard amount and notifiy plot holder
		if = {
			limit = { NOT = { event_target:assassin_plot_owner = { character = event_target:assassin } } }
			hidden_effect = { event_target:assassin_plot_owner = { letter_event = { id = MNM.6107 } } }
			add_society_currency_minor_effect = yes
		}

		if = {
			limit = { event_target:plot_target = { has_character_flag = assassins_target_marked_for_death }	}

			random_society_member = { 
				limit = { society_rank = { rank == 4 society = the_assassins } }
				letter_event = { id = MNM.6843 }
			}
		}

		hidden_effect = {
			event_target:plot_target = { character_event = { id = MNM.6120 days = 1 } } #Clears flags
			clr_character_flag = murder_in_motion
		}
	}
}

#Plot owner notified "Plot target dies, undiscovered"
letter_event = {
	id = MNM.6107
	border = GFX_event_letter_frame_intrigue
	desc = EVTDESC_MNM_6107

	is_triggered_only = yes

	option = {
		name = EXCELLENT
		clr_character_flag = murder_in_motion

		
		if = {
			limit = {
				has_quest = quest_the_assassins_assassination
				quest_target = { character = event_target:plot_target }
			}
			clr_quest = quest_the_assassins_assassination
			sound_effect = assassins_assassinate_character

			if = {
				limit = { event_target:plot_target = { higher_tier_than = DUKE } }
				add_society_currency_major_effect = yes
			}
			if = {
				limit = { event_target:plot_target = { tier = DUKE } } 
				add_society_currency_medium_effect = yes
			}
			if = {
				limit = { event_target:plot_target = { lower_tier_than = DUKE } }
				add_society_currency_minor_effect = yes
			}
		}
	}
}

#Plot target dies, discovered
character_event = {
	id = MNM.6108
	picture = GFX_evt_assassination
	border = GFX_event_normal_frame_intrigue

	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_after_temple } }
		text = EVTDESC_MNM_6108_A
		picture = GFX_evt_assassination
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_prison } }
		text = EVTDESC_MNM_6108_B
		picture = GFX_evt_into_the_dungeon
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_hiding } }
		text = EVTDESC_MNM_6108_C
		picture = GFX_evt_shadow
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_seclusion } }
		text = EVTDESC_MNM_6108_D
		picture = GFX_evt_assassination
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_incapable } }
		text = EVTDESC_MNM_6108_E
		picture = GFX_evt_shadow
	}
	desc = { 
		trigger = { event_target:plot_target = { has_character_flag = assassination_during_feast } }
		text = EVTDESC_MNM_6108_D
		picture = GFX_evt_assassination
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_while_asleep } }
		text = EVTDESC_MNM_6108_C
		picture = GFX_evt_shadow
	}

	is_triggered_only = yes
	hide_from = yes

	option = {
		name = EVTOPTA_MNM_6105

		tooltip = { death = { death_reason = death_murder_hashashin killer = event_target:assassin_plot_owner } }

		hidden_effect = {
			event_target:assassin = { character_event = { id = MNM.6109 } }
		}
	}
}

#Assassin notified of "Plot target dies, discovered"
character_event = {
	id = MNM.6109
	picture = GFX_evt_assassination
	border = GFX_event_normal_frame_intrigue

	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_after_temple } }
		text = EVTDESC_MNM_6109_A
		picture = GFX_evt_assassination
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_prison } }
		text = EVTDESC_MNM_6109_B
		picture = GFX_evt_into_the_dungeon
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_hiding } }
		text = EVTDESC_MNM_6109_C
		picture = GFX_evt_shadow
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_seclusion } }
		text = EVTDESC_MNM_6109_D
		picture = GFX_evt_assassination
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_incapable } }
		text = EVTDESC_MNM_6109_E
		picture = GFX_evt_shadow
	}
	desc = { 
		trigger = { event_target:plot_target = { has_character_flag = assassination_during_feast } }
		text = EVTDESC_MNM_6109_D
		picture = GFX_evt_assassination
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_while_asleep } }
		text = EVTDESC_MNM_6109_C
		picture = GFX_evt_shadow
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_6109
		custom_tooltip = { text = EVTOPTA_MNM_6109_TOOLTIP }
		
		FROM = { death = { death_reason = death_murder_hashashin killer = event_target:assassin } }

		#If quest holder, clear quest and reward
		if = {
			limit = {
				has_quest = quest_the_assassins_assassination
				quest_target = { character = event_target:plot_target }
			}
			clr_quest = quest_the_assassins_assassination
			sound_effect = assassins_assassinate_character

			if = {
				limit = { event_target:plot_target = { higher_tier_than = DUKE } }
				add_society_currency_major_effect = yes
			}
			if = {
				limit = { event_target:plot_target = { tier = DUKE } } 
				add_society_currency_medium_effect = yes
			}
			if = {
				limit = { event_target:plot_target = { lower_tier_than = DUKE } }
				add_society_currency_minor_effect = yes
			}
		}

		#If this is not your plot, give standard amount and notifiy plot holder
		if = {
			limit = { NOT = { event_target:assassin_plot_owner = { character = event_target:assassin } } }
			hidden_effect = { event_target:assassin_plot_owner = { letter_event = { id = MNM.6110 } } }
			add_society_currency_minor_effect = yes
		}

		if = {
			limit = { event_target:plot_target = { has_character_flag = assassins_target_marked_for_death }	}
			random_society_member = { 
				limit = { society_rank = { rank == 4 society = the_assassins } }
				letter_event = { id = MNM.6843 }
			}
		}

		hidden_effect = {
			event_target:plot_target = { character_event = { id = MNM.6120 days = 1 } } #Clears flags
			clr_character_flag = murder_in_motion
		}
	}
}

#Plot owner notified "Plot target dies, discovered"
letter_event = {
	id = MNM.6110
	border = GFX_event_letter_frame_intrigue
	desc = EVTDESC_MNM_6110

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_6110
		custom_tooltip = { text = EVTOPTA_MNM_6110_TOOLTIP }
		clr_character_flag = murder_in_motion

		#If quest holder, clear quest and reward
		if = {
			limit = {
				has_quest = quest_the_assassins_assassination
				quest_target = { character = event_target:plot_target }
			}
			clr_quest = quest_the_assassins_assassination
			sound_effect = assassins_assassinate_character

			if = {
				limit = { event_target:plot_target = { higher_tier_than = DUKE } }
				add_society_currency_major_effect = yes
			}
			if = {
				limit = { event_target:plot_target = { tier = DUKE } } 
				add_society_currency_medium_effect = yes
			}
			if = {
				limit = { event_target:plot_target = { lower_tier_than = DUKE } }
				add_society_currency_minor_effect = yes
			}
		}
	}
}

#Plot target survives, undiscovered
character_event = {
	id = MNM.6111
	picture = GFX_evt_melee
	border = GFX_event_normal_frame_intrigue

	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_after_temple } }
		text = EVTDESC_MNM_6111_A
		picture = GFX_evt_melee
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_prison } }
		text = EVTDESC_MNM_6111_B
		picture = GFX_evt_into_the_dungeon
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_hiding } }
		text = EVTDESC_MNM_6111_C
		picture = GFX_evt_melee
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_seclusion } }
		text = EVTDESC_MNM_6111_D
		picture = GFX_evt_melee
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_incapable } }
		text = EVTDESC_MNM_6111_E
		picture = GFX_evt_melee
	}
	desc = { 
		trigger = { event_target:plot_target = { has_character_flag = assassination_during_feast } }
		text = EVTDESC_MNM_6111_D
		picture = GFX_evt_melee
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_while_asleep } }
		text = EVTDESC_MNM_6111_C
		picture = GFX_evt_melee
	}

	is_triggered_only = yes
	hide_from = yes

	option = {
		name = EVTOPTA_MNM_6111
		custom_tooltip = { text = EVTOPTA_MNM_6111_TOOLTIP }

		hidden_effect = {
			event_target:assassin = { character_event = { id = MNM.6112 } }
		}
	}
}

#Assassin notified of "Plot target survives, undiscovered"
character_event = {
	id = MNM.6112
	picture = GFX_evt_melee
	border = GFX_event_normal_frame_intrigue

	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_after_temple } }
		text = EVTDESC_MNM_6112_A
		picture = GFX_evt_melee
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_prison } }
		text = EVTDESC_MNM_6112_B
		picture = GFX_evt_into_the_dungeon
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_hiding } }
		text = EVTDESC_MNM_6112_C
		picture = GFX_evt_melee
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_seclusion } }
		text = EVTDESC_MNM_6112_D
		picture = GFX_evt_melee
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_incapable } }
		text = EVTDESC_MNM_6112_E
		picture = GFX_evt_melee
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_during_feast } }
		text = EVTDESC_MNM_6112_D
		picture = GFX_evt_melee
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_while_asleep } }
		text = EVTDESC_MNM_6112_C
		picture = GFX_evt_melee
	}


	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_6112
		custom_tooltip = { text = EVTOPTA_MNM_6112_TOOLTIP }

		hidden_effect = {
			if = {
				limit = { NOT = { event_target:assassin_plot_owner = { character = event_target:assassin } } }
				event_target:assassin_plot_owner = { letter_event = { id = MNM.6113 } }
			}
			event_target:plot_target = { character_event = { id = MNM.6120 days = 1 } } #Clears flags
			clr_character_flag = murder_in_motion
		}
	}
}

#Plot owner notified "Plot target survives, undiscovered"
letter_event = {
	id = MNM.6113
	border = GFX_event_letter_frame_intrigue
	desc = EVTDESC_MNM_6113

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_6113
		custom_tooltip = { text = EVTOPTA_MNM_6113_TOOLTIP }
		clr_character_flag = murder_in_motion
	}
}

#Plot target survives, wounded
character_event = {
	id = MNM.6114
	picture = GFX_evt_melee
	border = GFX_event_normal_frame_intrigue

	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_after_temple } }
		text = EVTDESC_MNM_6114_A
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_prison } }
		text = EVTDESC_MNM_6114_B
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_hiding } }
		text = EVTDESC_MNM_6114_B
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_seclusion } }
		text = EVTDESC_MNM_6114_B
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_incapable } }
		text = EVTDESC_MNM_6114_E
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_during_feast } }
		text = EVTDESC_MNM_6114_B
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_while_asleep } }
		text = EVTDESC_MNM_6114_B
	}


	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_6114
		custom_tooltip = { text = EVTOPTA_MNM_6111_TOOLTIP }

		random_list = {
			70 = {
				event_target:assassin = { 
					tooltip = { add_trait = wounded }
					set_character_flag = assassin_wounded
				}
			}
			30 = {
				event_target:assassin = {
					tooltip = { add_maimed_trait_effect = yes }
					set_character_flag = assassin_maimed
				}
			}
		}

		hidden_effect = {
			event_target:assassin = { character_event = { id = MNM.6115 } }
		}
	}
}

#Assassin notified of "Plot target survives, wounded"
character_event = {
	id = MNM.6115
	picture = GFX_evt_melee
	border = GFX_event_normal_frame_intrigue

	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_after_temple } }
		text = EVTDESC_MNM_6115_A
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_prison } }
		text = EVTDESC_MNM_6115_B
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_hiding } }
		text = EVTDESC_MNM_6115_C
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_seclusion } }
		text = EVTDESC_MNM_6115_D
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_incapable } }
		text = EVTDESC_MNM_6115_E
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_during_feast } }
		text = EVTDESC_MNM_6115_D
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_while_asleep } }
		text = EVTDESC_MNM_6115_C
	}


	is_triggered_only = yes

	option = {
		name = CURSES
		custom_tooltip = { text = EVTOPTA_MNM_6109_TOOLTIP }

		if = {
			limit = { has_character_flag = assassin_wounded }
			add_trait_wounded_effect = yes
			clr_character_flag = assassin_wounded
		}
		if = {
			limit = { has_character_flag = assassin_maimed }
			add_maimed_trait_effect = yes
			clr_character_flag = assassin_maimed
		}

		hidden_effect = {
			if = {
				limit = { NOT = { event_target:assassin_plot_owner = { character = event_target:assassin } } }
				event_target:assassin_plot_owner = { letter_event = { id = MNM.6116 } }
			}
			event_target:plot_target = { character_event = { id = MNM.6120 days = 1 } } #Clears flags
			clr_character_flag = murder_in_motion
		}
	}
}

#Plot owner notified "Plot target survives, wounded"
letter_event = {
	id = MNM.6116
	border = GFX_event_letter_frame_intrigue
	desc = EVTDESC_MNM_6116

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_6116
		custom_tooltip = { text = EVTOPTA_MNM_6116_TOOLTIP }
		clr_character_flag = murder_in_motion
	}
}

#Plot target survives, killed
character_event = {
	id = MNM.6117
	picture = GFX_evt_melee
	border = GFX_event_normal_frame_intrigue

	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_after_temple } }
		text = EVTDESC_MNM_6117_A
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_prison } }
		text = EVTDESC_MNM_6117_B
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_hiding } }
		text = EVTDESC_MNM_6117_B
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_seclusion } }
		text = EVTDESC_MNM_6117_B
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_incapable } }
		text = EVTDESC_MNM_6117_E
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_during_feast } }
		text = EVTDESC_MNM_6117_B
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_while_asleep } }
		text = EVTDESC_MNM_6117_B
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_6117
		custom_tooltip = { text = EVTOPTA_MNM_6111_TOOLTIP }

		tooltip = { event_target:assassin = { death = { death_reason = death_battle killer = event_target:plot_target } } }

		hidden_effect = {
			event_target:assassin = { character_event = { id = MNM.6118 } }
		}
	}
}

#Assassin notified of "Plot target survives, killed"
character_event = {
	id = MNM.6118
	picture = GFX_evt_melee
	border = GFX_event_normal_frame_intrigue

	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_after_temple } }
		text = EVTDESC_MNM_6118_A
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_prison } }
		text = EVTDESC_MNM_6118_B
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_hiding } }
		text = EVTDESC_MNM_6118_C
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_in_seclusion } }
		text = EVTDESC_MNM_6118_D
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_incapable } }
		text = EVTDESC_MNM_6118_E
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_during_feast } }
		text = EVTDESC_MNM_6118_D
	}
	desc = {
		trigger = { event_target:plot_target = { has_character_flag = assassination_while_asleep } }
		text = EVTDESC_MNM_6118_C
	}


	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_6105

		hidden_effect = {
			if = {
				limit = { NOT = { event_target:assassin_plot_owner = { character = event_target:assassin } } }
				event_target:assassin_plot_owner = { character_event = { id = MNM.6119 } }
			}
			clr_character_flag = murder_in_motion
			event_target:plot_target = { character_event = { id = MNM.6120 days = 1 } } #Clears flags
		}
		death = { death_reason = death_battle killer = event_target:plot_target } 
	}
}

#Plot owner notified "Plot target survives, killed"
character_event = {
	id = MNM.6119
	border = GFX_event_letter_frame_intrigue
	desc = EVTDESC_MNM_6119
	picture = GFX_evt_melee

	is_triggered_only = yes

	option = {
		name = CURSES
		clr_character_flag = murder_in_motion
	}
}

#Clean-up for target
character_event = {
	id = MNM.6120
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		clr_character_flag = assassination_after_temple
		clr_character_flag = assassination_in_prison
		clr_character_flag = assassination_in_hiding
		clr_character_flag = assassination_in_seclusion
		clr_character_flag = assassination_incapable
		clr_character_flag = assassination_during_feast
		clr_character_flag = assassination_while_asleep
	}
}

###MISSIONS### (start on 6199)

#Mission tombola
character_event = {
	id = MNM.6199
	hide_window = yes

	is_triggered_only = yes
	is_in_society = yes

	trigger = {
		society_member_of = the_assassins
		has_any_quest = no
		NOT = { has_character_modifier = quest_cooldown_timer }
		is_society_grandmaster = no
		NOT = { is_inaccessible_trigger = yes }
	}

	immediate = {
		random_society_member = {
			limit = {
				is_society_grandmaster = yes
				society_member_of = the_assassins
			}
			save_event_target_as = grand_master
		}

		random_list = {
			15 = { 
				#modifier = {
				#	factor = 10
				#	ai = yes
				#}
				character_event = { id = MNM.6200 } #Assassination 
			}
			20 = {
				modifier = { factor = 0 ai = yes }
				modifier = { factor = 0 NOT = { religion = shiite } }
				event_target:grand_master = { character_event = { id = MNM.6203 } } #Convert a specific holding
			}
			15 = {
				modifier = {
					factor = 0
					NOT = { 
						any_character = {
							is_within_diplo_range = ROOT
							is_adult = yes
							has_character_flag = assassins_refused_to_pay_debt
							OR = {
								has_character_modifier = borrowed_from_assassins
								has_character_modifier = assassins_debt
							}
						}
					}
				}
				event_target:grand_master = { character_event = { id = MNM.6214 } } # Collect debt
			}
			10 = {
				modifier = { 
					factor = 0 
					is_playable = no 
				}
				modifier = {
					factor = 0
					NOT = { religion = shiite }
				}
				modifier = {
					factor = 0
					independent = no
				}
				modifier = { 
					factor = 0
					ai = yes
				}
				modifier = {
					factor = 0
					NOT = {
						any_realm_province = {
							any_neighbor_province = {
								owner = {
									top_liege = {
										NOT = { character = ROOT }
										NOT = { religion = shiite }
										any_realm_province = {
											owner = { NOT = { religion = shiite } }
											any_province_holding = { 
												owner = { NOT = { religion = shiite } } 
												OR = {
													holding_type = temple
													holding_type = castle
												}
											}
										}
									}
								}
							}
						}
					}
				}
				event_target:grand_master = { character_event = { id = MNM.6220 } } #Occupy infidel holding
			}
			5 = {
				event_target:grand_master = { character_event = { id = MNM.6248 } } #Train protege
			}
			50 = { # AI bypasses missions at times
				modifier = {
					factor = 0
					ai = no
				}
				random_list = {
					70 = {
						modifier = {
							factor = 0.9
							society_influence >= 30
						}
						modifier = {
							factor = 0.9
							society_influence >= 40
						}
						modifier = {
							factor = 0.8
							society_influence >= 50
						}
						modifier = {
							factor = 0.7
							society_influence >= 70
						}
						modifier = {
							factor = 0.6
							society_influence >= 80
						}
						modifier = {
							factor = 0.5
							society_influence >= 90
						}
						add_mission_succeed_influence_effect = yes
						if = { # Added to promote landless assassins to rank 2, so they can participate in plots
							limit = {
								society_rank < 2
								society_can_rank_up = yes
							}
							random_list = {
								50 = {}
								50 = {
									society_rank_up = 1					
								}
							}
						}
					}
					30 = {
						add_mission_fail_influence_effect = yes
					}
				}
			}
			125 = {
				modifier = {
					factor = 0
					ai = no
				}
				#Do nothing for AI
			}
		}
	}
}

#MISSION: Assassinate a target 
character_event = {
	id = MNM.6200
	hide_window = yes

	is_triggered_only = yes

	immediate = { 
		random_list = {
			40 = { #Infidel ruler at war with shia, or their vassal/commander
				modifier = {
					factor = 0
					NOT = {
						any_independent_ruler = { 
							is_within_diplo_range = ROOT #Not using assassins_appropriate_target_trigger here to also find vassals/commanders
							NOT = { religion = shiite }
							NOT = { society_member_of = the_assassins }
							any_war = {
								attacker = { character = PREV }
								defender = { 
									religion = shiite 
									NOT = { character = ROOT }
								}
							}
						}
					}
				}

				#Find the ruler
				random_independent_ruler = {
					limit = {
						is_within_diplo_range = ROOT #Not using assassins_appropriate_target_trigger here to also find vassals/commanders
						NOT = { religion = shiite }
						NOT = { society_member_of = the_assassins }
						any_war = {
							any_attacker = { character = PREV }
							defender = { 
								religion = shiite 
								NOT = { character = ROOT }
							}
						}
					}

					if = {
						limit = { assassins_appropriate_target_trigger = yes }
						save_event_target_as = assassins_target
					}

					if =  { 
						limit = { assassins_appropriate_target_trigger = no }

						save_event_target_as = assassins_aggressor
						
						random_vassal = {
							limit = { 
								assassins_appropriate_target_trigger = yes
								NOT = { society_member_of = the_assassins }
								OR = {
									liege = { is_feudal = yes }
									any_war = {
										any_attacker = { character = PREV }
										defender = { religion = shiite }
									}
								}
							}
							save_event_target_as = assassins_target
						}

						random_courtier_or_vassal = {
							limit = {
								assassins_appropriate_target_trigger = yes
								NOT = { society_member_of = the_assassins }
								in_command = yes
								OR = {
									is_ruler = no
									OR = {
										liege = { is_feudal = yes }
										any_war = {
											any_attacker = { character = PREV }
											defender = { religion = shiite }
										}
									}
								}
							}
							save_event_target_as = assassins_target
						}

						event_target:assassins_target = {
							if = {
								limit = { independent = yes }
								set_character_flag = assassins_target_war_attacker
							}
							if = {
								limit = {
									independent = no
									in_command = no
								}
								set_character_flag = assassins_target_war_attacker_vassal
							}
							if = {
								limit = {
									independent = no
									in_command = yes
								}
								set_character_flag = assassins_target_war_attacker_commander
							}
						}
					}
				}
			}
			15 = { #Assaulted an assassin
				modifier = {
					factor = 0
					NOT = { 
						any_character = { 
							assassins_appropriate_target_trigger = yes
							has_character_flag = assassins_target_assaulted_member
						}
					}
				}
				random_character = {
					limit = { 
						assassins_appropriate_target_trigger = yes
						has_character_flag = assassins_target_assaulted_member 
					}
					save_event_target_as = assassins_target
				}
			}
			20 = { #Killed an assassin
				modifier = {
					factor = 0
					NOT = { 
						any_character = { 
							assassins_appropriate_target_trigger = yes
							has_character_flag = assassins_target_killed_member
						}
					}
				}
				random_character = {
					limit = { 
						assassins_appropriate_target_trigger = yes
						has_character_flag = assassins_target_killed_member 
					}
					save_event_target_as = assassins_target
				}
			}
			20 = { #Marked for death by GM
				modifier = {
					factor = 0
					NOT = { 
						any_character = { 
							assassins_appropriate_target_trigger = yes
							has_character_flag = assassins_target_marked_for_death
						}
					}
				}
				random_character = {
					limit = { 
						assassins_appropriate_target_trigger = yes
						has_character_flag = assassins_target_marked_for_death 
					}
					save_event_target_as = assassins_target
				}
			} 
			15 = { #Cruel non-shia ruler with shia population
				modifier = {
					factor = 0
					NOT = {
						any_independent_ruler = {
							assassins_appropriate_target_trigger = yes
							NOT = { society_member_of = the_assassins }
							OR = {
								is_evil_trigger = yes
								trait = zealous
							}
							NOT = { religion = shiite }
							any_realm_province = { religion = shiite }
						}
					}
				}
				random_independent_ruler = {
					limit = {
						assassins_appropriate_target_trigger = yes
						NOT = { society_member_of = the_assassins }
						OR = {
							is_evil_trigger = yes
							trait = zealous
						}
						NOT = { religion = shiite }
						any_realm_province = { religion = shiite }
					}
					save_event_target_as = assassins_target
					set_character_flag = assassins_target_persecutes_shiites
				}
			}
		}

		if = { #Fallback
			limit = { NOT = { event_target:assassins_target = { always = yes } } }
			random_playable_ruler = {
				limit = {
					assassins_appropriate_target_trigger = yes
					NOT = { religion = shiite }
					NOT = { society_member_of = the_assassins }
					OR = {
						NOT = {
							any_playable_ruler = {
								assassins_appropriate_target_trigger = yes
								NOT = { religion = shiite }
								NOT = { society_member_of = the_assassins }
								
								OR = {
									is_evil_trigger = yes
									trait = zealous
								}
							}
						}
						OR = {
							is_evil_trigger = yes
							trait = zealous
						}
					}
				}
				save_event_target_as = assassins_target
				set_character_flag = assassins_target_fallback
			}
		}

		if = {
			limit = { 
				event_target:assassins_target = { always = yes } 
				is_within_diplo_range = event_target:assassins_target
			}
			random_society_member = {
				limit = { society_rank = { rank == 4 society = the_assassins } }
				character_event = { id = MNM.6201 }
			}
		}
		if = {
			limit = { NOT = { is_within_diplo_range = event_target:assassins_target } }
			event_target:assassins_target = {
				clr_character_flag = assassins_target_persecutes_shiites
				clr_character_flag = assassins_target_fallback
				clr_character_flag = assassins_target_war_attacker
				clr_character_flag = assassins_target_war_attacker_vassal
				clr_character_flag = assassins_target_war_attacker_commander
			}
		}
	}
}

#Ping event for GM
character_event = {
	id = MNM.6201
	hide_window = yes

	is_triggered_only = yes

	immediate = { 
		if = {
			limit = { event_target:assassins_target = { always = yes } }
			FROM = { society_quest_event = { id = MNM.6202 days = 7 random = 7 } } 
		}
	}
}

#You get your target
society_quest_event = {
	id = MNM.6202
	title = quest_the_assassins_assassination
	quest_target = event_target:assassins_target

	desc = {
		trigger = { event_target:assassins_target = { has_character_flag = assassins_target_war_attacker } }
		text = EVTDESC_MNM_6202_WAR_ATTACKER
	}
	desc = {
		trigger = { event_target:assassins_target = { has_character_flag = assassins_target_war_attacker_vassal } }
		text = EVTDESC_MNM_6202_WAR_ATTACKER_VASSAL
	}
	desc = {
		trigger = { event_target:assassins_target = { has_character_flag = assassins_target_war_attacker_commander } }
		text = EVTDESC_MNM_6202_WAR_ATTACKER_COMMANDER
	}
	desc = {
		trigger = { event_target:assassins_target = { has_character_flag = assassins_target_assaulted_member } }
		text = EVTDESC_MNM_6202_ASSAULTED_MEMBER
	}
	desc = {
		trigger = { event_target:assassins_target = { has_character_flag = assassins_target_killed_member } }
		text = EVTDESC_MNM_6202_KILLED_MEMBER
	}
	desc = {
		trigger = { event_target:assassins_target = { has_character_flag = assassins_target_marked_for_death } }
		text = EVTDESC_MNM_6202_MARKED_FOR_DEATH
	}
	desc = {
		trigger = { event_target:assassins_target = { has_character_flag = assassins_target_persecutes_shiites } }
		text = EVTDESC_MNM_6202_PERSECUTED_SHIITES
	}
	desc = {
		trigger = { event_target:assassins_target = { has_character_flag = assassins_target_fallback } }
		text = EVTDESC_MNM_6202_FALLBACK
	}

	is_triggered_only = yes

	immediate = { #For loc
		hidden_effect = {
			event_target:assassins_target = {
				any_war = {
					limit = { defender = { religion = shiite } }
					defender = { save_event_target_as = shiite_defender }
				}
				any_realm_province = {
					limit = { religion = shiite }
					save_event_target_as = shiite_province
				}
			}
		}
	}

	option = {
		name = ACCEPT
		
		event_target:assassins_target = {
			set_quest_target = {
				id = quest_the_assassins_assassination
				holder = ROOT
			}
		}

		hidden_effect = {
			if = { #Makes sure the AI actually does the mission
				limit = { ai = yes }
				random_list = {
					20 = {
						trigger = { 
							attribute_diff = { character = event_target:assassins_target attribute = intrigue value = 6 } 
							society_rank = 2
						}
						modifier = { intrigue = 12 factor = 1.2 }
						modifier = { intrigue = 14 factor = 1.2 }
						modifier = { intrigue = 16 factor = 1.2 }
						modifier = { intrigue = 18 factor = 1.2 }
						character_event = { id = MNM.6948 days = 150 random = 100 } #Triggers plot event 
					}
					20 = {
						trigger = { attribute_diff = { character = event_target:assassins_target attribute = intrigue value = 3 } }
						modifier = { intrigue = 12 factor = 1.2 }
						modifier = { intrigue = 14 factor = 1.2 }
						modifier = { intrigue = 16 factor = 1.2 }
						modifier = { intrigue = 18 factor = 1.2 }
						character_event = { id = MNM.6948 days = 300 random = 100 } #Triggers plot event
					}
					20 = {
						modifier = { intrigue = 12 factor = 1.2 }
						modifier = { intrigue = 14 factor = 1.2 }
						modifier = { intrigue = 16 factor = 1.2 }
						modifier = { intrigue = 18 factor = 1.2 }
						character_event = { id = MNM.6948 days = 500 random = 300 } #Triggers plot event
					}
					40 = {
						modifier = { event_target:assassins_target = { intrigue = 12 } factor = 1.2 }
						modifier = { event_target:assassins_target = { intrigue = 14 } factor = 1.2 }
						modifier = { event_target:assassins_target = { intrigue = 16 } factor = 1.2 }
						modifier = { event_target:assassins_target = { intrigue = 18 } factor = 1.2 }
						modifier = { event_target:assassins_target = { tier = COUNT } factor = 1.5 }
						modifier = { event_target:assassins_target = { tier = DUKE } factor = 2 }
						modifier = { event_target:assassins_target = { tier = KING } factor = 2.5 }
						modifier = { event_target:assassins_target = { tier = EMPEROR } factor = 5 }
						character_event = { id = MNM.6949 } #Clears quest
					}
				}
			}
		}
		event_target:assassins_target = {
			set_character_flag = appear_in_option
			clr_character_flag = appear_in_option

			hidden_effect = {
				clr_character_flag = assassins_target_persecutes_shiites
				clr_character_flag = assassins_target_fallback
				clr_character_flag = assassins_target_war_attacker
				clr_character_flag = assassins_target_war_attacker_vassal
				clr_character_flag = assassins_target_war_attacker_commander
			}
		}
	}

	option = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }

		hidden_effect = {
			event_target:assassins_target = {
				clr_character_flag = assassins_target_persecutes_shiites
				clr_character_flag = assassins_target_fallback
				clr_character_flag = assassins_target_war_attacker
				clr_character_flag = assassins_target_war_attacker_vassal
				clr_character_flag = assassins_target_war_attacker_commander
			}

			add_character_modifier = {
				name = quest_cooldown_timer
				hidden = yes
				days = 1000
			}
		}

		ai_chance = { factor = 0 }
	}
}

#Helps AI do mission
character_event = {
    id = MNM.6948
    hide_window = yes
    is_triggered_only = yes
    trigger = { 
    	NOT = { plot_target_char = { is_quest_target_of = ROOT } } 
    	has_quest = quest_the_assassins_assassination
    }
    immediate = {
    	character_event = { id = MNM.6100 }
    }
}

#AI clean-up
character_event = {
    id = MNM.6949
    hide_window = yes
    is_triggered_only = yes
    trigger = { 
    	NOT = { plot_target_char = { is_quest_target_of = ROOT } } 
    	has_quest = quest_the_assassins_assassination
    }
    immediate = {
    	clr_quest = {
    		id = quest_the_assassins_assassination
    		failure = yes
    	}
    }
}

character_event = {
    id = MNM.6950
    desc = EVTDESC_MNM_6950
    picture = GFX_evt_assassination
    border = GFX_event_normal_frame_intrigue

    is_triggered_only = yes
    
    trigger = {
    	has_quest = quest_the_assassins_assassination
    }

    option = { 
        name = EVTOPTA_MNM_6106
        clr_quest = quest_the_assassins_assassination
        sound_effect = assassins_assassinate_character

		if = {
			limit = { event_target:plot_target = { higher_tier_than = DUKE } }
			add_society_currency_medium_effect = yes
		}
		if = {
			limit = { event_target:plot_target = { lower_tier_than = KING } }
			add_society_currency_minor_effect = yes
		}
    }
}

#MISSION: Convert specific province to Shia
#GM ping event
character_event = {
	id = MNM.6203
	hide_window = yes

	is_triggered_only = yes

	trigger = { 
		FROM = { 
			religion = shiite 
			any_realm_province = { NOT = { religion = shiite } }
		} 
	}

	immediate = { 
		FROM = { society_quest_event = { id = MNM.6204 days = 7 random = 7 } }
	}
}

society_quest_event = {
	id = MNM.6204
	quest_target = event_target:conversion_province

	desc = {
		trigger = { event_target:conversion_province = { owner = { character = ROOT } } }
		text = EVTDESC_MNM_6204_A
	}
	desc = {
		trigger = { event_target:conversion_province = { NOT = { owner = { character = ROOT } } } }
		text = EVTDESC_MNM_6204_B
	}

	is_triggered_only = yes

	immediate = {
		random_realm_province = {
			limit = { 
				NOT = { religion = shiite }
			}
			save_event_target_as = conversion_province
		}
		random_realm_province = {
			limit = { 
				owner = { NOT = { religion = shiite } }
				NOT = { religion = shiite }
			}
			save_event_target_as = conversion_province
		}
		random_demesne_province = {
			limit = { NOT = { religion = shiite } }
			save_event_target_as = conversion_province
		}
		event_target:conversion_province = { owner = { save_event_target_as = conversion_province_owner } }
	}

	option = {
		name = ACCEPT

		event_target:conversion_province = {
			set_quest_target = {
				id = quest_the_assassins_convert_province
				holder = ROOT
			}
		}
	}

	option = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }

		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			days = 1000
		}

		ai_chance = { factor = 0 }
	}
}

#The province in question is converted
province_event = {
	id = MNM.6206
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		any_quester_targeting_this = {
			limit = { has_quest = quest_the_assassins_convert_province }
			character_event = { id = MNM.6205 }
		}
	}
}

#character_event = { #Eve,t for clearing quest_the_assassins_convert_province
#    id = MNM.6230
#    hide_window = yes
#    is_triggered_only = yes
#   	trigger = {
#   		FROM = {
#   			tier = COUNT
#   			location = { is_quest_target = yes }
#   			OR = {
#	   			location = { 
#	   				any_quester_targeting_this = { 
#	   					character = FROMFROM 
#	   					NOT = { is_vassal_or_below = ROOT }
#	   					has_quest = quest_the_assassins_convert_province
#	   				} 
#	   			}
#	   			location = { 
#	   				any_quester_targeting_this = { 
#	   					is_vassal_or_below = FROMFROM 
#	   					NOR = { 
#	   						character = ROOT 
#	   						is_vassal_or_below = ROOT
#	   					}
#	   					has_quest = quest_the_assassins_convert_province
#	   				} 
#	   			}
#   			}
#   		}
#   	}
#   	immediate = {
#   		FROM = {
#   			location = {
#   				any_quester_targeting_this = {
#		   			limit = {
#		   				OR = {
#		   					AND = {
#		   						character = FROMFROM 
#			   					NOT = { is_vassal_or_below = ROOT }
#			   					has_quest = quest_the_assassins_convert_province
#		   					}
#		   					AND = {
#		   						is_vassal_or_below = FROMFROM 
#			   					NOR = { 
#			   						character = ROOT 
#			   						is_vassal_or_below = ROOT
#			   					}
#		   					}
#		   				}
#		   				has_quest = quest_the_assassins_convert_province
#		   			}
#					wealth = 5000
#		   		}
#   			}
#   		}
#   	}
#}

#Mission completion
character_event = {
	id = MNM.6205
	desc = EVTDESC_MNM_6205
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	hide_from = yes

	trigger = {
		religion = FROM
	}

	immediate = {
		FROM = { save_event_target_as = conversion_province }
	}

	option = {
		name = EVTOPTA_MNM_6205
		clr_quest = quest_the_assassins_convert_province
		sound_effect = assassins_convert_province
	}
}



#MISSION: Collect debt
character_event = {
	id = MNM.6214
	hide_window = yes

	is_triggered_only = yes

	immediate = { FROM = { society_quest_event = { id = MNM.6207 days = 7 random = 7 } } }
}

society_quest_event = {
	id = MNM.6207
	desc = EVTDESC_MNM_6207 
	quest_target = event_target:owes_the_assassins

	is_triggered_only = yes

	trigger = {
		society_member_of = the_assassins
		any_character = {
			is_within_diplo_range = ROOT
			is_adult = yes
			has_character_flag = assassins_refused_to_pay_debt
			OR = {
				has_character_modifier = borrowed_from_assassins
				has_character_modifier = assassins_debt
			}
			is_quest_target = no
		}
	}

	immediate = { 
		random_character = {
			limit = {
				is_within_diplo_range = ROOT
				is_adult = yes
				has_character_flag = assassins_refused_to_pay_debt
				OR = {
					has_character_modifier = borrowed_from_assassins
					has_character_modifier = assassins_debt
				}	
				is_quest_target = no		
			}
			save_event_target_as = owes_the_assassins
		}
	}

	option = {
		name = ACCEPT

		event_target:owes_the_assassins = {
			set_quest_target = { 
				id = quest_the_assassins_collect_debt
				holder = ROOT
			}
		}

		event_target:owes_the_assassins = {
			set_character_flag = appear_on_option
			clr_character_flag = appear_on_option
		}

	}

	option = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }

		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			days = 1000
		}

		ai_chance = { factor = 0 }
	}
}

#plot triggers, ping event 
character_event = {
	id = MNM.6217
	hide_window = yes
	
	is_in_society = yes
	is_part_of_plot = yes
	capable_only = yes
	prisoner = no
	min_age = 16

	trigger = {
		society_member_of = the_assassins
		has_plot = plot_assassins_collect_debt
		NOT = { has_character_flag = collecting_debt }
		NOT = { has_character_flag = collected_debt_failure }
		NOT = { has_character_flag = collected_debt_success }
	}

	mean_time_to_happen = {
		months = 2000

		modifier = {
			society_rank = {
				society = the_assassins
				rank == 3
			}
			factor = 3
		}
		modifier = {
			society_rank = {
				society = the_assassins
				rank == 2
			}
			factor = 1.75
		}
		modifier = {
			plot_target_char = { is_inaccessible_trigger = yes }
			factor = 1.5
		}
		modifier = {
			plot_target_char = { prisoner = yes }
			factor = 1.5
		}
		modifier = {
			plot_power = 0.1
			factor = 0.6
		}
		modifier = {
			plot_power = 0.2
			factor = 0.6
		}
		modifier = {
			factor = 0.6
			plot_power = 0.3
		}
		modifier = {
			factor = 0.6
			plot_power = 0.4
		}
		modifier = {
			factor = 0.6
			plot_power = 0.5
		}
		modifier = {
			factor = 0.6
			plot_power = 0.6
		}
		modifier = {
			factor = 0.6
			plot_power = 0.7
		}
		modifier = {
			factor = 0.6
			plot_power = 0.8
		}
		modifier = {
			factor = 0.6
			plot_power = 0.9
		}
		modifier = {
			factor = 0.6
			plot_power = 1
		}
		modifier = {
			factor = 0.3
			plot_power = 1.5
		}
		modifier = {
			factor = 0.3
			plot_power = 2
		}
	}

	immediate = {
		save_event_target_as = assassin
		set_character_flag = collecting_debt
		
		if = {
			limit = {
				has_quest = quest_the_assassins_collect_debt
			}
			quest_target = { save_event_target_as = owes_the_assassins }
		}

		event_target:owes_the_assassins = {
			random_friend = { 
				limit = { NOT = { society_member_of = the_assassins } }
				save_event_target_as = threaten_dear_relation }
			host = { 
				random_courtier = {
					limit = {
						NOT = { society_member_of = the_assassins }
						is_close_relative = event_target:owes_the_assassins
						reverse_opinion = { who = event_target:owes_the_assassins value = 40 }
					}
					save_event_target_as = threaten_dear_relation
				}
			}
			random_lover = { 
				limit = { NOT = { society_member_of = the_assassins } }
				save_event_target_as = threaten_dear_relation 
			}
			random_realm_province = {
				limit = { any_province_holding = { holding_type = city } }
				save_event_target_as = fire_town_province
				random_province_holding = { 
					limit = { holding_type = city }
					save_event_target_as = fire_town
				}
			}
			if = {
				limit = { NOT = { event_target:fire_town = { always = yes } } }
				capital_scope = {
					save_event_target_as = fire_town_province
					random_province_holding = { 
						limit = { holding_type = city }
						save_event_target_as = fire_town
					}
				}
			}

			character_event = { id = MNM.6218 }
		}
	}
}

#Target ping event
character_event = {
	id = MNM.6218
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		FROM = { character_event = { id = MNM.6208 } }
	}
}

#How do you go about collecting the debt?
character_event = {
	id = MNM.6208
	desc = EVTDESC_MNM_6208
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	

	#Threaten them personally
	option = {
		name = EVTOPTA_MNM_6208
		custom_tooltip = { text = EVTOPTA_MNM_6208_TOOLTIP }
		hidden_effect = { event_target:owes_the_assassins = { character_event = { id = MNM.6209 days = 7 } } }
		hidden_effect = { set_character_flag = threaten_personally }
	}

	#Threaten someone they hold dear
	option = {
		trigger = { event_target:threaten_dear_relation = { always = yes } }
		name = EVTOPTB_MNM_6208
		custom_tooltip = { text = EVTOPTB_MNM_6208_TOOLTIP }
		hidden_effect = { event_target:threaten_dear_relation = { character_event = { id = MNM.6211 days = 7 } } }
		hidden_effect = { set_character_flag = threaten_relation }
	}

	#Threaten their wealth
	option = {
		trigger = { event_target:fire_town = { always = yes } }
		name = EVTOPTC_MNM_6208
		custom_tooltip = { text = EVTOPTC_MNM_6208_TOOLTIP }
		hidden_effect = { event_target:owes_the_assassins = { character_event = { id = MNM.6213 days = 7 } } }
		hidden_effect = { set_character_flag = threaten_wealth }
	}
}


#You threaten them personally
character_event = {
	id = MNM.6209
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	hide_from = yes

	desc = {
	 	trigger = {
	 		OR = {
	 			trait = paranoid
	 			trait = schemer
	 			intrigue = 15
	 		}
	 	}
	 	text = EVTDESC_MNM_6209_A
	}
	desc = {
	 	trigger = {
	 		NOR = {
	 			trait = paranoid
	 			trait = schemer
	 			intrigue = 15
	 		}
	 	}
	 	text = EVTDESC_MNM_6209_B
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_6209

		if = {
			limit = {
				OR = {
					trait = paranoid
		 			trait = schemer
		 			intrigue = 15
				}
			}
			custom_tooltip = { text = EVTOPTA_MNM_6209_TOOLTIP_A }
		}

		if = {
			limit = {
				NOR = {
					trait = paranoid
		 			trait = schemer
		 			intrigue = 15
				}
			}
			custom_tooltip = { text = EVTOPTA_MNM_6209_TOOLTIP_B }
			if = {
				limit = {
					has_dlc = "Reapers"
					NOT = { has_character_flag = developing_illness }
					NOT = { has_character_flag = disease_not_serious }
					NOT = { trait = vomiting }
				}

				set_character_flag = disease_not_serious
				add_trait = vomiting
				hidden_tooltip = { character_event = { id = RIP.11005 days = 15 random = 10 } }
			}
			if = {
				limit = {
					NOT = { has_dlc = "Reapers" }
					NOT = { trait = ill }
				}

				add_trait = ill
				hidden_tooltip = { character_event = { id = 6061 days = 15 random = 10 } }
			}
		}
		hidden_tooltip = { character_event =  { id = MNM.6210 days = 3 } }
	}
}

character_event = {
	id = MNM.6210
	desc = EVTDESC_MNM_6210
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue

	min_age = 16
	hide_from = yes

	immediate = {
		random_society_member = {
			limit = {
				society_rank = {
					rank == 4
					society = the_assassins
				}
			}
			save_event_target_as = grand_master
		}
	}

	is_triggered_only = yes

	#Yes
	option = {
		name = EVTOPTA_MNM_6210
		custom_tooltip = { text = EVTOPTA_MNM_6210_TOOLTIP }

		pay_back_assassins_effect = yes

		remove_assassins_debt_effect = yes

		clr_character_flag = assassins_refused_to_pay_debt

		hidden_effect = { event_target:assassin = { character_event =  { id = MNM.6215 } } }

		ai_chance = {
			factor = 50
			modifier = {
				trait = craven
				factor = 5
			}	
			modifier = {
				has_mental_disorder_trigger = yes
				factor = 2
			}
			modifier = {
				has_mental_disorder_trigger = yes
				factor = 2
			}
			modifier = {
				event_target:assassin = { attribute_diff = { character = ROOT attribute = intrigue value = 2 } }
				factor = 1.3
			}
			modifier = {
				event_target:assassin = { attribute_diff = { character = ROOT attribute = intrigue value = 4 } }
				factor = 1.3
			}
			modifier = {
				event_target:assassin = { attribute_diff = { character = ROOT attribute = intrigue value = 6 } }
				factor = 1.4
			}
			modifier = {
				event_target:assassin = { attribute_diff = { character = ROOT attribute = intrigue value = 8 } }
				factor = 1.5
			}
		}
	}

	option = {
		name = EVTOPTB_MNM_6210
		custom_tooltip = { text = EVTOPTB_MNM_6210_TOOLTIP }
		clr_character_flag = assassins_refused_to_pay_debt
		set_character_flag = assassins_target_debt

		hidden_effect = { event_target:assassin = { character_event =  { id = MNM.6216 } } }

		ai_chance = {
			factor = 50
			modifier = {
				trait = brave
				factor = 4
			}	
			modifier = {
				can_pay_assassins_debt = no
				factor = 2
			}	
		}
	}
}

character_event = {
	id = MNM.6211
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		event_target:owes_the_assassins = { character_event = { id = MNM.6212 } }
	}
}

#You threaten someone dear to them
character_event = {
	id = MNM.6212
	desc = EVTDESC_MNM_6212
	picture = GFX_evt_uncomfortable
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	#Yes
	option = {
		name = EVTOPTA_MNM_6210
		custom_tooltip = { text = EVTOPTA_MNM_6210_TOOLTIP }

		pay_back_assassins_effect = yes
		remove_assassins_debt_effect = yes

		clr_character_flag = assassins_refused_to_pay_debt

		hidden_effect = { event_target:assassin = { character_event =  { id = MNM.6215 } } }

		reverse_opinion = {
			who = FROM
			modifier = opinion_grateful
			years = 5
		}

		ai_chance = {
			factor = 50
			modifier = {
				is_benevolent_trigger = yes
				factor = 5
			}	
			modifier = {
				opinion = { who = event_target:threaten_dear_relation value = 75 }
				factor = 2
			}	
			modifier = {
				event_target:assassin = { attribute_diff = { character = ROOT attribute = intrigue value = 2 } }
				factor = 1.3
			}
			modifier = {
				event_target:assassin = { attribute_diff = { character = ROOT attribute = intrigue value = 4 } }
				factor = 1.3
			}
			modifier = {
				event_target:assassin = { attribute_diff = { character = ROOT attribute = intrigue value = 6 } }
				factor = 1.4
			}
			modifier = {
				event_target:assassin = { attribute_diff = { character = ROOT attribute = intrigue value = 8 } }
				factor = 1.5
			}
		}
	}

	option = {
		name = EVTOPTB_MNM_6210
		custom_tooltip = { text = EVTOPTB_MNM_6210_TOOLTIP }
		clr_character_flag = assassins_refused_to_pay_debt
		set_character_flag = assassins_target_debt

		hidden_effect = { event_target:assassin = { character_event =  { id = MNM.6216 } } }

		reverse_opinion = {
			who = FROM
			modifier = opinion_angry
			years = 5
		}

		ai_chance = {
			factor = 50
			modifier = {
				is_evil_trigger = yes
				factor = 4
			}
			modifier = {
				NOT = { opinion = { who = event_target:threaten_dear_relation value = 50 } }
				factor = 2
			}	
			modifier = {
				can_pay_assassins_debt = no
				factor = 2
			}		
		}
	}
}

#Threaten their money
character_event = {
	id = MNM.6213
	desc = EVTDESC_MNM_6213
	picture = GFX_evt_uncomfortable
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes
	hide_from = yes

	#Yes
	option = {
		name = EVTOPTA_MNM_6210
		custom_tooltip = { text = EVTOPTA_MNM_6210_TOOLTIP }

		pay_back_assassins_effect = yes
		remove_assassins_debt_effect = yes

		clr_character_flag = assassins_refused_to_pay_debt

		hidden_effect = { event_target:assassin = { character_event =  { id = MNM.6215 } } }

		event_target:fire_town_province = {
			add_province_modifier = {
				name = trade_district_fire
				duration = 3650
			}
		}

		ai_chance = {
			factor = 50
			modifier = {
				trait = greedy
				factor = 5
			}	
			modifier = {
				trait = ambitious
				factor = 1.5
			}	
			modifier = {
				event_target:assassin = { attribute_diff = { character = ROOT attribute = intrigue value = 2 } }
				factor = 1.3
			}
			modifier = {
				event_target:assassin = { attribute_diff = { character = ROOT attribute = intrigue value = 4 } }
				factor = 1.3
			}
			modifier = {
				event_target:assassin = { attribute_diff = { character = ROOT attribute = intrigue value = 6 } }
				factor = 1.4
			}
			modifier = {
				event_target:assassin = { attribute_diff = { character = ROOT attribute = intrigue value = 8 } }
				factor = 1.5
			}	
		}
	}

	option = {
		name = EVTOPTB_MNM_6210
		custom_tooltip = { text = EVTOPTB_MNM_6210_TOOLTIP }
		clr_character_flag = assassins_refused_to_pay_debt
		set_character_flag = assassins_target_debt

		hidden_effect = { event_target:assassin = { character_event =  { id = MNM.6216 } } }

		event_target:fire_town_province = {
			add_province_modifier = {
				name = trade_district_fire
				duration = 3650
			}
		}

		ai_chance = {
			factor = 50
			modifier = {
				trait = charitable
				factor = 4
			}
			modifier = {
				trait = content
				factor = 1.5
			}
			modifier = {
				can_pay_assassins_debt = no
				factor = 2
			}			
		}
	}
}

#They payed back, mission successful
character_event = {
	id = MNM.6215
	picture = GFX_evt_relic_box
	border = GFX_event_normal_frame_intrigue	

	desc = {
		trigger = { has_character_flag = threaten_personally }
		text = EVTDESC_MNM_6215_A
	}
	desc = {
		trigger = { has_character_flag = threaten_relation }
		text = EVTDESC_MNM_6215_B
	}
	desc = {
		trigger = { has_character_flag = threaten_wealth }
		text = EVTDESC_MNM_6215_C
	}

	immediate = {
		random_society_member = {
			limit = {
				society_rank = {
					rank == 4
					society = the_assassins
				}
			}
			save_event_target_as = grand_master
		}
	}

	is_triggered_only = yes

	option = {
		name = EXCELLENT

		clr_quest = quest_the_assassins_collect_debt
		sound_effect = assassins_collect_debt
		add_society_currency_minor_effect = yes #reward

		hidden_effect = {
			clr_character_flag = threaten_personally
			clr_character_flag = threaten_relation
			clr_character_flag = threaten_wealth
			clr_character_flag = collecting_debt
			set_character_flag = collected_debt_success
		}
	}
}

#They refused to pay back, mission unsuccessful
character_event = {
	id = MNM.6216
	picture = GFX_evt_uncomfortable
	border = GFX_event_normal_frame_intrigue	

	desc = {
		trigger = { has_character_flag = threaten_personally }
		text = EVTDESC_MNM_6216_A
	}
	desc = {
		trigger = { has_character_flag = threaten_relation }
		text = EVTDESC_MNM_6216_B
	}
	desc = {
		trigger = { has_character_flag = threaten_wealth }
		text = EVTDESC_MNM_6216_C
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_6215
		clr_quest = { id = quest_the_assassins_collect_debt failure = yes }
		hidden_effect = {
			clr_character_flag = threaten_personally
			clr_character_flag = threaten_relation
			clr_character_flag = threaten_wealth
			clr_character_flag = collecting_debt
			set_character_flag = collected_debt_failure
		}
	}
}

#MISSION: Occupy infidel holding 
character_event = {
	id = MNM.6220
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		FROM = { society_quest_event = { id = MNM.6221 days = 7 random = 7 } }
	}
}

society_quest_event = {
	id = MNM.6221
	desc = EVTDESC_MNM_6221
	quest_target = event_target:infidel_holding

	is_triggered_only = yes
	
	immediate = {
		random_realm_province = {
			limit = {
				any_neighbor_province = {
					owner = {
						top_liege = {
							NOT = { character = ROOT }
							OR = {
								NOT = { religion_group = muslim }
								AND = {
									NOT = { religion = shiite }
									NOT = { ROOT = { any_realm_province = { any_neighbor_province = { owner = { top_liege = { NOT = { religion_group = muslim } } } } } } }
								}
							}
							any_realm_province = {
								any_province_holding = { 
									owner = { NOT = { religion = shiite } } 
									OR = {
										holding_type = temple
										holding_type = castle
									}
								}
							}
						}
					}
				}
			}
			random_neighbor_province = {
				limit = { 
					owner = {
						top_liege = {
							NOT = { character = ROOT }
							OR = {
								NOT = { religion_group = muslim }
								AND = {
									NOT = { religion = shiite }
									NOT = { ROOT = { any_realm_province = { any_neighbor_province = { owner = { top_liege = { NOT = { religion_group = muslim } } } } } } }
								}
							}
							any_realm_province = {
								owner = { NOT = { religion = shiite } }
								any_province_holding = { 
									owner = { NOT = { religion = shiite } } 
									OR = {
										holding_type = temple
										holding_type = castle
									}
								}
							}
						}
					}
				}
			
				owner = {
					top_liege = {
						random_realm_province = {
							limit = {
								any_province_holding = { 
									owner = { NOT = { religion = shiite } } 
									OR = {
										holding_type = temple
										holding_type = castle
									}
								}
							}
							random_province_holding = {
								limit = {
									owner = { NOT = { religion = shiite } } 
									OR = {
										holding_type = temple
										holding_type = castle
									}
								}
								save_event_target_as = infidel_holding #Lowest prio, random holding in neigbor's realm
							}
						}
						random_demesne_province = {
							limit = {
								any_province_holding = { 
									owner = { NOT = { religion = shiite } } 
									OR = {
										holding_type = temple
										holding_type = castle
									}
								}
							}
							random_province_holding = {
								limit = {
									owner = { NOT = { religion = shiite } } 
									OR = {
										holding_type = temple
										holding_type = castle
									}
								}
								save_event_target_as = infidel_holding #Hgihest prio, top liege neigbor's holding
							}
						}
					}
				}
			}
		}
		event_target:infidel_holding = { location = { owner = { save_event_target_as = infidel_holding_owner } } }
		event_target:infidel_holding = { location = { save_event_target_as = infidel_holding_province } }
	}

	option = {
		name = ACCEPT

		event_target:infidel_holding = {
			set_quest_target = {
				id = quest_the_assassins_occupy_holding
				holder = ROOT
			}
		}
	
		event_target:infidel_holding_owner = { 
			set_character_flag = appear_on_option
			clr_character_flag = appear_on_option
		}
	}

	option = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }

		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			days = 1000
		}

		ai_chance = { factor = 0 }
	}
}

#Holding occupied
character_event = {
	id = MNM.6222
	desc = EVTDESC_MNM_6222
	picture = GFX_evt_magnificent_castle
	border = GFX_event_normal_frame_intrigue

	trigger = {
		has_quest = quest_the_assassins_occupy_holding
		quest_target = { title = FROM }
	} 

	is_triggered_only = yes

	immediate = {

		FROM = {
			save_event_target_as = infidel_holding
			owner = { save_event_target_as = infidel_holding_owner }
		}
	}

	option = {
		name = EVTOPTA_6028
		clr_quest = quest_the_assassins_occupy_holding
		sound_effect = assassins_occupy_infidel_holding
		add_society_currency_medium_effect = yes
	}
}

###POWERS###

#POWER: Drugs
character_event = {
	id = MNM.6800
	desc = EVTDESC_MNM_6800
	picture = GFX_evt_dark_prayer
	border = GFX_event_normal_frame_religion

	immediate = {
		set_character_flag = assassins_taking_drugs #Is removed in 6802
	}

	is_triggered_only = yes

	#Small dose
	option = {
		name = EVTOPTA_MNM_6800
		custom_tooltip = { text = EVTOPTA_MNM_6800_TOOLTIP }

		set_character_flag = drugs_small_dose

		hidden_effect = { character_event = { id = MNM.6801 } }
	}

	#Regular dose
	option = {
		name = EVTOPTB_MNM_6800
		custom_tooltip = { text = EVTOPTB_MNM_6800_TOOLTIP }

		hidden_effect = { character_event = { id = MNM.6801 } }
	}

	#Big dose
	option = {
		name = EVTOPTC_MNM_6800
		custom_tooltip = { text = EVTOPTC_MNM_6800_TOOLTIP }

		set_character_flag = drugs_big_dose

		hidden_effect = { character_event = { id = MNM.6801 } }
	}
}

#Drug tombola!
character_event = {
	id = MNM.6801
	hide_window = yes

	is_triggered_only = yes

	immediate = {	
		#How will the trip be, over all?
		random_list = {
			20 = { #Great
				set_character_flag = great_trip

				modifier = {
					has_character_flag = drugs_big_dose
					factor = 2
				}
				modifier = {
					has_character_flag = drugs_small_dose
					factor = 0.5
				}
				modifier = {
					trait = hedonist
					factor = 1.5
				}
			}
			60 = { #Good
				set_character_flag = good_trip
			}
			20 = { #Bad
				set_character_flag = bad_trip

				modifier = {
					has_character_flag = drugs_big_dose
					factor = 1.5
				}
				modifier = {
					has_character_flag = drugs_small_dose
					factor = 0.5
				}
				modifier = {
					has_mental_disorder_trigger = yes
					factor = 1.5
				}
				modifier = {
					has_character_modifier = hashish_addict
					factor = 1.5
				}
				modifier = {
					trait = paranoid
					factor = 1.5
				}
			}
		}

		#Outcome
		character_event = { id = MNM.6802 days = 7 } #Overall outcome

		#Special events, all with 4 day delays, weight with trip flags
		random_list = {
			10 = { #Nothing
				modifier = {
					has_character_flag = drugs_small_dose
					factor = 2
				}
				modifier = {
					has_character_flag = drugs_big_dose
					factor = 0.5
				}
			}
			10 = { #Become posessed
				modifier = {
					NOT = { has_character_flag = bad_trip}
					factor = 0
				}
				modifier = {
					has_character_flag = drugs_big_dose
					factor = 1.5
				}
				modifier = {
					has_character_flag = drugs_small_dose
					factor = 0.5
				}
				modifier = {
					has_character_modifier = hashish_addict
					factor = 1.5
				}

				if = {
					limit = {
						NOT = { trait = possessed}
					}
					set_character_flag = become_possessed
					character_event = { id = MNM.6810 days = 4}
				}
			}
			10 = { #Become paranoid
				modifier = {
					NOT = { has_character_flag = bad_trip}
					factor = 0
				}
				modifier = {
					has_character_flag = drugs_big_dose
					factor = 1.5
				}
				modifier = {
					has_character_flag = drugs_small_dose
					factor = 0.5
				}
				modifier = {
					has_character_modifier = hashish_addict
					factor = 1.5
				}
				modifier = {
					trait = trusting
					factor = 0.5
				}
				if = {
					limit = {
						NOT = { trait = paranoid}
					}
					set_character_flag = become_paranoid
					character_event = { id = MNM.6810 days = 4}
				}
			}
			5 = { 	#Become gluttonous
				modifier = {
					has_character_flag = drugs_big_dose
					factor = 1.5
				}
				modifier = {
					has_character_flag = drugs_small_dose
					factor = 0.5
				}
				modifier = {
					has_character_modifier = hashish_addict
					factor = 1.5
				}
				modifier = {
					trait = temperate
					factor = 0.5
				}
				if = {
					limit = {
						NOT = { trait = gluttonous }
					}
					set_character_flag = become_gluttonous
					character_event = { id = MNM.6810 days = 4}
				}
			}
			5 = { 	#Become slothful
				modifier = {
					has_character_flag = drugs_big_dose
					factor = 1.5
				}
				modifier = {
					has_character_flag = drugs_small_dose
					factor = 0.5
				}
				modifier = {
					has_character_modifier = hashish_addict
					factor = 1.5
				}
				modifier = {
					trait = diligent
					factor = 0.5
				}
				if = {
					limit = {
						NOT = { trait = slothful }
					}
					set_character_flag = become_slothful
					character_event = { id = MNM.6810 days = 4}
				}
			}
			10 = { #Discover a plot
				modifier = {
					NOT = {has_character_flag = good_trip}
					factor = 2
				}
				modifier = {
					trait = paranoid
					factor = 2
				}
				modifier = {
					trait = possessed
					factor = 1.5
				}
				modifier = {
					NOT = {
						top_liege = {
							any_realm_character = {
								has_plot = yes
								NOT = {
									plot_is_known_by = ROOT
								}
							}
						}
					}
					factor = 0
				}
				character_event = { id = MNM.6811}
			} 
			10 = { #Gain a lover, perhaps your spouse?
				modifier = {
					has_character_flag = great_trip
					factor = 2
				}
				modifier = {
					has_character_flag = bad_trip
					factor = 0
				}
				modifier = {
					trait = lustful
					factor = 1.5
				}
				modifier = {
					trait = eunuch
					factor = 0
				}
				modifier = {
					has_lover = yes
					factor = 0.5
				}
				set_character_flag = drug_lover
				character_event = { id = MNM.6812 days = 4}
			}
			20 = { #Gain a friend
				modifier = {
					has_character_flag = great_trip
					factor = 2
				}
				modifier = {
					has_character_flag = bad_trip
					factor = 0
				}
				modifier = {
					trait = paranoid
					factor = 0.5
				}
				set_character_flag = drug_friend
				character_event = { id = MNM.6812 days = 4}
			}
			10 = { #Discover a cheating spouse
				modifier = {
					is_married = no
					factor = 0
				}
				modifier = {
					NOR = {
						any_spouse = {
							any_lover = {
								NOT = {
									character = ROOT
								}
							}
						}
						AND = {
							trait = paranoid
							any_realm_character = {
		 						same_sex = root
		 						NOT = { character = ROOT }
							}
						}
					}
					factor = 0
				}
				character_event = { id = MNM.6813 days = 4}
			}
			10 = { #Make a fool of yourself
				modifier = {
					has_character_flag = drugs_big_dose
					factor = 1.5
				}
				modifier = {
					has_character_flag = drugs_small_dose
					factor = 0.5
				}
				character_event = { id = MNM.6814 days = 4}
			}
			10 = { #Die, only if you're already an addict
				modifier = {
					NOT = { has_character_flag = drugs_big_dose}
					factor = 0.5
				}
				modifier = {
					NOT = { has_character_flag = bad_trip}
					factor = 0
				}
				modifier = {
					NOT = { has_character_modifier = hashish_addict }
					factor = 0
				}
				modifier = {
					has_character_modifier = withdrawal_symptoms
					factor = 1.5
				}
				modifier = {
					has_character_modifier = drugs_timer
					factor = 2
				}
				modifier = {
					trait = gluttonous 
					factor = 1.5
				}
				modifier = {
					trait = temperate 
					factor = 0.5
				}
				modifier = {
					health = 5
					factor = 0
				}
				modifier = {
					OR = {
						trait = ill
						trait = pneumonic
						trait = has_tuberculosis
						trait = cough
						trait = chest_pain
					}
					factor = 2
				}
				character_event = { id = MNM.6815 days = 4}
			}
			10 = { # Cure stressed
				modifier = {
					factor = 0
					NOT = { trait = stressed }
				}
				modifier = {
					factor = 0.5
					has_character_flag = drugs_small_dose
				}
				set_character_flag = drugs_curing_stressed
				character_event = { id = MNM.6816 days = 4 }
			}
			10 = { # Cure possessed
				modifier = {
					factor = 0
					NOT = { trait = possessed }
				}
				modifier = {
					factor = 0.5
					has_character_flag = drugs_small_dose
				}
				set_character_flag = drugs_curing_possessed
				character_event = { id = MNM.6816 days = 4 }
			}
			10 = { # Cure depressed
				modifier = {
					factor = 0
					NOT = { trait = depressed }
				}
				modifier = {
					factor = 0.5
					NOT = { has_character_flag = drugs_big_dose }
				}
				set_character_flag = drugs_curing_depressed
				character_event = { id = MNM.6816 days = 4 }
			}
			10 = { # Cure lunatic
				modifier = {
					factor = 0
					NOT = { trait = lunatic }
				}
				modifier = {
					factor = 0
					NOT = { has_character_flag = drugs_big_dose }
				}
				set_character_flag = drugs_curing_lunatic
				character_event = { id = MNM.6816 days = 4 }
			}
			10 = { # Diplomatic insight
				modifier = {
					factor = 0
					NOT = {
						OR = {
							has_character_flag = great_trip
							has_character_flag = good_trip
						}
					}
				}
				modifier = {
					factor = 2
					has_character_flag = great_trip
				}
				modifier = {
					factor = 2
					NOT = {
						diplomacy = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						diplomacy = 15
					}
				}
				modifier = {
					factor = 0
					has_character_modifier = diplomatic_insight
				}
				set_character_flag = gains_diplomatic_insight_flag
				character_event = { id = MNM.6817 days = 4 }
			}
			10 = { # Martial insight
				modifier = {
					factor = 0
					NOT = {
						OR = {
							has_character_flag = great_trip
							has_character_flag = good_trip
						}
					}
				}
				modifier = {
					factor = 2
					has_character_flag = great_trip
				}
				modifier = {
					factor = 2
					NOT = {
						martial = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						martial = 15
					}
				}
				modifier = {
					factor = 0
					has_character_modifier = martial_insight
				}
				set_character_flag = gains_martial_insight_flag
				character_event = { id = MNM.6817 days = 4 }
			}
			10 = { # Intrigue insight
				modifier = {
					factor = 0
					NOT = {
						OR = {
							has_character_flag = great_trip
							has_character_flag = good_trip
						}
					}
				}
				modifier = {
					factor = 2
					has_character_flag = great_trip
				}
				modifier = {
					factor = 2
					NOT = {
						intrigue = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						intrigue = 15
					}
				}
				modifier = {
					factor = 0
					has_character_modifier = intrigue_insight
				}
				set_character_flag = gains_intrigue_insight_flag
				character_event = { id = MNM.6817 days = 4 }
			}
			10 = { # Learning insight
				modifier = {
					factor = 0
					NOT = {
						OR = {
							has_character_flag = great_trip
							has_character_flag = good_trip
						}
					}
				}
				modifier = {
					factor = 2
					has_character_flag = great_trip
				}
				modifier = {
					factor = 2
					NOT = {
						learning = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						learning = 15
					}
				}
				modifier = {
					factor = 0
					has_character_modifier = learning_insight
				}
				set_character_flag = gains_learning_insight_flag
				character_event = { id = MNM.6817 days = 4 }
			}
			10 = { # Stewardship insight
				modifier = {
					factor = 0
					NOT = {
						OR = {
							has_character_flag = great_trip
							has_character_flag = good_trip
						}
					}
				}
				modifier = {
					factor = 2
					has_character_flag = great_trip
				}
				modifier = {
					factor = 2
					NOT = {
						stewardship = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						stewardship = 15
					}
				}
				modifier = {
					factor = 0
					has_character_modifier = stewardship_insight
				}
				set_character_flag = gains_stewardship_insight_flag
				character_event = { id = MNM.6817 days = 4 }
			}
			10 = { #Cure your disease
				modifier = {
					factor = 0
					NOT = { has_dlc = "Reapers" }
				}
				modifier = {
					factor = 0
					has_disease_trigger = no
				}
				modifier = {
					factor = 3
					has_character_flag = great_trip
				}
				character_event = { id = MNM.6818 days = 4 }
			}
		}
		random = {
			chance = 5

			character_event = { id = MNM.6803 days = 20 random = 20 } #Gives addiction

			modifier = {
				has_character_modifier = hashish_addict
				factor = 0
			}
			modifier = {
				has_character_modifier = drugs_timer
				factor = 4
			}
			modifier = {
				has_character_flag = drugs_big_dose
				factor = 1.5
			}
			modifier = {
				has_character_flag = drugs_small_dose
				factor = 0.5
			}
			modifier = {
				trait = gluttonous 
				factor = 1.5
			}
			modifier = {
				trait = temperate 
				factor = 0.5
			}
			modifier = {
				has_mental_disorder_trigger = yes
				factor = 2
			}
		}

		#Add drug timer based on dosage
		if = {
			limit = { has_character_flag = drugs_small_dose }
			add_character_modifier = {
				name = drugs_timer
				hidden = yes
				days = 365
			}
		}
		if = {
			limit = { 
				NOR = {
					has_character_flag = drugs_small_dose 
					has_character_flag = drugs_big_dose
				}
			}
			add_character_modifier = {
				name = drugs_timer
				hidden = yes
				days = 600
			}
		}
		if = {
			limit = { has_character_flag = drugs_big_dose }
			add_character_modifier = {
				name = drugs_timer
				hidden = yes
				days = 900
			}
		}	

		#Illness handling
		random = {
			chance = 5
			give_cancer_effect = yes
		}

		#Removing flags
		clr_character_flag = drugs_small_dose
		clr_character_flag = drugs_big_dose
	}
}

#Outcome of trip
character_event = {
	id = MNM.6802
	picture = GFX_evt_dark_prayer
	border = GFX_event_normal_frame_religion

	desc = {
		trigger = { has_character_flag = great_trip }
		text = EVTDESC_MNM_6802_GREAT
		picture = GFX_evt_religious_exultation
	}
	desc = {
		trigger = { has_character_flag = good_trip }
		text = EVTDESC_MNM_6802_GOOD
		picture = GFX_evt_dark_prayer
	}
	desc = {
		trigger = { has_character_flag = bad_trip }
		text = EVTDESC_MNM_6802_BAD
		picture = GFX_evt_impalement
	}

	is_triggered_only = yes
	
	option = {
		name = {
			trigger = { has_character_flag = great_trip }
			text = EVTOPTA_MNM_6802_GREAT
		}
		name = {
			trigger = { has_character_flag = good_trip }
			text = EVTOPTA_MNM_6802_GOOD
		}
		name = {
			trigger = { has_character_flag = bad_trip }
			text = EVTOPTA_MNM_6802_BAD
		}

		if = {
			limit = { has_character_flag = great_trip }
			if = {
				limit = { has_character_modifier = astounding_visions }
				remove_character_modifier = astounding_visions
			}
			if = {
				limit = { has_character_modifier = uplifting_visions }
				remove_character_modifier = uplifting_visions
			}
			if = {
				limit = { has_character_modifier = frightening_visions }
				remove_character_modifier = frightening_visions
			}
			add_character_modifier = {
				name = astounding_visions
				days = 365
			}
			clr_character_flag = great_trip
		}
		if = {
			limit = { has_character_flag = good_trip }
			if = {
				limit = { has_character_modifier = astounding_visions }
				remove_character_modifier = astounding_visions
			}
			if = {
				limit = { has_character_modifier = uplifting_visions }
				remove_character_modifier = uplifting_visions
			}
			if = {
				limit = { has_character_modifier = frightening_visions }
				remove_character_modifier = frightening_visions
			}
			add_character_modifier = {
				name = uplifting_visions
				days = 365
			}
			clr_character_flag = good_trip
		}

		if = {
			limit = { has_character_flag = bad_trip }
			if = {
				limit = { has_character_modifier = astounding_visions }
				remove_character_modifier = astounding_visions
			}
			if = {
				limit = { has_character_modifier = uplifting_visions }
				remove_character_modifier = uplifting_visions
			}
			if = {
				limit = { has_character_modifier = frightening_visions }
				remove_character_modifier = frightening_visions
			}
			add_character_modifier = {
				name = frightening_visions
				days = 365
			}
			clr_character_flag = bad_trip
		}
		clr_character_flag = assassins_taking_drugs
	}
}

#You're an addict
character_event = {
	id = MNM.6803
	desc = EVTDESC_MNM_6803
	picture = GFX_evt_drunk
	border = GFX_event_normal_frame_religion

	trigger = { NOT = { has_character_modifier = hashish_addict } }

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_6803
		custom_tooltip = { text = EVTOPTA_6803_TOOLTIP }

		add_character_modifier = {
			name = hashish_addict
			duration = -1
		}

		hidden_effect = { character_event = { id = MNM.6804 days = 100 } } 
	}
}

#Hidden addiction handling
character_event = {
	id = MNM.6804
	hide_window = yes

	trigger = { has_character_modifier = hashish_addict }

	is_triggered_only = yes

	immediate = {
		#Withdrawal syptoms
		random = {
			chance = 20
			character_event = { id = MNM.6805 }
		}
		#Recover
		if = {
			limit = { has_character_modifier =  withdrawal_symptoms }
			random = {
				chance = 40
				character_event = { id = MNM.6806 }
			}
		}

		character_event = { id = MNM.6804 days = 100 }
	}
}

#You're having withdrawal symptoms
character_event = {
	id = MNM.6805
	desc = EVTDESC_MNM_6805
	picture = GFX_evt_illness
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = { NOT = { has_character_modifier = withdrawal_symptoms } }

	option = {
		name = EVTOPTA_MNM_6805

		add_character_modifier = {
			name = withdrawal_symptoms
			duration = -1
		}
	}
}

#Recovered from addiction
character_event = {
	id = MNM.6806
	desc = EVTDESC_MNM_6806
	picture = GFX_evt_recovery
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = {
		has_character_modifier = hashish_addict
		has_character_modifier = withdrawal_symptoms
	}

	option = {
		name = EVTOPTA_MNM_6806

		remove_character_modifier = hashish_addict
		remove_character_modifier = withdrawal_symptoms
	}
}

#Special events
#Get Trait
#Three descs and options
character_event = {
	id = MNM.6810
	picture = GFX_evt_drunk
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	desc = {
		trigger = { has_character_flag = become_gluttonous }
		text = EVTDESCA_MNM_6810
	}
	desc = {
		trigger = { has_character_flag = become_paranoid }
		text = EVTDESCB_MNM_6810
	}
	desc = {
		trigger = { has_character_flag = become_slothful }
		text = EVTDESCC_MNM_6810
	}
	desc = {
		trigger = { has_character_flag = become_possessed }
		text = EVTDESCD_MNM_6810
	}

	option = {
		name = EVTOPTA_MNM_6810
		if = {
			limit = {
				NOT = { trait = temperate }
			}
		add_trait = gluttonous
		}
		if = { 
			limit = { trait = temperate }
			remove_trait = temperate
		}
		clr_character_flag = become_gluttonous

		trigger = { has_character_flag = become_gluttonous }
	}

	option = {
		name = EVTOPTB_MNM_6810
		if = {
			limit  = {
				NOT = { trait = trusting }
			}
			add_trait = paranoid
		}
		if = { 
			limit = { trait = trusting }
			remove_trait = trusting
		}
		clr_character_flag = become_paranoid

		trigger = { has_character_flag = become_paranoid }
	}
	
	option = {
		name = EVTOPTC_MNM_6810
		if = {
			limit  = {
				NOT = { trait = diligent }
			}
			add_trait = slothful
		}
		if = { 
			limit = { trait = diligent }
			remove_trait = diligent
		}
		clr_character_flag = become_slothful

		trigger = { has_character_flag = become_slothful }
	}

	option = {
		name = EVTOPTD_MNM_6810
		add_trait = possessed
		clr_character_flag = become_possessed
		trigger = { has_character_flag = become_possessed }
	}
}

#Discover Plot
character_event = {
	id = MNM.6811
	is_triggered_only = yes
	hide_window = yes
	immediate = {
		random_list = {
			40 = {
				modifier = {
					NOT= {
						top_liege = {
							any_realm_character = {
								plot_target_char = { character = ROOT }
								NOT = { plot_is_known_by = ROOT }
							}
						}
					}
					factor = 0
				}
				modifier = {
					NOT= {
						top_liege = {
							any_realm_lord = {
								plot_target_char = { character = ROOT }
								NOT = { plot_is_known_by = ROOT }
							}
						}
					}
					factor = 0.5
				}
				save_event_target_as = drug_plotter_target
				top_liege = {
					random_realm_character = {
						limit = {
							plot_target_char = { character = ROOT }
							NOT = { plot_is_known_by = ROOT }
						}
						save_event_target_as = drug_plotter_reveal
						character_event = { id = MNM.68111 }
					}
				}
				top_liege = {
					random_realm_lord = {
						limit = {
							plot_target_char = { character = ROOT }
							NOT = { plot_is_known_by = ROOT }
						}
						save_event_target_as = drug_plotter_reveal
						character_event = { id = MNM.68111 }
					}
				}
			}
			20 = {
				modifier = {
					NOT = {
						any_realm_character = {
							NOT = { plot_is_known_by = ROOT }
							plot_target_char = {
								dynasty = ROOT
							}
						}
					}
					factor = 0
				}
				modifier = {
					any_realm_lord = {
						plot_target_char = {
							dynasty = ROOT
						}
						NOT = { plot_is_known_by = ROOT }
					}
					factor = 1.5
				}
				random_realm_character = {
					limit = {
						has_plot = yes
						NOT = { plot_is_known_by = ROOT }
					}
					save_event_target_as = drug_plotter_reveal
					plot_target_char = {
						save_event_target_as = drug_plotter_target
					}
					character_event = { id = MNM.68111 }
				}
				random_realm_lord = {
					limit = {
						has_plot = yes
						NOT = { plot_is_known_by = ROOT }
						plot_target_char = {
							dynasty = ROOT
						}
					}
					save_event_target_as = drug_plotter_reveal
					plot_target_char = {
						save_event_target_as = drug_plotter_target
					}
					character_event = { id = MNM.68111 }
				}
			}
			10 = {
				modifier = {
					NOT = {
						any_realm_character = {
							has_plot = yes
							NOT = { plot_is_known_by = ROOT }
						}
					}
					factor = 0
				}
				random_realm_character = {
					limit = {
						has_plot = yes
						NOT = { plot_is_known_by = ROOT }
					} 
					save_event_target_as = drug_plotter_reveal
					plot_target_char = {
						save_event_target_as = drug_plotter_target
					}
					character_event = { id = MNM.68111 }

				}
			}
			1 = {
				top_liege = {
					random_realm_character = {
						limit = {
							has_plot = yes
							NOT = {
								plot_is_known_by = ROOT
							}
						}
						save_event_target_as = drug_plotter_reveal
						plot_target_char = {
							save_event_target_as = drug_plotter_target
						}
						character_event = { id = MNM.68111 }
					}
				}
			}
		}
	}
}
#Ping
character_event = {
	id = MNM.68111
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		FROM = {
			character_event = {
				id = MNM.68112 days = 4
			}
		}
	}
}
#Four Descs, one or two options
character_event = {
	id = MNM.68112
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes


	desc = {
		text = EVTDESCA_MNM_68112
		trigger = {
			event_target:drug_plotter_target = { character = ROOT }
			event_target:drug_plotter_reveal = {
				OR = {
					has_plot = plot_kill_character
					has_plot = plot_kill_spouse
				}
			}
		}
	}

	desc = {
		text = EVTDESCB_MNM_68112
		trigger = {
			event_target:drug_plotter_target = { character = ROOT }
			event_target:drug_plotter_reveal = {
				NOT = {
					has_plot = plot_kill_character
					has_plot = plot_kill_spouse
				}
			}
		}
	}

	desc = {
		text = EVTDESCC_MNM_68112
		trigger = {
			event_target:drug_plotter_target = { NOT ={ character = ROOT } }
			event_target:drug_plotter_reveal = {
				OR = {
					has_plot = plot_kill_character
					has_plot = plot_kill_spouse
				}
			}
		}
	}

	desc = {
		text = EVTDESCD_MNM_68112
		trigger = {
			event_target:drug_plotter_target = { NOT ={ character = ROOT } }
			event_target:drug_plotter_reveal = {
				NOT = {
					has_plot = plot_kill_character
					has_plot = plot_kill_spouse
				}
			}
		}
	}
	immediate = {
		event_target:drug_plotter_reveal = {
			reveal_plot = ROOT
		}
	}
	option = {
		trigger = {
			event_target:drug_plotter_target = { character = ROOT }
			event_target:drug_plotter_reveal = {
				OR = {
					has_plot = plot_kill_character
					has_plot = plot_kill_spouse
				}
			}
		}
		name = EVTOPTA_MNM_68112
	}
	option = {
		trigger = {
			event_target:drug_plotter_target = { character = ROOT }
			event_target:drug_plotter_reveal = {
				NOT = {
					has_plot = plot_kill_character
					has_plot = plot_kill_spouse
				}
			}
		}
		name = EVTOPTB_MNM_68112
	}
	option = {
		trigger = {
			event_target:drug_plotter_target = { NOT ={ character = ROOT } }
			event_target:drug_plotter_reveal = {
				OR = {
					has_plot = plot_kill_character
					has_plot = plot_kill_spouse
				}
			}
		}
		name = EVTOPTC_MNM_68112
	}
	option = {
		trigger = {
			event_target:drug_plotter_target = { NOT ={ character = ROOT } }
			event_target:drug_plotter_reveal = {
				NOT = {
					has_plot = plot_kill_character
					has_plot = plot_kill_spouse
				}
			}
		}
		name = EVTOPTD_MNM_68112
	}
}

#Gain Relation
#One desc and option
character_event = {
	id = MNM.6812
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes

	immediate = {
		if = {
			limit = { has_character_flag = drug_friend }
			create_character = {
				random_traits = yes
			}
			new_character = {
				remove_trait = trusting
				remove_trait = temperate
				remove_trait = celibate
				remove_trait = diligent
				add_trait = paranoid
				add_trait = gluttonous
				add_trait = hedonist
				add_trait = slothful
				save_event_target_as = slacker_buddy
			}
		}
		if = {
			limit = { has_character_flag = drug_lover }

			random_list = {
				10 = {
					modifier = {
						NOT = {
							any_spouse = {
								NOT = { is_lover = ROOT }
								opinion = {
									who = ROOT
									value = 0
								}
							}
						}
						factor = 0
					}
					random_spouse = {
						limit = {
							NOT = { is_lover = ROOT }
							opinion = {
								who = ROOT
								value = 0
							}
						}
						save_event_target_as = drug_new_lover
					}
				}
				5 = {
					modifier = {
						NOT = {
							any_courtier = {
								OR = {
									AND = {
										same_sex = ROOT
										trait = homosexual
										ROOT = {
											trait = homosexual
										}
									}
									AND = {
										is_opposite_sex = ROOT
										NOT = { 
											trait = homosexual
											ROOT = { trait = homosexual }
										}
									}
								}
								opinion = {
									who = ROOT
									value = 0
								}
							}
						}
					factor = 0
					}
					random_courtier = {
						limit = {
							OR = {
								AND = {
									same_sex = ROOT
									trait = homosexual
									ROOT = {
										trait = homosexual
									}
								}
								AND = {
									is_opposite_sex = ROOT
									NOT = { 
										trait = homosexual
										ROOT = { trait = homosexual }
									}
								}
							}
							opinion = {
								who = ROOT
								value = 0
							}
						}
						save_event_target_as = drug_new_lover
					}
				}
				5 = {
					if = {
						limit = {
							OR = {
								is_female = yes
								AND = {
									is_female = no
									trait = homosexual
								}
							}
						}
						create_character = {
							female = no
						}
						new_character = {
							save_event_target_as = drug_new_lover
						}
					}
					if = {
						limit = {
							OR = {
								is_female = no
								AND = {
									is_female = yes
									trait = homosexual
								}
							}
						}
						create_character = {
							female = yes
						}
						new_character = {
							save_event_target_as = drug_new_lover
						}
					}
				}
			}
		}
	}

	desc = {
		trigger = { has_character_flag = drug_friend }
		text = EVTDESCA_MNM_6812
		picture = GFX_evt_feast
	}
	option = {
		name = EVTOPTA_MNM_6812
		trigger = { has_character_flag = drug_friend }
		add_friend = event_target:slacker_buddy
		clr_character_flag = drug_friend
	}

	desc = {
		trigger = { has_character_flag = drug_lover }
		text = EVTDESCB_MNM_6812
		picture = GFX_evt_dark_love
	}
	option = {
		name = EVTOPTB_MNM_6812
		trigger = { has_character_flag = drug_lover }
		add_lover = event_target:drug_new_lover
		clr_character_flag = drug_lover
	}
}

#Cheating Spouse
#One desc and option, separate handling for "real" and "paranoid" affair
character_event = {
	id = MNM.6813
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes
	desc = EVTDESC_MNM_6813
	
	immediate = {
		random_spouse = {
			limit = {
				has_lover = yes
				NOT = {
					is_lover = ROOT
				}
			}
			save_event_target_as = drug_cheater_spouse
			random_lover = {
				limit = { NOT = { character = ROOT } }
				save_event_target_as = drug_cheater_lover
			}
		}
		random_spouse = {
			limit = {
				OR = {
					has_lover = no
					is_lover = ROOT
				}
			}
			random_realm_character = {
		 		limit = {
		 			same_sex = root
		 			NOT = { character = ROOT }
		 		}
		 		save_event_target_as = drug_cheater_lover
		 	}
			save_event_target_as = drug_cheater_spouse
			
		}
	}

	#reveal
	option = {
		name = EVTOPTA_MNM_6813
		if = {
			limit = {
				event_target:drug_cheater_lover = {
					is_opposite_sex = root
				}
			}
			event_target:drug_cheater_lover = {
				add_character_modifier = {
					name = known_sodomite
					days = -1
				}
			}
			event_target:drug_cheater_spouse = {
				add_character_modifier = {
					name = known_sodomite
					days = -1
				}
			}
		}
		if = {
			limit = {
				event_target:drug_cheater_lover = {
					same_sex = root
				}
				event_target:drug_cheater_spouse = {
					dynasty = event_target:drug_cheater_lover
				}
			}
			if = {
				limit = { is_female = no }
				event_target:drug_cheater_lover = {
					add_character_modifier = {
						name = incestuous_adulterer
						days = -1
					}
				}
				event_target:drug_cheater_spouse = {
					add_character_modifier = {
						name = incestuous_adulteress
						days = -1
					}
				}
			}
			if = {
				limit = { is_female = yes }
				event_target:drug_cheater_lover = {
					add_character_modifier = {
						name = incestuous_adulteress
						days = -1
					}
				}
				event_target:drug_cheater_spouse = {
					add_character_modifier = {
						name = incestuous_adulterer
						days = -1
					}
				}
			}
		}
		if = {
			limit = {
				event_target:drug_cheater_lover = {
					same_sex = root
				}
				NOT = {
					event_target:drug_cheater_spouse = {
						dynasty = event_target:drug_cheater_lover
					}
				}
			}
			if = {
				limit = { is_female = no }
				event_target:drug_cheater_lover = {
					add_character_modifier = {
						name = adulterer
						days = -1
					}
				}
				event_target:drug_cheater_spouse = {
					add_character_modifier = {
						name = adulteress
						days = -1
					}
				}
			}
			if = {
				limit = { is_female = yes }
				event_target:drug_cheater_lover = {
					add_character_modifier = {
						name = adulteress
						days = -1
					}
				}
				event_target:drug_cheater_spouse = {
					add_character_modifier = {
						name = adulterer
						days = -1
					}
				}
			}
		}
	}
	#keep to self
	option = {
		name = EVTOPTB_MNM_6813
		#opinion modifier?
	}
}

#Make a fool of yourself
#one desc and option
#drug fool 
character_event = {
	id = MNM.6814
	picture = GFX_evt_drunk
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes

	desc = EVTDESC_MNM_6814
	option = {
		name = EVTOPTA_MNM_6814
		add_character_modifier = { name = foolish_behavior years = 3 }
		custom_tooltip = { text = EVTOPTA_MNM_6814_TOOLTIP }
	}
}

#Die
#One Desc and option
character_event = {
	id = MNM.6815
	picture = GFX_evt_impalement
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes

	desc = EVTDESC_MNM_6815
	option = {
		name = EVTOPTA_MNM_6815
		death = {
			death_reason = death_hashish_overdose
		}
	}
}


# Become cured of a bad trait
character_event = {
	id = MNM.6816
	picture = GFX_evt_dark_prayer
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes

	desc = EVTDESC_MNM_6816

	option = {
		name = EVTOPTA_MNM_6816
		trigger = {
			has_character_flag = drugs_curing_stressed
		}
		remove_trait = stressed
	}
	option = {
		name = EVTOPTB_MNM_6816
		trigger = {
			has_character_flag = drugs_curing_possessed
		}
		remove_trait = possessed
	}
	option = {
		name = EVTOPTC_MNM_6816
		trigger = {
			has_character_flag = drugs_curing_depressed
		}
		remove_trait = depressed
	}
	option = {
		name = EVTOPTD_MNM_6816
		trigger = {
			has_character_flag = drugs_curing_lunatic
		}
		remove_trait = lunatic
	}

	after = {
		hidden_effect = {
			clr_character_flag = drugs_curing_stressed
			clr_character_flag = drugs_curing_possessed
			clr_character_flag = drugs_curing_depressed
			clr_character_flag = drugs_curing_lunatic
		}
	}
}

#Gain insight
character_event = {
	id = MNM.6817
	picture = GFX_evt_dark_prayer
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes

	desc = EVTDESC_MNM_6817

	option = {
		name = EVTOPTA_MNM_6817
		trigger = {
			has_character_flag = gains_diplomatic_insight_flag
		}
		if = {
			limit = { has_character_modifier = martial_insight }
			remove_character_modifier = martial_insight
		}
		if = {
			limit = { has_character_modifier = learning_insight }
			remove_character_modifier = learning_insight
		}
		if = {
			limit = { has_character_modifier = stewardship_insight }
			remove_character_modifier = stewardship_insight
		}
		if = {
			limit = { has_character_modifier = intrigue_insight }
			remove_character_modifier = intrigue_insight
		}
		add_character_modifier = {
			name = diplomatic_insight
			days = 1825
		}
	}
	option = {
		name = EVTOPTB_MNM_6817
		trigger = {
			has_character_flag = gains_martial_insight_flag
		}
		if = {
			limit = { has_character_modifier = diplomatic_insight }
			remove_character_modifier = diplomatic_insight
		}
		if = {
			limit = { has_character_modifier = learning_insight }
			remove_character_modifier = learning_insight
		}
		if = {
			limit = { has_character_modifier = stewardship_insight }
			remove_character_modifier = stewardship_insight
		}
		if = {
			limit = { has_character_modifier = intrigue_insight }
			remove_character_modifier = intrigue_insight
		}
		add_character_modifier = {
			name = martial_insight
			days = 1825
		}
	}
	option = {
		name = EVTOPTA_MNM_6817
		trigger = {
			has_character_flag = gains_intrigue_insight_flag
		}
		if = {
			limit = { has_character_modifier = martial_insight }
			remove_character_modifier = martial_insight
		}
		if = {
			limit = { has_character_modifier = learning_insight }
			remove_character_modifier = learning_insight
		}
		if = {
			limit = { has_character_modifier = stewardship_insight }
			remove_character_modifier = stewardship_insight
		}
		if = {
			limit = { has_character_modifier = diplomatic_insight }
			remove_character_modifier = diplomatic_insight
		}
		add_character_modifier = {
			name = intrigue_insight
			days = 1825
		}
	}
	option = {
		name = EVTOPTD_MNM_6817
		trigger = {
			has_character_flag = gains_learning_insight_flag
		}
		if = {
			limit = { has_character_modifier = martial_insight }
			remove_character_modifier = martial_insight
		}
		if = {
			limit = { has_character_modifier = diplomatic_insight }
			remove_character_modifier = diplomatic_insight
		}
		if = {
			limit = { has_character_modifier = stewardship_insight }
			remove_character_modifier = stewardship_insight
		}
		if = {
			limit = { has_character_modifier = intrigue_insight }
			remove_character_modifier = intrigue_insight
		}
		add_character_modifier = {
			name = learning_insight
			days = 1825
		}
	}
	option = {
		name = EVTOPTE_MNM_6817
		trigger = {
			has_character_flag = gains_stewardship_insight_flag
		}
		if = {
			limit = { has_character_modifier = martial_insight }
			remove_character_modifier = martial_insight
		}
		if = {
			limit = { has_character_modifier = learning_insight }
			remove_character_modifier = learning_insight
		}
		if = {
			limit = { has_character_modifier = diplomatic_insight }
			remove_character_modifier = diplomatic_insight
		}
		if = {
			limit = { has_character_modifier = intrigue_insight }
			remove_character_modifier = intrigue_insight
		}
		add_character_modifier = {
			name = stewardship_insight
			days = 1825
		}
	}

	after = {
		clr_character_flag = gains_diplomatic_insight_flag
		clr_character_flag = gains_martial_insight_flag
		clr_character_flag = gains_intrigue_insight_flag
		clr_character_flag = gains_learning_insight_flag
		clr_character_flag = gains_stewardship_insight_flag
	}
}

#Cure your illness
character_event = {
	id = MNM.6818
	picture = GFX_evt_dark_prayer
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes

	desc = EVTDESC_MNM_6818

	option = {
		name = EVTOPTA_MNM_6818
		remove_disease_trait_effect = yes
	}
}


#POWER: Intimidate for favor
character_event = {
	id = MNM.6840
	desc = EVTDESC_MNM_6840
	picture = GFX_evt_uncomfortable
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_6840
		tooltip = { FROMFROM  = { add_favor = ROOT } }
		opinion = {
			modifier = opinion_threatened_me
			who = FROMFROM
			years = 5
		}
		hidden_effect = { FROMFROM = { character_event = { id = MNM.6841 } } }
	}
}

character_event = {
	id = MNM.6841
	desc = EVTDESC_MNM_6841
	picture = GFX_evt_uncomfortable
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_6841
		tooltip = { add_favor = FROM }
		tooltip = {
			reverse_opinion = {
				modifier = opinion_threatened_me
				who = FROMFROM
				years = 5
			}
		}
	}
}

#Fail 
character_event = {
	id = MNM.6980
	desc = EVTDESC_MNM_6980
	picture = GFX_evt_uncomfortable
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	option = {
		name = CURSES
		reverse_opinion = {
			modifier = opinion_threatened_me
			who = FROM
			years = 5
		}
	}
}

#POWER: mark of death
#Confirmation of mark
character_event = {
	id = MNM.6842
	desc = EVTDESC_MNM_6842
	picture = GFX_evt_assassination
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	option = {
		name = EXCELLENT
	}
}

#Confirmation of kill
letter_event = {
	id = MNM.6843
	desc = EVTDESC_MNM_6843
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EXCELLENT
	}
}

#Clearing the flag from GM
character_event = {
	id = MNM.6844
	hide_window = yes
	is_triggered_only = yes

	trigger = { has_character_flag = assassins_target_marked_for_death }

	immediate = {
		random_society_member = { 
			limit = { 
				society_rank = {
					rank == 4
					society = the_assassins
				}
				has_character_flag = assassins_marked_someone_for_death 
			}
			clr_character_flag = assassins_marked_someone_for_death
		}
	}
}


#MISSION: Train a protege
character_event = {
	id = MNM.6248
	hide_window = yes

	is_triggered_only = yes

	immediate = { FROM = { society_quest_event = { id = MNM.6249 days = 7 random = 7 } } }
}

society_quest_event = {
	id = MNM.6249
	desc = EVTDESC_MNM_6249
	title = quest_the_assassins_protege

	is_triggered_only = yes

	option = {
		name = ACCEPT

		set_quest = quest_the_assassins_protege

		hidden_effect = {
			character_event = { id = MNM.6250 days = 14 random = 60 } 
		}
	}

	option = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }
		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			days = 1000
		}
		ai_chance = { factor = 0 }
	}
}

#Choose a child to train / A child is caught trying to pickpocket you
character_event = {
	id = MNM.6250
	picture = GFX_evt_secret_ceremony
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes
	hide_new = yes
	hide_from = yes

	trigger = {
		NOT = { has_character_flag = training_protege }
	}

	immediate = {
		hidden_effect = {
			set_character_flag = training_protege

			random_child = {
				limit = {
					is_child_of = ROOT
					age = 12
					is_ruler = no
					is_abroad = no
					NOT = { any_spouse = { is_landed = yes } }
					NOT = { age = 21 }
					NOT = { has_character_flag = assassin_protege_1_flag }
					OR = {
						is_female = no
						has_game_rule = {
							name = gender
							value = all
						}
					}
				}
				set_character_flag = assassin_protege_1_flag
				save_event_target_as = assassin_protege_1
			}
			random_child = {
				limit = {
					is_child_of = ROOT
					age = 12
					is_ruler = no
					is_abroad = no
					NOT = { any_spouse = { is_landed = yes } }
					NOT = { age = 21 }
					NOT = { has_character_flag = assassin_protege_1_flag }
					NOT = { has_character_flag = assassin_protege_2_flag }
					OR = {
						is_female = no
						has_game_rule = {
							name = gender
							value = all
						}
					}
				}
				set_character_flag = assassin_protege_2_flag
				save_event_target_as = assassin_protege_2
			}
			random_child = {
				limit = {
					is_child_of = ROOT
					age = 12
					is_ruler = no
					is_abroad = no
					NOT = { any_spouse = { is_landed = yes } }
					NOT = { age = 21 }
					NOT = { has_character_flag = assassin_protege_1_flag }
					NOT = { has_character_flag = assassin_protege_2_flag }
					NOT = { has_character_flag = assassin_protege_3_flag }
					OR = {
						is_female = no
						has_game_rule = {
							name = gender
							value = all
						}
					}
				}
				set_character_flag = assassin_protege_3_flag
				save_event_target_as = assassin_protege_3
			}

			if = {
				limit = {
					NOR = {
						event_target:assassin_protege_1 = { always = yes }
						event_target:assassin_protege_2 = { always = yes }
						event_target:assassin_protege_3 = { always = yes }
					}
				}
				random_list = {
					10 = {
						modifier = {
							factor = 0
							NOT = {
								has_game_rule = {
									name = gender
									value = all
								}
							}
						}

						create_character = {
							age = 12
							female = yes
							random_traits = yes
							intrigue = 4
							religion = ROOT
							dynasty = none
							race = ROOT
							culture = ROOT
						}
						new_character = {
							save_event_target_as = assassin_protege
						}
					}
					10 = {
						create_character = {
							age = 12
							female = no
							random_traits = yes
							intrigue = 4
							religion = ROOT
							dynasty = none
							race = ROOT
							culture = ROOT
						}
						new_character = {
							save_event_target_as = assassin_protege
						}
					}
				}
			}
		}
	}

	desc = {
		text = EVTDESC_MNM_6250_A
		trigger = {
			OR = {
				event_target:assassin_protege_1 = { always = yes }
				event_target:assassin_protege_2 = { always = yes }
				event_target:assassin_protege_3 = { always = yes }
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_6250_B
		trigger = {
			NOR = {
				event_target:assassin_protege_1 = { always = yes }
				event_target:assassin_protege_2 = { always = yes }
				event_target:assassin_protege_3 = { always = yes }
			}
		}
	}

	option = { #Choose random child 1
		name = EVTOPTA_MNM_6250
		custom_tooltip = { text = EVTOPTA_MNM_6250_TT }

		event_target:assassin_protege_1 = {
			opinion = {
				who = ROOT
				modifier = opinion_parental_praise
				years = 5
			}
			save_event_target_as = assassin_protege
			hidden_effect = { character_event = { id = MNM.6251 } } # training ping event
		}
		hidden_effect = {
			event_target:assassin_protege_2 = {
				clr_character_flag = assassin_protege_2_flag
			}
			event_target:assassin_protege_3 = {
				clr_character_flag = assassin_protege_3_flag
			}
		}
		trigger = {
			any_child = {
				is_child_of = ROOT
				has_character_flag = assassin_protege_1_flag
			}
		}
	}
	option = { #Choose random child 2
		name = EVTOPTB_MNM_6250
		custom_tooltip = { text = EVTOPTB_MNM_6250_TT }
		
		event_target:assassin_protege_2 = {
			opinion = {
				who = ROOT
				modifier = opinion_parental_praise
				years = 5
			}
			save_event_target_as = assassin_protege
			hidden_effect = { character_event = { id = MNM.6251 } } # training ping event
		}
		hidden_effect = {
			event_target:assassin_protege_1 = {
				clr_character_flag = assassin_protege_1_flag
			}
			event_target:assassin_protege_3 = {
				clr_character_flag = assassin_protege_3_flag
			}
		}
		trigger = {
			any_child = {
				is_child_of = ROOT
				has_character_flag = assassin_protege_2_flag
			}
		}
	}
	option = { #Choose random child 3 
		name = EVTOPTC_MNM_6250
		custom_tooltip = { text = EVTOPTC_MNM_6250_TT }

		event_target:assassin_protege_3 = {
			opinion = {
				who = ROOT
				modifier = opinion_parental_praise
				years = 5
			}
			save_event_target_as = assassin_protege
			hidden_effect = { character_event = { id = MNM.6251 } } # training ping event
		}
		hidden_effect = {
			event_target:assassin_protege_1 = {
				clr_character_flag = assassin_protege_1_flag
			}
			event_target:assassin_protege_2 = {
				clr_character_flag = assassin_protege_2_flag
			}
		}
		trigger = {
			any_child = {
				is_child_of = ROOT
				has_character_flag = assassin_protege_3_flag
			}
		}
	}
	option = { # Take the child under your wing
		name = EVTOPTD_MNM_6250
		custom_tooltip = { text = EVTOPTD_MNM_6250_TT }
		set_character_flag = apprentice_is_not_bloodrelation

		event_target:assassin_protege = {
			opinion = {
				who = ROOT
				modifier = opinion_was_shown_mercy
				years = 5
			}
			hidden_effect = { character_event = { id = MNM.6251 } } # training ping event
		}
		trigger = {
			NOR = {
				event_target:assassin_protege_1 = { always = yes }
				event_target:assassin_protege_2 = { always = yes }
				event_target:assassin_protege_3 = { always = yes }
			}
		}
	}
	option = { #Imprison the urchin!
		name = EVTOPTE_MNM_6250
		custom_tooltip = { text = EVTOPTE_MNM_6250_TT }

		clr_quest = { id = quest_the_assassins_protege failure = yes }

		hidden_effect = {
			event_target:assassin_protege = {
				imprison = ROOT
			}
		}
		trigger = {
			NOR = {
				event_target:assassin_protege_1 = { always = yes }
				event_target:assassin_protege_2 = { always = yes }
				event_target:assassin_protege_3 = { always = yes }
			}
		}
	}
	option = { # You are busy right now
		name = EVTOPTF_MNM_6250
		custom_tooltip = { text = EVTOPTF_MNM_6250_TT }

		clr_quest = { id = quest_the_assassins_protege failure = yes }

		hidden_effect = {
			any_child = {
				clr_character_flag = assassin_protege_1_flag
				clr_character_flag = assassin_protege_2_flag
				clr_character_flag = assassin_protege_3_flag
			}
		}
		trigger = {
			any_child = {
				is_child_of = ROOT
				has_character_flag = assassin_protege_1_flag
			}
		}
	}
}

character_event = { # ping event
	id = MNM.6251
	picture = GFX_evt_secret_ceremony
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes
	hide_window = yes

	option = {
		clr_character_flag = assassin_protege_1_flag
		clr_character_flag = assassin_protege_2_flag
		clr_character_flag = assassin_protege_3_flag
		set_quest_target = {
	        id = quest_the_assassins_protege
	        society = the_assassins
	        holder = FROM
		}
		hidden_effect = { FROM = { character_event = { id = MNM.6252 days = 60 random = 20 } } } # specialization event
	}
}

character_event = { # choose specialization for kid
	id = MNM.6252
	desc = EVTDESC_MNM_6252
	picture = GFX_evt_shady_meeting
	border = GFX_event_normal_frame_intrigue

	trigger = { has_character_flag = training_protege }

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_6252
		custom_tooltip = { text = EVTOPTA_MNM_6252_TT }
		set_character_flag = chose_intrigue_focus

		hidden_effect = { character_event = { id = MNM.6253 days = 90 random = 60 } } # intrigue focus
	}
	option = {
		name = EVTOPTB_MNM_6252
		custom_tooltip = { text = EVTOPTB_MNM_6252_TT }
		set_character_flag = chose_martial_focus

		hidden_effect = { character_event = { id = MNM.6253 days = 90 random = 60 } } # martial focus
	}
	option = {
		name = EVTOPTC_MNM_6252
		custom_tooltip = { text = EVTOPTC_MNM_6252_TT }
		set_character_flag = chose_even_focus

		hidden_effect = { character_event = { id = MNM.6253 days = 90 random = 60 } } # even focus
	}
}

character_event = { # they are hard at work and time has come for a test
	id = MNM.6253
	picture = GFX_evt_shady_meeting
	border = GFX_event_normal_frame_intrigue

	trigger = {
		has_character_flag = training_protege
	}

	is_triggered_only = yes

	desc = {
		trigger = {	has_character_flag = chose_intrigue_focus }
		text = EVTDESC_MNM_6253_A
	}
	desc = {
		trigger = {	has_character_flag = chose_martial_focus }
		text = EVTDESC_MNM_6253_B
	} 
	desc = {
		trigger = {	has_character_flag = chose_even_focus }
		text = EVTDESC_MNM_6253_C
	}

	option = {
		name = EVTOPTA_MNM_6253
		custom_tooltip = { text = EVTOPTA_MNM_6253_TT }

		if = {
			limit = { has_character_flag = chose_intrigue_focus }
			event_target:assassin_protege = {
				add_trait_deceitful_effect = yes
				remove_trait_honest_effect = yes
			}
		}
		if = {
			limit = { has_character_flag = chose_martial_focus }
			event_target:assassin_protege = {
				add_trait_brave_effect = yes
				remove_trait_craven_effect = yes
			}
		}
		if = {
			limit = { has_character_flag = chose_even_focus }
			event_target:assassin_protege = {
				add_trait_diligent_effect = yes
				remove_trait_slothful_effect = yes
			}
		}

		hidden_effect = {
			random_list = {
				10 = {
					modifier = {
						factor = 1.1
						event_target:assassin_protege = { martial = 3 }
					}
					modifier = {
						factor = 1.1
						event_target:assassin_protege = { martial = 4 }
					}
					modifier = {
						factor = 1.1
						event_target:assassin_protege = { martial = 5 }
					}
					modifier = {
						factor = 1.1
						event_target:assassin_protege = { martial = 6 }
					}
					modifier = {
						factor = 1.1
						event_target:assassin_protege = { martial = 7 }
					}
					modifier = {
						factor = 1.1
						event_target:assassin_protege = { martial = 8 }
					}
					modifier = {
						factor = 1.1
						event_target:assassin_protege = { martial = 9 }
					}
					modifier = {
						factor = 1.1
						event_target:assassin_protege = { martial = 10 }
					}
					modifier = {
						factor = 1.1
						event_target:assassin_protege = { intrigue = 3 }
					}
					modifier = {
						factor = 1.1
						event_target:assassin_protege = { intrigue = 4 }
					}
					modifier = {
						factor = 1.1
						event_target:assassin_protege = { intrigue = 5 }
					}
					modifier = {
						factor = 1.1
						event_target:assassin_protege = { intrigue = 6 }
					}
					modifier = {
						factor = 1.1
						event_target:assassin_protege = { intrigue = 7 }
					}
					modifier = {
						factor = 1.1
						event_target:assassin_protege = { intrigue = 8 }
					}
					modifier = {
						factor = 1.1
						event_target:assassin_protege = { intrigue = 9 }
					}
					modifier = {
						factor = 1.1
						event_target:assassin_protege = { intrigue = 10 }
					}
					modifier = {
						factor = 1.1
						event_target:assassin_protege = { trait = deceitful }
					}
					modifier = {
						factor = 1.5
						event_target:assassin_protege = {
							OR = {
								trait = shrewd
								trait = quick
								trait = genius
							}
						}
					}
					character_event = { id = MNM.6254 days = 5 } # good outcome 1
				}
				10 = {
					character_event = { id = MNM.6255 days = 5 } # mediocre outcome 1
				}
				5 = {
					modifier = {
						factor = 10
						event_target:assassin_protege = {
							OR = {
								trait = slow
								trait = imbecile
								trait = dull
							}
						}
					}
					character_event = { id = MNM.6256 days = 5 } # bad outcome 1
				}
			}
		}

		trigger = {	has_character_flag = chose_intrigue_focus }
	}
}

character_event = { # good outcome
	id = MNM.6254
	picture = GFX_evt_secret_ceremony
	border = GFX_event_normal_frame_intrigue

	hide_from = yes

	trigger = { has_character_flag = training_protege }

	is_triggered_only = yes

	desc = {
		trigger = {	has_character_flag = chose_intrigue_focus }
		text = EVTDESC_MNM_6254_A
	}
	desc = {
		trigger = {	has_character_flag = chose_martial_focus }
		text = EVTDESC_MNM_6254_B
	}
	desc = {
		trigger = {	has_character_flag = chose_even_focus }
		text = EVTDESC_MNM_6254_C
	}

	option = {
		name = EVTOPTA_MNM_6254
		custom_tooltip = { text = EVTOPTA_MNM_6254_TT }
		set_character_flag = apprentice_did_great
		character_event = { id = MNM.6261 days = 25 }
	}
}

character_event = { # mediocre outcome
	id = MNM.6255
	picture = GFX_evt_secret_ceremony
	border = GFX_event_normal_frame_intrigue

	hide_from = yes
	
	trigger = { has_character_flag = training_protege }

	is_triggered_only = yes

	desc = {
		trigger = {	has_character_flag = chose_intrigue_focus }
		text = EVTDESC_MNM_6255_A
	}
	desc = {
		trigger = {	has_character_flag = chose_martial_focus }
		text = EVTDESC_MNM_6255_B
	}
	desc = {
		trigger = {	has_character_flag = chose_even_focus }
		text = EVTDESC_MNM_6255_C
	}

	option = {
		name = EVTOPTA_MNM_6255
		custom_tooltip = { text = EVTOPTA_MNM_6255_TT }
		set_character_flag = apprentice_did_ok
		
		event_target:assassin_protege = {
			add_maimed_trait_effect = yes
		}

		character_event = { id = MNM.6261 days = 25 }
	}
}

character_event = { # bad outcome
	id = MNM.6256
	desc = EVTDESC_MNM_6256
	picture = GFX_evt_assassination
	border = GFX_event_normal_frame_intrigue

	hide_from = yes

	has_character_flag = training_protege

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_6256
		custom_tooltip = { text = EVTOPTA_MNM_6256_TT }
		set_character_flag = apprentice_failed_miserably

		event_target:assassin_protege = {
			death = { death_reason = death_murder_unknown killer = ROOT }
		}

		character_event = { id = MNM.6259 days = 25 }

		trigger = {
			event_target:assassin_protege = {
				NOT = { is_child_of = ROOT }
			}
		}
	}
	option = {
		name = EVTOPTB_MNM_6256
		custom_tooltip = { text = EVTOPTB_MNM_6256_TT }
		set_character_flag = apprentice_failed_miserably
		character_event = { id = MNM.6259 days = 25 }

		event_target:assassin_protege = {
			death = { death_reason = death_murder_unknown killer = ROOT }
		}

		trigger = {
			event_target:assassin_protege = {
				is_child_of = ROOT
			}
		}
	}
}

character_event = { # clean-up after training apprentice
	id = MNM.6257
	picture = GFX_evt_secret_ceremony
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes
	hide_window = yes

	option = {
		if = { limit = { event_target:assassin_protege = { true_religion_shiite_trigger = no } }
			custom_tooltip = { text = 6252_CONVERT_APPRENTICE_TT }
			event_target:assassin_protege = {
				character_event = { id = MNM.6258 } # convert
			}
		}
		event_target:assassin_protege = { clr_character_flag = show_picture_in_option }
		clr_character_flag = training_protege
		clr_character_flag = chose_intrigue_focus
		clr_character_flag = chose_martial_focus
		clr_character_flag = chose_even_focus
		clr_character_flag = apprentice_is_not_bloodrelation
		clr_character_flag = apprentice_did_great
		clr_character_flag = apprentice_did_ok
		clr_character_flag = apprentice_failed_miserably
	}
}

character_event = { # Conversion event (for apprentice) if they are not already Shia (sent from MNM.6052)
	id = MNM.6258
	desc = EVTDESC_MNM_6258
	picture = GFX_evt_secret_ceremony
	border = GFX_event_normal_frame_intrigue

	trigger = {
		event_target:assassin_protege = { is_alive = yes }
		true_religion_shiite_trigger = no
	}

	is_triggered_only = yes

	option = { #I (apprentice)  will convert
		name = EVTOPTA_MNM_6258
		
		religion = shiite
		
		ai_chance = {
			factor = 20

			modifier = {
				true_religion_group_muslim_trigger = yes
				factor = 2
			}
			modifier = {
				independent = yes
				factor = 2
			}
			modifier = {
				trait = brave
				factor = 2
			}
			modifier = {
				trait = honest
				factor = 2
			}
		}
	}
	option = { # I (apprentice) will convert, secretly
		name = EVTOPTB_MNM_6258
		
		clear_secret_religion = yes
		set_secret_religion = shiite

		ai_chance = {
			factor = 80
			modifier = {
				trait = craven
				factor = 2
			}
			modifier = {
				trait = deceitful
				factor = 2
			}
		}
	}
}

character_event = { # Final talk with apprentice
	id = MNM.6259
	picture = GFX_evt_secret_ceremony
	border = GFX_event_normal_frame_intrigue

	hide_from = yes

	has_character_flag = training_protege

	is_triggered_only = yes

	desc = {
		trigger = {
			has_character_flag = apprentice_did_great
			event_target:assassin_protege = { true_religion_shiite_trigger = yes }
		}
		text = EVTDESC_MNM_6259_A # apprentice is a fine example and already a believer
	}
	desc = {
		trigger = {
			has_character_flag = apprentice_did_ok
			event_target:assassin_protege = { true_religion_shiite_trigger = yes }
		}
		text = EVTDESC_MNM_6259_B # Apprentice has done alright, all things considered
	}
	desc = {
		trigger = {
			has_character_flag = apprentice_failed_miserably
			event_target:assassin_protege = { true_religion_shiite_trigger = yes }
		}
		text = EVTDESC_MNM_6259_C # believer apprentice is dead, I might train a new one?
	}
	desc = {
		trigger = {
			has_character_flag = apprentice_did_great
			event_target:assassin_protege = { true_religion_shiite_trigger = no }
		}
		text = EVTDESC_MNM_6259_D # apprentice is a fine example and already a believer
	}
	desc = {
		trigger = {
			has_character_flag = apprentice_did_ok
			event_target:assassin_protege = { true_religion_shiite_trigger = no }
		}
		text = EVTDESC_MNM_6259_E # Apprentice has done alright, all things considered AND will convert
	}
	desc = {
		trigger = {
			has_character_flag = apprentice_failed_miserably
			event_target:assassin_protege = { true_religion_shiite_trigger = no }
		}
		text = EVTDESC_MNM_6259_F # to-be-converted apprentice is dead, I might train a new one?
	}


	option = {
		name = EVTOPTA_MNM_6259 # Great!
		clr_quest = quest_the_assassins_protege
		sound_effect = assassins_train_protege
		add_society_currency_medium_effect = yes
		hidden_effect = { character_event = { id = MNM.6257 } } # clean up
		event_target:assassin_protege = { set_character_flag = show_picture_in_option }
		trigger = {	has_character_flag = apprentice_did_great }
	}

	option = {
		name = EVTOPTB_MNM_6259 # OK
		clr_quest = quest_the_assassins_protege
		sound_effect = assassins_train_protege
		add_society_currency_minor_effect = yes
		hidden_effect = { character_event = { id = MNM.6257 } } # clean up
		event_target:assassin_protege = { set_character_flag = show_picture_in_option }
		trigger = {	has_character_flag = apprentice_did_ok }
	}

	option = {
		name = EVTOPTC_MNM_6259 # Typical
		clr_quest = { id = quest_the_assassins_protege failure = yes }
		hidden_effect = { character_event = { id = MNM.6257 } } # clean up
		event_target:assassin_protege = { set_character_flag = show_picture_in_option }
		trigger = {	has_character_flag = apprentice_failed_miserably }
	}
}


character_event = { # Fallback - apprentice has died somehow during chain
	id = MNM.6260
	picture = GFX_evt_secret_ceremony
	border = GFX_event_normal_frame_intrigue

	has_character_flag = training_protege

	is_triggered_only = yes

	desc = {
		trigger = { NOT = { has_character_flag = apprentice_is_not_bloodrelation } }
		text = EVTDESC_MNM_6260_A
	}
	desc = {
		trigger = { has_character_flag = apprentice_is_not_bloodrelation }
		text = EVTDESC_MNM_6260_B
	}


	option = {
		name = EVTOPTA_MNM_6260 # Drat
		clr_quest = { id = quest_the_assassins_protege failure = yes }
		hidden_effect = { character_event = { id = MNM.6257 } } # clean up
	}
}

character_event = { #Fallback doublecheck - apprentice died before the Assassins could be notified of the success (leads to fail of mission)
    id = MNM.6261
    hide_window = yes

	has_character_flag = training_protege

    is_triggered_only = yes
    
    immediate = {
    	if = {
    		limit = { event_target:assassin_protege = { is_alive = yes } }
    		character_event = { id = MNM.6259 }
    	}
    }
}

###INTERACTIONS###

#Interaction: Friend or foe?
character_event = {
	id = MNM.6899
	hide_window = yes

	min_age = 16
	only_playable = yes
	only_capable = yes
	prisoner = no
	has_dlc = "Mystics"
	is_in_society = yes

	is_triggered_only = yes

	trigger = {
		society_member_of = the_assassins
		NOR = {
			has_character_modifier = won_duel
			has_character_modifier = outwitted_opponent
			has_character_modifier = focused_on_training
		}
		society = {
			any_society_member = {
				block_general_event_trigger = no
				ai = yes
				ROOT = { same_society_rank_as_prev_trigger = yes }
				NOR = {
					trait = incapable
					prisoner = yes
					is_rival = ROOT
					is_friend = ROOT
					is_lover = ROOT
					is_close_relative = ROOT
				}
			}
		}
	}

	immediate = {
		society = {
			random_society_member = {
				limit = {
					block_general_event_trigger = no
					ai = yes
					ROOT = { same_society_rank_as_prev_trigger = yes }
					NOR = {
						trait = incapable
						prisoner = yes
						is_rival = ROOT
						is_friend = ROOT
						is_lover = ROOT
						is_close_relative = ROOT
					}
				}
				save_event_target_as = friend_or_foe
			}
		}
		society = {
			random_society_member = {
				limit = {
					block_general_event_trigger = no
					ai = yes
					ROOT = { same_society_rank_as_prev_trigger = yes }
					NOR = {
						trait = incapable
						prisoner = yes
						is_rival = ROOT
						is_friend = ROOT
						is_lover = ROOT
						is_close_relative = ROOT
					}
					age_diff = { who = ROOT years = 5 }
				}
				save_event_target_as = friend_or_foe
			}
		}
		event_target:friend_or_foe = { character_event = { id = MNM.6900 } }
	}
}

character_event = {
	id = MNM.6900
	hide_window = yes
	is_triggered_only = yes
	immediate = { FROM = { character_event = { id = MNM.6901 } } }
}


#They're so infuriating! What do?
character_event = {
    id = MNM.6901
    desc = EVTDESC_MNM_6901
    picture = GFX_evt_quarrel
    border = GFX_event_normal_frame_war

    is_triggered_only = yes
    
    #Challenge him/her
    option = { 
        name = EVTOPTA_MNM_6901
        custom_tooltip = { text = EVTOPTA_MNM_6901_TT }

        hidden_effect = {
        	random_list = {
        		17 = { #Win - outwit
        			modifier = { is_smart_trigger = yes factor = 2 }
        			modifier = { FROM = { is_dumb_trigger = yes } factor = 2 }
        			modifier = { trait = erudite factor = 2 }
        			modifier = { attribute_diff = { character = FROM attribute = intrigue value = 3 } factor = 2 }

        			set_character_flag = won_outwit

     				random_list = {
     					75 = { set_character_flag = modifier_outwit }
     					25 = { 
     						modifier = { OR = { is_smart_trigger = yes is_dumb_trigger = yes } factor = 0 }
     						set_character_flag = trait_shrewd
     					}
     				}
        		}
        		17 = { #Win - outstrong
        			modifier = { is_strong_trigger = yes factor = 2 }
        			modifier = { FROM = { is_weak_trigger = yes } factor = 2 }
        			modifier = { combat_rating_diff = { who = FROM value = 1 } factor = 2 } 
        			modifier = { attribute_diff = { character = FROM attribute = martial value = 3 } factor = 2 }

        			set_character_flag = won_outstrong

        			random_list = {
	        			75 = { set_character_flag = modifier_outstrong }
	 					25 = { 
	 						modifier = { OR = { is_strong_trigger = yes is_weak_trigger = yes } factor = 0 }
	 						set_character_flag = trait_robust
	 					}
        			}
        		}
        		33 = {
        			set_character_flag = draw
        		}
        		17 = { #Lose - outwit
        			modifier = { FROM = { is_smart_trigger = yes } factor = 2 }
        			modifier = { is_dumb_trigger = yes factor = 2 }
        			modifier = { FROM = { trait = erudite } factor = 2 }
        			modifier = { FROM = { attribute_diff = { character = ROOT attribute = intrigue value = 3 } } factor = 2 }

     				set_character_flag = lost_outwit
        		}
        		17 = { #Lose - outstrong
        			modifier = { FROM = { is_strong_trigger = yes } factor = 2 }
        			modifier = { is_weak_trigger = yes factor = 2 }
        			modifier = { FROM = { combat_rating_diff = { who = ROOT value = 1 } } factor = 2 } 
        			modifier = { FROM = { attribute_diff = { character = ROOT attribute = martial value = 3 } } factor = 2 }

        			set_character_flag = lost_outstrong
        		}
        	}

        	FROM = { character_event = { id = MNM.6902 } }
        }
    }

    #Ignore him/her
    option = {
        name = EVTOPTB_MNM_6901
        custom_tooltip = { text = EVTOPTB_MNM_6901_TT }

        reverse_opinion = {
        	who = FROM
        	modifier = opinion_very_disappointed
        	years = 10
        }

        add_character_modifier = {
        	name = focused_on_training
        	years = 5
        }
    }
}

#Ping event outcome
character_event = {
	id = MNM.6902
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		random_list = {
			50 = {
				modifier = { is_benevolent_trigger = yes factor = 2 }
				modifier = { has_pleasant_personality_trigger = yes factor = 1.3 }
				modifier = { trait = content factor = 1.3 }
				modifier = { opinion = { who = FROM value = 30 } factor = 1.5 }
				FROM = { set_character_flag = nice_opponent }
			}
			50 = {
				modifier = { is_evil_trigger = yes factor = 2 }
				modifier = { has_unpleasant_personality_trigger = yes factor = 1.3 }
				modifier = { trait = ambitious factor = 1.2 }
				modifier = { NOT = { opinion = { who = FROM value = 0 } } factor = 1.3 } 
				FROM = { set_character_flag = mean_opponent }
			}
		}

		#Challenge is set
		FROM = {
			character_event = { id = MNM.6908 days = 14 }
		}

		#Outcome
		FROM = {	
			#Nice win
			if = {
				limit = { 
					OR = {
						has_character_flag = won_outwit
						has_character_flag = won_outstrong
					}
					has_character_flag = nice_opponent
				}
				character_event = { id = MNM.6903 days = 20 }
			}
			#Mean win
			if = {
				limit = { 
					OR = {
						has_character_flag = won_outwit
						has_character_flag = won_outstrong
					}
					has_character_flag = mean_opponent
				}
				character_event = { id = MNM.6904 days = 20 }
			}
			#Draw
			if = {
				limit = { has_character_flag = draw }
				character_event = { id = MNM.6903 days = 20 }
			}
			#Nice lose
			if = {
				limit = { 
					OR = {
						has_character_flag = lost_outwit
						has_character_flag = lost_outstrong
					}
					has_character_flag = nice_opponent
				}
				character_event = { id = MNM.6903 days = 20 }
			}
			#Mean lose
			if = {
				limit = { 
					OR = {
						has_character_flag = lost_outwit
						has_character_flag = lost_outstrong
					}
					has_character_flag = mean_opponent
				}
				character_event = { id = MNM.6905 days = 20 }
			}
		}
	}
}

character_event = {
    id = MNM.6908
    picture = GFX_evt_market_byzantine
    border = GFX_event_normal_frame_war

    desc = {
    	trigger = {
    		OR = {
    			has_character_flag = won_outwit
    			has_character_flag = lost_outwit
    		}
    	}
    	text = EVTDESC_MNM_6908_A
    	picture = GFX_evt_market_byzantine
    }
    desc = {
    	trigger = {
    		OR = {
    			has_character_flag = lost_outstrong
    			has_character_flag = won_outstrong
    			has_character_flag = draw
    		}
    	}
    	text = EVTDESC_MNM_6908_B
    	picture = GFX_evt_melee
    }

    is_triggered_only = yes
    
    option = { 
        name = EVTOPTA_MNM_6908
        custom_tooltip = { text = EVTOPTA_MNM_6908_TT }
    }
}

#Nice win/draw/nice lose
character_event = {
    id = MNM.6903
    border = GFX_event_normal_frame_diplomacy
    picture = GFX_evt_market_byzantine

    desc = {
    	trigger = { has_character_flag = won_outwit }
    	text = EVTDESC_MNM_6903_A
    	picture = GFX_evt_market_byzantine
    }
    desc = {
    	trigger = { has_character_flag = won_outstrong }
    	text = EVTDESC_MNM_6903_B
    	picture = GFX_evt_melee
    }
    desc = {
    	trigger = { has_character_flag = draw }
    	text = EVTDESC_MNM_6903_C
    	picture = GFX_evt_melee
    }
    desc = {
    	trigger = { has_character_flag = lost_outwit }
    	text = EVTDESC_MNM_6903_D
    	picture = GFX_evt_market_byzantine
    }
    desc = {
    	trigger = { has_character_flag = lost_outstrong }
    	text = EVTDESC_MNM_6903_E
    	picture = GFX_evt_melee
    }

    is_triggered_only = yes
    
    #Friends
    option = { 
        name = EVTOPTA_MNM_6903

        add_friend = FROM
    }

    #Love?
    option = {
    	trigger = { FROM = { root_attraction_trigger = yes } }
        name = EVTOPTB_MNM_6903
        custom_tooltip = { text = EVTOPTB_MNM_6903_TT }

        hidden_effect = { FROM = { character_event = { id = MNM.6906 days = 3 } } }

        ai_chance = {
        	factor = 1
        	modifier = {
        		factor = 0
        		NOR = {
        			trait = lustful
        			AND = {
        				NOT = { any_lover = { is_alive = yes } }
        				is_married = yes
        			}
        			FROM = { has_attractive_trait_trigger = yes }
        		}
        	}
        }
    }
    
    #Glory
    option = {
    	trigger = {
    		OR = {
    			has_character_flag = won_outwit
    			has_character_flag = won_outstrong
    		}
    	}
        name = EVTOPTC_MNM_6903
        custom_tooltip = { text = EVTOPTC_MNM_6903_TT }

        prestige = 100
        add_society_currency_major_effect = yes
    }
    
    after = {
    	if = {
    		limit = { has_character_flag = modifier_outwit }
    		add_character_modifier = {
    			name = outwitted_opponent
    			years = 10
    		}
    	}
    	if = {
    		limit = { has_character_flag = trait_shrewd }
    		add_trait = shrewd
    	}
    	if = {
    		limit = { has_character_flag = modifier_outstrong }
    		add_character_modifier = {
    			name = won_duel
    			years = 10
    		}
    	}
    	if = {
    		limit = { has_character_flag = trait_robust }
    		add_trait = robust
    	}
    	hidden_effect = {
    		clr_character_flag = won_outwit
    		clr_character_flag = won_outstrong
    		clr_character_flag = draw
    		clr_character_flag = lost_outwit
    		clr_character_flag = lost_outstrong
    		clr_character_flag = nice_opponent
			clr_character_flag = mean_opponent
    		clr_character_flag = modifier_outwit
    		clr_character_flag = trait_shrewd
    		clr_character_flag = modifier_outstrong
    		clr_character_flag = trait_robust
    	}
    }
}

#Mean win
character_event = {
    id = MNM.6904
    border = GFX_event_normal_frame_war
    picture = GFX_evt_market_byzantine

    desc = {
    	trigger = { has_character_flag = won_outwit }
    	text = EVTDESC_MNM_6904_A
    	picture = GFX_evt_market_byzantine
    }
    desc = {
    	trigger = { has_character_flag = won_outstrong }
    	text = EVTDESC_MNM_6904_B
    	picture = GFX_evt_melee
    }

    is_triggered_only = yes

    #Beat
    option = { 
        name = EVTOPTA_MNM_6904
        custom_tooltip = { text = EVTOPTA_MNM_6904_TT }

        add_rival = FROM
        
        FROM = {
        	if = {
	        	limit = { NOT = { trait = wounded } }
	        	add_trait = wounded
        	}
        }
    }

    #Let it be
    option = {
        name = EVTOPTB_MNM_6904
        custom_tooltip = { text = EVTOPTB_MNM_6904_TT }

        prestige = 100
        add_society_currency_major_effect = yes
    }

    after = {
    	if = {
    		limit = { has_character_flag = modifier_outwit }
    		add_character_modifier = {
    			name = outwitted_opponent
    			years = 10
    		}
    	}
    	if = {
    		limit = { has_character_flag = trait_shrewd }
    		add_trait = shrewd
    	}
    	if = {
    		limit = { has_character_flag = modifier_outstrong }
    		add_character_modifier = {
    			name = won_duel
    			years = 10
    		}
    	}
    	if = {
    		limit = { has_character_flag = trait_robust }
    		add_trait = robust
    	}
    	hidden_effect = {
    		clr_character_flag = won_outwit
    		clr_character_flag = won_outstrong
    		clr_character_flag = mean_opponent
    		clr_character_flag = modifier_outwit
    		clr_character_flag = trait_shrewd
    		clr_character_flag = modifier_outstrong
    		clr_character_flag = trait_robust
    	}
    }
}	

#Mean lose
character_event = {
    id = MNM.6905
    border = GFX_event_normal_frame_war
    picture = GFX_evt_assassination

    desc = {
    	trigger = { has_character_flag = lost_outwit }
    	text = EVTDESC_MNM_6905_A
    	picture = GFX_evt_assassination
    }
    desc = {
    	trigger = { has_character_flag = lost_outstrong }
    	text = EVTDESC_MNM_6905_B
    	picture = GFX_evt_melee
    }

    is_triggered_only = yes
    
    option = { 
        name = EVTOPTA_MNM_6905

        add_rival = FROM
        if = {
        	limit = { NOT = { trait = wounded } }
        	add_trait = wounded
        }
    }

    after = {
    	clr_character_flag = lost_outwit
    	clr_character_flag = lost_outstrong
		clr_character_flag = mean_opponent
		clr_character_flag = modifier_outwit
		clr_character_flag = trait_shrewd
		clr_character_flag = modifier_outstrong
		clr_character_flag = trait_robust
    }
}

#Love ping event
character_event = {
	id = MNM.6906
	hide_window = yes
	is_triggered_only = yes
	immediate = { 

		random_list = {
    		50 = { #Not interested
    			modifier = { is_married = yes factor = 2 }
    			modifier = { any_lover = { is_alive = yes } factor = 4 }
    			modifier = { trait = chaste factor = 4 }
    			modifier = { trait = celibate factor = 10 }
    			modifier = { has_unpleasant_trait_trigger = yes factor = 2 }
    			modifier = { NOT = { opinion = { who = FROM value = 20 } } factor = 2 }
    			modifier = { 
					root_attraction_trigger = no 
					NOT = { trait = homosexual }
					factor = 0.5 
    			}
    			modifier = { 
					root_attraction_trigger = no 
					trait = homosexual
					factor = 0
    			}
    			set_character_flag = not_interested
    		} 
    		50 = { #Interested
    			modifier = { trait = lustful factor = 4 }
    			modifier = { has_pleasant_trait_trigger = yes factor = 2 }
    			modifier = { opinion = { who = FROM value = 40 } factor = 2 }
    			modifier = { FROM = { has_attractive_trait_trigger = yes } factor = 3 }

    			set_character_flag = interested

    			if = {
    				limit = { same_sex = FROM }
    				add_trait = homosexual 
    			}
    		}
    	}

		FROM = { character_event = { id = MNM.6907 } }
	}
}

#Love outcome
character_event = {
    id = MNM.6907
    border = GFX_event_normal_frame_diplomacy
    picture = GFX_evt_lovers

    desc = {
    	trigger = { FROM = { has_character_flag = not_interested } }
    	text = EVTDESC_MNM_6907_A
    	picture = GFX_evt_courtiers_talking
    }
    desc = {
    	trigger = { FROM = { has_character_flag = interested } }
    	text = EVTDESC_MNM_6907_B
    	picture = GFX_evt_lovers
    }

    is_triggered_only = yes

    #Friends instead?
    option = {
    	trigger = { FROM = { has_character_flag = not_interested } }
        name = EVTOPTC_MNM_6907

        add_friend = FROM
    }

    #Nah
    option = { 
    	trigger = { FROM = { has_character_flag = not_interested } } 
        name = EVTOPTA_MNM_6907

        opinion = {
        	modifier = opinion_distressing_encounter
        	who = FROM
        	years = 5
        }
        reverse_opinion = {
        	modifier = opinion_distressing_encounter
        	who = FROM
        	years = 5
        }
    }

    #Love
    option = {
    	trigger = { FROM = { has_character_flag = interested } }
        name = EVTOPTB_MNM_6907

        add_lover = FROM
    }

    after = {
    	hidden_effect = {
    		FROM  = {
    			clr_character_flag = not_interested
    			clr_character_flag = interested
    		}
    	}
    }
}

#Interaction: Help someone's murder plot
character_event = {
	id = MNM.6910
	hide_window = yes

	min_age = 16
	only_playable = yes
	only_capable = yes
	prisoner = no
	is_in_society = yes

	is_triggered_only = yes

	trigger = {
		society_member_of = the_assassins
		society = {
			any_society_member = {
				block_general_event_trigger = no
				ai = yes
				society_rank >= 2
				has_quest = quest_the_assassins_assassination
				NOT = { any_plot_backer = { character = ROOT } }
				OR = {
					AND = {
						has_plot = plot_kill_character
						plot_target_char = { is_quest_target_of = PREV }
					}
					AND = {
						has_plot = plot_kill_spouse
						plot_target_char = { is_quest_target_of = PREV }
					}
				}
			}
		}
	}

	immediate = {
		society = {
			random_society_member = {
				limit = {
					block_general_event_trigger = no
					ai = yes
					society_rank >= 2
					has_quest = quest_the_assassins_assassination
					NOT = { any_plot_backer = { character = ROOT } }
					OR = {
						AND = {
							has_plot = plot_kill_character
							plot_target_char = { is_quest_target_of = PREV }
						}
						AND = {
							has_plot = plot_kill_spouse
							plot_target_char = { is_quest_target_of = PREV }
						}
					}
				}
				save_event_target_as = assassins_plotter
			}
			random_society_member = {
				limit = {
					block_general_event_trigger = no
					ai = yes
					society_rank >= 3
					has_quest = quest_the_assassins_assassination
					NOT = { any_plot_backer = { character = ROOT } }
					OR = {
						AND = {
							has_plot = plot_kill_character
							plot_target_char = { is_quest_target_of = PREV }
						}
						AND = {
							has_plot = plot_kill_spouse
							plot_target_char = { is_quest_target_of = PREV }
						}
					}
				}
				save_event_target_as = assassins_plotter
			}
		}
		event_target:assassins_plotter = { character_event = { id = MNM.6911 } }
	}
}


character_event = {
    id = MNM.6911
    hide_window = yes
    is_triggered_only = yes
    immediate = { FROM = { character_event = { id = MNM.6912 } } }
}

#I can offer my help, but against what?
character_event = {
    id = MNM.6912
    desc = EVTDESC_MNM_6912
    picture = GFX_evt_assassination
    border = GFX_event_normal_frame_intrigue

    is_triggered_only = yes
    
    immediate = {
    	FROM = { plot_target_char = { save_event_target_as = assassin_quest_target } }
    	plot_target_char = { save_event_target_as = my_quest_target }
    }

    #You scratch my back, I scratch yours
    option = { 
    	trigger = { 
    		has_quest = quest_the_assassins_assassination
    		plot_target_char = { is_quest_target_of = ROOT }
    	}
        name = EVTOPTA_MNM_6912

        FROM = { back_plot = ROOT }

        back_plot = FROM

        reverse_opinion = {
        	who = FROM
        	modifier = opinion_grateful
        	years = 10
        }

        ai_chance = { factor = 100 }
    }

    #Some influence
    option = {
        name = EVTOPTB_MNM_6912

        add_society_currency_medium_effect = yes

        back_plot = FROM

        reverse_opinion = {
        	who = FROM
        	modifier = opinion_grateful
        	years = 10
        }

        ai_chance = { factor = 50 }
    }
    
    #Anything for a friend!
    option = {
        name = EVTOPTC_MNM_6912

        if = {
        	limit = { is_friend = FROM }
        	reverse_opinion = {
	        	who = FROM
	        	modifier = opinion_grateful
	        	years = 10
	        }
        }

        if = {
        	limit = { NOT = { is_friend = FROM } }
        	add_friend = FROM 
        }

        back_plot = FROM

        ai_chance = {
        	factor = 10
        	modifier = {
        		OR = {
        			trait = kind
        			trait = gregarious
        			trait = socializer
        		}
        		factor = 20
        	}
        }
    }
    
    #Not interested
    option = {
        name = EVTOPTD_MNM_6912

        reverse_opinion = {
        	who = FROM
        	modifier = opinion_disappointed
        	years = 10
        }

        ai_chance = { factor = 0 }
    }
}

#Interaction: Blackmailing superior
character_event = {
	id = MNM.6920
	hide_window = yes

	is_in_society = yes
	capable_only = yes
	prisoner = no
	min_age = 16

	is_triggered_only = yes
	
	trigger = {
		society_member_of = the_assassins
		any_society_member = {
			same_society_as = ROOT
			block_general_event_trigger = no
			ai = yes
			higher_society_rank_than_prev_trigger = yes
			NOT = { is_rival = ROOT }
			NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_very_grateful } }
		}	
	}

	immediate = {
		
		random_list = {
			10 = {
				modifier = {
					factor = 0
					NOT = {
						any_society_member = {
							same_society_as = ROOT
							block_general_event_trigger = no
							ai = yes
							higher_society_rank_than_prev_trigger = yes
							NOT = { is_rival = ROOT }
							NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_very_grateful } }
							OR = {
								trait = lustful
								trait = seducer
								trait = seductress
								any_lover = { is_alive = yes }
							}
						}
					}
				}
				random_society_member = {
					limit = {
						same_society_as = ROOT
						block_general_event_trigger = no
						ai = yes
						higher_society_rank_than_prev_trigger = yes
						NOT = { is_rival = ROOT }
						NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_very_grateful } }
						OR = {
							trait = lustful
							trait = seducer
							trait = seductress
							any_lover = { is_alive = yes }
						}
					}
					save_event_target_as = assassin_blackmail_target
					set_character_flag = blackmail_lover
				}
			}
			10 = {
				modifier = {
					factor = 0
					NOT = {
						any_society_member = {
							same_society_as = ROOT
							block_general_event_trigger = no
							ai = yes
							higher_society_rank_than_prev_trigger = yes
							NOT = { is_rival = ROOT }
							NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_very_grateful } }
							OR = {
								trait = decadent
								trait = hedonist
								trait = gluttonous
								trait = drunkard
							}
						}
					}
				}
				random_society_member = {
					limit = {
						same_society_as = ROOT
						block_general_event_trigger = no
						ai = yes
						higher_society_rank_than_prev_trigger = yes
						NOT = { is_rival = ROOT }
						NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_very_grateful } }
						OR = {
							trait = decadent
							trait = hedonist
							trait = gluttonous
							trait = drunkard
						}
					}
					save_event_target_as = assassin_blackmail_target
					set_character_flag = blackmail_decadence
				}
			}
			10 = {
				modifier = {
					factor = 0
					NOT = {
						any_society_member = {
							block_general_event_trigger = no
							same_society_as = ROOT
							ai = yes
							higher_society_rank_than_prev_trigger = yes
							NOT = { is_rival = ROOT }
							NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_very_grateful } }
							OR = {
								trait = craven
								is_weak_trigger = yes
								has_disease_trigger = yes
								has_disability_trigger = yes 
								has_mental_disorder_trigger = yes
							}
						}
					}
				}
				random_society_member = {
					limit = {
						block_general_event_trigger = no
						same_society_as = ROOT
						ai = yes
						higher_society_rank_than_prev_trigger = yes
						NOT = { is_rival = ROOT }
						NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_very_grateful } }
						OR = {
							trait = craven
							is_weak_trigger = yes
							has_disease_trigger = yes
							has_disability_trigger = yes 
							has_mental_disorder_trigger = yes
						}
					}
					save_event_target_as = assassin_blackmail_target
					set_character_flag = blackmail_weak
				}
			}
		}

		if = {
			limit = { NOT = { event_target:assassin_blackmail_target = { always = yes } } }
			random_society_member = {
				limit = {
					block_general_event_trigger = no
					same_society_as = ROOT
					ai = yes
					higher_society_rank_than_prev_trigger = yes
					NOT = { is_rival = ROOT }
					NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_very_grateful } }
				}
				save_event_target_as = assassin_blackmail_target
				set_character_flag = blackmail_decadence
			}
		}
	
		event_target:assassin_blackmail_target = { character_event = { id = MNM.6921 } }
	}
}

character_event = {
	id = MNM.6921
	hide_window = yes
	is_triggered_only = yes
	immediate = { FROM = { character_event = { id = MNM.6922 } } }
}

#I found out their secret, what do?
character_event = {
    id = MNM.6922
    picture = GFX_evt_shady_meeting
    border = GFX_event_normal_frame_intrigue

    desc = {
    	trigger = { FROM = { has_character_flag = blackmail_decadence } }
    	text = EVTDESC_MNM_6922_A
    }
    desc = {
    	trigger = { FROM = { has_character_flag = blackmail_lover } }
    	text = EVTDESC_MNM_6922_B
    }
    desc = {
    	trigger = { FROM = { has_character_flag = blackmail_weak } }
    	text = EVTDESC_MNM_6922_C
    }

    is_triggered_only = yes

    immediate = {
    	hidden_effect = {
	    	FROM = {
	    		random_lover = { save_event_target_as = lover_of_target }
		    	if = {
		    		limit = { 
		    			has_character_flag = blackmail_lover
		    			NOT = { any_lover = { is_alive = yes } }
		    		}
		    		host = {
		    			if = {
		    				limit = { prefers_men_trigger = yes }
		    				create_random_diplomat = {
		    					female = no
		    					random_traits = yes
		    					dynasty = none
		    					age = 30
		    				}
		    				new_character = {
		    					add_lover = event_target:assassin_blackmail_target
		    					save_event_target_as = lover_of_target
		    				}
		    			}
		    			if = {
		    				limit = { prefers_men_trigger = no }
		    				create_random_diplomat = {
		    					female = yes
		    					random_traits = yes
		    					dynasty = none
		    					age = 30
		    				}
		    				new_character = {
		    					add_lover = event_target:assassin_blackmail_target
		    					save_event_target_as = lover_of_target
		    				}
		    			}
		    			if = {
		    				limit = { trait = homosexual }
		    				event_target:lover_of_target = { add_trait = homosexual }
		    			}
		    		}
		    	}
	    	}
    	}
    }
    
    #Promote me
    option = { 
    	trigger = {
    		society_rank < 3
    		OR = {
    			ai = no
    			society_can_rank_up = yes
    		}
    		days_at_current_society_rank = 3650
    	}
        name = EVTOPTA_MNM_6922

        society_rank_up = 1

        add_rival = FROM

        ai_chance = { factor = 100 }
    }

    #Give me some influence 
    option = {
        name = EVTOPTB_MNM_6922

       	add_society_currency_major_effect = yes

       	add_rival = FROM

       	ai_chance = { factor = 10 }
    }
    
    #I will keep your secret safe
    option = {
        name = EVTOPTD_MNM_6922

        reverse_opinion = {
        	who = FROM
        	modifier = opinion_very_grateful 
        	years = 20
        }

        ai_chance = {
        	factor = 10
        	modifier = {
        		factor = 20
        		OR = {
        			trait = kind
        			trait = honest
        			trait = content
        			trait = just
        		}
        	}
        }
    }
}



###MISC EVENTS###

#Makes sure d_hashashin owner and subjects have appropriate religion and assassins membership
character_event = {
	id = MNM.6990
	hide_window = yes

	trigger = {
		primary_title = { title = d_hashshashin }
		ai = yes
	}

	is_triggered_only = yes

	immediate = {		
		#Changes religion
		if = {
			limit = { 
				independent = yes 
				primary_title = { title = d_hashshashin } 
				NOT = { religion = shiite }
			}
			religion = shiite
		}

		if = {
			limit = {
				NAND = {
					independent = yes 
					primary_title = { title = d_hashshashin }
					religion = shiite
				}
				NOT = { secret_religion = shiite }
			}
			clear_secret_religion = yes
			set_secret_religion = shiite
		}

		#Try and force them to lvl 3 of the assassins
		if = {
			limit = { NOT = { society_member_of = the_assassins } }
			join_society = the_assassins
		}
		if = {
			limit = {
				society_rank = {
					rank == 1
					society = the_assassins
				}
			}
			society_rank_up = {
				rank = 2
				society = the_assassins
			}
		}
		if = {
			limit = {
				society_rank = {
					rank == 2
					society = the_assassins
				}
			}
			society_rank_up = {
				rank = 1
				society = the_assassins
			}
		}

		#Make every apropriate courtier member of society
		if = {
			limit = { 
				primary_title = { title = d_hashshashin } 
				religion = shiite
			} 
			any_courtier = {
				religion = shiite

				if = {
					limit = {
						is_in_society = no
						is_adult = yes
						prisoner = no
						NOT = { trait = incapable }
						OR = {
							is_female = no
							has_game_rule = {
								name = gender
								value = all
							}
						}
					}
					join_society = the_assassins
				}
			}
			any_vassal = {
				religion = shiite

				if = {
					limit = {
						is_in_society = no
						is_adult = yes
						prisoner = no
						NOT = { trait = incapable }
						OR = {
							is_female = no
							has_game_rule = {
								name = gender
								value = all
							}
						}
					}
					join_society = the_assassins
				}
			}
		}
	}
}


