namespace = PlusFaction

#reserved: PlusFaction.200 to PlusFaction.299

##################################
# FACTION MAINTENANCE EVENTS
# Original Faction System by Wiz
# Re-Written by Rylock
##################################

# PlusFaction.200 [Liege]
# On-demand faction maintenance event
character_event = {
	id = PlusFaction.200
	
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		higher_tier_than = COUNT
		is_nomadic = no
		is_landed = yes
		num_of_vassals = 1
		any_vassal = { pf_leader_trigger = yes }
	}

	immediate = {
		character_event = { id = PlusFaction.221 } # pre-effects
		character_event = { id = PlusFaction.222 } # on-demand maintenance
		character_event = { id = PlusFaction.224 } # completion effects
	}
}

# PlusFaction.201 [Liege & His Court Faction Members]
# Notification of court faction mood change
character_event = {
	id = PlusFaction.201
	picture = GFX_evt_council
	
	is_triggered_only = yes
	notification = yes
	hide_from = yes
	
	desc = {
		text = EVTDESC_PlusFaction_201_Happy
		trigger = {
			FROM = { has_character_flag = faction_court_happy }
		}
	}
	desc = {
		text = EVTDESC_PlusFaction_201_Neutral
		trigger = {
			FROM = {
				NOR = {
					has_character_flag = faction_court_happy
					has_character_flag = faction_court_unhappy
					has_character_flag = faction_court_angry
				}
			}
		}
	}
	desc = {
		text = EVTDESC_PlusFaction_201_Unhappy
		trigger = {
			FROM = { has_character_flag = faction_court_unhappy }
		}
	}
	desc = {
		text = EVTDESC_PlusFaction_201_Angry
		trigger = {
			FROM = { has_character_flag = faction_court_angry }
		}
	}
	
	option = {
		name = "OK"
	}
}

# PlusFaction.202 [Liege & His Prosperity Faction Members]
# Notification of prosperity faction mood change
character_event = {
	id = PlusFaction.202
	picture = GFX_evt_council
	
	is_triggered_only = yes
	notification = yes
	hide_from = yes
	
	desc = {
		text = EVTDESC_PlusFaction_202_Happy
		trigger = {
			FROM = { has_character_flag = faction_prosperity_happy }
		}
	}
	desc = {
		text = EVTDESC_PlusFaction_202_Neutral
		trigger = {
			FROM = {
				NOR = {
					has_character_flag = faction_prosperity_happy
					has_character_flag = faction_prosperity_unhappy
					has_character_flag = faction_prosperity_angry
				}
			}
		}
	}
	desc = {
		text = EVTDESC_PlusFaction_202_Unhappy
		trigger = {
			FROM = { has_character_flag = faction_prosperity_unhappy }
		}
	}
	desc = {
		text = EVTDESC_PlusFaction_202_Angry
		trigger = {
			FROM = { has_character_flag = faction_prosperity_angry }
		}
	}
	
	option = {
		name = "OK"
	}
}

# PlusFaction.203 [Liege & His Glory Faction Members]
# Notification of glory faction mood change
character_event = {
	id = PlusFaction.203
	picture = GFX_evt_council
	
	is_triggered_only = yes
	notification = yes
	hide_from = yes
	
	desc = {
		text = EVTDESC_PlusFaction_203_Happy
		trigger = {
			FROM = { has_character_flag = faction_glory_happy }
		}
	}
	desc = {
		text = EVTDESC_PlusFaction_203_Neutral
		trigger = {
			FROM = {
				NOR = {
					has_character_flag = faction_glory_happy
					has_character_flag = faction_glory_unhappy
					has_character_flag = faction_glory_angry
				}
			}
		}
	}
	desc = {
		text = EVTDESC_PlusFaction_203_Unhappy
		trigger = {
			FROM = { has_character_flag = faction_glory_unhappy }
		}
	}
	desc = {
		text = EVTDESC_PlusFaction_203_Angry
		trigger = {
			FROM = { has_character_flag = faction_glory_angry }
		}
	}
	
	option = {
		name = "OK"
	}
}

# PlusFaction.204 [Liege & His Tradition Faction Members]
# Notification of tradition faction mood change
character_event = {
	id = PlusFaction.204
	picture = GFX_evt_council
	
	is_triggered_only = yes
	notification = yes
	hide_from = yes
	
	desc = {
		text = EVTDESC_PlusFaction_204_Happy
		trigger = {
			FROM = { has_character_flag = faction_tradition_happy }
		}
	}
	desc = {
		text = EVTDESC_PlusFaction_204_Neutral
		trigger = {
			FROM = {
				NOR = {
					has_character_flag = faction_tradition_happy
					has_character_flag = faction_tradition_unhappy
					has_character_flag = faction_tradition_angry
				}
			}
		}
	}
	desc = {
		text = EVTDESC_PlusFaction_204_Unhappy
		trigger = {
			FROM = { has_character_flag = faction_tradition_unhappy }
		}
	}
	desc = {
		text = EVTDESC_PlusFaction_204_Angry
		trigger = {
			FROM = { has_character_flag = faction_tradition_angry }
		}
	}
	
	option = {
		name = "OK"
	}
}

# PlusFaction.205 [Dying Liege]
# Faction maintenance on character death
character_event = {
	id = PlusFaction.205
	hide_window = yes
	is_triggered_only = yes
	
	only_playable = yes

	trigger = {
		current_heir = { is_alive = yes }
	}

	immediate = {
		#pass on proper flags to the heir if currently in a faction revolt
		if = {
			limit = { has_character_flag = faction_court_war }
			current_heir = { set_character_flag = faction_court_war }
		}
		if = {
			limit = { has_character_flag = faction_prosperity_war }
			current_heir = { set_character_flag = faction_prosperity_war }
		}
		if = {
			limit = { has_character_flag = faction_glory_war }
			current_heir = { set_character_flag = faction_glory_war }
		}
		if = {
			limit = { has_character_flag = faction_tradition_war }
			current_heir = { set_character_flag = faction_tradition_war }
		}
		if = {
			limit = { has_character_flag = faction_separatist_war }
			current_heir = { set_character_flag = faction_separatist_war }
		}
		if = {
			limit = { has_character_flag = faction_pretender_war }
			current_heir = { set_character_flag = faction_pretender_war }
		}
		if = {
			limit = { has_character_flag = faction_religious_war }
			current_heir = { set_character_flag = faction_religious_war }
		}
		#pass on rebel trait/opinions if the heir is not currently part of an ongoing civil war
		if = {
			limit = {
				trait = rebel
				current_heir = {
					NOR = {
						trait = loyalist
						trait = neutral
						trait = rebel
					}
				}
			}
			current_heir = { add_trait = rebel }
			any_opinion_modifier_target = {
				limit = {
					reverse_has_opinion_modifier = { who = ROOT modifier = revolting_against }
				}
				ROOT = {
					current_heir = {
						opinion = { who = PREVPREV modifier = revolting_against years = 100 }
					}
					remove_opinion = { who = PREV modifier = revolting_against }
				}
			}
			remove_trait = rebel
		}
		#pass on opinions of rebels who are now rebelling against the heir
		current_heir = {
			ROOT = {
				any_realm_character = {
					limit = { has_opinion_modifier = { who = ROOT modifier = revolting_against } }
					opinion = { who = PREVPREV modifier = revolting_against years = 100 }
					remove_opinion = { who = ROOT modifier = revolting_against }
				}
				any_title = {
					limit = {
						has_holder = yes
						is_primary_holder_title = yes
						rebel = no
						holder_scope = { liege = { character = PREV } }
					}
					holder_scope = {
						if = {
							limit = { has_opinion_modifier = { who = ROOT modifier = revolting_against } }
							opinion = { who = PREVPREVPREV modifier = revolting_against years = 100 }
							remove_opinion = { who = ROOT modifier = revolting_against }
						}
						any_realm_character = {
							limit = { has_opinion_modifier = { who = ROOT modifier = revolting_against } }
							opinion = { who = PREVPREVPREVPREV modifier = revolting_against years = 100 }
							remove_opinion = { who = ROOT modifier = revolting_against }
						}
					}
				}
			}
		}
		#reset heir's faction variables
		current_heir = {
			set_variable = { which = "faction_votes_court" value = 0 }
			set_variable = { which = "faction_votes_prosperity" value = 0 }
			set_variable = { which = "faction_votes_glory" value = 0 }
			set_variable = { which = "faction_votes_tradition" value = 0 }
			set_variable = { which = "faction_mood_court" value = 0 }
			set_variable = { which = "faction_mood_prosperity" value = 0 }
			set_variable = { which = "faction_mood_glory" value = 0 }
			set_variable = { which = "faction_mood_tradition" value = 0 }
			clr_character_flag = faction_court_happy
			clr_character_flag = faction_court_unhappy
			clr_character_flag = faction_court_angry
			clr_character_flag = faction_prosperity_happy
			clr_character_flag = faction_prosperity_unhappy
			clr_character_flag = faction_prosperity_angry
			clr_character_flag = faction_glory_happy
			clr_character_flag = faction_glory_unhappy
			clr_character_flag = faction_glory_angry
			clr_character_flag = faction_tradition_happy
			clr_character_flag = faction_tradition_unhappy
			clr_character_flag = faction_tradition_angry
		}
		#pass on the liege's faction mood flags
		if = {
			limit = { has_character_flag = faction_court_happy }
			current_heir = { set_character_flag = faction_court_happy }
		}
		if = {
			limit = { has_character_flag = faction_court_unhappy }
			current_heir = { set_character_flag = faction_court_unhappy }
		}
		if = {
			limit = { has_character_flag = faction_court_angry }
			current_heir = { set_character_flag = faction_court_angry }
		}
		if = {
			limit = { has_character_flag = faction_prosperity_happy }
			current_heir = { set_character_flag = faction_prosperity_happy }
		}
		if = {
			limit = { has_character_flag = faction_prosperity_unhappy }
			current_heir = { set_character_flag = faction_prosperity_unhappy }
		}
		if = {
			limit = { has_character_flag = faction_prosperity_angry }
			current_heir = { set_character_flag = faction_prosperity_angry }
		}
		if = {
			limit = { has_character_flag = faction_glory_happy }
			current_heir = { set_character_flag = faction_glory_happy }
		}
		if = {
			limit = { has_character_flag = faction_glory_unhappy }
			current_heir = { set_character_flag = faction_glory_unhappy }
		}
		if = {
			limit = { has_character_flag = faction_glory_angry }
			current_heir = { set_character_flag = faction_glory_angry }
		}
		if = {
			limit = { has_character_flag = faction_tradition_happy }
			current_heir = { set_character_flag = faction_tradition_happy }
		}
		if = {
			limit = { has_character_flag = faction_tradition_unhappy }
			current_heir = { set_character_flag = faction_tradition_unhappy }
		}
		if = {
			limit = { has_character_flag = faction_tradition_angry }
			current_heir = { set_character_flag = faction_tradition_angry }
		}
	}
}

# PlusFaction.211 [Granted Title]
# GRANT_LANDED_TITLE_INTERACTION_ACCEPT_EVENT - updates faction response to a granted title
#
# ROOT = Granted Title
# FROM = Granter
character_event = {
	id = PlusFaction.211

	is_triggered_only = yes
	hide_window = yes

	immediate = {
		FROM = { character_event = { id = PlusFaction.212 days = 1 } }
	}
}

# PlusFaction.211 [Granter of Title]
# Faction pleased due to title granted to one of their members
#
# FROM = Granted Title
character_event = {
	id = PlusFaction.212
	
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		#save the title and new holder as event targets
		FROM = {
			save_event_target_as = pf_new_title
			holder_scope = { save_event_target_as = pf_new_owner }
		}
		#claimants to the granted title who aren't close relatives of the new owner are displeased
		event_target:pf_new_title = {
			any_claimant = {
				limit = {
					NOR = {
						character = ROOT
						character = event_target:pf_new_owner
						is_close_relative = event_target:pf_new_owner
					}
					OR = {
						is_female = no
						ROOT = {
							succ_law_title = {
								has_law = true_cognatic_succession
							}
						}
					}
					any_liege = { character = ROOT }
				}
				if = {
					limit = { has_strong_claim = PREV }
					opinion = { who = ROOT modifier = faction_disapprove_title_grant multiplier = 4 years = 10 }
				}
				if = {
					limit = { has_weak_claim = PREV }
					opinion = { who = ROOT modifier = faction_disapprove_title_grant multiplier = 2 years = 10 }
				}
			}
		}
		#members of the same faction as the new holder are pleased, based on the tier of the title
		if = {
			limit = {
				event_target:pf_new_owner = {
					OR = {
						leads_faction = faction_court
						in_faction = faction_court
					}
				}
			}
			ROOT = {
				any_vassal = {
					limit = {
						NOT = { character = event_target:pf_new_owner }
						OR = {
							leads_faction = faction_court
							in_faction = faction_court
						}
					}
					if = {
						limit = { event_target:pf_new_title = { tier = BARON } }
						opinion = { who = ROOT modifier = faction_approve_title_grant years = 3 }
					}
					if = {
						limit = { event_target:pf_new_title = { tier = COUNT } }
						opinion = { who = ROOT modifier = faction_approve_title_grant multiplier = 2 years = 3 }
					}
					if = {
						limit = { event_target:pf_new_title = { tier = DUKE } }
						opinion = { who = ROOT modifier = faction_approve_title_grant multiplier = 4 years = 3 }
					}
					if = {
						limit = { event_target:pf_new_title = { tier = KING } }
						opinion = { who = ROOT modifier = faction_approve_title_grant multiplier = 6 years = 3 }
					}
				}
				character_event = { id = PlusFaction.200 days = 1 } #fire maintenance event to recalculate moods
			}
		}
		if = {
			limit = {
				event_target:pf_new_owner = {
					OR = {
						leads_faction = faction_prosperity
						in_faction = faction_prosperity
					}
				}
			}
			ROOT = {
				any_vassal = {
					limit = {
						NOT = { character = event_target:pf_new_owner }
						OR = {
							leads_faction = faction_prosperity
							in_faction = faction_prosperity
						}
					}
					if = {
						limit = { event_target:pf_new_title = { tier = BARON } }
						opinion = { who = ROOT modifier = faction_approve_title_grant years = 3 }
					}
					if = {
						limit = { event_target:pf_new_title = { tier = COUNT } }
						opinion = { who = ROOT modifier = faction_approve_title_grant multiplier = 2 years = 3 }
					}
					if = {
						limit = { event_target:pf_new_title = { tier = DUKE } }
						opinion = { who = ROOT modifier = faction_approve_title_grant multiplier = 4 years = 3 }
					}
					if = {
						limit = { event_target:pf_new_title = { tier = KING } }
						opinion = { who = ROOT modifier = faction_approve_title_grant multiplier = 6 years = 3 }
					}
				}
				character_event = { id = PlusFaction.200 days = 1 } #fire maintenance event to recalculate moods
			}
		}
		if = {
			limit = {
				event_target:pf_new_owner = {
					OR = {
						leads_faction = faction_glory
						in_faction = faction_glory
					}
				}
			}
			ROOT = {
				any_vassal = {
					limit = {
						NOT = { character = event_target:pf_new_owner }
						OR = {
							leads_faction = faction_glory
							in_faction = faction_glory
						}
					}
					if = {
						limit = { event_target:pf_new_title = { tier = BARON } }
						opinion = { who = ROOT modifier = faction_approve_title_grant years = 3 }
					}
					if = {
						limit = { event_target:pf_new_title = { tier = COUNT } }
						opinion = { who = ROOT modifier = faction_approve_title_grant multiplier = 2 years = 3 }
					}
					if = {
						limit = { event_target:pf_new_title = { tier = DUKE } }
						opinion = { who = ROOT modifier = faction_approve_title_grant multiplier = 4 years = 3 }
					}
					if = {
						limit = { event_target:pf_new_title = { tier = KING } }
						opinion = { who = ROOT modifier = faction_approve_title_grant multiplier = 6 years = 3 }
					}
				}
				character_event = { id = PlusFaction.200 days = 1 } #fire maintenance event to recalculate moods
			}
		}
		if = {
			limit = {
				event_target:pf_new_owner = {
					OR = {
						leads_faction = faction_tradition
						in_faction = faction_tradition
					}
				}
			}
			ROOT = {
				any_vassal = {
					limit = {
						NOT = { character = event_target:pf_new_owner }
						OR = {
							leads_faction = faction_tradition
							in_faction = faction_tradition
						}
					}
					if = {
						limit = { event_target:pf_new_title = { tier = BARON } }
						opinion = { who = ROOT modifier = faction_approve_title_grant years = 3 }
					}
					if = {
						limit = { event_target:pf_new_title = { tier = COUNT } }
						opinion = { who = ROOT modifier = faction_approve_title_grant multiplier = 2 years = 3 }
					}
					if = {
						limit = { event_target:pf_new_title = { tier = DUKE } }
						opinion = { who = ROOT modifier = faction_approve_title_grant multiplier = 4 years = 3 }
					}
					if = {
						limit = { event_target:pf_new_title = { tier = KING } }
						opinion = { who = ROOT modifier = faction_approve_title_grant multiplier = 6 years = 3 }
					}
				}
				character_event = { id = PlusFaction.200 days = 1 } #fire maintenance event to recalculate moods
			}
		}
	}
}

# PlusFaction.220 [Liege]
# Annual faction maintenance event <MTTH>
character_event = {
	id = PlusFaction.220
	hide_window = yes

	only_playable = yes
	has_character_modifier = pf_maintenance_timer
	
	trigger = {
		higher_tier_than = COUNT
		is_nomadic = no
		is_landed = yes
		any_vassal = { pf_leader_trigger = yes }
	}

	mean_time_to_happen = {
		days = 1

		modifier = {
			factor = 0.01
			always = yes
		}
	}

	immediate = {
		# Clear the maintenance timer (just a handy MTTH event pre-trigger optimization)
		remove_character_modifier = pf_maintenance_timer

		character_event = { id = PlusFaction.221 } # pre-effects

		# We still do on-demand maintenance here, because it could be a handy optimization
		# in the future to defer on-demand mood increase/decrease for AI lieges until
		# this mandatory annual maintenance event's execution.

		character_event = { id = PlusFaction.222 } # on-demand maintenance
		character_event = { id = PlusFaction.223 } # annual maintenance
		character_event = { id = PlusFaction.224 } # completion effects
	}
}


# PlusFaction.221 [Liege]
# Faction maintenance pre-effects
character_event = {
	id = PlusFaction.221
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		#reset variables
		set_variable = { which = "faction_votes_court" value = 0 }
		set_variable = { which = "faction_votes_prosperity" value = 0 }
		set_variable = { which = "faction_votes_glory" value = 0 }
		set_variable = { which = "faction_votes_tradition" value = 0 }
		set_variable = { which = "faction_mood_court" value = 0 }
		set_variable = { which = "faction_mood_prosperity" value = 0 }
		set_variable = { which = "faction_mood_glory" value = 0 }
		set_variable = { which = "faction_mood_tradition" value = 0 }

		#count the number of votes in each faction

		any_vassal = {
			limit = { pf_member_court_trigger = yes }
			if = {
				limit = { real_tier = BARON }
				ROOT = { change_variable = { which = "faction_votes_court" value = 1 } }
			}
			if = {
				limit = { real_tier = COUNT }
				ROOT = { change_variable = { which = "faction_votes_court" value = 2 } }
			}
			if = {
				limit = { real_tier = DUKE }
				ROOT = { change_variable = { which = "faction_votes_court" value = 4 } }
			}
			if = {
				limit = { real_tier = KING }
				ROOT = { change_variable = { which = "faction_votes_court" value = 8 } }
			}
		}
		any_vassal = {
			limit = { pf_member_prosperity_trigger = yes }
			if = {
				limit = { real_tier = BARON }
				ROOT = { change_variable = { which = "faction_votes_prosperity" value = 1 } }
			}
			if = {
				limit = { real_tier = COUNT }
				ROOT = { change_variable = { which = "faction_votes_prosperity" value = 2 } }
			}
			if = {
				limit = { real_tier = DUKE }
				ROOT = { change_variable = { which = "faction_votes_prosperity" value = 4 } }
			}
			if = {
				limit = { real_tier = KING }
				ROOT = { change_variable = { which = "faction_votes_prosperity" value = 8 } }
			}
		}
		any_vassal = {
			limit = { pf_member_glory_trigger = yes }
			if = {
				limit = { real_tier = BARON }
				ROOT = { change_variable = { which = "faction_votes_glory" value = 1 } }
			}
			if = {
				limit = { real_tier = COUNT }
				ROOT = { change_variable = { which = "faction_votes_glory" value = 2 } }
			}
			if = {
				limit = { real_tier = DUKE }
				ROOT = { change_variable = { which = "faction_votes_glory" value = 4 } }
			}
			if = {
				limit = { real_tier = KING }
				ROOT = { change_variable = { which = "faction_votes_glory" value = 8 } }
			}
		}
		any_vassal = {
			limit = { pf_member_tradition_trigger = yes }
			if = {
				limit = { real_tier = BARON }
				ROOT = { change_variable = { which = "faction_votes_tradition" value = 1 } }
			}
			if = {
				limit = { real_tier = COUNT }
				ROOT = { change_variable = { which = "faction_votes_tradition" value = 2 } }
			}
			if = {
				limit = { real_tier = DUKE }
				ROOT = { change_variable = { which = "faction_votes_tradition" value = 4 } }
			}
			if = {
				limit = { real_tier = KING }
				ROOT = { change_variable = { which = "faction_votes_tradition" value = 8 } }
			}
		}

		#remove any [invalid] faction_mood increase/decrease on non-faction-leaders
		if = {
			limit = {
				pf_leader_trigger = no
				OR = {
					check_variable = { which = "faction_mood_increase" value = 0.5 }
					check_variable = { which = "faction_mood_decrease" value = 0.5 }
				}
			}
			set_variable = { which = "faction_mood_increase" value = 0 }
			set_variable = { which = "faction_mood_decrease" value = 0 }
		}
		any_vassal = {
			limit = {
				pf_leader_trigger = no
				OR = {
					check_variable = { which = "faction_mood_increase" value = 0.5 }
					check_variable = { which = "faction_mood_decrease" value = 0.5 }
				}
			}
			set_variable = { which = "faction_mood_increase" value = 0 }
			set_variable = { which = "faction_mood_decrease" value = 0 }
		}
	}
}



# PlusFaction.222 [Liege]
# On-demand maintenance core
character_event = {
	id = PlusFaction.222
	hide_window = yes
	is_triggered_only = yes

	immediate = {

		# Optimization notes for the future: At least for AI lieges, first subtract
		# faction_mood_decrease from faction_mood_increase to reduce the number of
		# opinion modifiers in play. [Only matters if AI on-demand effects are
		# queued for processing in batch manually.]

		#make any one-time adjustments to faction opinions (fired from events & decisions)
		any_vassal = {
			limit = {
				pf_leader_trigger = yes
				OR = {
					check_variable = { which = "faction_mood_increase" value = 0.5 }
					check_variable = { which = "faction_mood_decrease" value = 0.5 }
				}
			}
			if = {
				limit = { is_variable_equal = { which = "faction_mood_increase" value = 1 } }
				opinion = { who = ROOT modifier = faction_pleased years = 3 }
			}
			if = {
				limit = { is_variable_equal = { which = "faction_mood_increase" value = 2 } }
				opinion = { who = ROOT modifier = faction_pleased multiplier = 2 years = 3 }
			}
			if = {
				limit = { is_variable_equal = { which = "faction_mood_increase" value = 3 } }
				opinion = { who = ROOT modifier = faction_pleased multiplier = 3 years = 3 }
			}
			if = {
				limit = { is_variable_equal = { which = "faction_mood_increase" value = 4 } }
				opinion = { who = ROOT modifier = faction_pleased multiplier = 4 years = 3 }
			}
			if = {
				limit = { is_variable_equal = { which = "faction_mood_increase" value = 5 } }
				opinion = { who = ROOT modifier = faction_pleased multiplier = 5 years = 3 }
			}
			if = {
				limit = { is_variable_equal = { which = "faction_mood_increase" value = 6 } }
				opinion = { who = ROOT modifier = faction_pleased multiplier = 6 years = 3 }
			}
			if = {
				limit = { is_variable_equal = { which = "faction_mood_increase" value = 7 } }
				opinion = { who = ROOT modifier = faction_pleased multiplier = 7 years = 3 }
			}
			if = {
				limit = { is_variable_equal = { which = "faction_mood_increase" value = 8 } }
				opinion = { who = ROOT modifier = faction_pleased multiplier = 8 years = 3 }
			}
			if = {
				limit = { is_variable_equal = { which = "faction_mood_increase" value = 9 } }
				opinion = { who = ROOT modifier = faction_pleased multiplier = 9 years = 3 }
			}
			if = {
				limit = { is_variable_equal = { which = "faction_mood_increase" value = 10 } }
				opinion = { who = ROOT modifier = faction_pleased multiplier = 10 years = 3 }
			}
			if = {
				limit = { is_variable_equal = { which = "faction_mood_decrease" value = 1 } }
				opinion = { who = ROOT modifier = faction_displeased years = 6 }
			}
			if = {
				limit = { is_variable_equal = { which = "faction_mood_decrease" value = 2 } }
				opinion = { who = ROOT modifier = faction_displeased multiplier = 2 years = 6 }
			}
			if = {
				limit = { is_variable_equal = { which = "faction_mood_decrease" value = 3 } }
				opinion = { who = ROOT modifier = faction_displeased multiplier = 3 years = 6 }
			}
			if = {
				limit = { is_variable_equal = { which = "faction_mood_decrease" value = 4 } }
				opinion = { who = ROOT modifier = faction_displeased multiplier = 4 years = 6 }
			}
			if = {
				limit = { is_variable_equal = { which = "faction_mood_decrease" value = 5 } }
				opinion = { who = ROOT modifier = faction_displeased multiplier = 5 years = 6 }
			}
			if = {
				limit = { is_variable_equal = { which = "faction_mood_decrease" value = 6 } }
				opinion = { who = ROOT modifier = faction_displeased multiplier = 6 years = 6 }
			}
			if = {
				limit = { is_variable_equal = { which = "faction_mood_decrease" value = 7 } }
				opinion = { who = ROOT modifier = faction_displeased multiplier = 7 years = 6 }
			}
			if = {
				limit = { is_variable_equal = { which = "faction_mood_decrease" value = 8 } }
				opinion = { who = ROOT modifier = faction_displeased multiplier = 8 years = 6 }
			}
			if = {
				limit = { is_variable_equal = { which = "faction_mood_decrease" value = 9 } }
				opinion = { who = ROOT modifier = faction_displeased multiplier = 9 years = 6 }
			}
			if = {
				limit = { is_variable_equal = { which = "faction_mood_decrease" value = 10 } }
				opinion = { who = ROOT modifier = faction_displeased multiplier = 10 years = 6 }
			}
			any_faction_backer = {
				limit = { pf_my_faction_backer_trigger = yes }
				if = {
					limit = { PREV = { is_variable_equal = { which = "faction_mood_increase" value = 1 } } }
					opinion = { who = ROOT modifier = faction_pleased years = 3 }
				}
				if = {
					limit = { PREV = { is_variable_equal = { which = "faction_mood_increase" value = 2 } } }
					opinion = { who = ROOT modifier = faction_pleased multiplier = 2 years = 3 }
				}
				if = {
					limit = { PREV = { is_variable_equal = { which = "faction_mood_increase" value = 3 } } }
					opinion = { who = ROOT modifier = faction_pleased multiplier = 3 years = 3 }
				}
				if = {
					limit = { PREV = { is_variable_equal = { which = "faction_mood_increase" value = 4 } } }
					opinion = { who = ROOT modifier = faction_pleased multiplier = 4 years = 3 }
				}
				if = {
					limit = { PREV = { is_variable_equal = { which = "faction_mood_increase" value = 5 } } }
					opinion = { who = ROOT modifier = faction_pleased multiplier = 5 years = 3 }
				}
				if = {
					limit = { PREV = { is_variable_equal = { which = "faction_mood_increase" value = 6 } } }
					opinion = { who = ROOT modifier = faction_pleased multiplier = 6 years = 3 }
				}
				if = {
					limit = { PREV = { is_variable_equal = { which = "faction_mood_increase" value = 7 } } }
					opinion = { who = ROOT modifier = faction_pleased multiplier = 7 years = 3 }
				}
				if = {
					limit = { PREV = { is_variable_equal = { which = "faction_mood_increase" value = 8 } } }
					opinion = { who = ROOT modifier = faction_pleased multiplier = 8 years = 3 }
				}
				if = {
					limit = { PREV = { is_variable_equal = { which = "faction_mood_increase" value = 9 } } }
					opinion = { who = ROOT modifier = faction_pleased multiplier = 9 years = 3 }
				}
				if = {
					limit = { PREV = { is_variable_equal = { which = "faction_mood_increase" value = 10 } } }
					opinion = { who = ROOT modifier = faction_pleased multiplier = 10 years = 3 }
				}
				if = {
					limit = { PREV = { is_variable_equal = { which = "faction_mood_decrease" value = 1 } } }
					opinion = { who = ROOT modifier = faction_displeased years = 6 }
				}
				if = {
					limit = { PREV = { is_variable_equal = { which = "faction_mood_decrease" value = 2 } } }
					opinion = { who = ROOT modifier = faction_displeased multiplier = 2 years = 6 }
				}
				if = {
					limit = { PREV = { is_variable_equal = { which = "faction_mood_decrease" value = 3 } } }
					opinion = { who = ROOT modifier = faction_displeased multiplier = 3 years = 6 }
				}
				if = {
					limit = { PREV = { is_variable_equal = { which = "faction_mood_decrease" value = 4 } } }
					opinion = { who = ROOT modifier = faction_displeased multiplier = 4 years = 6 }
				}
				if = {
					limit = { PREV = { is_variable_equal = { which = "faction_mood_decrease" value = 5 } } }
					opinion = { who = ROOT modifier = faction_displeased multiplier = 5 years = 6 }
				}
				if = {
					limit = { PREV = { is_variable_equal = { which = "faction_mood_decrease" value = 6 } } }
					opinion = { who = ROOT modifier = faction_displeased multiplier = 6 years = 6 }
				}
				if = {
					limit = { PREV = { is_variable_equal = { which = "faction_mood_decrease" value = 7 } } }
					opinion = { who = ROOT modifier = faction_displeased multiplier = 7 years = 6 }
				}
				if = {
					limit = { PREV = { is_variable_equal = { which = "faction_mood_decrease" value = 8 } } }
					opinion = { who = ROOT modifier = faction_displeased multiplier = 8 years = 6 }
				}
				if = {
					limit = { PREV = { is_variable_equal = { which = "faction_mood_decrease" value = 9 } } }
					opinion = { who = ROOT modifier = faction_displeased multiplier = 9 years = 6 }
				}
				if = {
					limit = { PREV = { is_variable_equal = { which = "faction_mood_decrease" value = 10 } } }
					opinion = { who = ROOT modifier = faction_displeased multiplier = 10 years = 6 }
				}
			}
			set_variable = { which = "faction_mood_increase" value = 0 }
			set_variable = { which = "faction_mood_decrease" value = 0 }
		}
	}
}


# PlusFaction.223 [Liege]
# Annual faction maintenance core
character_event = {
	id = PlusFaction.223
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		#CROWN AUTHORITY
		any_vassal = {
			remove_opinion = { who = ROOT modifier = faction_approve_CA }
			remove_opinion = { who = ROOT modifier = faction_disapprove_CA }
		}
		#Crown Authority 0
		if = {
			limit = {
				higher_real_tier_than = DUKE
				primary_title = { crownlaw_title = { has_law = crown_authority_0 } }
			}
			#court faction likes CA 0
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_court
						in_faction = faction_court
					}
				}
				opinion = { who = ROOT modifier = faction_approve_CA months = 14 }
			}
			#prosperity faction dislikes CA 0 (too much chaos)
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_prosperity
						in_faction = faction_prosperity
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_CA months = 14 }
			}
		}
		#Crown Authority 1
		if = {
			limit = {
				higher_real_tier_than = DUKE
				primary_title = {
					crownlaw_title = { has_law = crown_authority_1 }
					NOT = { title = e_hre }
				}
			}
			#non-HRE court factions dislike CA 1
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_court
						in_faction = faction_court
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_CA months = 14 }
			}
		}
		if = {
			limit = {
				higher_real_tier_than = DUKE
				primary_title = {
					crownlaw_title = { has_law = crown_authority_1 }
					title = e_hre
				}
			}
			#HRE court factions dislike CA 1 more
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_court
						in_faction = faction_court
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_CA multiplier = 2 months = 14 }
			}
		}
		#Crown Authority 2
		if = {
			limit = {
				higher_real_tier_than = DUKE
				primary_title = {
					crownlaw_title = { has_law = crown_authority_2 }
					NOT = { title = e_hre }
				}
			}
			#non-HRE court factions dislike CA 2
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_court
						in_faction = faction_court
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_CA months = 14 }
			}
		}
		if = {
			limit = {
				higher_real_tier_than = DUKE
				primary_title = {
					crownlaw_title = { has_law = crown_authority_2 }
					title = e_hre
				}
			}
			# HRE glory & tradition factions dislike CA 2
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_glory
						in_faction = faction_glory
						leads_faction = faction_tradition
						in_faction = faction_tradition
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_CA months = 14 }
			}
			# HRE court factions really dislike CA 2
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_court
						in_faction = faction_court
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_CA multiplier = 3 months = 14 }
			}
		}
		#Crown Authority 3
		if = {
			limit = {
				higher_real_tier_than = DUKE
				primary_title = {
					crownlaw_title = { has_law = crown_authority_3 }
					NOT = { title = e_hre }
				}
			}
			# non-HRE court factions really dislike CA 2
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_court
						in_faction = faction_court
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_CA multiplier = 2 months = 14 }
			}
			# non-HRE prosperity factions like CA 2
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_prosperity
						in_faction = faction_prosperity
					}
				}
				opinion = { who = ROOT modifier = faction_approve_CA months = 14 }
			}
		}
		if = {
			limit = {
				higher_real_tier_than = DUKE
				primary_title = {
					crownlaw_title = { has_law = crown_authority_3 }
					title = e_hre
				}
			}
			# HRE glory & tradition factions dislike CA 3
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_glory
						in_faction = faction_glory
						leads_faction = faction_tradition
						in_faction = faction_tradition
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_CA multiplier = 2 months = 14 }
			}	
			# HRE court factions intensely dislike CA 3
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_court
						in_faction = faction_court
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_CA multiplier = 4 months = 14 }
			}
			# HRE prosperity factions like CA 3
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_prosperity
						in_faction = faction_prosperity
					}
				}
				opinion = { who = ROOT modifier = faction_approve_CA months = 14 }
			}
		}
		#Crown Authority 4
		if = {
			limit = {
				higher_real_tier_than = DUKE
				primary_title = {
					crownlaw_title = { has_law = crown_authority_4 }
					NOT = { title = e_hre }
				}
			}
			# non-HRE court factions intensely dislike CA 4
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_court
						in_faction = faction_court
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_CA multiplier = 3 months = 14 }
			}
			# non-HRE prosperity facions really like CA 4
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_prosperity
						in_faction = faction_prosperity
					}
				}
				opinion = { who = ROOT modifier = faction_approve_CA multiplier = 2 months = 14 }
			}
		}
		if = {
			limit = {
				higher_real_tier_than = DUKE
				primary_title = {
					crownlaw_title = { has_law = crown_authority_4 }
					title = e_hre
				}
			}
			# HRE court factions lose their minds over CA 4
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_court
						in_faction = faction_court
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_CA multiplier = 5 months = 14 }
			}
			# HRE glory & tradition factions intensely dislike CA 4
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_glory
						in_faction = faction_glory
						leads_faction = faction_tradition
						in_faction = faction_tradition
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_CA multiplier = 3 months = 14 }
			}
			# HRE prosperity factions really like CA 4
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_prosperity
						in_faction = faction_prosperity
					}
				}
				opinion = { who = ROOT modifier = faction_approve_CA multiplier = 2 months = 14 }
			}
		}

		#TRIBAL ORGANIZATION
		any_vassal = {
			remove_opinion = { who = ROOT modifier = faction_approve_TO }
			remove_opinion = { who = ROOT modifier = faction_disapprove_TO }
		}
		#Tribal Organization 0
		if = {
			limit = {
				primary_title = { crownlaw_title = { has_law = tribal_organization_0 } }
			}
			#court factions approve
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_court
						in_faction = faction_court
					}
				}
				opinion = { who = ROOT modifier = faction_approve_TO months = 14 }
			}
			#prosperity factions disapprove
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_prosperity
						in_faction = faction_prosperity
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_TO months = 14 }
			}
		}
		#Tribal Organization 1
		if = {
			limit = {
				primary_title = { crownlaw_title = { has_law = tribal_organization_1 } }
			}
			#court factions disapprove
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_court
						in_faction = faction_court
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_TO months = 14 }
			}
		}
		#Tribal Organization 2
		if = {
			limit = {
				primary_title = { crownlaw_title = { has_law = tribal_organization_2 } }
			}
			# court factions disapprove
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_court
						in_faction = faction_court
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_TO months = 14 }
			}
		}
		#Tribal Organization 3
		if = {
			limit = {
				primary_title = { crownlaw_title = { has_law = tribal_organization_3 } }
			}
			# court factions really disapprove
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_court
						in_faction = faction_court
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_TO multiplier = 2 months = 14 }
			}
			# tradition factions disapprove
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_tradition
						in_faction = faction_tradition
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_TO months = 14 }
			}
			# prosperity factions approve
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_prosperity
						in_faction = faction_prosperity
					}
				}
				opinion = { who = ROOT modifier = faction_approve_TO months = 14 }
			}
		}
		#Tribal Organization 4
		if = {
			limit = {
				primary_title = { crownlaw_title = { has_law = tribal_organization_4 } }
			}
			#court factions really disapprove
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_court
						in_faction = faction_court
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_TO multiplier = 3 months = 14 }
			}
			#tradition factions disapprove
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_tradition
						in_faction = faction_tradition
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_TO months = 14 }
			}
			#prosperity factions really approve
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_prosperity
						in_faction = faction_prosperity
					}
				}
				opinion = { who = ROOT modifier = faction_approve_TO multiplier = 2 months = 14 }
			}
		}							

		#OBLIGATIONS
		any_vassal = {
			remove_opinion = { who = ROOT modifier = faction_approve_obligations }
			remove_opinion = { who = ROOT modifier = faction_disapprove_obligations }
		}
		#Feudal Obligations 0
		if = {
			limit = { primary_title = { has_law = feudal_obligations_0 } }
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_court
						in_faction = faction_court
						leads_faction = faction_glory
						in_faction = faction_glory
					}
				}
				opinion = { who = ROOT modifier = faction_approve_obligations months = 14 }
			}
		}
		#Feudal Obligations 2
		if = {
			limit = { primary_title = { has_law = feudal_obligations_2 } }
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_court
						in_faction = faction_court
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_obligations months = 14 }
			}
		}
		#Feudal Obligations 3
		if = {
			limit = { primary_title = { has_law = feudal_obligations_3 } }
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_court
						in_faction = faction_court
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_obligations multiplier = 2 months = 14 }
			}
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_glory
						in_faction = faction_glory
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_obligations months = 14 }
			}
		}
		#Feudal Obligations 4
		if = {
			limit = { primary_title = { has_law = feudal_obligations_4 } }
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_court
						in_faction = faction_court
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_obligations multiplier = 3 months = 14 }
			}
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_glory
						in_faction = faction_glory
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_obligations multiplier = 2 months = 14 }
			}
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_prosperity
						in_faction = faction_prosperity
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_obligations months = 14 }
			}
		}			
		#Temple Obligations 0
		if = {
			limit = { primary_title = { has_law = temple_obligations_0 } }
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_tradition
						in_faction = faction_tradition
					}
				}
				opinion = { who = ROOT modifier = faction_approve_obligations months = 14 }
			}
		}
		#Temple Obligations 2
		if = {
			limit = { primary_title = { has_law = temple_obligations_2 } }
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_tradition
						in_faction = faction_tradition
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_obligations months = 14 }
			}
		}
		#Temple Obligations 3
		if = {
			limit = { primary_title = { has_law = temple_obligations_3 } }
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_tradition
						in_faction = faction_tradition
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_obligations multiplier = 2 months = 14 }
			}
		}
		#Temple Obligations 4
		if = {
			limit = { primary_title = { has_law = temple_obligations_4 } }
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_tradition
						in_faction = faction_tradition
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_obligations multiplier = 3 months = 14 }
			}
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_prosperity
						in_faction = faction_prosperity
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_obligations months = 14 }
			}
		}
		#City Obligations 0
		if = {
			limit = { primary_title = { has_law = city_obligations_0 } }
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_prosperity
						in_faction = faction_prosperity
					}
				}
				opinion = { who = ROOT modifier = faction_approve_obligations months = 14 }
			}
		}
		#City Obligations 2
		if = {
			limit = { primary_title = { has_law = city_obligations_2 } }
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_prosperity
						in_faction = faction_prosperity
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_obligations months = 14 }
			}
		}
		#City Obligations 3
		if = {
			limit = { primary_title = { has_law = city_obligations_3 } }
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_prosperity
						in_faction = faction_prosperity
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_obligations multiplier = 2 months = 14 }
			}
		}
		#City Obligations 4
		if = {
			limit = { primary_title = { has_law = city_obligations_4 } }
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_prosperity
						in_faction = faction_prosperity
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_obligations multiplier = 3 months = 14 }
			}
		}
		#Iqta Obligations 0
		if = {
			limit = { primary_title = { has_law = iqta_obligations_0 } }
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_court
						in_faction = faction_court
						leads_faction = faction_glory
						in_faction = faction_glory
					}
				}
				opinion = { who = ROOT modifier = faction_approve_obligations months = 14 }
			}
		}
		#Iqta Obligations 2
		if = {
			limit = { primary_title = { has_law = iqta_obligations_2 } }
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_court
						in_faction = faction_court
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_obligations months = 14 }
			}
		}
		#Iqta Obligations 3
		if = {
			limit = { primary_title = { has_law = iqta_obligations_3 } }
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_court
						in_faction = faction_court
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_obligations multiplier = 2 months = 14 }
			}
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_glory
						in_faction = faction_glory
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_obligations months = 14 }
			}
		}
		#Iqta Obligations 4
		if = {
			limit = { primary_title = { has_law = iqta_obligations_4 } }
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_court
						in_faction = faction_court
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_obligations multiplier = 3 months = 14 }
			}
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_glory
						in_faction = faction_glory
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_obligations multiplier = 2 months = 14 }
			}
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_prosperity
						in_faction = faction_prosperity
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_obligations months = 14 }
			}
		}
		#Tribal Obligations 0
		if = {
			limit = { primary_title = { has_law = tribal_obligations_0 } }
			any_vassal = {
				limit = {
					is_tribal = yes
					OR = {
						leads_faction = faction_court
						in_faction = faction_court
						leads_faction = faction_glory
						in_faction = faction_glory
					}
				}
				opinion = { who = ROOT modifier = faction_approve_obligations months = 14 }
			}
		}
		#Tribal Obligations 2
		if = {
			limit = { primary_title = { has_law = tribal_obligations_2 } }
			any_vassal = {
				limit = {
					is_tribal = yes
					OR = {
						leads_faction = faction_court
						in_faction = faction_court
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_obligations months = 14 }
			}
		}
		#Tribal Obligations 3
		if = {
			limit = { primary_title = { has_law = tribal_obligations_3 } }
			any_vassal = {
				limit = {
					is_tribal = yes
					OR = {
						leads_faction = faction_court
						in_faction = faction_court
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_obligations multiplier = 2 months = 14 }
			}
			any_vassal = {
				limit = {
					is_tribal = yes
					OR = {
						leads_faction = faction_glory
						in_faction = faction_glory
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_obligations months = 14 }
			}
		}
		#Tribal Obligations 4
		if = {
			limit = { primary_title = { has_law = tribal_obligations_4 } }
			any_vassal = {
				limit = {
					is_tribal = yes
					OR = {
						leads_faction = faction_court
						in_faction = faction_court
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_obligations multiplier = 3 months = 14 }
			}
			any_vassal = {
				limit = {
					is_tribal = yes
					OR = {
						leads_faction = faction_glory
						in_faction = faction_glory
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_obligations multiplier = 2 months = 14 }
			}
			any_vassal = {
				limit = {
					is_tribal = yes
					OR = {
						leads_faction = faction_prosperity
						in_faction = faction_prosperity
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_obligations months = 14 }
			}
		}

		#COUNCILLORS
		any_vassal = {
			remove_opinion = { who = ROOT modifier = faction_approve_council }
			remove_opinion = { who = ROOT modifier = faction_disapprove_council }
		}
		#Court Faction member on council
		if = {
			limit = {
				any_courtier = {
					is_councillor = yes
					OR = {
						leads_faction = faction_court
						in_faction = faction_court
					}
				}
			}
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_court
						in_faction = faction_court
					}
				}
				opinion = { who = ROOT modifier = faction_approve_council months = 14 }
			}
		}
		#No Court Faction member on council
		if = {
			limit = {
				NOT = {
					any_courtier = {
						is_councillor = yes
						OR = {
							leads_faction = faction_court
							in_faction = faction_court
						}
					}
				}
			}
			any_vassal = {
				limit = {
					is_councillor = no
					OR = {
						leads_faction = faction_court
						in_faction = faction_court
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_council months = 14 }
			}
		}
		#Steward is not member of Prosperity Faction
		if = {
			limit = {
				job_treasurer = {
					NOR = {
						leads_faction = faction_prosperity
						in_faction = faction_prosperity
					}
				}
			}
			any_vassal = {
				limit = {
					is_councillor = no
					OR = {
						leads_faction = faction_prosperity
						in_faction = faction_prosperity
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_council months = 14 }
			}
		}
		#Steward is member of Prosperity Faction
		if = {
			limit = {
				job_treasurer = {
					OR = {
						leads_faction = faction_prosperity
						in_faction = faction_prosperity
					}
				}
			}
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_prosperity
						in_faction = faction_prosperity
					}
				}
				opinion = { who = ROOT modifier = faction_approve_council months = 14 }
			}
		}
		#Marshal is not member of Glory Faction
		if = {
			limit = {
				job_marshal = {
					NOR = {
						leads_faction = faction_glory
						in_faction = faction_glory
					}
				}
			}
			any_vassal = {
				limit = {
					is_councillor = no
					OR = {
						leads_faction = faction_glory
						in_faction = faction_glory
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_council months = 14 }
			}
		}
		#Marshal is member of Glory Faction
		if = {
			limit = {
				job_marshal = {
					OR = {
						leads_faction = faction_glory
						in_faction = faction_glory
					}
				}
			}
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_glory
						in_faction = faction_glory
					}
				}
				opinion = { who = ROOT modifier = faction_approve_council months = 14 }
			}
		}
		#Lord Spiritual is not member of Tradition Faction
		if = {
			limit = {
				job_spiritual = {
					NOR = {
						leads_faction = faction_tradition
						in_faction = faction_tradition
					}
				}
			}
			any_vassal = {
				limit = {
					is_councillor = no
					OR = {
						leads_faction = faction_tradition
						in_faction = faction_tradition
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_council months = 14 }
			}
		}
		#Lord Spiritual is member of Tradition Faction
		if = {
			limit = {
				job_spiritual = {
					OR = {
						leads_faction = faction_tradition
						in_faction = faction_tradition
					}
				}
			}
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_tradition
						in_faction = faction_tradition
					}
				}
				opinion = { who = ROOT modifier = faction_approve_council months = 14 }
			}
		}

		#LIEGE PIETY
		any_vassal = {
			remove_opinion = { who = ROOT modifier = faction_approve_piety }
			remove_opinion = { who = ROOT modifier = faction_disapprove_piety }
		}
		#Liege has negative piety and not in a crusade or holy war
		if = {
			limit = {
				NOR = {
					piety = 0
					any_war = {
						OR = {
							using_cb = crusade
							using_cb = religious
						}
						any_attacker = { character = ROOT }
					}
				}
			}
			#Non-muslim Tradition Faction disapproves
			any_vassal = {
				limit = {
					NOT = { religion_group = muslim }
					OR = {
						leads_faction = faction_tradition
						in_faction = faction_tradition
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_piety multiplier = 2 months = 14 }
			}
			#Muslim Tradition Faction disapproves more
			any_vassal = {
				limit = {
					religion_group = muslim
					OR = {
						leads_faction = faction_tradition
						in_faction = faction_tradition
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_piety multiplier = 4 months = 14 }
			}
			#Muslim Court Faction disapproves
			any_vassal = {
				limit = {
					religion_group = muslim
					OR = {
						leads_faction = faction_court
						in_faction = faction_court
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_piety multiplier = 2 months = 14 }
			}
			#Muslim Glory Faction disapproves
			any_vassal = {
				limit = {
					religion_group = muslim
					OR = {
						leads_faction = faction_glory
						in_faction = faction_glory
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_piety months = 14 }
			}
		}
		#Liege has 500-999 Piety
		if = {
			limit = {
				piety = 500
				NOT = { piety = 1000 }
			}
			#Tradition Faction approves
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_tradition
						in_faction = faction_tradition
					}
				}
				opinion = { who = ROOT modifier = faction_approve_piety months = 14 }
			}
		}
		#Liege has 1000+ Piety
		if = {
			limit = { piety = 1000 }
			#Tradition Faction approves more
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_tradition
						in_faction = faction_tradition
					}
				}
				opinion = { who = ROOT modifier = faction_approve_piety multiplier = 2 months = 14 }
			}
		}
		#Liege is in a crusade or holy war
		if = {
			limit = {
				any_war = {
					OR = {
						using_cb = crusade
						using_cb = religious
					}
					any_attacker = { character = ROOT }
				}
			}
			#Tradition Faction approves more
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_tradition
						in_faction = faction_tradition
					}
				}
				opinion = { who = ROOT modifier = faction_approve_piety multiplier = 2 months = 14 }
			}
		}

		#LIEGE DEBT/WEALTH
		any_vassal = {
			remove_opinion = { who = ROOT modifier = faction_disapprove_debt }
			remove_opinion = { who = ROOT modifier = faction_approve_wealth }
		}
		#Liege has negative wealth or is in debt
		if = {
			limit = {
				OR = {
					NOT = { wealth = 0 }
					has_character_modifier = small_loan
					has_character_modifier = medium_loan
				}
			}
			#Prosperity faction disapproves
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_prosperity
						in_faction = faction_prosperity
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_debt multiplier = 2 months = 14 }
			}
		}
		#Liege is in debt
		if = {
			limit = {
				has_character_modifier = small_loan
			}
			#Prosperity faction disapproves
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_prosperity
						in_faction = faction_prosperity
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_debt months = 14 }
			}
		}
		#Liege is moderately in debt
		if = {
			limit = {
				has_character_modifier = medium_loan
			}
			#Prosperity faction disapproves
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_prosperity
						in_faction = faction_prosperity
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_debt multiplier = 2 months = 14 }
			}
		}
		#Liege is very in debt
		if = {
			limit = {
				has_character_modifier = large_loan
			}
			#Prosperity faction disapproves
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_prosperity
						in_faction = faction_prosperity
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_debt multiplier = 3 months = 14 }
			}
		}
		#Liege has positive wealth, but is massively in debt
		if = {
			limit = {
				has_character_modifier = huge_loan
			}
			#Prosperity faction disapproves
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_prosperity
						in_faction = faction_prosperity
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_debt multiplier = 4 months = 14 }
			}
		}
		#Liege has 2.5-4.9 scaled wealth, and no loan
		if = {
			limit = {
				scaled_wealth = 2.5
				NOT = { scaled_wealth = 5.0 }
				NOR = {
					has_character_modifier = small_loan
					has_character_modifier = medium_loan
					has_character_modifier = large_loan
					has_character_modifier = huge_loan
					has_character_modifier = borrowed_from_knights_templar
					has_character_modifier = borrowed_from_assassins
					has_character_modifier = borrowed_from_bektashi
					has_character_modifier = borrowed_from_haruriyyah
				}
			}
			#Prosperity faction approves
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_prosperity
						in_faction = faction_prosperity
					}
				}
				opinion = { who = ROOT modifier = faction_approve_wealth months = 14 }
			}
		}
		#Liege has 5.0+ scaled wealth, and no loan
		if = {
			limit = {
				scaled_wealth = 5.0
				NOR = {
					has_character_modifier = small_loan
					has_character_modifier = medium_loan
					has_character_modifier = large_loan
					has_character_modifier = huge_loan
					has_character_modifier = borrowed_from_knights_templar
					has_character_modifier = borrowed_from_assassins
					has_character_modifier = borrowed_from_bektashi
					has_character_modifier = borrowed_from_haruriyyah
				}
			}
			#Prosperity faction approves more
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_prosperity
						in_faction = faction_prosperity
					}
				}
				opinion = { who = ROOT modifier = faction_approve_wealth multiplier = 2 months = 14 }
			}
		}

		#LIEGE PRESTIGE
		any_vassal = {
			remove_opinion = { who = ROOT modifier = faction_approve_prestige }
			remove_opinion = { who = ROOT modifier = faction_disapprove_prestige }
		}
		#Liege has negative prestige
		if = {
			limit = { NOT = { prestige = 0 } }
			#Glory Faction disapproves
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_glory
						in_faction = faction_glory
					}
				}
				opinion = { who = ROOT modifier = faction_disapprove_prestige multiplier = 2 months = 14 }
			}
		}
		#Liege has 1000-2499 Prestige
		if = {
			limit = {
				prestige = 1000
				NOT = { prestige = 2500 }
			}
			#Glory Faction approves
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_glory
						in_faction = faction_glory
					}
				}
				opinion = { who = ROOT modifier = faction_approve_prestige months = 14 }
			}
		}
		#Liege has 2500 Prestige+
		if = {
			limit = {
				prestige = 2500
			}
			#Glory Faction approves more
			any_vassal = {
				limit = {
					OR = {
						leads_faction = faction_glory
						in_faction = faction_glory
					}
				}
				opinion = { who = ROOT modifier = faction_approve_prestige multiplier = 2 months = 14 }
			}
		}

		# #YEARS OF PEACE
		# any_vassal = {
			# remove_opinion = { who = ROOT modifier = faction_approve_peace }
			# remove_opinion = { who = ROOT modifier = faction_disapprove_peace }
		# }
		# #5-9 years of consecutive peace
		# if = {
			# limit = {
				# check_variable = { which = "years_of_peace" value = 5 }
				# NOT = { check_variable = { which = "years_of_peace" value = 10 } }
			# }
			# #Prosperity Faction approves
			# any_vassal = {
				# limit = {
					# OR = {
						# leads_faction = faction_prosperity
						# in_faction = faction_prosperity
					# }
				# }
				# opinion = { who = ROOT modifier = faction_approve_peace months = 14 }
			# }
			# #Glory Faction disapproves
			# any_vassal = {
				# limit = {
					# OR = {
						# leads_faction = faction_glory
						# in_faction = faction_glory
					# }
				# }
				# opinion = { who = ROOT modifier = faction_disapprove_peace months = 14 }
			# }
		# }
		# #10-19 years of consecutive peace
		# if = {
			# limit = {
				# check_variable = { which = "years_of_peace" value = 10 }
				# NOT = { check_variable = { which = "years_of_peace" value = 20 } }
			# }
			# #Prosperity Faction approves more
			# any_vassal = {
				# limit = {
					# OR = {
						# leads_faction = faction_prosperity
						# in_faction = faction_prosperity
					# }
				# }
				# opinion = { who = ROOT modifier = faction_approve_peace multiplier = 2 months = 14 }
			# }
			# #Glory Faction disapproves more
			# any_vassal = {
				# limit = {
					# OR = {
						# leads_faction = faction_glory
						# in_faction = faction_glory
					# }
				# }
				# opinion = { who = ROOT modifier = faction_disapprove_peace multiplier = 2 months = 14 }
			# }
		# }
		# #20+ years of consecutive peace
		# if = {
			# limit = {
				# check_variable = { which = "years_of_peace" value = 20 }
			# }
			# #Prosperity Faction REALLY approves
			# any_vassal = {
				# limit = {
					# OR = {
						# leads_faction = faction_prosperity
						# in_faction = faction_prosperity
					# }
				# }
				# opinion = { who = ROOT modifier = faction_approve_peace multiplier = 4 months = 14 }
			# }
			# #Glory Faction REALLY disapproves
			# any_vassal = {
				# limit = {
					# OR = {
						# leads_faction = faction_glory
						# in_faction = faction_glory
					# }
				# }
				# opinion = { who = ROOT modifier = faction_disapprove_peace multiplier = 4 months = 14 }
			# }
		# }

		#Adjust moods of factions towards their own leaders, based on agreement over opinion of liege
		any_vassal = {
			limit = {
				OR = {
					leads_faction = faction_court
					leads_faction = faction_prosperity
					leads_faction = faction_glory
					leads_faction = faction_tradition
				}
			}
			#First remove the old agree/disagree modifiers for all the liege's vassals
			ROOT = {
				any_vassal = {
					remove_opinion = { who = PREVPREV modifier = faction_agree_liege }
					remove_opinion = { who = PREVPREV modifier = faction_disagree_liege }
				}
			}
			#Then check the faction leader's opinion range of the liege
			#and look at all fellow faction members, and see if they sit in the same range or not
			#the more extreme the difference, the larger the disapproval of the faction leader
			if = {
				limit = {
					NOT = { opinion = { who = ROOT value = -75 } }
				}
				ROOT = {
					any_vassal = {
						limit = {
							OR = {
								AND = {
									in_faction = faction_court
									PREVPREV = { leads_faction = faction_court }
								}
								AND = {
									in_faction = faction_prosperity
									PREVPREV = { leads_faction = faction_prosperity }
								}
								AND = {
									in_faction = faction_glory
									PREVPREV = { leads_faction = faction_glory }
								}
								AND = {
									in_faction = faction_tradition
									PREVPREV = { leads_faction = faction_tradition }
								}
							}
						}
						if = {
							limit = {
								NOT = { opinion = { who = ROOT value = -75 } }
							}
							opinion = { who = PREVPREV modifier = faction_agree_liege months = 14 }
						}
						if = {
							limit = {
								opinion = { who = ROOT value = -25 }
								NOT = { opinion = { who = ROOT value = 25 } }
							}
							opinion = { who = PREVPREV modifier = faction_disagree_liege months = 14 }
						}
						if = {
							limit = {
								opinion = { who = ROOT value = 25 }
								NOT = { opinion = { who = ROOT value = 75 } }
							}
							opinion = { who = PREVPREV modifier = faction_disagree_liege multiplier = 2 months = 14 }
						}
						if = {
							limit = {
								opinion = { who = ROOT value = 75 }
							}
							opinion = { who = PREVPREV modifier = faction_disagree_liege multiplier = 3 months = 14 }
						}
					}
				}
			}
			if = {
				limit = {
					opinion = { who = ROOT value = -75 }
					NOT = { opinion = { who = ROOT value = -25 } }
				}
				ROOT = {
					any_vassal = {
						limit = {
							OR = {
								AND = {
									in_faction = faction_court
									PREVPREV = { leads_faction = faction_court }
								}
								AND = {
									in_faction = faction_prosperity
									PREVPREV = { leads_faction = faction_prosperity }
								}
								AND = {
									in_faction = faction_glory
									PREVPREV = { leads_faction = faction_glory }
								}
								AND = {
									in_faction = faction_tradition
									PREVPREV = { leads_faction = faction_tradition }
								}
							}
						}
						if = {
							limit = {
								opinion = { who = ROOT value = -75 }
								NOT = { opinion = { who = ROOT value = -25 } }
							}
							opinion = { who = PREVPREV modifier = faction_agree_liege months = 14 }
						}
						if = {
							limit = {
								opinion = { who = ROOT value = 25 }
								NOT = { opinion = { who = ROOT value = 75 } }
							}
							opinion = { who = PREVPREV modifier = faction_disagree_liege months = 14 }
						}
						if = {
							limit = {
								opinion = { who = ROOT value = 75 }
							}
							opinion = { who = PREVPREV modifier = faction_disagree_liege multiplier = 2 months = 14 }
						}
					}
				}
			}
			if = {
				limit = {
					opinion = { who = ROOT value = -25 }
					NOT = { opinion = { who = ROOT value = 25 } }
				}
				ROOT = {
					any_vassal = {
						limit = {
							OR = {
								AND = {
									in_faction = faction_court
									PREVPREV = { leads_faction = faction_court }
								}
								AND = {
									in_faction = faction_prosperity
									PREVPREV = { leads_faction = faction_prosperity }
								}
								AND = {
									in_faction = faction_glory
									PREVPREV = { leads_faction = faction_glory }
								}
								AND = {
									in_faction = faction_tradition
									PREVPREV = { leads_faction = faction_tradition }
								}
							}
						}
						if = {
							limit = {
								NOT = { opinion = { who = ROOT value = -75 } }
							}
							opinion = { who = PREVPREV modifier = faction_disagree_liege months = 14 }
						}
						if = {
							limit = {
								opinion = { who = ROOT value = -25 }
								NOT = { opinion = { who = ROOT value = 25 } }
							}
							opinion = { who = PREVPREV modifier = faction_agree_liege months = 14 }
						}
						if = {
							limit = {
								opinion = { who = ROOT value = 75 }
							}
							opinion = { who = PREVPREV modifier = faction_disagree_liege months = 14 }
						}
					}
				}
			}
			if = {
				limit = {
					opinion = { who = ROOT value = 25 }
					NOT = { opinion = { who = ROOT value = 75 } }
				}
				ROOT = {
					any_vassal = {
						limit = {
							OR = {
								AND = {
									in_faction = faction_court
									PREVPREV = { leads_faction = faction_court }
								}
								AND = {
									in_faction = faction_prosperity
									PREVPREV = { leads_faction = faction_prosperity }
								}
								AND = {
									in_faction = faction_glory
									PREVPREV = { leads_faction = faction_glory }
								}
								AND = {
									in_faction = faction_tradition
									PREVPREV = { leads_faction = faction_tradition }
								}
							}
						}
						if = {
							limit = {
								NOT = { opinion = { who = ROOT value = -75 } }
							}
							opinion = { who = PREVPREV modifier = faction_disagree_liege multiplier = 2 months = 14 }
						}
						if = {
							limit = {
								opinion = { who = ROOT value = -75 }
								NOT = { opinion = { who = ROOT value = -25 } }
							}
							opinion = { who = PREVPREV modifier = faction_disagree_liege months = 14 }
						}
						if = {
							limit = {
								opinion = { who = ROOT value = 25 }
								NOT = { opinion = { who = ROOT value = 75 } }
							}
							opinion = { who = PREVPREV modifier = faction_agree_liege months = 14 }
						}
					}
				}
			}
			if = {
				limit = {
					opinion = { who = ROOT value = 75 }
				}
				ROOT = {
					any_vassal = {
						limit = {
							OR = {
								AND = {
									in_faction = faction_court
									PREVPREV = { leads_faction = faction_court }
								}
								AND = {
									in_faction = faction_prosperity
									PREVPREV = { leads_faction = faction_prosperity }
								}
								AND = {
									in_faction = faction_glory
									PREVPREV = { leads_faction = faction_glory }
								}
								AND = {
									in_faction = faction_tradition
									PREVPREV = { leads_faction = faction_tradition }
								}
							}
						}
						if = {
							limit = {
								NOT = { opinion = { who = ROOT value = -75 } }
							}
							opinion = { who = PREVPREV modifier = faction_disagree_liege multiplier = 3 months = 14 }
						}
						if = {
							limit = {
								opinion = { who = ROOT value = -75 }
								NOT = { opinion = { who = ROOT value = -25 } }
							}
							opinion = { who = PREVPREV modifier = faction_disagree_liege multiplier = 2 months = 14 }
						}
						if = {
							limit = {
								opinion = { who = ROOT value = -25 }
								NOT = { opinion = { who = ROOT value = 25 } }
							}
							opinion = { who = PREVPREV modifier = faction_disagree_liege months = 14 }
						}
						if = {
							limit = {
								opinion = { who = ROOT value = 75 }
							}
							opinion = { who = PREVPREV modifier = faction_agree_liege months = 14 }
						}
					}
				}
			}
		}
	}
}


# PlusFaction.224 [Liege]
# Faction maintenance completion effects
character_event = {
	id = PlusFaction.224
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		#Now calculate each faction's mood, which is the  average of each faction member's
		#overall opinion of the liege, weighted by the number of votes they have in the faction
		any_vassal = {
			limit = {
				OR = {
					leads_faction = faction_court
					leads_faction = faction_prosperity
					leads_faction = faction_glory
					leads_faction = faction_tradition
					in_faction = faction_court
					in_faction = faction_prosperity
					in_faction = faction_glory
					in_faction = faction_tradition
				}
			}
			#first reset the variable for the individual faction member
			ROOT = { set_variable = { which = "faction_member_approval" value = 0 } }
			#then add a number based on their opinion of the liege (from 1 to 100, 100 being the best)
			if = {
				limit = {
					opinion = { who = ROOT value = 75 }
				}
				ROOT = { change_variable = { which = "faction_member_approval" value = 100 } }
			}
			if = {
				limit = {
					NOT = { opinion = { who = ROOT value = 75 } }
					opinion = { who = ROOT value = 50 }
				}
				ROOT = { change_variable = { which = "faction_member_approval" value = 87.5 } }
			}
			if = {
				limit = {
					NOT = { opinion = { who = ROOT value = 50 } }
					opinion = { who = ROOT value = 25 }
				}
				ROOT = { change_variable = { which = "faction_member_approval" value = 75 } }
			}
			if = {
				limit = {
					NOT = { opinion = { who = ROOT value = 25 } }
					opinion = { who = ROOT value = 0 }
				}
				ROOT = { change_variable = { which = "faction_member_approval" value = 62.5 } }
			}
			if = {
				limit = {
					NOT = { opinion = { who = ROOT value = 0 } }
					opinion = { who = ROOT value = -25 }
				}
				ROOT = { change_variable = { which = "faction_member_approval" value = 50 } }
			}
			if = {
				limit = {
					NOT = { opinion = { who = ROOT value = -25 } }
					opinion = { who = ROOT value = -50 }
				}
				ROOT = { change_variable = { which = "faction_member_approval" value = 37.5 } }
			}
			if = {
				limit = {
					NOT = { opinion = { who = ROOT value = -50 } }
					opinion = { who = ROOT value = -75 }
				}
				ROOT = { change_variable = { which = "faction_member_approval" value = 25 } }
			}
			if = {
				limit = {
					NOT = { opinion = { who = ROOT value = -75 } }
					opinion = { who = ROOT value = -99 }
				}
				ROOT = { change_variable = { which = "faction_member_approval" value = 12.5 } }
			}
			if = {
				limit = {
					NOT = { opinion = { who = ROOT value = -99 } }
				}
				ROOT = { change_variable = { which = "faction_member_approval" value = 1 } }
			}
			#then multiply that number by the number of votes they have in the faction
			if = {
				limit = { real_tier = COUNT }
				ROOT = { multiply_variable = { which = "faction_member_approval" value = 2 } }
			}
			if = {
				limit = { real_tier = DUKE }
				ROOT = { multiply_variable = { which = "faction_member_approval" value = 4 } }
			}
			if = {
				limit = { real_tier = KING }
				ROOT = { multiply_variable = { which = "faction_member_approval" value = 8 } }
			}
			#then divide by the total number of votes in the faction and add that to the liege's mood variable
			if = {
				limit = {
					OR = {
						leads_faction = faction_court
						in_faction = faction_court
					}
				}
				ROOT = {
					divide_variable = { which = "faction_member_approval" which = "faction_votes_court" }
					change_variable = { which = "faction_mood_court" which = "faction_member_approval" }
				}
			}
			if = {
				limit = {
					OR = {
						leads_faction = faction_prosperity
						in_faction = faction_prosperity
					}
				}
				ROOT = {
					divide_variable = { which = "faction_member_approval" which = "faction_votes_prosperity" }
					change_variable = { which = "faction_mood_prosperity" which = "faction_member_approval" }
				}
			}
			if = {
				limit = {
					OR = {
						leads_faction = faction_glory
						in_faction = faction_glory
					}
				}
				ROOT = {
					divide_variable = { which = "faction_member_approval" which = "faction_votes_glory" }
					change_variable = { which = "faction_mood_glory" which = "faction_member_approval" }
				}
			}
			if = {
				limit = {
					OR = {
						leads_faction = faction_tradition
						in_faction = faction_tradition
					}
				}
				ROOT = {
					divide_variable = { which = "faction_member_approval" which = "faction_votes_tradition" }
					change_variable = { which = "faction_mood_tradition" which = "faction_member_approval" }
				}
			}
		}
		#Now determine the overall mood category of the faction and set the flag if it's different than before
		#and notify the liege if it's actually changed (and only then, to avoid spam)
		if = {
			limit = {
				any_vassal = {
					OR = {
						leads_faction = faction_court
						in_faction = faction_court
					}
				}
			}
			if = {
				limit = {
					check_variable = { which = "faction_mood_court" value = 75 }
					NOT = { has_character_flag = faction_court_happy }
				}
				set_character_flag = faction_court_happy
				clr_character_flag = faction_court_unhappy
				clr_character_flag = faction_court_angry
				character_event = { id = PlusFaction.201 days = 1 }
				any_vassal = {
					limit = {
						OR = {
							leads_faction = faction_court
							in_faction = faction_court
						}
					}
					character_event = { id = PlusFaction.201 days = 1 }
				}
			}
			if = {
				limit = {
					NOT = { check_variable = { which = "faction_mood_court" value = 75 } }
					check_variable = { which = "faction_mood_court" value = 50 }
					OR = {
						has_character_flag = faction_court_happy
						has_character_flag = faction_court_unhappy
						has_character_flag = faction_court_angry
					}	
				}
				clr_character_flag = faction_court_happy
				clr_character_flag = faction_court_unhappy
				clr_character_flag = faction_court_angry
				character_event = { id = PlusFaction.201 days = 1 }
				any_vassal = {
					limit = {
						OR = {
							leads_faction = faction_court
							in_faction = faction_court
						}
					}
					character_event = { id = PlusFaction.201 days = 1 }
				}
			}				
			if = {
				limit = {
					check_variable = { which = "faction_mood_court" value = 37.5 }
					NOT = { check_variable = { which = "faction_mood_court" value = 50 } }
					NOT = { has_character_flag = faction_court_unhappy }
				}
				set_character_flag = faction_court_unhappy
				clr_character_flag = faction_court_happy
				clr_character_flag = faction_court_angry
				character_event = { id = PlusFaction.201 days = 1 }
				any_vassal = {
					limit = {
						OR = {
							leads_faction = faction_court
							in_faction = faction_court
						}
					}
					character_event = { id = PlusFaction.201 days = 1 }
				}
			}
			if = {
				limit = {
					NOT = { check_variable = { which = "faction_mood_court" value = 37.5 } }
					NOT = { has_character_flag = faction_court_angry }
				}
				set_character_flag = faction_court_angry
				clr_character_flag = faction_court_unhappy
				clr_character_flag = faction_court_happy
				character_event = { id = PlusFaction.201 days = 1 }
				any_vassal = {
					limit = {
						OR = {
							leads_faction = faction_court
							in_faction = faction_court
						}
					}
					character_event = { id = PlusFaction.201 days = 1 }
				}
			}
		}
		if = {
			limit = {
				any_vassal = {
					OR = {
						leads_faction = faction_prosperity
						in_faction = faction_prosperity
					}
				}
			}
			if = {
				limit = {
					check_variable = { which = "faction_mood_prosperity" value = 75 }
					NOT = { has_character_flag = faction_prosperity_happy }
				}
				set_character_flag = faction_prosperity_happy
				clr_character_flag = faction_prosperity_unhappy
				clr_character_flag = faction_prosperity_angry
				character_event = { id = PlusFaction.202 days = 1 }
				any_vassal = {
					limit = {
						OR = {
							leads_faction = faction_prosperity
							in_faction = faction_prosperity
						}
					}
					character_event = { id = PlusFaction.202 days = 1 }
				}
			}
			if = {
				limit = {
					NOT = { check_variable = { which = "faction_mood_prosperity" value = 75 } }
					check_variable = { which = "faction_mood_prosperity" value = 50 }
					OR = {
						has_character_flag = faction_prosperity_happy
						has_character_flag = faction_prosperity_unhappy
						has_character_flag = faction_prosperity_angry
					}	
				}
				clr_character_flag = faction_prosperity_happy
				clr_character_flag = faction_prosperity_unhappy
				clr_character_flag = faction_prosperity_angry
				character_event = { id = PlusFaction.202 days = 1 }
				any_vassal = {
					limit = {
						OR = {
							leads_faction = faction_prosperity
							in_faction = faction_prosperity
						}
					}
					character_event = { id = PlusFaction.202 days = 1 }
				}
			}
			if = {
				limit = {
					check_variable = { which = "faction_mood_prosperity" value = 37.5 }
					NOT = { check_variable = { which = "faction_mood_prosperity" value = 50 } }
					NOT = { has_character_flag = faction_prosperity_unhappy }
				}
				set_character_flag = faction_prosperity_unhappy
				clr_character_flag = faction_prosperity_happy
				clr_character_flag = faction_prosperity_angry
				character_event = { id = PlusFaction.202 days = 1 }
				any_vassal = {
					limit = {
						OR = {
							leads_faction = faction_prosperity
							in_faction = faction_prosperity
						}
					}
					character_event = { id = PlusFaction.202 days = 1 }
				}
			}
			if = {
				limit = {
					NOT = { check_variable = { which = "faction_mood_prosperity" value = 37.5 } }
					NOT = { has_character_flag = faction_prosperity_angry }
				}
				set_character_flag = faction_prosperity_angry
				clr_character_flag = faction_prosperity_unhappy
				clr_character_flag = faction_prosperity_happy
				character_event = { id = PlusFaction.202 days = 1 }
				any_vassal = {
					limit = {
						OR = {
							leads_faction = faction_prosperity
							in_faction = faction_prosperity
						}
					}
					character_event = { id = PlusFaction.202 days = 1 }
				}
			}
		}
		if = {
			limit = {
				any_vassal = {
					OR = {
						leads_faction = faction_glory
						in_faction = faction_glory
					}
				}
			}
			if = {
				limit = {
					check_variable = { which = "faction_mood_glory" value = 75 }
					NOT = { has_character_flag = faction_glory_happy }
				}
				set_character_flag = faction_glory_happy
				clr_character_flag = faction_glory_unhappy
				clr_character_flag = faction_glory_angry
				character_event = { id = PlusFaction.203 days = 1 }
				any_vassal = {
					limit = {
						OR = {
							leads_faction = faction_glory
							in_faction = faction_glory
						}
					}
					character_event = { id = PlusFaction.203 days = 1 }
				}
			}
			if = {
				limit = {
					NOT = { check_variable = { which = "faction_mood_glory" value = 75 } }
					check_variable = { which = "faction_mood_glory" value = 50 }
					OR = {
						has_character_flag = faction_glory_happy
						has_character_flag = faction_glory_unhappy
						has_character_flag = faction_glory_angry
					}	
				}
				clr_character_flag = faction_glory_happy
				clr_character_flag = faction_glory_unhappy
				clr_character_flag = faction_glory_angry
				character_event = { id = PlusFaction.203 days = 1 }
				any_vassal = {
					limit = {
						OR = {
							leads_faction = faction_glory
							in_faction = faction_glory
						}
					}
					character_event = { id = PlusFaction.203 days = 1 }
				}
			}
			if = {
				limit = {
					check_variable = { which = "faction_mood_glory" value = 37.5 }
					NOT = { check_variable = { which = "faction_mood_glory" value = 50 } }
					NOT = { has_character_flag = faction_glory_unhappy }
				}
				set_character_flag = faction_glory_unhappy
				clr_character_flag = faction_glory_happy
				clr_character_flag = faction_glory_angry
				character_event = { id = PlusFaction.203 days = 1 }
				any_vassal = {
					limit = {
						OR = {
							leads_faction = faction_glory
							in_faction = faction_glory
						}
					}
					character_event = { id = PlusFaction.203 days = 1 }
				}
			}
			if = {
				limit = {
					NOT = { check_variable = { which = "faction_mood_glory" value = 37.5 } }
					NOT = { has_character_flag = faction_glory_angry }
				}
				set_character_flag = faction_glory_angry
				clr_character_flag = faction_glory_unhappy
				clr_character_flag = faction_glory_happy
				character_event = { id = PlusFaction.203 days = 1 }
				any_vassal = {
					limit = {
						OR = {
							leads_faction = faction_glory
							in_faction = faction_glory
						}
					}
					character_event = { id = PlusFaction.203 days = 1 }
				}
			}
		}
		if = {
			limit = {
				any_vassal = {
					OR = {
						leads_faction = faction_tradition
						in_faction = faction_tradition
					}
				}
			}
			if = {
				limit = {
					check_variable = { which = "faction_mood_tradition" value = 75 }
					NOT = { has_character_flag = faction_tradition_happy }
				}
				set_character_flag = faction_tradition_happy
				clr_character_flag = faction_tradition_unhappy
				clr_character_flag = faction_tradition_angry
				character_event = { id = PlusFaction.204 days = 1 }
				any_vassal = {
					limit = {
						OR = {
							leads_faction = faction_tradition
							in_faction = faction_tradition
						}
					}
					character_event = { id = PlusFaction.204 days = 1 }
				}
			}
			if = {
				limit = {
					NOT = { check_variable = { which = "faction_mood_tradition" value = 75 } }
					check_variable = { which = "faction_mood_tradition" value = 50 }
					OR = {
						has_character_flag = faction_tradition_happy
						has_character_flag = faction_tradition_unhappy
						has_character_flag = faction_tradition_angry
					}	
				}
				clr_character_flag = faction_tradition_happy
				clr_character_flag = faction_tradition_unhappy
				clr_character_flag = faction_tradition_angry
				character_event = { id = PlusFaction.204 days = 1 }
				any_vassal = {
					limit = {
						OR = {
							leads_faction = faction_tradition
							in_faction = faction_tradition
						}
					}
					character_event = { id = PlusFaction.204 days = 1 }
				}
			}
			if = {
				limit = {
					check_variable = { which = "faction_mood_tradition" value = 37.5 }
					NOT = { check_variable = { which = "faction_mood_tradition" value = 50 } }
					NOT = { has_character_flag = faction_tradition_unhappy }
				}
				set_character_flag = faction_tradition_unhappy
				clr_character_flag = faction_tradition_happy
				clr_character_flag = faction_tradition_angry
				character_event = { id = PlusFaction.204 days = 1 }
				any_vassal = {
					limit = {
						OR = {
							leads_faction = faction_tradition
							in_faction = faction_tradition
						}
					}
					character_event = { id = PlusFaction.204 days = 1 }
				}
			}
			if = {
				limit = {
					NOT = { check_variable = { which = "faction_mood_tradition" value = 37.5 } }
					NOT = { has_character_flag = faction_tradition_angry }
				}
				set_character_flag = faction_tradition_angry
				clr_character_flag = faction_tradition_unhappy
				clr_character_flag = faction_tradition_happy
				character_event = { id = PlusFaction.204 days = 1 }
				any_vassal = {
					limit = {
						OR = {
							leads_faction = faction_tradition
							in_faction = faction_tradition
						}
					}
					character_event = { id = PlusFaction.204 days = 1 }
				}
			}
		}
	}
}
