
emf_laws_change_succ_prestige_cost_effect = {
	if = {
		limit = { tier = BARON }
		holder_scope = { prestige = -125 }
	}
	if = {
		limit = { tier = COUNT }
		holder_scope = { prestige = -250 }
	}
	if = {
		limit = { tier = DUKE }
		holder_scope = { prestige = -500 }
	}
	if = {
		limit = { tier = KING }
		holder_scope = { prestige = -750 }
	}
	if = {
		limit = { tier = EMPEROR }
		holder_scope = { prestige = -1000 }
	}
}

emf_laws_change_succ_effect = {
	emf_laws_change_succ_prestige_cost_effect = yes
	holder_scope = {
		pf_tradition_minus2_effect = yes
	}
	pf_save_old_succ_law_effect = yes
}


emf_laws_change_succ_save_contenders_effect = {
	holder_scope = {
		event_target:emf_succ_title = {
			current_heir = {
				reverse_opinion = { who = PREVPREV modifier = opinion_succ_former_heir }
				save_event_target_as = emf_former_heir
			}
		}
		any_character = {
			limit = {
				NOT = { character = event_target:emf_former_heir }
				any_pretender_title = { title = event_target:emf_succ_title }
			}
			reverse_opinion = { who = PREV modifier = opinion_succ_former_pretender }
		}
	}
}


emf_laws_change_succ_clr_reaction_flags_effect = {
	clr_character_flag = emf_bad2_succ_change_reaction
	clr_character_flag = emf_bad_succ_change_reaction
	clr_character_flag = emf_succ_change_reaction
	clr_character_flag = emf_good_succ_change_reaction
}

# Remove any succ_change opinions that we've added as part of this particular law change reaction
emf_laws_change_succ_reset_reaction_effect = {
	hidden_tooltip = {
		if = {
			limit = { has_character_flag = emf_succ_change_reaction }
			remove_opinion = { who = event_target:emf_succ_changer modifier = opinion_succ_law_change }
		}
		if = {
			limit = { has_character_flag = emf_good_succ_change_reaction }
			remove_opinion = { who = event_target:emf_succ_changer modifier = opinion_good_succ_law_change }
		}
		if = {
			limit = { has_character_flag = emf_bad_succ_change_reaction }
			remove_opinion = { who = event_target:emf_succ_changer modifier = opinion_bad_succ_law_change }
		}
		if = {
			limit = { has_character_flag = emf_bad2_succ_change_reaction }
			remove_opinion = { who = event_target:emf_succ_changer modifier = opinion_bad_succ_law_change }
			remove_opinion = { who = event_target:emf_succ_changer modifier = opinion_bad_succ_law_change }
		}
		emf_laws_change_succ_clr_reaction_flags_effect = yes
	}
}

emf_laws_change_succ_terrible_reaction_effect = {
	emf_laws_change_succ_reset_reaction_effect = yes
	set_character_flag = emf_bad2_succ_change_reaction
	opinion = { who = event_target:emf_succ_changer modifier = opinion_bad_succ_law_change multiplier = 2 }
}

emf_laws_change_succ_bad_reaction_effect = {
	emf_laws_change_succ_reset_reaction_effect = yes
	set_character_flag = emf_bad_succ_change_reaction
	opinion = { who = event_target:emf_succ_changer modifier = opinion_bad_succ_law_change }
}

emf_laws_change_succ_mild_reaction_effect = {
	emf_laws_change_succ_reset_reaction_effect = yes
	set_character_flag = emf_succ_change_reaction
	opinion = { who = event_target:emf_succ_changer modifier = opinion_succ_law_change }
}

emf_laws_change_succ_good_reaction_effect = {
	emf_laws_change_succ_reset_reaction_effect = yes
	set_character_flag = emf_good_succ_change_reaction
	opinion = { who = event_target:emf_succ_changer modifier = opinion_good_succ_law_change }
}

emf_laws_change_succ_cleanup_effect = {
	# Cleanup former heir & former pretender temporary TOMs...
	remove_opinion = { who = event_target:emf_former_heir modifier = opinion_succ_former_heir }
	any_opinion_modifier_target = {
		limit = { reverse_has_opinion_modifier = { who = PREV modifier = opinion_succ_former_pretender } }
		reverse_remove_opinion = { who = PREV modifier = opinion_succ_former_pretender }
	}

	# Unmark title...
	event_target:emf_succ_title = { clr_title_flag = emf_succ_title }

	# Clear our event targets...
	clear_event_target = emf_succ_title
	clear_event_target = emf_succ_changer
	clear_event_target = emf_former_heir
	clear_event_target = emf_heir

	# Cleanup reaction flags for this law change...
	# Could optimize this in the future by changing these scripted triggers/effects for reactions to use temporary TOMs
	# and thus any_opinion_modifier_target instead of literally sweeping all characters in the game.
	any_character = {
		emf_laws_change_succ_clr_reaction_flags_effect = yes
	}
}
