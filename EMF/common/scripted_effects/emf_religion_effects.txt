# -*- ck2.scripted_effects -*-

emf_ai_wrong_religion_liege_decision_effect = {
	# First try to transfer to a higher-tier liege that matches our religion:
	if = {
		limit = { top_liege = { religion = PREV } } # Note that liege of liege of a duke is an emperor
		if = {
			limit = { num_of_count_titles_in_realm > 0 }
			reverse_opinion = { who = LIEGE modifier = opinion_rightful_subjugation }
		}
		top_liege = { set_defacto_vassal = PREV }
		set_flag = ai_flag_never_transfer
	}
	# Otherwise, go independent
	else = {
		if = {
			limit = { num_of_count_titles_in_realm > 0 }
			top_liege = { opinion = { who = PREV modifier = opinion_rightful_subjugation } }
		}
		set_defacto_liege = THIS
	}
	emf_liege_change = yes
}


emf_fix_wrong_religion_lieges_in_realm = {
	any_realm_lord = {
		limit = {
			emf_ai_has_wrong_religion_liege = yes
		}
		emf_ai_wrong_religion_liege_decision_effect = yes
	}
}
