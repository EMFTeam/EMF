# -*- ck2.scripted_effects -*-

emf_activate_randomized_relhead_title = {
	if = {
		limit = { NOT = { is_title_active = event_target:emf_rel_title } }
		activate_title = { title = event_target:emf_rel_title status = yes }
		# Try to find an appropriate holder culture instead of the vanilla culture = random
		random_province = {
			limit = {
				religion_group = event_target:emf_rel
			}
			preferred_limit = {
				religion = event_target:emf_rel
			}
			save_event_target_as = emf_cul
		}
		if = {
			limit = { NOT = { event_target:emf_cul = { always = yes } } }
			random_character = {
				limit = {
					religion_group = event_target:emf_rel
				}
				preferred_limit = {
					is_landed = yes
					religion = event_target:emf_rel
				}
				preferred_limit = {
					religion = event_target:emf_rel
				}
				preferred_limit = {
					is_landed = yes
				}
				save_event_target_as = emf_cul
			}
		}
		if = {
			limit = { NOT = { event_target:emf_cul = { always = yes } } }
			swedish = { save_event_target_as = emf_cul } # If in doubt, Swede that shit.
		}
		create_character = {
			random_traits = yes
			religion = event_target:emf_rel
			culture = event_target:emf_cul
			dynasty = none
			female = no
			age = 34
		}
		new_character = {
			clear_education_trait = yes
			random_list = {
				1 = { add_trait = mastermind_theologian }
				2 = { add_trait = scholarly_theologian }
			}
			random_list = {
				1 = { add_age = 1 }
				1 = { add_age = 2 }
				1 = { add_age = 3 }
				2 = { add_age = 5 }
				2 = { add_age = 7 }
				2 = { add_age = 9 }
				2 = { add_age = 12 }
				2 = { add_age = 15 }
			}
			emf_new_character = yes
			grant_title = event_target:emf_rel_title
			set_government_type = theocracy_government
		}
	}
	clear_event_target = emf_cul
	clear_event_target = emf_rel
	clear_event_target = emf_rel_title
}
