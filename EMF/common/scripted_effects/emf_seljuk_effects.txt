# -*- ck2.scripted_effects -*-

emf_seljuk_spawn_initial_unit = {
    spawn_unit = {
        province = PREV
        home = PREV
        owner = THIS
        troops = {
            light_infantry = { 2250 2250 }
            light_cavalry = { 2000 2000 }
            horse_archers = { 1500 1500 }
            knights = { 50 50 }
        }
        attrition = 0.25
        maintenance_multiplier = 0
        earmark = emf_seljuk_event_troops
    }
}

emf_seljuk_spawn_reinforcement_unit = {
    spawn_unit = {
        province = PREV
        home = PREV
        owner = THIS
        troops = {
            light_infantry = { 2250 2250 }
            light_cavalry = { 2000 2000 }
            horse_archers = { 1500 1500 }
            knights = { 50 50 }
        }
        attrition = 0.25
        maintenance_multiplier = 0
        earmark = emf_seljuk_event_troops
    }
}

emf_seljuk_spawn_adventure_unit = {
    spawn_unit = {
        province = PREV
        home = PREV
        owner = THIS
        match_character = event_target:seljuk_target_ruler
        match_mult = 0.4
        match_min = 500
        match_max = 10000
        attrition = 0.25
        disband_on_peace = yes
        earmark = emf_seljuk_adventure
    }
}

emf_seljuk_spawn_reinforcements = {
    set_character_flag = emf_seljuk_reinforcements
    piety = 250
    capital_scope = {
        ROOT = {
            emf_seljuk_spawn_reinforcement_unit = yes
            emf_seljuk_spawn_reinforcement_unit = yes
            emf_seljuk_spawn_reinforcement_unit = yes
            emf_seljuk_spawn_reinforcement_unit = yes
            if = {
                limit = { martial > 8 }
                emf_seljuk_spawn_reinforcement_unit = yes
            }
            if = {
                limit = { martial > 10 }
                emf_seljuk_spawn_reinforcement_unit = yes
            }
            if = {
                limit = { martial > 12 }
                emf_seljuk_spawn_reinforcement_unit = yes
            }
            if = {
                limit = { martial > 14 }
                emf_seljuk_spawn_reinforcement_unit = yes
            }
        }
    }
}

emf_seljuk_become_invader = {
    emf_seljuk_invader = {
        limit = {
            is_alive = yes
            NOT = { character = ROOT }
        }
        remove_trait = emf_seljuk_invader
    }
    add_trait = emf_seljuk_invader
    set_character_flag = emf_seljuk_invader
}

emf_seljuk_cleanup_potential_invader = {
    if = {
        limit = { is_alive = yes }
        if = {
            limit = {
                prisoner = yes
                host = { ai = yes }
            }
            prisoner = no
        }
        if = {
            limit = { prisoner = no }
            remove_trait = weak
            remove_trait = feeble
            remove_trait = dull
            remove_trait = slow
            remove_trait = imbecile
            remove_trait = incapable
            remove_trait = sick_incapable
            add_trait = ambitious
            while = {
                count = 3
                limit = { martial < 16 }
                emf_promote_education_trait = yes
            }
            while = {
                count = 10
                limit = { martial < 16 }
                change_martial = 1
            }
        }
    }
}

emf_seljuk_target_initial_invasion = {
    random_independent_ruler = {
        limit = {
            NOT = { event_target:seljuk_target_ruler = { always = yes } }
            emf_seljuk_valid_initial_invasion_target_ruler = yes
            c_tus = { owner_under_PREV = yes }
        }
        save_event_target_as = seljuk_target_ruler
        c_tus = { location = { save_event_target_as = seljuk_target_province } }
    }
    random_independent_ruler = {
        limit = {
            NOT = { event_target:seljuk_target_ruler = { always = yes } }
            emf_seljuk_valid_initial_invasion_target_ruler = yes
            c_merv = { owner_under_PREV = yes }
        }
        save_event_target_as = seljuk_target_ruler
        c_merv = { location = { save_event_target_as = seljuk_target_province } }
    }
    random_independent_ruler = {
        limit = {
            NOT = { event_target:seljuk_target_ruler = { always = yes } }
            emf_seljuk_valid_initial_invasion_target_ruler = yes
            c_dihistan = { owner_under_PREV = yes }
        }
        save_event_target_as = seljuk_target_ruler
        c_dihistan = { location = { save_event_target_as = seljuk_target_province } }
    }

    # Select origin
    if = {
        limit = { has_global_flag = SWMH }
        random_province = {
            limit = {
                NOT = { event_target:seljuk_origin = { always = yes } }
                has_owner = yes
                NOT = { owner = { same_realm = event_target:seljuk_target_ruler } }
                culture = oghuz
                NOT = { event_target:seljuk_target_province = { distance = { where = PREV value = 300 } } }
            }
            save_event_target_as = seljuk_origin
        }
        random_province = {
            limit = {
                NOT = { event_target:seljuk_origin = { always = yes } }
                has_owner = yes
                NOT = { owner = { same_realm = event_target:seljuk_target_ruler } }
                culture = oghuz
                NOT = { event_target:seljuk_target_province = { distance = { where = PREV value = 600 } } }
            }
            save_event_target_as = seljuk_origin
        }
        c_buzachi = {
            location = {
                if = {
                    limit = {
                        NOT = { event_target:seljuk_origin = { always = yes } }
                        has_owner = yes
                        NOT = { owner = { same_realm = event_target:seljuk_target_ruler } }
                    }
                    save_event_target_as = seljuk_origin
                }
            }
        }
        random_province = {
            limit = {
                NOT = { event_target:seljuk_origin = { always = yes } }
                has_owner = yes
                NOT = { owner = { same_realm = event_target:seljuk_target_ruler } }
                NOT = { event_target:seljuk_target_province = { distance = { where = PREV value = 300 } } }
            }
            save_event_target_as = seljuk_origin
        }
        random_province = {
            limit = {
                NOT = { event_target:seljuk_origin = { always = yes } }
                has_owner = yes
                NOT = { owner = { same_realm = event_target:seljuk_target_ruler } }
                NOT = { event_target:seljuk_target_province = { distance = { where = PREV value = 600 } } }
            }
            save_event_target_as = seljuk_origin
        }
        random_province = {
            limit = {
                NOT = { event_target:seljuk_origin = { always = yes } }
                has_owner = yes
                NOT = { event_target:seljuk_target_province = { distance = { where = PREV value = 300 } } }
            }
            save_event_target_as = seljuk_origin
        }
    }
    else = {
        random_province = {
            limit = {
                NOT = { event_target:seljuk_origin = { always = yes } }
                has_owner = yes
                NOT = { owner = { same_realm = event_target:seljuk_target_ruler } }
                culture_group = altaic
                NOT = { event_target:seljuk_target_province = { distance = { where = PREV value = 300 } } }
            }
            save_event_target_as = seljuk_origin
        }
        random_province = {
            limit = {
                NOT = { event_target:seljuk_origin = { always = yes } }
                has_owner = yes
                NOT = { owner = { same_realm = event_target:seljuk_target_ruler } }
                culture_group = altaic
                NOT = { event_target:seljuk_target_province = { distance = { where = PREV value = 600 } } }
            }
            save_event_target_as = seljuk_origin
        }
        random_province = {
            limit = {
                NOT = { event_target:seljuk_origin = { always = yes } }
                has_owner = yes
                NOT = { owner = { same_realm = event_target:seljuk_target_ruler } }
                NOT = { event_target:seljuk_target_province = { distance = { where = PREV value = 300 } } }
            }
            save_event_target_as = seljuk_origin
        }
        random_province = {
            limit = {
                NOT = { event_target:seljuk_origin = { always = yes } }
                has_owner = yes
                NOT = { owner = { same_realm = event_target:seljuk_target_ruler } }
                NOT = { event_target:seljuk_target_province = { distance = { where = PREV value = 600 } } }
            }
            save_event_target_as = seljuk_origin
        }
        random_province = {
            limit = {
                NOT = { event_target:seljuk_origin = { always = yes } }
                has_owner = yes
                NOT = { event_target:seljuk_target_province = { distance = { where = PREV value = 300 } } }
            }
            save_event_target_as = seljuk_origin
        }
    }
}
