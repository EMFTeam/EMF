# Faction tags need to start with 'faction_'

# Supported types:
# liege_titles, liege_titles_w_claimant, character

# The succession law factions have hard coded elements to ensure that the correct heir is shown in Plot and 
# Faction interfaces and that AI faction members vote for laws in accordance with the faction goal.
# The valid tags correspond to the law name: faction_succ_seniority, faction_succ_primogeniture, etc.

###############
# FACTIONS
###############

# Court faction: desires more power for vassals
faction_court = {
	type = liege_titles
	
	# Plotter scope
	potential = {
		is_ruler = yes
		is_landed = yes
		independent = no
		is_nomadic = no
		prisoner = no
		is_adult = yes
		NOT = { trait = incapable }
		liege = {
			is_nomadic = no
			NOR = {
				character = ROOT
				has_character_flag = faction_court_war
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_coerced_into_leaving_faction }
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated }
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated_other_rel }
				any_demesne_title = { temporary = yes }
			}
		}
		OR = {
			NOT = { has_character_flag = former_faction_leader }
			had_character_flag = { flag = former_faction_leader days = 7 }
		}
		NOT = {
			any_faction_backer = {
				in_faction = faction_court
				NOT = { has_character_flag = removed_from_leadership }
				higher_real_tier_than = ROOT
			}
		}
		NOR = {
			leads_faction = faction_prosperity
			leads_faction = faction_glory
			leads_faction = faction_tradition
		}
	}
	
	# Target scope (ROOT = liege title, FROM = faction leader)
	allow = {
		is_primary_holder_title = yes
	}
	
	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			is_ruler = yes
			independent = no
			is_adult = yes
			prisoner = no
			is_nomadic = no
			NOR = {
				trait = incapable
				trait = in_hiding
				liege = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_coerced_into_leaving_faction } }
				liege = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated } }
				liege = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated_other_rel } }
			}
		}
	}
	
	# AI creation weight (ROOT = title, FROM = faction creator)
	chance = {
		factor = 100
		modifier = {
			factor = 0
			FROM = {
				NOT = { has_character_flag = faction_court_supporter }
			}
		}
		modifier = {
			factor = 0
			FROM = {
				OR = {
					controls_religion = yes
					rightful_religious_head_scope = { character = PREV }
				}
			}
		}
		modifier = {
			factor = 10
			FROM = {
				real_tier = king
				liege = { real_tier = emperor }
			}
		}
		modifier = {
			factor = 10
			FROM = {
				real_tier = duke
				liege = { real_tier = king }
			}
		}
		modifier = {
			factor = 0
			current_heir = { character = FROM }
		}
	}
	
	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 100
		modifier = {
			factor = 0
			ROOT = {
				NOT = { has_character_flag = faction_court_supporter }
			}
		}
		modifier = {
			factor = 0
			OR = {
				controls_religion = yes
				rightful_religious_head = ROOT
			}
		}
	}
	
	success = {
		always = no
	}

	abort = {
		always = no
	}

	abort_effect = {
	}

	effect = {
	}
}	

# Prosperity faction: desires wealth and a healthy economy
faction_prosperity = {
	type = liege_titles
	
	# Plotter scope
	potential = {
		is_ruler = yes
		is_landed = yes
		independent = no
		prisoner = no
		is_nomadic = no
		is_adult = yes
		NOT = { trait = incapable }
		liege = {
			is_nomadic = no
			NOR = {
				character = ROOT
				has_character_flag = faction_properity_war
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_coerced_into_leaving_faction }
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated }
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated_other_rel }
				any_demesne_title = { temporary = yes }
			}
		}
		OR = {
			NOT = { has_character_flag = former_faction_leader }
			had_character_flag = { flag = former_faction_leader days = 7 }
		}
		NOT = {
			any_faction_backer = {
				in_faction = faction_prosperity
				NOT = { has_character_flag = removed_from_leadership }
				higher_real_tier_than = ROOT
			}
		}
		NOR = {
			leads_faction = faction_court
			leads_faction = faction_glory
			leads_faction = faction_tradition
		}
	}

	# Target scope (ROOT = liege title, FROM = faction leader)
	allow = {
		is_primary_holder_title = yes
	}
	
	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			is_ruler = yes
			independent = no
			is_adult = yes
			prisoner = no
			is_nomadic = no
			NOR = {
				trait = incapable
				trait = in_hiding
				liege = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_coerced_into_leaving_faction } }
				liege = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated } }
				liege = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated_other_rel } }
			}
		}
	}
	
	# AI creation weight (ROOT = title, FROM = faction creator)
	chance = {
		factor = 100
		modifier = {
			factor = 0
			FROM = {
				NOT = { has_character_flag = faction_prosperity_supporter }
			}
		}
		modifier = {
			factor = 0
			FROM = {
				OR = {
					controls_religion = yes
					rightful_religious_head_scope = { character = PREV }
				}
			}
		}
		modifier = {
			factor = 10
			FROM = {
				real_tier = king
				liege = { real_tier = emperor }
			}
		}
		modifier = {
			factor = 10
			FROM = {
				real_tier = duke
				liege = { real_tier = king }
			}
		}
		modifier = {
			factor = 0
			current_heir = { character = FROM }
		}
	}
		
	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 100
		modifier = {
			factor = 0
			ROOT = {
				NOT = { has_character_flag = faction_prosperity_supporter }
			}
		}
		modifier = {
			factor = 0
			OR = {
				controls_religion = yes
				rightful_religious_head = ROOT
			}
		}
	}
	
	success = {
		always = no
	}

	abort = {
		always = no
	}

	abort_effect = {
	}

	effect = {
	}
}	

# Glory faction: desires prestige and the spoils of war
faction_glory = {
	type = liege_titles
	
	# Plotter scope
	potential = {
		is_ruler = yes
		is_landed = yes
		independent = no
		prisoner = no
		is_nomadic = no
		is_adult = yes
		NOT = { trait = incapable }
		liege = {
			is_nomadic = no
			NOR = {
				character = ROOT
				has_character_flag = faction_glory_war
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_coerced_into_leaving_faction }
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated }
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated_other_rel }
				any_demesne_title = { temporary = yes }
			}
		}
		OR = {
			NOT = { has_character_flag = former_faction_leader }
			had_character_flag = { flag = former_faction_leader days = 7 }
		}
		NOT = {
			any_faction_backer = {
				in_faction = faction_glory
				NOT = { has_character_flag = removed_from_leadership }
				higher_real_tier_than = ROOT
			}
		}
		NOR = {
			leads_faction = faction_court
			leads_faction = faction_prosperity
			leads_faction = faction_tradition
		}
	}

	# Target scope (ROOT = liege title, FROM = faction leader)
	allow = {
		is_primary_holder_title = yes
	}
	
	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			is_ruler = yes
			independent = no
			is_adult = yes
			prisoner = no
			is_nomadic = no
			NOR = {
				trait = incapable
				trait = in_hiding
				liege = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_coerced_into_leaving_faction } }
				liege = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated } }
				liege = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated_other_rel } }
			}
		}
	}
	
	# AI creation weight (ROOT = title, FROM = faction creator)
	chance = {
		factor = 100
		modifier = {
			factor = 0
			FROM = {
				NOT = { has_character_flag = faction_glory_supporter }
			}
		}
		modifier = {
			factor = 0
			FROM = {
				OR = {
					controls_religion = yes
					rightful_religious_head_scope = { character = PREV }
				}
			}
		}
		modifier = {
			factor = 10
			FROM = {
				real_tier = king
				liege = { real_tier = emperor }
			}
		}
		modifier = {
			factor = 10
			FROM = {
				real_tier = duke
				liege = { real_tier = king }
			}
		}
		modifier = {
			factor = 0
			current_heir = { character = FROM }
		}
	}
	
	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 100
		modifier = {
			factor = 0
			ROOT = {
				NOT = { has_character_flag = faction_glory_supporter }
			}
		}
		modifier = {
			factor = 0
			OR = {
				controls_religion = yes
				rightful_religious_head = ROOT
			}
		}
	}
	
	success = {
		always = no
	}

	abort = {
		always = no
	}

	abort_effect = {
	}

	effect = {
	}
}	

# Tradition faction: desires piety and support for religion
faction_tradition = {
	type = liege_titles
	
	# Plotter scope
	potential = {
		is_ruler = yes
		is_landed = yes
		independent = no
		prisoner = no
		is_nomadic = no
		is_adult = yes
		NOR = {
			trait = incapable
			trait = excommunicated
		}
		liege = {
			is_nomadic = no
			religion = ROOT
			NOR = {
				character = ROOT
				has_character_flag = faction_tradition_war
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_coerced_into_leaving_faction }
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated }
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated_other_rel }
				any_demesne_title = { temporary = yes }
			}
		}
		OR = {
			NOT = { has_character_flag = former_faction_leader }
			had_character_flag = { flag = former_faction_leader days = 7 }
		}
		NOT = {
			any_faction_backer = {
				in_faction = faction_tradition
				NOT = { has_character_flag = removed_from_leadership }
				higher_real_tier_than = ROOT
			}
		}
		NOR = {
			leads_faction = faction_court
			leads_faction = faction_prosperity
			leads_faction = faction_glory
		}
	}

	# Target scope (ROOT = liege title, FROM = faction leader)
	allow = {
		is_primary_holder_title = yes
	}
	
	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			is_ruler = yes
			independent = no
			is_adult = yes
			prisoner = no
			is_nomadic = no
			liege = { religion = ROOT }
			NOR = {
				trait = incapable
				trait = in_hiding
				trait = excommunicated
				liege = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_coerced_into_leaving_faction } }
				liege = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated } }
				liege = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated_other_rel } }
			}
		}
	}
	
	# AI creation weight (ROOT = title, FROM = faction creator)
	chance = {
		factor = 100
		modifier = {
			factor = 0
			FROM = {
				NOT = { has_character_flag = faction_tradition_supporter }
			}
		}
		modifier = {
			factor = 0
			FROM = {
				OR = {
					controls_religion = yes
					rightful_religious_head_scope = { character = PREV }
				}
			}
		}
		modifier = {
			factor = 10
			FROM = {
				real_tier = king
				liege = { real_tier = emperor }
			}
		}
		modifier = {
			factor = 10
			FROM = {
				real_tier = duke
				liege = { real_tier = king }
			}
		}
		modifier = {
			factor = 0
			current_heir = { character = FROM }
		}
	}
	
	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 100
		modifier = {
			factor = 0
			ROOT = {
				NOT = { has_character_flag = faction_tradition_supporter }
			}
		}
		modifier = {
			factor = 0
			OR = {
				controls_religion = yes
				rightful_religious_head = ROOT
			}
		}
		modifier = {
			factor = 0
			ROOT = { trait = cynical }
		}
	}
	
	success = {
		always = no
	}

	abort = {
		always = no
	}

	abort_effect = {
	}

	effect = {
	}
}	

