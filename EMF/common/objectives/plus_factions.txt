# -*- ck2.objectives -*-

# Faction tags need to start with 'faction_'

# Supported types:
# liege_titles, liege_titles_w_claimant, character

# The succession law factions have hard coded elements to ensure that the correct heir is shown in Plot and 
# Faction interfaces and that AI faction members vote for laws in accordance with the faction goal.
# The valid tags correspond to the law name: faction_succ_seniority, faction_succ_primogeniture, etc.

###############
# FACTIONS
###############

# Court faction: desires more power for vassals
faction_court = {
	type = liege_titles
	
	# Plotter scope
	potential = {
		is_nomadic = no
		emf_faction_basic_vassal_requirements = yes
		liege = {
			is_nomadic = no
			NOR = {
				character = ROOT
				has_character_flag = faction_court_war
				has_opinion_modifier = { who = ROOT modifier = opinion_civil_war_loser }
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated }
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated_other_rel }
				any_demesne_title = { temporary = yes }
			}
		}
		OR = {
			NOT = { has_character_flag = former_faction_leader }
			had_character_flag = { flag = former_faction_leader days = 7 }
		}
		NOT = {
			any_faction_backer = {
				in_faction = faction_court
				NOT = { has_character_flag = removed_from_leadership }
				higher_real_tier_than = ROOT
			}
		}
		NOR = {
			in_faction = faction_prosperity
			in_faction = faction_glory
			in_faction = faction_tradition
		}
	}
	
	# Target scope (ROOT = liege title, FROM = faction leader)
	allow = {
		is_primary_holder_title = yes
		FROM = { primary_title = { is_primary_type_title = no } }
	}
	
	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			is_nomadic = no
			emf_faction_basic_vassal_requirements = yes
			OR = {
				has_character_flag = will_join_civil_war
				NOR = {
					in_faction = faction_prosperity
					in_faction = faction_glory
					in_faction = faction_tradition
				}
			}
			NOR = {
				AND = {
					NOT = { has_character_flag = will_join_civil_war }
					reverse_has_opinion_modifier = { who = LIEGE modifier = opinion_civil_war_loser }
				}
				liege = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated } }
				liege = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated_other_rel } }
			}
		}
	}
	
	# AI creation weight (ROOT = title, FROM = faction creator)
	chance = {
		factor = 100
		modifier = {
			factor = 0
			FROM = {
				NOT = { has_character_flag = faction_court_supporter }
			}
		}
		modifier = {
			factor = 0
			FROM = {
				OR = {
					controls_religion = yes
					rightful_religious_head_scope = { character = PREV }
				}
			}
		}
		modifier = {
			factor = 10
			FROM = {
				real_tier = KING
				liege = { real_tier = EMPEROR }
			}
		}
		modifier = {
			factor = 10
			FROM = {
				real_tier = DUKE
				liege = { real_tier = KING }
			}
		}
		modifier = {
			factor = 0
			current_heir = { character = FROM }
		}
		modifier = {
			factor = 0
			FROM = { primary_title = { is_primary_type_title = yes } }
		}
	}
	
	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 100
		modifier = {
			factor = 0
			NOR = {
				ROOT = { has_character_flag = faction_court_supporter }
				AND = {
					ROOT = { has_character_flag = will_join_civil_war }
					FROM = {
						has_character_flag = civil_war_faction_leader
						pf_not_regular_faction_war_trigger = no
					}
				}
			}
		}
		modifier = {
			factor = 10
			ROOT = { has_character_flag = will_join_civil_war }
		}
		modifier = {
			factor = 0
			OR = {
				controls_religion = yes
				rightful_religious_head = ROOT
			}
		}
	}

	success = {
		always = no
	}

	abort = {
		always = no
	}

	abort_effect = {
	}

	effect = {
	}
}	

# Prosperity faction: desires wealth and a healthy economy
faction_prosperity = {
	type = liege_titles
	
	# Plotter scope
	potential = {
		is_nomadic = no
		emf_faction_basic_vassal_requirements = yes
		liege = {
			is_nomadic = no
			NOR = {
				character = ROOT
				has_character_flag = faction_prosperity_war
				has_opinion_modifier = { who = ROOT modifier = opinion_civil_war_loser }
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated }
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated_other_rel }
				any_demesne_title = { temporary = yes }
			}
		}
		OR = {
			NOT = { has_character_flag = former_faction_leader }
			had_character_flag = { flag = former_faction_leader days = 7 }
		}
		NOT = {
			any_faction_backer = {
				in_faction = faction_prosperity
				NOT = { has_character_flag = removed_from_leadership }
				higher_real_tier_than = ROOT
			}
		}
		NOR = {
			in_faction = faction_court
			in_faction = faction_glory
			in_faction = faction_tradition
		}
	}

	# Target scope (ROOT = liege title, FROM = faction leader)
	allow = {
		is_primary_holder_title = yes
		FROM = { primary_title = { is_primary_type_title = no } }
	}
	
	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			is_nomadic = no
			emf_faction_basic_vassal_requirements = yes
			OR = {
				has_character_flag = will_join_civil_war
				NOR = {
					trait = in_hiding
					in_faction = faction_court
					in_faction = faction_glory
					in_faction = faction_tradition
				}
			}
			NOR = {
				AND = {
					NOT = { has_character_flag = will_join_civil_war }
					reverse_has_opinion_modifier = { who = LIEGE modifier = opinion_civil_war_loser }
				}
				liege = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated } }
				liege = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated_other_rel } }
			}
		}
	}
	
	# AI creation weight (ROOT = title, FROM = faction creator)
	chance = {
		factor = 100
		modifier = {
			factor = 0
			FROM = {
				NOT = { has_character_flag = faction_prosperity_supporter }
			}
		}
		modifier = {
			factor = 0
			FROM = {
				OR = {
					controls_religion = yes
					rightful_religious_head_scope = { character = PREV }
				}
			}
		}
		modifier = {
			factor = 10
			FROM = {
				real_tier = KING
				liege = { real_tier = EMPEROR }
			}
		}
		modifier = {
			factor = 10
			FROM = {
				real_tier = DUKE
				liege = { real_tier = KING }
			}
		}
		modifier = {
			factor = 0
			current_heir = { character = FROM }
		}
		modifier = {
			factor = 0
			FROM = { primary_title = { is_primary_type_title = yes } }
		}
	}
		
	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 100
		modifier = {
			factor = 0
			NOR = {
				ROOT = { has_character_flag = faction_prosperity_supporter }
				AND = {
					ROOT = { has_character_flag = will_join_civil_war }
					FROM = {
						has_character_flag = civil_war_faction_leader
						pf_not_regular_faction_war_trigger = no
					}
				}
			}
		}
		modifier = {
			factor = 10
			ROOT = { has_character_flag = will_join_civil_war }
		}
		modifier = {
			factor = 0
			OR = {
				controls_religion = yes
				rightful_religious_head = ROOT
			}
		}
	}

	success = {
		always = no
	}

	abort = {
		always = no
	}

	abort_effect = {
	}

	effect = {
	}
}	

# Glory faction: desires prestige and the spoils of war
faction_glory = {
	type = liege_titles
	
	# Plotter scope
	potential = {
		is_nomadic = no
		emf_faction_basic_vassal_requirements = yes
		liege = {
			is_nomadic = no
			NOR = {
				character = ROOT
				has_character_flag = faction_glory_war
				has_opinion_modifier = { who = ROOT modifier = opinion_civil_war_loser }
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated }
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated_other_rel }
				any_demesne_title = { temporary = yes }
			}
		}
		OR = {
			NOT = { has_character_flag = former_faction_leader }
			had_character_flag = { flag = former_faction_leader days = 7 }
		}
		NOT = {
			any_faction_backer = {
				in_faction = faction_glory
				NOT = { has_character_flag = removed_from_leadership }
				higher_real_tier_than = ROOT
			}
		}
		NOR = {
			in_faction = faction_court
			in_faction = faction_prosperity
			in_faction = faction_tradition
		}
	}

	# Target scope (ROOT = liege title, FROM = faction leader)
	allow = {
		is_primary_holder_title = yes
		FROM = { primary_title = { is_primary_type_title = no } }
	}
	
	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			is_nomadic = no
			emf_faction_basic_vassal_requirements = yes
			OR = {
				has_character_flag = will_join_civil_war
				NOR = {
					trait = in_hiding
					in_faction = faction_court
					in_faction = faction_prosperity
					in_faction = faction_tradition
				}
			}
			NOR = {
				AND = {
					NOT = { has_character_flag = will_join_civil_war }
					reverse_has_opinion_modifier = { who = LIEGE modifier = opinion_civil_war_loser }
				}
				liege = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated } }
				liege = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated_other_rel } }
			}
		}
	}
	
	# AI creation weight (ROOT = title, FROM = faction creator)
	chance = {
		factor = 100
		modifier = {
			factor = 0
			FROM = {
				NOT = { has_character_flag = faction_glory_supporter }
			}
		}
		modifier = {
			factor = 0
			FROM = {
				OR = {
					controls_religion = yes
					rightful_religious_head_scope = { character = PREV }
				}
			}
		}
		modifier = {
			factor = 10
			FROM = {
				real_tier = KING
				liege = { real_tier = EMPEROR }
			}
		}
		modifier = {
			factor = 10
			FROM = {
				real_tier = DUKE
				liege = { real_tier = KING }
			}
		}
		modifier = {
			factor = 0
			current_heir = { character = FROM }
		}
		modifier = {
			factor = 0
			FROM = { primary_title = { is_primary_type_title = yes } }
		}
	}
	
	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 100
		modifier = {
			factor = 0
			NOR = {
				ROOT = { has_character_flag = faction_glory_supporter }
				AND = {
					ROOT = { has_character_flag = will_join_civil_war }
					FROM = {
						has_character_flag = civil_war_faction_leader
						pf_not_regular_faction_war_trigger = no
					}
				}
			}
		}
		modifier = {
			factor = 10
			ROOT = { has_character_flag = will_join_civil_war }
		}
		modifier = {
			factor = 0
			OR = {
				controls_religion = yes
				rightful_religious_head = ROOT
			}
		}
	}

	success = {
		always = no
	}

	abort = {
		always = no
	}

	abort_effect = {
	}

	effect = {
	}
}	

# Tradition faction: desires piety and support for religion
faction_tradition = {
	type = liege_titles
	
	# Plotter scope
	potential = {
		is_nomadic = no
		emf_faction_basic_vassal_requirements = yes
		NOT = { trait = excommunicated }
		liege = {
			is_nomadic = no
			religion = ROOT
			NOR = {
				character = ROOT
				has_character_flag = faction_tradition_war
				has_opinion_modifier = { who = ROOT modifier = opinion_civil_war_loser }
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated }
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated_other_rel }
				any_demesne_title = { temporary = yes }
			}
		}
		OR = {
			NOT = { has_character_flag = former_faction_leader }
			had_character_flag = { flag = former_faction_leader days = 7 }
		}
		NOT = {
			any_faction_backer = {
				in_faction = faction_tradition
				NOT = { has_character_flag = removed_from_leadership }
				higher_real_tier_than = ROOT
			}
		}
		NOR = {
			in_faction = faction_court
			in_faction = faction_prosperity
			in_faction = faction_glory
		}
	}

	# Target scope (ROOT = liege title, FROM = faction leader)
	allow = {
		is_primary_holder_title = yes
		FROM = { primary_title = { is_primary_type_title = no } }
	}
	
	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			is_nomadic = no
			emf_faction_basic_vassal_requirements = yes
			OR = {
				has_character_flag = will_join_civil_war
				NOR = {
					NOT = { liege = { religion = PREV } }
					trait = excommunicated
					trait = in_hiding
					in_faction = faction_court
					in_faction = faction_prosperity
					in_faction = faction_glory
				}
			}
			NOR = {
				AND = {
					NOT = { has_character_flag = will_join_civil_war }
					reverse_has_opinion_modifier = { who = LIEGE modifier = opinion_civil_war_loser }
				}
				liege = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated } }
				liege = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated_other_rel } }
			}
		}
	}
	
	# AI creation weight (ROOT = title, FROM = faction creator)
	chance = {
		factor = 100
		modifier = {
			factor = 0
			FROM = {
				NOT = { has_character_flag = faction_tradition_supporter }
			}
		}
		modifier = {
			factor = 0
			FROM = {
				OR = {
					controls_religion = yes
					rightful_religious_head_scope = { character = PREV }
				}
			}
		}
		modifier = {
			factor = 10
			FROM = {
				real_tier = KING
				liege = { real_tier = EMPEROR }
			}
		}
		modifier = {
			factor = 10
			FROM = {
				real_tier = DUKE
				liege = { real_tier = KING }
			}
		}
		modifier = {
			factor = 0
			current_heir = { character = FROM }
		}
		modifier = {
			factor = 0
			FROM = { primary_title = { is_primary_type_title = yes } }
		}
	}
	
	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 100
		modifier = {
			factor = 0
			NOR = {
				ROOT = { has_character_flag = faction_tradition_supporter }
				AND = {
					ROOT = { has_character_flag = will_join_civil_war }
					FROM = {
						has_character_flag = civil_war_faction_leader
						pf_not_regular_faction_war_trigger = no
					}
				}
			}
		}
		modifier = {
			factor = 10
			ROOT = { has_character_flag = will_join_civil_war }
		}
		modifier = {
			factor = 0
			OR = {
				controls_religion = yes
				rightful_religious_head = ROOT
			}
		}
		modifier = {
			factor = 0
			ROOT = {
				trait = cynical
				NOT = { has_character_flag = will_join_civil_war }
			}
		}
	}

	success = {
		always = no
	}

	abort = {
		always = no
	}

	abort_effect = {
	}

	effect = {
	}
}	

# Institute Succession by Seniority
faction_succ_seniority = {
	type = liege_titles
	
	warning_level = 0.7 # At this level of faction power we give player an alert. Set to 0 for no alerts.
	
	# Plotter scope
	potential = {
		emf_faction_basic_potential = yes
		liege = { is_feudal = yes }
		NOR = {
			religion_group = muslim
			religion_group = indian_group
			in_faction = faction_succ_primogeniture
			in_faction = faction_succ_feudal_elective
			in_faction = faction_succ_gavelkind
		}
		OR = {
			emf_laws_no_crown_law_title_trigger = yes
			# The Crown Law title holder is my liege
			crownlaw_title = { holder_scope = { is_liege_of = ROOT } }
			emf_laws_crownlaw_title_high_ca_plus_trigger = no
			AND = {
				will_liege_enforce_peace = no
				has_liege_enforced_peace = no
			}
		}
	}
	
	# Target scope
	allow = {
		is_law_potential = succ_seniority
		NOT = { has_law = succ_seniority }
		OR = {
			is_primary_holder_title = yes
			higher_tier_than = DUKE
		}
		holder_scope = {
			NOT = {
				any_war = { war_title = ROOT }
			}
		}
		FROM = { primary_title = { is_primary_type_title = no } }
	}
	
	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			emf_faction_basic_allow_join = yes
			OR = {
				NOR = {
					in_faction = faction_succ_primogeniture
					in_faction = faction_succ_feudal_elective
					in_faction = faction_succ_gavelkind
				}
				has_character_flag = will_join_civil_war
			}
			NOR = {
				religion_group = muslim
				religion_group = indian_group
			}
		}
	}
	
	# AI creation weight (ROOT = title, FROM = faction creator)
	chance = {
		factor = 1	
		modifier = {
			factor = 0.2
			FROM = { pacifist = yes }
		}
		modifier = {
			factor = 0
			FROM = {
				OR = {
					prisoner = yes
					has_character_modifier = in_seclusion
				}
			}
		}
		modifier = {
			factor = 0
			holder_scope = { is_married = FROM }
		}
		modifier = {
			factor = 0
			current_heir = { character = FROM }
		}
		modifier = {
			factor = 0
			FROM = { primary_title = { is_primary_type_title = yes } }
		}
		modifier = {
			factor = 0
			current_heir = {
				ROOT = {
					heir_under_seniority_law = {
						character = PREVPREV
					}
				}
			}
		}
		modifier = {
			factor = 0
			NOR = {
				has_title_flag = former_seniority
				FROM = {
					OR = {
						culture_group = east_slavic
						culture_group = west_slavic
						culture_group = south_slavic
						culture = hungarian
						culture = ethiopian
					}
				}
				heir_under_seniority_law = {
					OR = {
						character = FROM
						is_married = FROM
						is_friend = FROM
					}
					trait = ambitious
					diplomacy = 12
				}
			}
		}
		modifier = {
			factor = 0
			#either has to be the seniority heir or the seniority heir is a dynasty member/ally I like better than my liege
			NOR = {
				would_be_heir_under_law = { who = FROM law = seniority }
				heir_under_seniority_law = {
					OR = {
						dynasty = FROM
						is_married = FROM
						is_friend = FROM
					}
					FROM = { opinion_diff = { first = PREV second = LIEGE value = 25 as_if_liege = yes } }
					reverse_opinion = { who = FROM value = 0 }
				}
			}
		}
		modifier = {
			factor = 0
			FROM = { preparing_invasion = yes }
		}
		modifier = {
			factor = 0.1
			FROM = { 
				opinion = { who = LIEGE value = 0 } 
				NOR = {
					trait = deceitful
					trait = ambitious
					trait = envious
				}			
			}
		}
		modifier = {
			factor = 0
			FROM = { 
				opinion = { who = LIEGE value = 20 } 
				NOR = {
					trait = deceitful
					trait = ambitious
					trait = envious
				}			
			}
		}
		modifier = {
			factor = 0.1
			FROM = {
				opinion = { who = LIEGE value = 20 } 
				OR = {
					trait = deceitful
					trait = ambitious
					trait = envious
				}				
			}
		}
		modifier = {
			factor = 0
			FROM = {
				opinion = { who = LIEGE value = 40 } 
				OR = {
					trait = deceitful
					trait = ambitious
					trait = envious
				}				
			}
		}
		modifier = {
			factor = 1.5
			NOT = { FROM = { opinion = { who = LIEGE value = 0 } } }
		}
		modifier = {
			factor = 2.0
			NOT = { FROM = { opinion = { who = LIEGE value = -50 } } }
		}
		modifier = {
			factor = 4.0
			NOT = { FROM = { opinion = { who = LIEGE value = -75 } } }
		}
		modifier = {
			factor = 0.01
			FROM = { trait = content }
		}
		modifier = {
			factor = 0.01
			FROM = { trait = imbecile }
		}
		modifier = {
			factor = 0.1
			FROM = { trait = inbred }
		}
		modifier = {
			factor = 0.1
			FROM = { trait = craven }
		}
		modifier = {
			factor = 0.2
			FROM = {
				OR = {
					trait = slow
					trait = dull
				}
			}
		}
		modifier = {
			factor = 0.5
			FROM = { trait = kind }
		}
		modifier = {
			factor = 0.5
			FROM = { trait = charitable }
		}
		modifier = {
			factor = 0.5
			FROM = { trait = honest }
		}
		modifier = {
			factor = 0.75
			FROM = { trait = humble }
		}
		modifier = {
			factor = 0.75
			FROM = { trait = just }
		}
		modifier = {
			factor = 1.5
			FROM = { trait = proud }
		}
		modifier = {
			factor = 1.5
			FROM = { trait = brave }
		}
		modifier = {
			factor = 1.5
			FROM = { trait = arbitrary }
		}
		modifier = {
			factor = 2.0
			FROM = { trait = envious }
		}
		modifier = {
			factor = 2.0
			FROM = { trait = greedy }
		}
		modifier = {
			factor = 2.0
			FROM = { trait = impaler }
		}
		modifier = {
			factor = 2.0
			FROM = { trait = deceitful }
		}
		modifier = {
			factor = 4.0
			FROM = { trait = ambitious }
		}
	}
	
	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 1
		modifier = {
			factor = 1000
			has_character_flag = will_join_civil_war
			FROM = {
				has_character_flag = demands_seniority
				has_character_flag = civil_war_faction_leader
			}
		}
		modifier = {
			factor = 0.2
			pacifist = yes
		}
		modifier = {
			factor = 0
			OR = {
				prisoner = yes
				has_character_modifier = in_seclusion
				preparing_invasion = yes
			}
		}
		modifier = {
			factor = 0
			FROMFROM = {
				current_heir = { character = ROOT }
			}
		}
		modifier = {
			factor = 0
			FROMFROM = {
				current_heir = {
					PREV = {
						heir_under_seniority_law = {
							character = PREVPREV
						}
					}
				}
			}
		}
		modifier = {
			factor = 0
			NOT = { has_character_flag = will_join_civil_war }
			FROMFROM = {
				holder_scope = { is_married = ROOT }
			}
		}
		# Try to exclude people who should rather support a claimant
		modifier = {
			factor = 0
			NOT = { has_character_flag = will_join_civil_war }
			FROMFROM = {
				heir_under_seniority_law = {
					OR = {
						NOT = { culture = ROOT }
						NOT = { religion = ROOT }
					}
				}
			}
			liege = {
				any_demesne_title = {
					OR = {
						is_primary_holder_title = yes
						higher_tier_than = DUKE
					}
					ROOT = {
						primary_title = {
							de_jure_liege_or_above = PREVPREV
						}
					}
					any_claimant = {
						culture = ROOT
						religion = ROOT
					}
				}
			}
		}		
		modifier = {
			factor = 0
			NOT = { has_character_flag = will_join_civil_war }
			FROMFROM = {
				heir_under_seniority_law = {
					ROOT = {
						OR = {
							AND = {
								NOT = { in_faction = faction_succ_seniority }
								opinion_diff = {
									first = LIEGE
									second = PREV
									value = -10 # I don't like the pretender enough
									as_if_liege = yes
								}
							}
							AND = {
								in_faction = faction_succ_seniority
								opinion_diff = {
									first = LIEGE
									second = PREV
									value = 10
									as_if_liege = yes
								}
							}
						}
					}
				}
			}
		}
		modifier = {
			factor = 0.1
			opinion = { who = LIEGE value = 0 } 
			NOT = {
				trait = deceitful
				trait = ambitious
				trait = envious
			}		
		}
		modifier = {
			factor = 0
			opinion = { who = LIEGE value = 20 } 
			NOT = {
				trait = deceitful
				trait = ambitious
				trait = envious
			}
		}		
		modifier = {
			factor = 0.1
			opinion = { who = LIEGE value = 20 } 
			OR = {
				trait = deceitful
				trait = ambitious
				trait = envious
			}
		}		
		modifier = {
			factor = 0
			opinion = { who = LIEGE value = 40 } 
			OR = {
				trait = deceitful
				trait = ambitious
				trait = envious
			}
		}
		modifier = {
			factor = 2
			FROMFROM = {
				heir_under_seniority_law = {
					ROOT = { opinion_diff = { first = PREV second = LIEGE value = 25 as_if_liege = yes } }
					reverse_opinion = { who = ROOT value = 0 }
				}
			}
		}
		modifier = {
			factor = 0.01
			trait = content
			NOT = { has_character_flag = will_join_civil_war }
		}
		modifier = {
			factor = 0.01
			trait = imbecile
			NOT = { has_character_flag = will_join_civil_war }
		}
		modifier = {
			factor = 0.1
			trait = inbred
			NOT = { has_character_flag = will_join_civil_war }
		}
		modifier = {
			factor = 0.1
			trait = craven
			NOT = { has_character_flag = will_join_civil_war }
		}
		modifier = {
			factor = 0.2
			OR = {
				trait = slow
				trait = dull
			}
		}
		modifier = {
			factor = 0.5
			trait = kind
		}
		modifier = {
			factor = 0.5
			trait = charitable
		}
		modifier = {
			factor = 0.5
			trait = honest
		}
		modifier = {
			factor = 0.75
			trait = humble
		}
		modifier = {
			factor = 0.75
			trait = just
		}
		modifier = {
			factor = 1.5
			trait = brave
		}
		modifier = {
			factor = 1.5
			trait = arbitrary
		}
		modifier = {
			factor = 2.0
			trait = impaler
		}
		modifier = {
			factor = 2.0
			trait = deceitful
		}
	}

	success = {
		has_law = succ_seniority
	}
	abort = {
		always = no		# Factions will abort if the Potential or Allow triggers are no longer valid
	}
	abort_effect = {
	}
	effect = {
		FROM = {
			any_faction_backer = {
				faction = faction_succ_seniority
				reverse_opinion = {
					modifier = opinion_grateful
					who = FROM
					years = 5
				}
			}
		}
	}
}

# Institute Succession by Primogeniture
faction_succ_primogeniture = {
	type = liege_titles
	
	warning_level = 0.7 # At this level of faction power we give player an alert. Set to 0 for no alerts.
	
	# Plotter scope
	potential = {
		emf_faction_basic_potential = yes
		liege = { is_feudal = yes }
		NOR = {
			religion_group = muslim
			in_faction = faction_succ_seniority
			in_faction = faction_succ_feudal_elective
			in_faction = faction_succ_gavelkind
		}
		OR = {
			emf_laws_no_crown_law_title_trigger = yes # Is not affected by a Crown Law title
			crownlaw_title = { holder_scope = { is_liege_of = ROOT } } # The Crown Law title holder is my liege
			emf_laws_crownlaw_title_high_ca_plus_trigger = no # The Crown Law title allows vassal infighting
			AND = {
				will_liege_enforce_peace = no
				has_liege_enforced_peace = no
			}
		}
	}
	
	# Target scope
	allow = {
		is_law_potential = succ_primogeniture
		NOT = { has_law = succ_primogeniture }
		OR = {
			is_primary_holder_title = yes
			higher_tier_than = DUKE
		}
		holder_scope = {
			NOT = {
				any_war = { war_title = ROOT }
			}
		}
		FROM = { primary_title = { is_primary_type_title = no } }
	}
	
	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			emf_faction_basic_allow_join = yes
			OR = {
				NOR = {
					in_faction = faction_succ_seniority
					in_faction = faction_succ_feudal_elective
					in_faction = faction_succ_gavelkind
				}
				has_character_flag = will_join_civil_war
			}
			NOT = { religion_group = muslim }
		}
	}	

	# AI creation weight (ROOT = title, FROM = faction creator)
	chance = {
		factor = 1	
		modifier = {
			factor = 0.2
			FROM = { pacifist = yes }
		}
		modifier = {
			factor = 0
			FROM = {
				OR = {
					prisoner = yes
					has_character_modifier = in_seclusion
				}
			}
		}
		modifier = {
			factor = 0
			holder_scope = { is_married = FROM }
		}
		modifier = {
			factor = 0
			current_heir = { character = FROM }
		}
		modifier = {
			factor = 0
			FROM = { primary_title = { is_primary_type_title = yes } }
		}
		modifier = {
			factor = 0
			current_heir = {
				ROOT = {
					heir_under_primogeniture_law = {
						character = PREVPREV
					}
				}
			}
		}
		modifier = {
			factor = 2
			has_title_flag = former_primogeniture
		}
		modifier = {
			factor = 0
			#either has to be the primogeniture heir or the primogeniture heir is a dynasty member/ally I like better than my liege
			NOR = {
				would_be_heir_under_law = { who = FROM law = primogeniture }
				heir_under_primogeniture_law = {
					OR = {
						dynasty = FROM
						is_married = FROM
						is_friend = FROM
					}
					FROM = { opinion_diff = { first = PREV second = LIEGE value = 25 as_if_liege = yes } }
					reverse_opinion = { who = FROM value = 0 }
				}
				heir_under_primogeniture_law = {
					OR = {
						character = FROM
						is_married = FROM
						is_friend = FROM
					}
					trait = ambitious
					diplomacy = 12
				}
			}
		}
		modifier = {
			factor = 0
			FROM = { preparing_invasion = yes }
		}
		modifier = {
			factor = 0.1
			FROM = { 
				opinion = { who = LIEGE value = 0 } 
				NOR = {
					trait = deceitful
					trait = ambitious
					trait = envious
				}
			}
		}
		modifier = {
			factor = 0
			FROM = { 
				opinion = { who = LIEGE value = 20 } 
				NOR = {
					trait = deceitful
					trait = ambitious
					trait = envious
				}
			}
		}
		modifier = {
			factor = 0.1
			FROM = {
				opinion = { who = LIEGE value = 20 } 
				OR = {
					trait = deceitful
					trait = ambitious
					trait = envious
				}
			}
		}
		modifier = {
			factor = 0
			FROM = {
				opinion = { who = LIEGE value = 40 } 
				OR = {
					trait = deceitful
					trait = ambitious
					trait = envious
				}
			}
		}
		modifier = {
			factor = 1.5
			NOT = { FROM = { opinion = { who = LIEGE value = 0 } } }
		}
		modifier = {
			factor = 2.0
			NOT = { FROM = { opinion = { who = LIEGE value = -50 } } }
		}
		modifier = {
			factor = 4.0
			NOT = { FROM = { opinion = { who = LIEGE value = -75 } } }
		}
		modifier = {
			factor = 0.01
			FROM = { trait = content }
		}
		modifier = {
			factor = 0.01
			FROM = { trait = imbecile }
		}
		modifier = {
			factor = 0.1
			FROM = { trait = inbred }
		}
		modifier = {
			factor = 0.1
			FROM = { trait = craven }
		}
		modifier = {
			factor = 0.2
			FROM = {
				OR = {
					trait = slow
					trait = dull
				}
			}
		}
		modifier = {
			factor = 0.5
			FROM = { trait = kind }
		}
		modifier = {
			factor = 0.5
			FROM = { trait = charitable }
		}
		modifier = {
			factor = 0.5
			FROM = { trait = honest }
		}
		modifier = {
			factor = 0.75
			FROM = { trait = humble }
		}
		modifier = {
			factor = 0.75
			FROM = { trait = just }
		}
		modifier = {
			factor = 1.5
			FROM = { trait = proud }
		}
		modifier = {
			factor = 1.5
			FROM = { trait = brave }
		}
		modifier = {
			factor = 1.5
			FROM = { trait = arbitrary }
		}
		modifier = {
			factor = 2.0
			FROM = { trait = envious }
		}
		modifier = {
			factor = 2.0
			FROM = { trait = greedy }
		}
		modifier = {
			factor = 2.0
			FROM = { trait = impaler }
		}
		modifier = {
			factor = 2.0
			FROM = { trait = deceitful }
		}
		modifier = {
			factor = 4.0
			FROM = { trait = ambitious }
		}
	}

	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 1
		modifier = {
			factor = 1000
			has_character_flag = will_join_civil_war
			FROM = {
				has_character_flag = demands_primogeniture
				has_character_flag = civil_war_faction_leader
			}
		}
		modifier = {
			factor = 0.2
			pacifist = yes
		}
		modifier = {
			factor = 0
			OR = {
				prisoner = yes
				has_character_modifier = in_seclusion
				preparing_invasion = yes
			}
		}
		modifier = {
			factor = 0
			FROMFROM = {
				current_heir = { character = ROOT }
			}
		}
		modifier = {
			factor = 0
			FROMFROM = {
				holder_scope = { is_married = ROOT }
			}
		}
		modifier = {
			factor = 0
			FROMFROM = {
				current_heir = {
					PREV = {
						heir_under_primogeniture_law = {
							character = PREVPREV
						}
					}
				}
			}
		}
		modifier = {
			factor = 2
			FROMFROM = { has_title_flag = former_primogeniture }
		}
		# Try to exclude people who should rather support a claimant
		modifier = {
			factor = 0
			NOT = { has_character_flag = will_join_civil_war }
			FROMFROM = {
				heir_under_primogeniture_law = {
					OR = {
						NOT = { culture = ROOT }
						NOT = { religion = ROOT }
					}
				}
			}
			liege = {
				any_demesne_title = {
					OR = {
						is_primary_holder_title = yes
						higher_tier_than = DUKE
					}
					ROOT = {
						primary_title = {
							de_jure_liege_or_above = PREVPREV
						}
					}
					any_claimant = {
						culture = ROOT
						religion = ROOT
					}
				}
			}
		}		
		modifier = {
			factor = 0
			NOT = { has_character_flag = will_join_civil_war }
			FROMFROM = {
				heir_under_primogeniture_law = {
					ROOT = {
						OR = {
							AND = {
								NOT = { in_faction = faction_succ_primogeniture }
								opinion_diff = {
									first = LIEGE
									second = PREV
									value = -10 # I don't like the pretender enough
									as_if_liege = yes
								}
							}
							AND = {
								in_faction = faction_succ_primogeniture
								opinion_diff = {
									first = LIEGE
									second = PREV
									value = 10
									as_if_liege = yes
								}
							}
						}
					}
				}
			}
		}
		modifier = {
			factor = 0.1
			opinion = { who = LIEGE value = 0 } 
			NOT = {
				trait = deceitful
				trait = ambitious
				trait = envious
			}		
		}
		modifier = {
			factor = 0
			opinion = { who = LIEGE value = 20 } 
			NOT = {
				trait = deceitful
				trait = ambitious
				trait = envious
			}
		}		
		modifier = {
			factor = 0.1
			opinion = { who = LIEGE value = 20 } 
			OR = {
				trait = deceitful
				trait = ambitious
				trait = envious
			}
		}		
		modifier = {
			factor = 0
			opinion = { who = LIEGE value = 40 } 
			OR = {
				trait = deceitful
				trait = ambitious
				trait = envious
			}
		}
		modifier = {
			factor = 2
			FROMFROM = {
				heir_under_primogeniture_law = {
					ROOT = { opinion_diff = { first = PREV second = LIEGE value = 25 as_if_liege = yes } }
					reverse_opinion = { who = ROOT value = 0 }
				}
			}
		}
		modifier = {
			factor = 0.01
			trait = content
			NOT = { has_character_flag = will_join_civil_war }
		}
		modifier = {
			factor = 0.01
			trait = imbecile
			NOT = { has_character_flag = will_join_civil_war }
		}
		modifier = {
			factor = 0.1
			trait = inbred
			NOT = { has_character_flag = will_join_civil_war }
		}
		modifier = {
			factor = 0.1
			trait = craven
			NOT = { has_character_flag = will_join_civil_war }
		}
		modifier = {
			factor = 0.2
			OR = {
				trait = slow
				trait = dull
			}
		}
		modifier = {
			factor = 0.5
			trait = kind
		}
		modifier = {
			factor = 0.5
			trait = charitable
		}
		modifier = {
			factor = 0.5
			trait = honest
		}
		modifier = {
			factor = 0.75
			trait = humble
		}
		modifier = {
			factor = 0.75
			trait = just
		}
		modifier = {
			factor = 1.5
			trait = brave
		}
		modifier = {
			factor = 1.5
			trait = arbitrary
		}
		modifier = {
			factor = 2.0
			trait = impaler
		}
		modifier = {
			factor = 2.0
			trait = deceitful
		}
	}

	success = {
		has_law = succ_primogeniture
	}	
	abort = {
		always = no		# Factions will abort if the Potential or Allow triggers are no longer valid
	}
	abort_effect = {
	}
	effect = {
		FROM = {
			any_faction_backer = {
				faction = faction_succ_primogeniture
				reverse_opinion = {
					modifier = opinion_grateful
					who = FROM
					years = 5
				}
			}
		}
	}
}

# Institute Succession by Gavelkind
faction_succ_gavelkind = {
	type = liege_titles
	
	warning_level = 0.7 # At this level of faction power we give player an alert. Set to 0 for no alerts.
	
	# Plotter scope
	potential = {
		emf_faction_basic_potential = yes
		liege = { is_feudal = yes }
		NOR = {
			religion_group = muslim
			in_faction = faction_succ_seniority
			in_faction = faction_succ_feudal_elective
			in_faction = faction_succ_primogeniture
		}
		OR = {
			emf_laws_no_crown_law_title_trigger = yes # Is not affected by a Crown Law title
			crownlaw_title = { holder_scope = { is_liege_of = ROOT } } # The Crown Law title holder is my liege
			emf_laws_crownlaw_title_high_ca_plus_trigger = no # The Crown Law title allows vassal infighting
			AND = {
				will_liege_enforce_peace = no
				has_liege_enforced_peace = no
			}
		}
	}
	
	# Target scope
	allow = {
		is_law_potential = succ_gavelkind
		NOT = { has_law = succ_gavelkind }
		OR = {
			is_primary_holder_title = yes
			higher_tier_than = DUKE
		}
		holder_scope = {
			NOT = {
				any_war = { war_title = ROOT }
			}
		}
		FROM = { primary_title = { is_primary_type_title = no } }
	}
	
	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			emf_faction_basic_allow_join = yes
			OR = {
				NOR = {
					in_faction = faction_succ_primogeniture
					in_faction = faction_succ_feudal_elective
					in_faction = faction_succ_seniority
				}
				has_character_flag = will_join_civil_war
			}
			NOT = { religion_group = muslim }
		}
	}	

	# AI creation weight (ROOT = title, FROM = faction creator)
	chance = {
		factor = 1
		modifier = {
			factor = 0.2
			FROM = { pacifist = yes }
		}
		modifier = {
			factor = 0
			FROM = {
				OR = {
					prisoner = yes
					has_character_modifier = in_seclusion
				}
			}
		}
		modifier = {
			factor = 0
			holder_scope = { is_married = FROM }
		}
		modifier = {
			factor = 0
			current_heir = { character = FROM }
		}
		modifier = {
			factor = 0
			FROM = { primary_title = { is_primary_type_title = yes } }
		}
		modifier = {
			factor = 0
			holder_scope = {
				NOT = {
					any_child = {
						OR = {
							AND = {
								is_female = no
								ROOT = {
									NOT = { has_law = enatic_succession }
									NOT = { has_law = enatic_cognatic_succession }
								}
							}
							AND = {
								is_female = yes
								ROOT = {
									NOT = { has_law = agnatic_succession }
									NOT = { has_law = cognatic_succession }
								}
							}
						}
						NOT = { trait = bastard }
						count = 2
					}
				}
				ROOT = {
					current_heir = {
						is_primary_heir = PREVPREV
					}
				}
			}
		}
		modifier = {
			factor = 0
			OR = {
				has_law = succ_feudal_elective
				has_law = succ_elective_gavelkind
			}
		}
		modifier = {
			factor = 0
			OR = {
				FROM = { higher_tier_than = COUNT }
				holder_scope = { lower_tier_than = KING }
			}
		}
		modifier = {
			factor = 0
			NOR = {
				has_title_flag = former_gavelkind
				FROM = {
					OR = {
						is_tribal = yes
						culture_group = north_germanic
						culture_group = central_germanic
						culture_group = west_germanic
					}
				}
				holder_scope = {
					any_child = {
						OR = {
							character = FROM
							is_married = FROM
							is_friend = FROM
						}
						NOT = { is_primary_heir = PREV }
						NOT = { trait = bastard }
						OR = {
							AND = {
								is_female = no
								ROOT = {
									NOT = { has_law = enatic_succession }
									NOT = { has_law = enatic_cognatic_succession }
								}
							}
							AND = {
								is_female = yes
								ROOT = {
									NOT = { has_law = agnatic_succession }
									NOT = { has_law = cognatic_succession }
								}
							}
						}
						trait = ambitious
						diplomacy = 12
					}
				}
			}
		}
		modifier = {
			factor = 0
			NOR = {
				holder_scope = {
					FROM = {
						OR = {
							NOT = { is_child_of = PREV }
							trait = bastard
							AND = {
								is_female = yes
								is_pretender = no
							}
						}
					}
				}
				holder_scope = {
					any_child = {
						OR = {
							dynasty = FROM
							is_married = FROM
							is_friend = FROM
						}
						OR = {
							AND = {
								is_female = no
								ROOT = {
									NOT = { has_law = enatic_succession }
									NOT = { has_law = enatic_cognatic_succession }
								}
							}
							AND = {
								is_female = yes
								ROOT = {
									NOT = { has_law = agnatic_succession }
									NOT = { has_law = cognatic_succession }
								}
							}
						}
						NOT = { is_primary_heir = PREV }
						NOT = { trait = bastard }
						FROM = { opinion_diff = { first = PREV second = LIEGE value = 25 as_if_liege = yes } }
						reverse_opinion = { who = FROM value = 0 }
					}
				}
			}
		}
		modifier = {
			factor = 0
			FROM = { preparing_invasion = yes }
		}
		modifier = {
			factor = 0.1
			FROM = { 
				opinion = { who = LIEGE value = 0 } 
				NOR = {
					trait = deceitful
					trait = ambitious
					trait = envious
				}			
			}
		}
		modifier = {
			factor = 0
			FROM = { 
				opinion = { who = LIEGE value = 20 } 
				NOR = {
					trait = deceitful
					trait = ambitious
					trait = envious
				}			
			}
		}
		modifier = {
			factor = 0.1
			FROM = {
				opinion = { who = LIEGE value = 20 } 
				OR = {
					trait = deceitful
					trait = ambitious
					trait = envious
				}				
			}
		}
		modifier = {
			factor = 0
			FROM = {
				opinion = { who = LIEGE value = 40 } 
				OR = {
					trait = deceitful
					trait = ambitious
					trait = envious
				}				
			}
		}
		modifier = {
			factor = 1.5
			NOT = { FROM = { opinion = { who = LIEGE value = 0 } } }
		}
		modifier = {
			factor = 2.0
			NOT = { FROM = { opinion = { who = LIEGE value = -50 } } }
		}
		modifier = {
			factor = 4.0
			NOT = { FROM = { opinion = { who = LIEGE value = -75 } } }
		}
		modifier = {
			factor = 0.01
			FROM = { trait = content }
		}
		modifier = {
			factor = 0.01
			FROM = { trait = imbecile }
		}
		modifier = {
			factor = 0.1
			FROM = { trait = inbred }
		}
		modifier = {
			factor = 0.1
			FROM = { trait = craven }
		}
		modifier = {
			factor = 0.2
			FROM = {
				OR = {
					trait = slow
					trait = dull
				}
			}
		}
		modifier = {
			factor = 0.5
			FROM = { trait = kind }
		}
		modifier = {
			factor = 0.5
			FROM = { trait = charitable }
		}
		modifier = {
			factor = 0.5
			FROM = { trait = honest }
		}
		modifier = {
			factor = 0.75
			FROM = { trait = humble }
		}
		modifier = {
			factor = 0.75
			FROM = { trait = just }
		}
		modifier = {
			factor = 1.5
			FROM = { trait = proud }
		}
		modifier = {
			factor = 1.5
			FROM = { trait = brave }
		}
		modifier = {
			factor = 1.5
			FROM = { trait = arbitrary }
		}
		modifier = {
			factor = 2.0
			FROM = { trait = envious }
		}
		modifier = {
			factor = 2.0
			FROM = { trait = greedy }
		}
		modifier = {
			factor = 2.0
			FROM = { trait = impaler }
		}
		modifier = {
			factor = 2.0
			FROM = { trait = deceitful }
		}
		modifier = {
			factor = 4.0
			FROM = { trait = ambitious }
		}
	}

	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 1
		modifier = {
			factor = 1000
			has_character_flag = will_join_civil_war
			FROM = {
				has_character_flag = demands_gavelkind
				has_character_flag = civil_war_faction_leader
			}
		}
		modifier = {
			factor = 0.2
			pacifist = yes
		}
		modifier = {
			factor = 0
			OR = {
				prisoner = yes
				has_character_modifier = in_seclusion
				preparing_invasion = yes
			}
		}
		modifier = {
			factor = 0
			FROMFROM = {
				current_heir = { character = ROOT }
			}
		}
		modifier = {
			factor = 0
			FROMFROM = {
				holder_scope = { is_married = ROOT }
			}
		}
		modifier = {
			factor = 0
			NOT = { has_character_flag = will_join_civil_war }
			liege = {
				NOT = {
					any_child = {
						OR = {
							AND = {
								is_female = no
								FROMFROM = {
									NOT = { has_law = enatic_succession }
									NOT = { has_law = enatic_cognatic_succession }
								}
							}
							AND = {
								is_female = yes
								FROMFROM = {
									NOT = { has_law = agnatic_succession }
									NOT = { has_law = cognatic_succession }
								}
							}
						}
						NOT = { trait = bastard }
						count = 2
					}
				}
				FROMFROM = {
					current_heir = {
						is_primary_heir = PREVPREV
					}
				}
			}
		}
		# Try to exclude people who should rather support a claimant
		modifier = {
			factor = 0
			NOT = { has_character_flag = will_join_civil_war }
			liege = {
				OR = {
					NOT = { culture = ROOT }
					NOT = { religion = ROOT }
				}
				any_demesne_title = {
					OR = {
						is_primary_holder_title = yes
						higher_tier_than = DUKE
					}
					ROOT = {
						primary_title = {
							de_jure_liege_or_above = PREVPREV
						}
					}
					any_claimant = {
						culture = ROOT
						religion = ROOT
					}
				}
			}
		}
		modifier = {
			factor = 0
			NOT = { has_character_flag = will_join_civil_war }
			OR = {
				AND = {
					NOT = { in_faction = faction_succ_gavelkind }
					opinion_diff = {
						first = LIEGE
						second = FROM
						value = 10 # I like my liege rather a lot more than the faction leader
						as_if_liege = yes
					}
				}
				AND = {
					in_faction = faction_succ_gavelkind
					opinion_diff = {
						first = LIEGE
						second = FROM
						value = 25
						as_if_liege = yes
					}
				}
			}
		}
		modifier = {
			factor = 0.1
			opinion = { who = LIEGE value = 0 } 
			NOT = {
				trait = deceitful
				trait = ambitious
				trait = envious
			}		
		}
		modifier = {
			factor = 0
			opinion = { who = LIEGE value = 20 } 
			NOT = {
				trait = deceitful
				trait = ambitious
				trait = envious
			}
		}		
		modifier = {
			factor = 0.1
			opinion = { who = LIEGE value = 20 } 
			OR = {
				trait = deceitful
				trait = ambitious
				trait = envious
			}
		}		
		modifier = {
			factor = 0
			opinion = { who = LIEGE value = 40 } 
			OR = {
				trait = deceitful
				trait = ambitious
				trait = envious
			}
		}
		modifier = {
			factor = 2
			opinion_diff = { first = FROM second = LIEGE value = 25 as_if_liege = yes }
			reverse_opinion = { who = FROM value = 0 }
		}
		modifier = {
			factor = 0.01
			trait = content
			NOT = { has_character_flag = will_join_civil_war }
		}
		modifier = {
			factor = 0.01
			trait = imbecile
			NOT = { has_character_flag = will_join_civil_war }
		}
		modifier = {
			factor = 0.1
			trait = inbred
			NOT = { has_character_flag = will_join_civil_war }
		}
		modifier = {
			factor = 0.1
			trait = craven
			NOT = { has_character_flag = will_join_civil_war }
		}
		modifier = {
			factor = 0.2
			OR = {
				trait = slow
				trait = dull
			}
		}
		modifier = {
			factor = 0.5
			trait = kind
		}
		modifier = {
			factor = 0.5
			trait = charitable
		}
		modifier = {
			factor = 0.5
			trait = honest
		}
		modifier = {
			factor = 0.75
			trait = humble
		}
		modifier = {
			factor = 0.75
			trait = just
		}
		modifier = {
			factor = 1.5
			trait = brave
		}
		modifier = {
			factor = 1.5
			trait = arbitrary
		}
		modifier = {
			factor = 2.0
			trait = impaler
		}
		modifier = {
			factor = 2.0
			trait = deceitful
		}
	}

	success = {
		has_law = succ_gavelkind
	}
	abort = {
		always = no		# Factions will abort if the Potential or Allow triggers are no longer valid
	}
	abort_effect = {
	}
	effect = {
		FROM = {
			any_faction_backer = {
				faction = faction_succ_gavelkind
				reverse_opinion = {
					modifier = opinion_grateful
					who = FROM
					years = 5
				}
			}
		}
	}
}

# Institute Succession by Feudal Elective
faction_succ_feudal_elective = {
	type = liege_titles
	
	warning_level = 0.7 # At this level of faction power we give player an alert. Set to 0 for no alerts.
	
	# Plotter scope
	potential = {
		emf_faction_basic_potential = yes
		liege = {
			is_feudal = yes
			primary_title = {
				has_law = war_voting_power_1
				has_law = law_voting_power_1
			}
		}
		NOR = {
			religion_group = muslim
			religion_group = indian_group
			in_faction = faction_succ_seniority
			in_faction = faction_succ_primogeniture
			in_faction = faction_succ_gavelkind
		}
		OR = {
			emf_laws_no_crown_law_title_trigger = yes # Is not affected by a Crown Law title
			crownlaw_title = { holder_scope = { is_liege_of = ROOT } } # The Crown Law title holder is my liege
			emf_laws_crownlaw_title_high_ca_plus_trigger = no # The Crown Law title allows vassal infighting
			AND = {
				will_liege_enforce_peace = no
				has_liege_enforced_peace = no
			}
		}
	}
	
	# Target scope (ROOT = liege title, FROM = faction leader)
	allow = {
		is_law_potential = succ_feudal_elective
		NOT = { has_law = succ_feudal_elective }
		NOR = {
			has_law = crown_authority_1
			has_law = crown_authority_2
			has_law = crown_authority_3
			has_law = crown_authority_4
		}
		OR = {
			is_primary_holder_title = yes
			higher_tier_than = DUKE
		}
		#the liege title is either de jure to my titles or is titular and primary title
		OR = {
			AND = {
				is_titular = no
				FROM = { any_demesne_title = { de_jure_liege_or_above = ROOT } }
			}
			is_primary_holder_title = yes
		}
		holder_scope = {
			NOT = {
				any_war = { war_title = ROOT }
			}
		}
		FROM = { primary_title = { is_primary_type_title = no } }
	}
	
	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			emf_faction_basic_allow_join = yes
			OR = {
				NOR = {
					in_faction = faction_succ_primogeniture
					in_faction = faction_succ_seniority
					in_faction = faction_succ_gavelkind
				}
				has_character_flag = will_join_civil_war
			}
			NOR = {
				religion_group = muslim
				religion_group = indian_group
			}
		}
	}
	
	# AI creation weight (ROOT = title, FROM = faction creator)
	chance = {
		factor = 1
		modifier = {
			factor = 0.2
			FROM = { pacifist = yes }
		}
		modifier = {
			factor = 0
			FROM = {
				OR = {
					prisoner = yes
					has_character_modifier = in_seclusion
				}
			}
		}
		modifier = {
			factor = 0
			FROM = { lower_tier_than = DUKE }
		}
		modifier = {
			factor = 0
			holder_scope = { lower_tier_than = KING }
		}
		modifier = {
			factor = 0
			holder_scope = { is_married = FROM }
		}
		modifier = {
			factor = 0
			NOR = {
				has_title_flag = former_feudal_elective
				FROM = {
					OR = {
						culture_group = north_germanic
						culture_group = central_germanic
						culture_group = west_germanic
						culture = frankish
						culture = norman
						culture = roman
						culture = nubian
						culture = somali
						culture = occitan
						culture = arpitan
					}
				}		
				FROM = {
					trait = ambitious
					diplomacy = 12
				}
			}
		}
		#the liege title is either de jure to my titles or is titular and primary title
		modifier = {
			factor = 0
			NOR = {
				AND = {
					is_titular = no
					FROM = {
						any_demesne_title = {
							OR = {
								higher_tier_than = COUNT
								ROOT = { lower_tier_than = KING }
							}
							de_jure_liege_or_above = ROOT
						}
					}
				}
				is_primary_holder_title = yes
			}
		}
		# Not for the current heir
		modifier = {
			factor = 0
			current_heir = { character = FROM }
		}
		modifier = {
			factor = 0
			FROM = { primary_title = { is_primary_type_title = yes } }
		}
		# Not for spouse of current heir
		modifier = {
			factor = 0
			current_heir = {
				any_spouse = { character = FROM }
			}
		}
		# Not for children of the present holder
		modifier = {
			factor = 0
			holder_scope = {
				FROM = { is_child_of = PREV }
			}
		}
		# Not for grandchildren of the present holder
		modifier = {
			factor = 0
			holder_scope = {
				any_child = {
					FROM = { is_child_of = PREV }
				}
			}
		}
		# Not for dynasty members under some laws
		modifier = {
			factor = 0
			OR = {
				has_law = succ_seniority
				has_law = succ_tanistry
				has_law = succ_elective_gavelkind
			}
			holder_scope = { dynasty = FROM }
		}
		# If next in line under seniority, choose that plot insetead
		modifier = {
			factor = 0
			would_be_heir_under_law = { who = FROM law = seniority }
		}
		# Try to exclude people who should rather support a claimant
		modifier = {
			factor = 0
			holder_scope = {
				OR = {
					NOT = { culture = FROM }
					NOT = { religion = FROM }
				}
				any_demesne_title = {
					OR = {
						is_primary_holder_title = yes
						higher_tier_than = DUKE
					}
					FROM = {
						primary_title = {
							de_jure_liege_or_above = PREVPREV
						}
					}
					any_claimant = {
						culture = FROM
						religion = FROM
					}
				}
			}
		}
		modifier = {
			factor = 0
			FROM = {
				OR = {
					AND = {
						NOT = { leads_faction = faction_succ_feudal_elective }
						opinion = { who = LIEGE value = 50 } 
					}
					AND = {
						leads_faction = faction_succ_feudal_elective
						opinion = { who = LIEGE value = 75 } 
					}
				}
			}
		}		
		modifier = {
			factor = 0
			FROM = { preparing_invasion = yes }
		}
		modifier = {
			factor = 0.1
			FROM = { 
				opinion = { who = LIEGE value = 0 } 
				NOR = {
					trait = deceitful
					trait = ambitious
					trait = envious
				}
			}
		}		
		modifier = {
			factor = 0
			FROM = { 
				opinion = { who = LIEGE value = 20 } 
				NOR = {
					trait = deceitful
					trait = ambitious
					trait = envious
				}
			}
		}		
		modifier = {
			factor = 0.1
			FROM = {
				opinion = { who = LIEGE value = 20 } 
				OR = {
					trait = deceitful
					trait = ambitious
					trait = envious
				}
			}
		}		
		modifier = {
			factor = 0
			FROM = {
				opinion = { who = LIEGE value = 40 } 
				OR = {
					trait = deceitful
					trait = ambitious
					trait = envious
				}
			}
		}
		modifier = {
			factor = 1.5
			NOT = { FROM = { opinion = { who = LIEGE value = 0 } } }
		}
		modifier = {
			factor = 2.0
			NOT = { FROM = { opinion = { who = LIEGE value = -50 } } }
		}
		modifier = {
			factor = 4.0
			NOT = { FROM = { opinion = { who = LIEGE value = -75 } } }
		}
		modifier = {
			factor = 4.0
			FROM = { is_pretender = yes }
		}
		modifier = {
			factor = 0.01
			FROM = { trait = content }
		}
		modifier = {
			factor = 0.01
			FROM = { trait = imbecile }
		}
		modifier = {
			factor = 0.1
			FROM = { trait = inbred }
		}
		modifier = {
			factor = 0.1
			FROM = { trait = craven }
		}
		modifier = {
			factor = 0.2
			FROM = {
				OR = {
					trait = slow
					trait = dull
				}
			}
		}
		modifier = {
			factor = 0.5
			FROM = { trait = kind }
		}
		modifier = {
			factor = 0.5
			FROM = { trait = charitable }
		}
		modifier = {
			factor = 0.5
			FROM = { trait = honest }
		}
		modifier = {
			factor = 0.75
			FROM = { trait = humble }
		}
		modifier = {
			factor = 0.75
			FROM = { trait = just }
		}
		modifier = {
			factor = 1.5
			FROM = { trait = proud }
		}
		modifier = {
			factor = 1.5
			FROM = { trait = brave }
		}
		modifier = {
			factor = 1.5
			FROM = { trait = arbitrary }
		}
		modifier = {
			factor = 2.0
			FROM = { trait = envious }
		}
		modifier = {
			factor = 2.0
			FROM = { trait = greedy }
		}
		modifier = {
			factor = 2.0
			FROM = { trait = impaler }
		}
		modifier = {
			factor = 2.0
			FROM = { trait = deceitful }
		}
		modifier = {
			factor = 4.0
			FROM = { trait = ambitious }
		}
		modifier = {
			factor = 2
			holder_scope = {
				primary_title = {
					calc_true_if = {
						amount = 6
						has_law = law_voting_power_1
						has_law = banish_voting_power_1
						has_law = execution_voting_power_1
						has_law = revoke_title_voting_power_1
						has_law = grant_title_voting_power_1
						has_law = imprison_voting_power_1
						has_law = war_voting_power_1
					}
				}
			}
		}
	}
	
	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 1
		modifier = {
			factor = 1000
			has_character_flag = will_join_civil_war
			FROM = {
				has_character_flag = demands_feudal_elective
				has_character_flag = civil_war_faction_leader
			}
		}
		modifier = {
			factor = 0.2
			pacifist = yes
		}
		modifier = {
			factor = 0
			OR = {
				prisoner = yes
				has_character_modifier = in_seclusion
				preparing_invasion = yes
			}
		}
		modifier = {
			factor = 2
			FROMFROM = { has_title_flag = former_feudal_elective }
		}
		#the liege title is either de jure to my titles or is titular and primary title
		modifier = {
			factor = 0
			NOR = {
				AND = {
					FROMFROM = { is_titular = no }
					any_demesne_title = { de_jure_liege_or_above = FROMFROM }
				}
				FROMFROM = { is_primary_holder_title = yes }
			}
		}
		# Not for the current heir
		modifier = {
			factor = 0
			FROMFROM = { current_heir = { character = ROOT } }
		}
		# Not for spouse of current heir
		modifier = {
			factor = 0
			FROMFROM = {
				current_heir = {
					any_spouse = { character = ROOT }
				}
			}
		}
		# Not for children of the present holder
		modifier = {
			factor = 0
			FROMFROM = {
				holder_scope = {
					ROOT = { is_child_of = PREV }
				}
			}
		}
		# Not for grandchildren of the present holder
		modifier = {
			factor = 0
			FROMFROM = {
				holder_scope = {
					any_child = {
						ROOT = { is_child_of = PREV }
					}
				}
			}
		}
		# Not for dynasty members under some laws
		modifier = {
			factor = 0
			FROMFROM = {
				OR = {
					has_law = succ_seniority
					has_law = succ_tanistry
					has_law = succ_elective_gavelkind
				}
				holder_scope = { dynasty = ROOT }
			}
		}
		# If next in line under seniority, choose that plot insetead
		modifier = {
			factor = 0
			NOT = { has_character_flag = will_join_civil_war }
			FROMFROM = {
				would_be_heir_under_law = { who = ROOT law = seniority }
			}
		}
		modifier = {
			factor = 0
			NOT = { has_character_flag = will_join_civil_war }
			OR = {
				AND = {
					NOT = { in_faction = faction_succ_feudal_elective }
					opinion_diff = {
						first = LIEGE
						second = FROM
						value = 10 # I like my liege rather a lot more than the faction leader
						as_if_liege = yes
					}
				}
				AND = {
					in_faction = faction_succ_feudal_elective
					opinion_diff = {
						first = LIEGE
						second = FROM
						value = 25
						as_if_liege = yes
					}
				}
			}
		}
		modifier = {
			factor = 0
			NOT = { has_character_flag = will_join_civil_war }
			OR = {
				AND = {
					NOT = { in_faction = faction_succ_feudal_elective }
					opinion = { who = LIEGE value = 50 } 
				}
				AND = {
					in_faction = faction_succ_feudal_elective
					opinion = { who = LIEGE value = 75 } 
				}
			}
		}
		modifier = {
			factor = 0.1
			opinion = { who = LIEGE value = 0 } 
			NOT = {
				trait = deceitful
				trait = ambitious
				trait = envious
			}
		}
		modifier = {
			factor = 0
			opinion = { who = LIEGE value = 20 } 
			NOT = {
				trait = deceitful
				trait = ambitious
				trait = envious
			}
		}
		modifier = {
			factor = 0.1
			opinion = { who = LIEGE value = 20 } 
			OR = {
				trait = deceitful
				trait = ambitious
				trait = envious
			}
		}
		modifier = {
			factor = 0
			opinion = { who = LIEGE value = 40 } 
			OR = {
				trait = deceitful
				trait = ambitious
				trait = envious
			}
		}
		modifier = {
			factor = 2.0
			opinion_diff = {
				first = FROM
				second = LIEGE
				value = 25
				as_if_liege = yes
			}
		}
		modifier = {
			factor = 0.01
			trait = content
			NOT = { has_character_flag = will_join_civil_war }
		}
		modifier = {
			factor = 0.01
			trait = imbecile
			NOT = { has_character_flag = will_join_civil_war }
		}
		modifier = {
			factor = 0.1
			trait = inbred
			NOT = { has_character_flag = will_join_civil_war }
		}
		modifier = {
			factor = 0.1
			trait = craven
			NOT = { has_character_flag = will_join_civil_war }
		}
		modifier = {
			factor = 0.2
			OR = {
				trait = slow
				trait = dull
			}
		}
		modifier = {
			factor = 0.5
			trait = kind
		}
		modifier = {
			factor = 0.5
			trait = charitable
		}
		modifier = {
			factor = 0.5
			trait = honest
		}
		modifier = {
			factor = 0.75
			trait = humble
		}
		modifier = {
			factor = 0.75
			trait = just
		}
		modifier = {
			factor = 1.5
			trait = proud
		}
		modifier = {
			factor = 1.5
			trait = brave
		}
		modifier = {
			factor = 1.5
			trait = arbitrary
		}
		modifier = {
			factor = 2.0
			trait = envious
		}
		modifier = {
			factor = 2.0
			trait = greedy
		}
		modifier = {
			factor = 2.0
			trait = impaler
		}
		modifier = {
			factor = 2.0
			trait = deceitful
		}
		modifier = {
			factor = 4.0
			trait = ambitious
		}
		modifier = {
			factor = 0.75
			liege = {
				primary_title = {
					calc_true_if = {
						amount = 2
						has_law = law_voting_power_1
						has_law = banish_voting_power_1
						has_law = execution_voting_power_1
						has_law = revoke_title_voting_power_1
						has_law = grant_title_voting_power_1
						has_law = imprison_voting_power_1
						has_law = war_voting_power_1
					}
				}
			}
		}
		modifier = {
			factor = 0.75
			liege = {
				primary_title = {
					calc_true_if = {
						amount = 4
						has_law = law_voting_power_1
						has_law = banish_voting_power_1
						has_law = execution_voting_power_1
						has_law = revoke_title_voting_power_1
						has_law = grant_title_voting_power_1
						has_law = imprison_voting_power_1
						has_law = war_voting_power_1
					}
				}
			}
		}
		modifier = {
			factor = 0.75
			liege = {
				primary_title = {
					calc_true_if = {
						amount = 6
						has_law = law_voting_power_1
						has_law = banish_voting_power_1
						has_law = execution_voting_power_1
						has_law = revoke_title_voting_power_1
						has_law = grant_title_voting_power_1
						has_law = imprison_voting_power_1
						has_law = war_voting_power_1
					}
				}
			}
		}
	}

	success = {
		has_law = succ_feudal_elective
	}
	abort = {
		always = no		# Factions will abort if the Potential or Allow triggers are no longer valid
	}
	abort_effect = {
	}
	effect = {
		FROM = {
			any_faction_backer = {
				faction = faction_succ_feudal_elective
				reverse_opinion = {
					modifier = opinion_grateful
					who = FROM
					years = 5
				}
			}
		}
	}
}


