# Scripted triggers for PlusFaction, prefixed by 'pf_'

pf_leader_trigger = {
	OR = {
		leads_faction = faction_court
		leads_faction = faction_prosperity
		leads_faction = faction_glory
		leads_faction = faction_tradition
	}
}

pf_member_trigger = {
	OR = {
		in_faction = faction_court
		in_faction = faction_prosperity
		in_faction = faction_glory
		in_faction = faction_tradition
	}
}

pf_war_trait_trigger = {
	OR = {
		trait = rebel
		trait = loyalist
		trait = neutral
	}
}


pf_war_flag_trigger = {
	OR = {
		has_character_flag = faction_court_war
		has_character_flag = faction_prosperity_war
		has_character_flag = faction_glory_war
		has_character_flag = faction_tradition_war
		has_character_flag = faction_pretender_war
		has_character_flag = faction_separatist_war
		has_character_flag = faction_religious_war
		has_character_flag = faction_succession_war
		has_character_flag = faction_authority_war
	}
}


# Fill this with an OR of all the CBs associated with PF civil war mechanics
pf_cb_trigger = {
	using_cb = cb_faction_overthrow_ruler
}


# Not to be confused with "part of this revolt": this is the `in_revolt = yes` equivalent for PF revolts (only)
pf_in_revolt_trigger = {
	is_ruler = yes
	liege = {
		in_revolt = yes
		any_war = {
			attacker = {
				character = PREVPREV
				OR = {
					character = PREVPREVPREV
					reverse_has_opinion_modifier = { who = PREVPREVPREV modifier = revolting_for }
				}
				pf_cb_trigger = yes
			}
		}
	}
}


# Like `war_with` but requires an actual war between THIS and ROOT-- not just hostility
pf_real_war_with_ROOT_trigger = {
	any_war = {
		OR = {
			AND = {
				any_attacker = { character = ROOT }
				any_defender = { character = PREVPREV }
			}
			AND = {
				any_defender = { character = ROOT }
				any_attacker = { character = PREVPREV }
			}
		}
	}
}

# used inside of an any_faction_backer scope (typically), PREV is assumed to be
# faction leader
pf_my_faction_backer_trigger = {
	OR = {
		AND = {
			PREV = { leads_faction = faction_court }
			in_faction = faction_court
		}
		AND = {
			PREV = { leads_faction = faction_prosperity }
			in_faction = faction_prosperity
		}
		AND = {
			PREV = { leads_faction = faction_glory }
			in_faction = faction_glory
		}
		AND = {
			PREV = { leads_faction = faction_tradition }
			in_faction = faction_tradition
		}
	}
}

# used inside of an any_vassal scope (typically), ROOT is assumed to be
# faction leader. identical to pf_my_faction_backer_trigger except that
# ROOT is assumed to be the faction leader and not necessarily PREV.
# [ see, this is why it'd be great if scripted triggers and effects could
#   optionally take a scope / target as a right-hand-side parameter too! ]
pf_root_faction_backer_trigger = {
	OR = {
		AND = {
			ROOT = { leads_faction = faction_court }
			in_faction = faction_court
		}
		AND = {
			ROOT = { leads_faction = faction_prosperity }
			in_faction = faction_prosperity
		}
		AND = {
			ROOT = { leads_faction = faction_glory }
			in_faction = faction_glory
		}
		AND = {
			ROOT = { leads_faction = faction_tradition }
			in_faction = faction_tradition
		}
	}
}

# see above (redundancy, be gone!)
pf_from_faction_backer_trigger = {
	OR = {
		AND = {
			FROM = { leads_faction = faction_court }
			in_faction = faction_court
		}
		AND = {
			FROM = { leads_faction = faction_prosperity }
			in_faction = faction_prosperity
		}
		AND = {
			FROM = { leads_faction = faction_glory }
			in_faction = faction_glory
		}
		AND = {
			FROM = { leads_faction = faction_tradition }
			in_faction = faction_tradition
		}
	}
}


pf_my_faction_angry_trigger = {
	OR = {
		AND = {
			leads_faction = faction_court
			liege = { has_character_flag = faction_court_angry }
		}
		AND = {
			leads_faction = faction_prosperity
			liege = { has_character_flag = faction_prosperity_angry }
		}
		AND = {
			leads_faction = faction_glory
			liege = { has_character_flag = faction_glory_angry }
		}
		AND = {
			leads_faction = faction_tradition
			liege = { has_character_flag = faction_tradition_angry }
		}
	}
}


pf_councillor_court_trigger = {
	OR = {
		job_chancellor = { in_faction = faction_court }
		job_marshal    = { in_faction = faction_court }
		job_treasurer  = { in_faction = faction_court }
		job_spymaster  = { in_faction = faction_court }
		job_spiritual  = { in_faction = faction_court }
	}
}

pf_councillor_prosperity_trigger = {
	job_treasurer = { in_faction = faction_prosperity }
}

pf_councillor_glory_trigger = {
	job_marshal = { in_faction = faction_glory }
}

pf_councillor_tradition_trigger = {
	job_spiritual = { in_faction = faction_tradition }
}


pf_tradition_approved_war_trigger = {
	any_war = {
		OR = {
			AND = {
				any_attacker = { character = PREVPREV }
				OR = {
					using_cb = crusade
					using_cb = religious
					using_cb = excommunicated_ruler
					using_cb = depose_antipope
					using_cb = cb_decadence_usurption
					using_cb = emf_religious_reconquest
					using_cb = emf_special_religious
					using_cb = emf_muslim_county_conquest_religious
					AND = {
						defender = { not = { religion_group = PREVPREV } }
						OR = {
							using_cb = tributary_cb
							using_cb = free_tributary_cb
						}
					}
				}
			}
			AND = {
				any_defender = { character = PREVPREV }
				attacker = { NOT = { religion = PREVPREV } }
				OR = {
					using_cb = tribal_invasion
					using_cb = crusade
					using_cb = religious
					using_cb = muslim_invasion
					using_cb = viking_invasion
					using_cb = pagan_county_conquest
					using_cb = shia_caliphate_rising
					using_cb = manifest_destiny_invasion
					using_cb = tributary_cb
					using_cb = nomad_invasion
					using_cb = emf_religious_reconquest
					using_cb = emf_special_religious
					using_cb = emf_horde_invasion
					using_cb = emf_muslim_county_conquest_religious
				}
			}
		}
	}
}

pf_part_of_this_revolt_trigger = {
	has_opinion_modifier = { who = PREV modifier = revolting_against }
	OR = {
		any_war = {
			attacker = { character = ROOT }
			any_attacker = { character = PREVPREV }
			defender = { character = event_target:current_holder }
		}
		AND = { vassal_of = ROOT in_revolt = yes }
		vassal_of = PREV
	}
}
