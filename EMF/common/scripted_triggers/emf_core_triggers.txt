# -*- ck2.scripted_triggers -*-


#### EMF CORE PROPERTIES TRIGGERS ####

emf_peace_trigger = {
	OR = {
		war = no
		NOT = {
			# Only consider wars in which we're primary defender/attacker
			any_war = {
				OR = {
					defender = { character = PREV }
					attacker = { character = PREV }
				}
			}
		}
	}
}

emf_feminist_religion_trigger = {
	OR = {
		religion = cathar
		religion = messalian
		religion = bogomilist
		religion = mazdaki
		religion = tondrakian
		religion = buddhist
		religion = druze
	}
}

emf_can_excommunicate_trigger = {
	OR = {
		religion = catholic
		religion = fraticelli
		religion = orthodox
		religion = bogomilist
		religion = monothelite
		religion = iconoclast
		religion = miaphysite
		religion = monophysite
		religion = apostolic
		religion = nestorian
	}
}

emf_formidable_woman_trigger = {
	is_female = yes
	trait = ambitious
	calc_true_if = {
		amount = 2
		diplomacy = 20
		martial = 20
		intrigue = 20
		diplomacy = 15
		martial = 15
		intrigue = 15
		trait = genius
		trait = quick
	}
	NOR = {
		trait = humble
		trait = shy
		trait = slothful
		trait = content
		trait = inbred
		trait = slow
		trait = incapable
	}
}

#### UTILITY/CONVENIENCE TRIGGERS ####

# Version of `completely_controls` that doesn't care about baron-tier control
#
# THIS = Duke/King/Empire title (if titular has same behavior as completely_controls)
# ROOT = Ruler

emf_can_inherit_trigger = {
	NOR = {
		trait = bastard
		trait = monk
		trait = nun
		trait = desert_father
		trait = desert_mother
		trait = eunuch
		trait = horse
		AND = { # TODO: verify that this covers all cultures in SWMH which disinherit_from_blinding = yes
			culture_group = byzantine
			trait = blinded
		}
		is_consort = yes # Concubines cannot inherit
		holy_order = yes
		any_liege = { holy_order = yes }
		AND = {
			NOR = {
				religion_group = pagan_group
				religion_group = muslim
			}
			OR = {
				is_theocracy = yes
				AND = { # Nominees
					is_ruler = no
					any_heir_title = { is_theocracy = yes }
				}
			}
		}
	}
}

emf_needs_extra_child = {
	ai = yes
	age = 30
	NOR = {
		age = 70
		holy_order = yes
		mercenary = yes
		is_theocracy = yes
		any_child = { is_female = yes }
		has_character_flag = emf_initial_child_check
	}
	OR = {
		any_child = {
			emf_can_inherit_trigger = yes
			age = 22
		}
		succ_law_title = {
			NOT = { has_law = cognatic_succession }
			NOT = { has_law = true_cognatic_succession }
		}
		AND = {
			succ_law_title = { has_law = cognatic_succession }
			any_child = {
				emf_can_inherit_trigger = yes
				is_female = no
			}
		}
	}
}

emf_minor_title_basic_allowed_to_hold_trigger = {
	OR = {
		is_ruler = no
		primary_title = { temporary = no }
	}
}

emf_hiprio_decision_basic_potential_trigger = {
	OR = {
		AND = {
			multiplayer = yes
			NOT = { is_multiplayer_host_character = yes }
		}
		had_global_flag = { flag = EMF days = 1 }
	}
}

emf_can_disturb_trigger = {
	NOT = { has_character_flag = do_not_disturb }
}

emf_ROOT_completely_controls_counties_trigger = {
	custom_tooltip = {
		text = emf_ctt_ROOT_completely_controls_counties_trigger
		hidden_tooltip = {
			NOT = {
				any_de_jure_vassal_title = {
					tier = COUNT
					owner_under_ROOT = no
				}
			}
		}
	}
}

emf_swmh_trigger = {
	custom_tooltip = {
		text = emf_ctt_swmh_trigger
		hidden_tooltip = { has_global_flag = SWMH }
	}
}
emf_not_swmh_trigger = { # Defined separately to give a custom negation tooltip
	custom_tooltip = {
		text = emf_ctt_swmh_trigger_not
		hidden_tooltip = { NOT = { has_global_flag = SWMH } }
	}
}

# opinion mods for things like "can imprison" or "can execute"
can_execute_ROOT = {
	OR = {
		has_opinion_modifier = { who = ROOT modifier = declared_war }
		has_opinion_modifier = { who = ROOT modifier = opinion_traitor }
		has_opinion_modifier = { who = ROOT modifier = opinion_rebel_traitor }
		has_opinion_modifier = { who = ROOT modifier = opinion_regicide_traitor }
		has_opinion_modifier = { who = ROOT modifier = opinion_targeted_by_adventurer }
		has_opinion_modifier = { who = ROOT modifier = attempted_murder_of_spouse }
		has_opinion_modifier = { who = ROOT modifier = attempted_murder_of_child }
		has_opinion_modifier = { who = ROOT modifier = attempted_murder_of_parent }
		has_opinion_modifier = { who = ROOT modifier = attempted_murder_of_sibling }
		has_opinion_modifier = { who = ROOT modifier = attempted_murder_of_vassal }
		has_opinion_modifier = { who = ROOT modifier = attempted_murder }
		has_opinion_modifier = { who = ROOT modifier = opinion_spouse_slayer }
		has_opinion_modifier = { who = ROOT modifier = opinion_murder_attempt }
		has_opinion_modifier = { who = ROOT modifier = opinion_killed_close_kin }
		has_opinion_modifier = { who = ROOT modifier = opinion_witch }
		has_opinion_modifier = { who = ROOT modifier = opinion_unfaithful_wife }
		has_opinion_modifier = { who = ROOT modifier = opinion_unfaithful_husband }
		has_opinion_modifier = { who = ROOT modifier = attempted_kidnapping }
		has_opinion_modifier = { who = ROOT modifier = attempted_kidnapping_of_kin }
		has_opinion_modifier = { who = ROOT modifier = attempted_kidnapping_of_vassal }
		has_opinion_modifier = { who = ROOT modifier = devious_plotter }
		has_opinion_modifier = { who = ROOT modifier = opinion_kidnapped_kin }
		has_opinion_modifier = { who = ROOT modifier = opinion_civil_war_loser }
	}
}
