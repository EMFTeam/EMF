
# THIS = adventurer
emf_adventurer_is_valid_trigger = {
	has_character_modifier = planning_claimant_adventure
	NOR = {
		prisoner = yes
		trait = incapable
		any_demesne_title = { adventurer = no }
	}
	any_independent_ruler = {
		is_landed = yes
		has_opinion_modifier = { who = PREV modifier = opinion_targeted_by_adventurer }
		reverse_has_opinion_modifier = { who = PREV modifier = opinion_claimant_adventure_target }
		any_demesne_title = { claimed_by = PREVPREV }
	}
}

# THIS = potential host, ROOT = adventurer
emf_adventurer_can_approach_trigger = {
	is_playable = yes
	is_landed = yes
	religion_group = ROOT
	NOR = {
		is_heresy_of = ROOT
		is_parent_religion = ROOT
	}
	NOT = { has_character_flag = emf_adv_approached_@ROOT }
	capital_scope = { owner = { character = PREVPREV } } # Need to own their capital province
	NOR = {
		character = event_target:emf_adv_target
		reverse_has_opinion_modifier = { who = ROOT modifier = turned_adventurer_away }
		reverse_has_opinion_modifier = { who = ROOT modifier = let_adventurer_stay }
		reverse_has_opinion_modifier = { who = ROOT modifier = backed_adventurer }
		reverse_has_opinion_modifier = { who = ROOT modifier = betrayed_adventurer }
	}
	# Need to have provinces from which we can recruit (i.e., other adventurers haven't already depleted them all recently)
	any_realm_province = { NOT = { has_province_modifier = adventurer_recruited } }
}

# THIS = "vassal" (or below, of some host) to approach, ROOT = adventurer
emf_adventurer_can_approach_vassal_trigger = {
	wealth = 10
	is_adult = yes
	prisoner = no
	NOT = { has_character_flag = emf_adv_approached_@ROOT }
	OR = {
		dynasty = ROOT
		is_close_relative = ROOT
		any_spouse = { is_close_relative = ROOT }
		opinion = { who = ROOT value = 40 }
		NOT = { opinion = { who = event_target:emf_adv_target value = -40 } }
	}
	NOR = {
		trait = incapable
		reverse_has_opinion_modifier = { who = ROOT modifier = turned_adventurer_away }
		reverse_has_opinion_modifier = { who = ROOT modifier = let_adventurer_stay }
		reverse_has_opinion_modifier = { who = ROOT modifier = backed_adventurer }
		reverse_has_opinion_modifier = { who = ROOT modifier = betrayed_adventurer }
		reverse_has_opinion_modifier = { who = ROOT modifier = refused_adventurer }
	}
}

# THIS = province, ROOT = adventurer
emf_adventurer_can_recruit_province_trigger = {
	NOR = {
		has_province_flag = emf_adv_recruited_@ROOT
		has_province_modifier = adventurer_recruited
		any_province_holding = { is_occupied = yes }
	}
}

# ROOT = adventurer
emf_adventurer_like_adventurer_trigger = {
	OR = {
		is_close_relative = ROOT
		is_friend = ROOT
		opinion = { who = ROOT value = 40 }
	}
}

# ROOT = adventurer
emf_adventurer_hate_adventurer_target_trigger = {
	OR = {
		NOT = { opinion = { who = event_target:emf_adv_target value = -40 } }
		is_rival = event_target:emf_adv_target
		war_with = event_target:emf_adv_target
		AND = {
			is_foe = event_target:emf_adv_target
			NOT = { opinion = { who = event_target:emf_adv_target value = 0 } }
		}
	}
}

# ROOT = adventurer, THIS = adventurer's claim
emf_adventurer_claim_is_valid_target_basic_trigger = {
	# only held count- or above-tier de jure titles (unless primary) that aren't landless
	higher_tier_than = BARON
	is_landless_type_title = no
	OR = {
		is_primary_holder_title = yes
		is_titular = no
	}
	holder_scope = {
		# independent and landed (also implies not in a rebellion)
		independent = yes
		is_landed = yes
		# weak claims only allowed against women/regencies/recent-succession unless claimant is ambitious
		OR = {
			ROOT = { has_strong_claim = PREVPREV }
			ROOT = { trait = ambitious }
			is_female = yes
			OR = { # appropriate regencies, not merely traveling or some such
				is_adult = no
				trait = incapable
			}
			has_character_modifier = emf_mod_recent_succession
		}
		# not held by theocracy of claimant's religion
		NAND = {
			is_theocracy = yes
			religion = ROOT
		}
		# cannot target nomads for their clan title or primary title
		NAND = {
			is_nomadic = yes
			OR = {
				clan_title = { title = PREVPREV }
				primary_title = { title = PREVPREV }
			}
		}
		# cannot target merchant republics if their capital is a de jure vassal of the title
		NAND = {
			is_merchant_republic = yes
			capital_holding = { de_jure_liege_or_above = PREVPREV }
		}
		# cannot not like the target too much
		NOT = { reverse_opinion = { who = ROOT value = 25 } }
		# cannot be targeted by another adventurer or have been recently targeted
		NOR = {
			has_character_modifier = adventurer_target_timer
			has_any_opinion_modifier = opinion_targeted_by_adventurer
		}
		# cannot target close relatives unless they are hated or the claimant is a bastard
		OR = {
			ROOT = { trait = bastard }
			NOT = { reverse_opinion = { who = ROOT value = -25 } }
			NOT = { is_close_relative = ROOT }
		}
	}
}

# ROOT = adventurer, THIS = adventurer's claim
emf_adventurer_claim_is_valid_target_female_trigger = {
	succ_law_title = {
		OR = {
			has_law = true_cognatic_succession
			AND = {
				holder_scope = { is_female = yes }
				has_law = cognatic_succession
			}
		}
	}
}

# ROOT = duchy adventurer, THIS = target
emf_adventurer_duchy_target_trigger = {
	num_of_count_titles = 1
	OR = {
		is_theocracy = no
		NOT = { religion = ROOT }
	}
	NOR = {
		same_realm = ROOT
		dynasty = ROOT
		any_spouse = { character = ROOT }
		reverse_opinion = { who = ROOT value = 25 }
		has_any_opinion_modifier = opinion_targeted_by_adventurer
	}
}

# ROOT = duchy adventurer, THIS = province
emf_adventurer_duchy_target_distance_trigger = {
	OR = {
		any_neighbor_province = {
			owner = { same_realm = ROOT }
		}
		ROOT = {
			top_liege = {
				any_realm_province = {
					NOT = { distance = { where = PREVPREVPREV value = 75 } }
				}
			}
		}
	}
}

