# -*- ck2.scripted_triggers -*-

#### LANDED TITLES TRIGGERS ####

title_duke_basic_allow = {
    is_primary_war_defender = no
    conditional_tooltip = {
        trigger = {
            FROM = { is_titular = yes }
            OR = {
                ai = no
                lower_real_tier_than = FROM
            }
        }
        custom_tooltip = {
            text = emf_ctt_has_not_become_defunct_titular_title
            hidden_tooltip = { NOT = { has_title_flag = emf_autodestroy_defunct } }
        }
    }
}

title_king_basic_allow = {
    conditional_tooltip = {
        trigger = { NOT = { has_character_flag = emf_aed_in_progress_tmp } }
        is_primary_war_defender = no
        is_adult = yes
        has_regent = no
        FROM = {
            conditional_tooltip = {
                trigger = { NOT = { is_title_active = THIS } }
                custom_tooltip = { text = emf_ctt_title_is_active hidden_tooltip = { always = no } }
            }
            conditional_tooltip = {
                trigger = { has_holder = no }
                conditional_tooltip = {
                    trigger = { is_de_jure_title = no }
                    ROOT = {
                        independent = yes
                        conditional_tooltip = {
                            trigger = { is_republic = no }
                            num_of_count_titles_in_realm = 5
                        }
                        # EMF allows emperor AI to create kingdoms, but we don't want them spamming titular ones (they would)
                        conditional_tooltip = {
                            trigger = { ai = yes }
                            lower_tier_than = EMPEROR
                        }
                    }
                }
                conditional_tooltip = {
                    trigger = { is_de_jure_title = yes }
                    conditional_tooltip = {
                        trigger = { NOT = { title = k_bohemia } } # Bohemia is a magical, lawless wonderland of glitter
                        conditional_tooltip = {
                            trigger = { empire = { owner = { same_realm = ROOT } } }
                            empire = { # Effectively never null in EMF
                                conditional_tooltip = {
                                    trigger = { NOT = { holder = ROOT } }
                                    NOR = {
                                        has_law = imperial_kingdom_creation_0
                                        has_law = imperial_kingdom_creation_2
                                    }
                                }
                                conditional_tooltip = {
                                    trigger = { holder = ROOT }
                                    NOT = { has_law = imperial_kingdom_creation_0 }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}

title_emperor_basic_allow = {
    war = no
    is_adult = yes # for that brief moment when a child isn't auto-assigned a regent, plus better TT
    has_regent = no
    ruled_years = 5
    realm_size = 120
    OR = {
        lower_real_tier_than = EMPEROR
        AND = {
            is_nomadic = no
            primary_title = { is_titular_title = yes }
            FROM = { is_de_jure_title = yes }
        }
    }
}


#### MISC ####

# THIS = title being qualified for the titular title autodestruction mechanic
#
# it is assumed that the owner = { ai = yes } for the general mechanic (as well as several other things, such as the
# fact that we obviously won't destroy a primary title unless we have a same-tier title to which we can switch, etc.)
emf_can_autodestroy_title = {
    higher_tier_than = COUNT
    OR = {
        has_title_flag = emf_autodestroy
        AND = {
            emf_can_safely_autodestroy_title = yes
            NOR = {
                has_title_flag = emf_autodestroy_exemption
                has_title_flag = emf_custom_created
            }
        }
    }
}

emf_can_safely_autodestroy_title = {
    is_primary_type_title = no
    is_landless_type_title = no
    controls_religion = no
    temporary = no
    mercenary = no
    holy_order = no
    clan = no
    adventurer = no
    rebel = no
}

emf_is_roman_empire = {
    OR = {
        title = e_byzantium
        title = e_roman_empire
    }
}
