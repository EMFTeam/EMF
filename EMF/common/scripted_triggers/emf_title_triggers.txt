# -*- ck2.scripted_triggers -*-

#### LANDED TITLES TRIGGERS ####

title_duke_basic_allow = {
    FROM = {
        custom_tooltip = {
            text = emf_ctt_has_not_become_defunct_titular_title
            hidden_tooltip = {
                ROOT = { ai = no } # only let players create titular duchies, as the AI seems to spam them unnecessarily
                OR = {
                    is_titular = no
                    NOT = { has_title_flag = emf_autodestroy_defunct }
                }
            }
        }
    }
}

title_king_basic_allow = {
    OR = {
        hidden_tooltip = { has_character_flag = emf_aed_in_progress_tmp }
        AND = {
            is_primary_war_defender = no
            is_adult = yes
            has_regent = no
            FROM = {
                custom_tooltip = {
                    text = emf_ctt_title_is_active
                    hidden_tooltip = { is_title_active = THIS }
                }
                OR = {
                    has_holder = yes # Usurpation always permitted
                    # Independent rulers can create titular kingdoms
                    AND = {
                        is_titular_title = yes
                        ROOT = {
                            independent = yes
                            OR = {
                                num_of_count_titles_in_realm = 5
                                is_republic = yes
                            }
                        }
                    }
                    custom_tooltip = {
                        text = emf_laws_ctt_dj_empire_no_holder_or_not_same_realm
                        hidden_tooltip = {
                            NOT = { empire = { owner = { same_realm = ROOT } } }
                        }
                    }
                    custom_tooltip = {
                        text = emf_laws_ctt_dj_empire_vassal_can_create_kingdoms
                        hidden_tooltip = {
                            empire = {
                                NOR = {
                                    has_law = imperial_kingdom_creation_0
                                    has_law = imperial_kingdom_creation_2
                                }
                                owner = { is_vassal_or_below = ROOT }
                            }
                        }
                    }
                    custom_tooltip = {
                        text = emf_laws_ctt_dj_empire_emperor_can_create_kingdoms
                        hidden_tooltip = {
                            empire = {
                                NOT = { has_law = imperial_kingdom_creation_0 }
                                holder = ROOT
                            }
                        }
                    }
                    title = k_bohemia
                }
            }
        }
    }
}

title_emperor_basic_allow = {
    war = no
    is_adult = yes # for that brief moment when a child isn't auto-assigned a regent, plus better TT
    has_regent = no
    ruled_years = 5
    realm_size = 120
    OR = {
        lower_real_tier_than = EMPEROR
        AND = {
            is_nomadic = no
            primary_title = { is_titular_title = yes }
            FROM = { is_de_jure_title = yes }
        }
    }
}


#### MISC ####

# THIS = title being qualified for the titular title autodestruction mechanic
#
# it is assumed that the owner = { ai = yes } for the general mechanic (as well as several other things, such as the
# fact that we obviously won't destroy a primary title unless we have a same-tier title to which we can switch, etc.)
emf_can_autodestroy_title = {
    higher_tier_than = COUNT
    OR = {
        has_title_flag = emf_autodestroy
        AND = {
            emf_can_safely_autodestroy_title = yes
            NOR = {
                has_title_flag = emf_autodestroy_exemption
                has_title_flag = emf_custom_created
            }
        }
    }
}

emf_can_safely_autodestroy_title = {
    is_primary_type_title = no
    is_landless_type_title = no
    controls_religion = no
    temporary = no
    mercenary = no
    holy_order = no
    clan = no
    adventurer = no
    rebel = no
}

emf_is_roman_empire = {
    OR = {
        title = e_byzantium
        title = e_roman_empire
    }
}
