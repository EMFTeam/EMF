# -*- ck2.council_voting -*-

friend_pattern_for = {
	icon = 16
	pattern_type = for
	
	##### INTERACTIONS
	
	declare_war_interaction = {
	# Councilor's friend might gain a title
		custom_tooltip = {
			text = pattern_friend_gain_title_custom_tooltip
			hidden_tooltip = {
				FROMFROMFROM = { # Gainer
					is_friend = ROOT
					NOT = { is_foe = ROOT }
				}	
			}
		}
	}
	ask_to_join_war_interaction = {
		OR = {
			custom_tooltip = {
				text = pattern_friend_affected_positively_custom_tooltip
				hidden_tooltip = {
					FROMFROM = { # Gainer
						is_friend = ROOT
						NOT = { is_foe = ROOT }
					}
				}
			}
			custom_tooltip = {
				text = pattern_friend_helps_my_ally_custom_tooltip
				hidden_tooltip = {
					FROMFROM = { # Gainer
						any_allied_character = {
							is_friend = ROOT
							NOT = { is_foe = ROOT }
						}
					}
				}
			}
		}
	}
	form_non_aggression_pact_interaction = {
		custom_tooltip = {
			text = pattern_friend_affected_positively_custom_tooltip
			hidden_tooltip = {
				FROMFROM = {
					is_friend = ROOT
					NOT = { is_foe = ROOT }
				}
			}
		}
	}
	form_alliance_interaction = {
		custom_tooltip = {
			text = pattern_friend_affected_positively_custom_tooltip
			hidden_tooltip = {
				FROMFROM = {
					is_friend = ROOT
					NOT = { is_foe = ROOT }
				}
			}
		}
	}
	
	# ROOT - Voter, FROM - Actor, FROMFROM - Recipient, FROMFROMFROM - Revoked title.
	grant_landed_title_interaction = {
		custom_tooltip = {
			text = pattern_friend_gain_title_custom_tooltip
			hidden_tooltip = {
				FROMFROM = {
					is_friend = ROOT
					NOT = { is_foe = ROOT }
				}	
			}
		}
	}
	transfer_vassal_interaction = {
		custom_tooltip = {
			text = pattern_friend_gain_title_custom_tooltip
			hidden_tooltip = {
				FROMFROM = {
					is_friend = ROOT
					NOT = { is_foe = ROOT }
				}
			}
		}
	}
	release_vassal_interaction = {
		custom_tooltip = {
			text = pattern_friend_indepedence_custom_tooltip
			hidden_tooltip = {
				FROMFROM = {
					is_friend = ROOT
					NOT = { is_foe = ROOT }
					in_faction = faction_independence
				}
			}
		}
	}
	offer_vassalization_interaction = {
		custom_tooltip = {
			text = pattern_friend_no_independence_custom_tooltip
			hidden_tooltip = {
				FROMFROM = {
					is_friend = ROOT
					NOT = { is_foe = ROOT }
					NOT = { in_faction = faction_independence }
					opinion = { who = FROM value = -30 }
					OR = {
						de_jure_liege_or_above = FROM
						culture_group = FROM
						AND = {
							culture = FROM
							religion = FROM
						}
					}
				}
			}
		}
	}
	release_tributary = {
		custom_tooltip = {
			text = pattern_friend_affected_positively_custom_tooltip
			hidden_tooltip = {
				FROMFROM = {
					is_friend = ROOT
					NOT = { is_foe = ROOT }
				}
			}
		}
	}
	ask_for_vassalization_interaction = {
		custom_tooltip = {
			text = pattern_friend_gain_title_custom_tooltip
			hidden_tooltip = {
				FROMFROM = { # Gainer
					is_friend = ROOT
					NOT = { is_foe = ROOT }
				}	
			}
		}
	}
	recruit_prisoner = {
		custom_tooltip = {
			text = pattern_friend_affected_positively_custom_tooltip
			hidden_tooltip = {
				FROMFROM = {
					is_friend = ROOT
					NOT = { is_foe = ROOT }
				}
			}
		}
	}
	emf_prisoner_house_arrest = {
		custom_tooltip = {
			text = pattern_friend_affected_positively_custom_tooltip
			hidden_tooltip = {
				FROMFROM = {
					is_friend = ROOT
					NOT = { is_foe = ROOT }
				}
			}
		}
	}
	emf_prisoner_dungeon = {
		custom_tooltip = {
			text = pattern_friend_affected_positively_custom_tooltip
			hidden_tooltip = {
				FROMFROM = {
					is_friend = ROOT
					NOT = { is_foe = ROOT }
					has_character_modifier = the_oubliette
				}
			}
		}
	}
	release_from_prison_interaction = {
		custom_tooltip = {
			text = pattern_friend_affected_positively_custom_tooltip
			hidden_tooltip = {
				FROMFROM = {
					is_friend = ROOT
					NOT = { is_foe = ROOT }
				}
			}
		}
	}
	
	enforce_peace = {
		OR = {
			custom_tooltip = {
				text = pattern_friend_save_my_hide_custom_tooltip
				hidden_tooltip = {
					any_war = {
						any_defender = {
							is_friend = ROOT
							NOT = { is_foe = ROOT }
						}
						attacker = {
							is_liege_or_above = FROM
						}
						OR = {
							war_score = -5
							defender = {
								attacker = {
									relative_power_including_allies_attacker = {
										who = PREV # Defender
										power = 1.0
									}
								}
							}
						}
					}
				}
			}

			custom_tooltip = {
				text = pattern_friend_save_ally_custom_tooltip
				hidden_tooltip = {
					any_friend = {
						NOT = { is_foe = ROOT }
						any_allied_character = {
							NOT = { is_foe = ROOT }
							any_war = {
								defender = {
									any_allied_character = {
										is_friend = ROOT
										NOT = { is_foe = ROOT }
										is_liege_or_above = FROM
									}
								}
								attacker = {
									is_liege_or_above = FROM
								}
								OR = {
									war_score = -5
									defender = {
										attacker = {
											relative_power_including_allies_attacker = {
												who = PREV # Defender
												power = 1.0
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
	
	##### LAWS
	
	# If religious head is friend and king is not a friend, vote yes on papal investiture
	investiture_law_0 = {
		NOT = {
			FROMFROM = {
				is_friend = ROOT
				NOT = { is_foe = ROOT }
			}
		}
		OR = {
			religion_head = {
				is_friend = ROOT
				NOT = { is_foe = ROOT }
			}
			FROMFROM = {
				religion_head = {
					is_friend = ROOT
					NOT = { is_foe = ROOT }
				}
			}
		}
	}
	# If king is friend and religious head is not a friend, vote yes on king investiture
	investiture_law_1 = {
		FROMFROM = {
			is_friend = ROOT
			NOT = { is_foe = ROOT }
		}
		NOR = {
			religion_head = {
				is_friend = ROOT
				NOT = { is_foe = ROOT }
			}
			FROMFROM = {
				religion_head = {
					is_friend = ROOT
					NOT = { is_foe = ROOT }
				}
			}
		}
	}
	
	# Female friend could gain a more appropriate job
	status_of_women_1 = {
		custom_tooltip = {
			text = pattern_friend_gain_job_custom_tooltip
			hidden_tooltip = {
				any_friend = {
					is_female = yes
					liege = { character = FROM }
					OR = {
						liege = {
							OR = {
								dynasty = PREV
								is_friend = PREV
								any_spouse = { character = PREV }
								any_consort = { character = PREV }
							}
						}
						is_landed = yes
						trait = nun
					}
					FROM = {
						primary_title = {
							has_law = status_of_women_0
						}
					}
					# Spymaster
					intrigue = 8
					calc_true_if = {
						amount = 2
						has_education_intrigue_trigger = yes
						has_lifestyle_intrigue_trigger = yes
						intrigue = 12
					}
					NAND = {
						religion_group = pagan_group
						liege = {
							religion_group = pagan_group
						}
					}
					OR = {
						NOT = { religion = cathar }
						NOT = { trait = perfecti }
					}
					OR = {
						NOT = { religion = bogomilist }
						NOR = {
							trait = perfecti
							is_theocracy = yes
						}
						liege = {
							religion = bogomilist
							OR = {
								has_law = bogomilist_church_2
								has_law = bogomilist_church_3
								has_law = bogomilist_church_4
							}
						}
					}
					NOT = { has_character_flag = guru }
				}
			}
		}
	}
	status_of_women_2 = {
		custom_tooltip = {
			text = pattern_friend_gain_job_custom_tooltip
			hidden_tooltip = {
				any_friend = {
					is_female = yes
					liege = { character = FROM }
					OR = {
						liege = {
							OR = {
								dynasty = PREV
								is_friend = PREV
								any_spouse = { character = PREV }
								any_consort = { character = PREV }
							}
						}
						is_landed = yes
						trait = nun
					}
					OR = {
						AND = {
							# Spymaster
							intrigue = 8
							FROM = {
								primary_title = {
									has_law = status_of_women_0
								}
							}
							calc_true_if = {
								amount = 2
								has_education_intrigue_trigger = yes
								has_lifestyle_intrigue_trigger = yes
								intrigue = 12
							}
							NAND = {
								religion_group = pagan_group
								liege = {
									religion_group = pagan_group
								}
							}
							OR = {
								NOT = { religion = cathar }
								NOT = { trait = perfecti }
							}
							OR = {
								NOT = { religion = bogomilist }
								NOR = {
									trait = perfecti
									is_theocracy = yes
								}
								liege = {
									religion = bogomilist
									OR = {
										has_law = bogomilist_church_2
										has_law = bogomilist_church_3
										has_law = bogomilist_church_4
									}
								}
							}
							NOT = { has_character_flag = guru }
						}
						AND = {
							# Chancellor
							diplomacy = 8
							FROM = {
								primary_title = {
									OR = {
										has_law = status_of_women_0
										has_law = status_of_women_1
									}
								}
							}
							calc_true_if = {
								amount = 2
								has_education_diplomacy_trigger = yes
								has_lifestyle_diplomacy_trigger = yes
								diplomacy = 12
							}
							OR = {
								NOT = { religion = waldensian }
								is_theocracy = no
								is_ruler = no
							}
							OR = {
								NOT = { religion = bogomilist }
								NOR = {
									trait = perfecti
									is_theocracy = yes
								}
								liege = {
									religion = bogomilist
									OR = {
										has_law = bogomilist_church_2
										has_law = bogomilist_church_3
										has_law = bogomilist_church_4
									}
								}
							}
						}
						AND = {
							# Treasurer
							stewardship = 8
							FROM = {
								primary_title = {
									OR = {
										has_law = status_of_women_0
										has_law = status_of_women_1
									}
								}
							}
							calc_true_if = {
								amount = 2
								has_education_stewardship_trigger = yes
								has_lifestyle_stewardship_trigger = yes
								stewardship = 12
							}
							OR = {
								NOT = { religion = waldensian }
								is_theocracy = no
								is_ruler = no
							}
							OR = {
								NOT = { religion = bogomilist }
								NOR = {
									trait = perfecti
									is_theocracy = yes
								}
								liege = {
									religion = bogomilist
									OR = {
										has_law = bogomilist_church_2
										has_law = bogomilist_church_3
										has_law = bogomilist_church_4
									}
								}
							}
							NOT = { has_character_flag = guru }
						}
					}
				}
			}
		}
	}
	status_of_women_3 = {
		OR = {
			custom_tooltip = {
				text = pattern_friend_gain_job_custom_tooltip
				hidden_tooltip = {
					any_friend = {
						is_female = yes
						liege = { character = FROM }
						OR = {
							liege = {
								OR = {
									dynasty = PREV
									is_friend = PREV
									any_spouse = { character = PREV }
									any_consort = { character = PREV }
								}
							}
							is_landed = yes
							trait = nun
						}
						OR = {
							AND = {
								# Spymaster
								intrigue = 8
								FROM = {
									primary_title = {
										has_law = status_of_women_0
									}
								}
								calc_true_if = {
									amount = 2
									has_education_intrigue_trigger = yes
									has_lifestyle_intrigue_trigger = yes
									intrigue = 12
								}
								NAND = {
									religion_group = pagan_group
									liege = {
										religion_group = pagan_group
									}
								}
								OR = {
									NOT = { religion = cathar }
									NOT = { trait = perfecti }
								}
								OR = {
									NOT = { religion = bogomilist }
									NOR = {
										trait = perfecti
										is_theocracy = yes
									}
									liege = {
										religion = bogomilist
										OR = {
											has_law = bogomilist_church_2
											has_law = bogomilist_church_3
											has_law = bogomilist_church_4
										}
									}
								}
								NOT = { has_character_flag = guru }
							}
							AND = {
								# Chancellor
								diplomacy = 8
								FROM = {
									primary_title = {
										OR = {
											has_law = status_of_women_0
											has_law = status_of_women_1
										}
									}
								}
								calc_true_if = {
									amount = 2
									has_education_diplomacy_trigger = yes
									has_lifestyle_diplomacy_trigger = yes
									diplomacy = 12
								}
								OR = {
									NOT = { religion = waldensian }
									is_theocracy = no
									is_ruler = no
								}
								OR = {
									NOT = { religion = bogomilist }
									NOR = {
										trait = perfecti
										is_theocracy = yes
									}
									liege = {
										religion = bogomilist
										OR = {
											has_law = bogomilist_church_2
											has_law = bogomilist_church_3
											has_law = bogomilist_church_4
										}
									}
								}
							}
							AND = {
								# Treasurer
								stewardship = 8
								FROM = {
									primary_title = {
										OR = {
											has_law = status_of_women_0
											has_law = status_of_women_1
										}
									}
								}
								calc_true_if = {
									amount = 2
									has_education_stewardship_trigger = yes
									has_lifestyle_stewardship_trigger = yes
									stewardship = 12
								}
								OR = {
									NOT = { religion = waldensian }
									is_theocracy = no
									is_ruler = no
								}
								OR = {
									NOT = { religion = bogomilist }
									NOR = {
										trait = perfecti
										is_theocracy = yes
									}
									liege = {
										religion = bogomilist
										OR = {
											has_law = bogomilist_church_2
											has_law = bogomilist_church_3
											has_law = bogomilist_church_4
										}
									}
								}
								NOT = { has_character_flag = guru }
							}
							AND = {
								# Marshal/Commander
								martial = 8
								FROM = {
									primary_title = {
										OR = {
											has_law = status_of_women_0
											has_law = status_of_women_1
											has_law = status_of_women_2
										}
									}
								}
								calc_true_if = {
									amount = 2
									has_education_martial_trigger = yes
									has_lifestyle_martial_trigger = yes
									martial = 12
								}
								OR = {
									NOT = { religion = hindu }
									trait = kshatriya
								}
								OR = {
									NOT = { religion = cathar }
									NOT = { trait = perfecti }
								}
								OR = {
									NOT = { religion = bogomilist }
									NOR = {
										trait = perfecti
										is_theocracy = yes
									}
									liege = {
										religion = bogomilist
										OR = {
											has_law = bogomilist_church_2
											has_law = bogomilist_church_3
											has_law = bogomilist_church_4
										}
									}
								}
							}
						}
					}
				}
			}
			custom_tooltip = {
				text = pattern_friend_become_heir_custom_tooltip
				hidden_tooltip = {
					any_friend = {
						liege = { character = FROM }
						is_female = yes
						FROM = {
							primary_title = {
								OR = {
									has_law = status_of_women_0
									has_law = status_of_women_1
									has_law = status_of_women_2
								}
							}
							OR = {
								emf_antifeminist_religion = no
								succ_law_title = {
									NOT = { has_law = cognatic_succession }
								}
							}
						}
						OR = {
							AND = {
								OR = {
									is_landed = yes
									from_ruler_dynasty = yes
								}
								FROM = {
									succ_law_title = {
										has_law = succ_feudal_elective
									}
								}
							}
							AND = {
								from_ruler_dynasty = yes
								FROM = {
									succ_law_title = {
										OR = {
											has_law = succ_hre_elective
											has_law = succ_byzantine_elective
										}
									}
								}
							}
							AND = {
								clan = yes
								FROM = {
									succ_law_title = {
										has_law = succ_nomad_succession
									}
								}
							}
							FROM = {
								succ_law_title = {
									has_law = succ_open_elective
								}
							}
							AND = {
								is_child_of = FROM
								FROM = {
									succ_law_title = {
										OR = {
											has_law = succ_gavelkind
											has_law = succ_elective_gavelkind
											has_law = succ_primogeniture
											has_law = succ_ultimogeniture
											has_law = succ_turkish_succession
										}
									}
								}
							}
							AND = {
								FROM = {
									succ_law_title = {
										has_law = succ_patrician_elective
									}
								}
								any_dynasty_member = {
									OR = {
										is_patrician = yes
										is_merchant_republic = yes
									}
								}
							}
							AND = {
								from_ruler_dynasty = yes
								FROM = {
									succ_law_title = {
										OR = {
											has_law = succ_tanistry
											has_law = succ_seniority
											has_law = succ_elective_gavelkind
											has_law = succ_eldership
#											has_law = succ_mirath
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
	status_of_women_4 = {
		OR = {
			custom_tooltip = {
				text = pattern_friend_gain_job_custom_tooltip
				hidden_tooltip = {
					any_friend = {
						liege = { character = FROM }
						is_female = yes
						OR = {
							AND = {
								# Spymaster
								intrigue = 8
								OR = {
									FROM = {
										primary_title = {
											has_law = status_of_women_0
										}
									}
									NOR = {
										liege = {
											OR = {
												dynasty = PREV
												is_friend = PREV
												any_spouse = { character = PREV }
												any_consort = { character = PREV }
											}
										}
										is_landed = yes
										trait = nun
									}
								}
								calc_true_if = {
									amount = 2
									has_education_intrigue_trigger = yes
									has_lifestyle_intrigue_trigger = yes
									intrigue = 12
								}
								NAND = {
									religion_group = pagan_group
									liege = {
										religion_group = pagan_group
									}
								}
								OR = {
									NOT = { religion = cathar }
									NOT = { trait = perfecti }
								}
								OR = {
									NOT = { religion = bogomilist }
									NOR = {
										trait = perfecti
										is_theocracy = yes
									}
									liege = {
										religion = bogomilist
										OR = {
											has_law = bogomilist_church_2
											has_law = bogomilist_church_3
											has_law = bogomilist_church_4
										}
									}
								}
								NOT = { has_character_flag = guru }
							}
							AND = {
								# Chancellor
								diplomacy = 8
								OR = {
									FROM = {
										primary_title = {
											OR = {
												has_law = status_of_women_0
												has_law = status_of_women_1
											}
										}
									}
									NOR = {
										liege = {
											OR = {
												dynasty = PREV
												is_friend = PREV
												any_spouse = { character = PREV }
												any_consort = { character = PREV }
											}
										}
										is_landed = yes
										trait = nun
									}
								}
								calc_true_if = {
									amount = 2
									has_education_diplomacy_trigger = yes
									has_lifestyle_diplomacy_trigger = yes
									diplomacy = 12
								}
								OR = {
									NOT = { religion = waldensian }
									is_theocracy = no
									is_ruler = no
								}
								OR = {
									NOT = { religion = bogomilist }
									NOR = {
										trait = perfecti
										is_theocracy = yes
									}
									liege = {
										religion = bogomilist
										OR = {
											has_law = bogomilist_church_2
											has_law = bogomilist_church_3
											has_law = bogomilist_church_4
										}
									}
								}
							}
							AND = {
								# Treasurer
								stewardship = 8
								OR = {
									FROM = {
										primary_title = {
											OR = {
												has_law = status_of_women_0
												has_law = status_of_women_1
											}
										}
									}
									NOR = {
										liege = {
											OR = {
												dynasty = PREV
												is_friend = PREV
												any_spouse = { character = PREV }
												any_consort = { character = PREV }
											}
										}
										is_landed = yes
										trait = nun
									}
								}
								calc_true_if = {
									amount = 2
									has_education_stewardship_trigger = yes
									has_lifestyle_stewardship_trigger = yes
									stewardship = 12
								}
								OR = {
									NOT = { religion = waldensian }
									is_theocracy = no
									is_ruler = no
								}
								OR = {
									NOT = { religion = bogomilist }
									NOR = {
										trait = perfecti
										is_theocracy = yes
									}
									liege = {
										religion = bogomilist
										OR = {
											has_law = bogomilist_church_2
											has_law = bogomilist_church_3
											has_law = bogomilist_church_4
										}
									}
								}
								NOT = { has_character_flag = guru }
							}
							AND = {
								# Marshal/Commander
								martial = 8
								OR = {
									FROM = {
										primary_title = {
											OR = {
												has_law = status_of_women_0
												has_law = status_of_women_1
												has_law = status_of_women_2
											}
										}
									}
									NOR = {
										liege = {
											OR = {
												dynasty = PREV
												is_friend = PREV
												any_spouse = { character = PREV }
												any_consort = { character = PREV }
											}
										}
										is_landed = yes
										trait = nun
									}
								}
								calc_true_if = {
									amount = 2
									has_education_martial_trigger = yes
									has_lifestyle_martial_trigger = yes
									martial = 12
								}
								OR = {
									NOT = { religion = hindu }
									trait = kshatriya
								}
								OR = {
									NOT = { religion = cathar }
									NOT = { trait = perfecti }
								}
								OR = {
									NOT = { religion = bogomilist }
									NOR = {
										trait = perfecti
										is_theocracy = yes
									}
									liege = {
										religion = bogomilist
										OR = {
											has_law = bogomilist_church_2
											has_law = bogomilist_church_3
											has_law = bogomilist_church_4
										}
									}
								}
							}
						}
					}
				}
			}
			
			custom_tooltip = {
				text = pattern_friend_become_heir_custom_tooltip
				hidden_tooltip = {
					any_friend = {
						liege = { character = FROM }
						is_female = yes
						FROM = {
							succ_law_title = {
								NOR = {
									has_law = true_cognatic_succession
									has_law = enatic_cognatic_succession
									has_law = enatic_succession
								}
							}
							OR = {
								emf_antifeminist_religion = no
								succ_law_title = {
									NOT = { has_law = cognatic_succession }
								}
							}
						}
						OR = {
							AND = {
								OR = {
									is_landed = yes
									from_ruler_dynasty = yes
								}
								FROM = {
									succ_law_title = {
										has_law = succ_feudal_elective
									}
								}
							}
							AND = {
								from_ruler_dynasty = yes
								FROM = {
									succ_law_title = {
										OR = {
											has_law = succ_hre_elective
											has_law = succ_byzantine_elective
										}
									}
								}
							}
							AND = {
								clan = yes
								FROM = {
									succ_law_title = {
										has_law = succ_nomad_succession
									}
								}
							}
							FROM = {
								succ_law_title = {
									has_law = succ_open_elective
								}
							}
							AND = {
								is_child_of = FROM
								FROM = {
									succ_law_title = {
										OR = {
											has_law = succ_gavelkind
											has_law = succ_elective_gavelkind
											has_law = succ_primogeniture
											has_law = succ_ultimogeniture
											has_law = succ_turkish_succession
										}
									}
								}
							}
							AND = {
								FROM = {
									succ_law_title = {
										has_law = succ_patrician_elective
									}
								}
								any_dynasty_member = {
									OR = {
										is_patrician = yes
										is_merchant_republic = yes
									}
								}
							}
							AND = {
								from_ruler_dynasty = yes
								FROM = {
									succ_law_title = {
										OR = {
											has_law = succ_tanistry
											has_law = succ_seniority
											has_law = succ_elective_gavelkind
											has_law = succ_eldership
#											has_law = succ_mirath
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
	
	# King Internal Peace Logic works the same way as under Enforce Realm Peace interaction
	king_peace_1 = {
		FROMFROM = { primary_title = { has_law = king_peace_0 } }
		OR = {
			custom_tooltip = {
				text = pattern_friend_save_my_hide_custom_tooltip
				hidden_tooltip = {
					any_war = {
						any_defender = {
							is_friend = ROOT
							NOT = { is_foe = ROOT }
						}
						attacker = {
							is_liege_or_above = FROM
						}
						OR = {
							war_score = -5
							defender = {
								attacker = {
									relative_power_including_allies_attacker = {
										who = PREV # Defender
										power = 1.0
									}
								}
							}
						}
					}
				}
			}
			custom_tooltip = {
				text = pattern_friend_save_ally_custom_tooltip
				hidden_tooltip = {
					any_friend = {
						NOT = { is_foe = ROOT }
						any_allied_character = {
							NOT = { is_foe = ROOT }
							any_war = {
								defender = {
									any_allied_character = {
										is_friend = ROOT
										NOT = { is_foe = ROOT }
										is_liege_or_above = FROM
									}
								}
								attacker = {
									is_liege_or_above = FROM
								}
								OR = {
									war_score = -5
									defender = {
										attacker = {
											relative_power_including_allies_attacker = {
												who = PREV # Defender
												power = 1.0
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
	
	# King Total Peace Logic works the similar to Enforce Realm Peace interaction, but triggers are more finicky.
	king_peace_2 = {
		FROMFROM = { primary_title = { has_law = king_peace_1 } }
		OR = {
			custom_tooltip = {
				text = pattern_friend_save_my_hide_custom_tooltip
				hidden_tooltip = {
					any_war = {
						any_defender = {
							is_friend = ROOT
							NOT = { is_foe = ROOT }
							NOT = { is_liege_or_above = FROM }
						}
						attacker = {
							de_jure_liege_or_above = FROM
							primary_title = { is_crown_law_title = no }
						}
						OR = {
							war_score = -5
							defender = {
								attacker = {
									relative_power_including_allies_attacker = {
										who = PREV # Defender
										power = 1.0
									}
								}
							}
						}
					}
				}
			}
			custom_tooltip = {
				text = pattern_friend_save_ally_custom_tooltip
				hidden_tooltip = {
					any_friend = {
						NOT = { is_foe = ROOT }
						any_allied_character = {
							NOT = { is_foe = ROOT }
							any_war = {
								defender = {
									any_allied_character = {
										is_friend = ROOT
										NOT = { is_foe = ROOT }
										NOT = { is_liege_or_above = FROM }
									}
								}
								attacker = {
									de_jure_liege_or_above = FROM
									primary_title = { is_crown_law_title = no }
								}
								OR = {
									war_score = -5
									defender = {
										attacker = {
											relative_power_including_allies_attacker = {
												who = PREV # Defender
												power = 1.0
											}
										}
									}
								}
							}
						}
					}	
				}
			}
		}
	}
}

friend_pattern_against = {
	icon = 17
	pattern_type = against
	
	##### INTERACTIONS
	
	declare_war_interaction = {
	# Councilor's friend might lose a title
		OR = {
			custom_tooltip = {
				text = pattern_friend_against_friend_custom_tooltip
				hidden_tooltip = {
					FROMFROM = { # Defender
						is_friend = ROOT
						NOT = { is_foe = ROOT }
					}
				}
			}
			custom_tooltip = {
				text = pattern_friend_lose_title_custom_tooltip
				hidden_tooltip = {
					AND = {
						NOR = { 
							stored_token_trigger = dejure_barony_claim
						}			
						FROMFROMFROMFROM = { # Thirdparty_title
							holder_scope = {
								is_friend = ROOT
								NOT = { is_foe = ROOT }
								is_liege_or_above = ROOT_FROMFROM
							}
						}
					}	
				}
			}
		}
	}
	prepare_invasion_interaction = {
		custom_tooltip = {
			text = pattern_friend_against_friend_custom_tooltip
			hidden_tooltip = {
				FROMFROM = { # Defender
					is_friend = ROOT
					NOT = { is_foe = ROOT }
				}
			}
		}
	}
	ask_to_join_war_interaction = {
		OR = {
			custom_tooltip = {
				text = pattern_friend_affected_negatively_custom_tooltip
				hidden_tooltip = {
					any_friend = {
						NOT = { is_foe = ROOT }
						war_with = FROMFROM
					}
				}
			}
			custom_tooltip = {
				text = pattern_friend_hurts_my_ally_custom_tooltip
				hidden_tooltip = {
					any_friend = {
						NOT = { is_foe = ROOT }
						any_allied_character = {
							ROOT_FROMFROM = {
								war_with = PREV
							}
						}
					}
				}
			}
		}
	}
	break_non_aggression_pact = {
		custom_tooltip = {
			text = pattern_friend_against_friend_custom_tooltip
			hidden_tooltip = {
				FROMFROMFROM = { # Defender
					is_friend = ROOT
					NOT = { is_foe = ROOT }
				}
			}
		}
	}
	dissolve_alliance_interaction = {
		custom_tooltip = {
			text = pattern_friend_against_friend_custom_tooltip
			hidden_tooltip = {
				FROMFROMFROM = { # Defender
					is_friend = ROOT
					NOT = { is_foe = ROOT }
				}
			}
		}
	}
	
	# ROOT - Voter, FROM - Actor, FROMFROM - Recipient, FROMFROMFROM - Revoked title.
	revoke_title_interaction = {
		custom_tooltip = {
			text = pattern_friend_lose_title_custom_tooltip
			hidden_tooltip = {
				FROMFROM = {
					is_friend = ROOT
					NOT = { is_foe = ROOT }
				}	
			}
		}
	}
	split_clan_interaction = {
		custom_tooltip = {
			text = pattern_friend_lose_title_custom_tooltip
			hidden_tooltip = {
				FROMFROM = {
					is_friend = ROOT
					NOT = { is_foe = ROOT }
					NOT = { character = FROM }
				}	
			}
		}
	}
	absorb_clan_interaction = {
		custom_tooltip = {
			text = pattern_friend_lose_title_custom_tooltip
			hidden_tooltip = {
				FROMFROM = {
					is_friend = ROOT
					NOT = { is_foe = ROOT }
				}	
			}
		}
	}
	lollard_revoke_temple = {
		custom_tooltip = {
			text = pattern_friend_lose_title_custom_tooltip
			hidden_tooltip = {
				FROMFROM = {
					is_friend = ROOT
					NOT = { is_foe = ROOT }
				}	
			}
		}
	}
	retract_vassal_interaction = {
		custom_tooltip = {
			text = pattern_friend_lose_title_custom_tooltip
			hidden_tooltip = {
				FROMFROM = {
					is_friend = ROOT
					NOT = { is_foe = ROOT }
				}	
			}
		}
	}
	transfer_vassal_interaction = {
		custom_tooltip = {
			text = pattern_friend_vassal_is_mine_custom_tooltip
			hidden_tooltip = {
				any_friend = {
					is_ruler = yes
					NOT = { is_foe = ROOT }
					FROMFROMFROM = {
						de_jure_liege_or_above = PREV
					}
				}
				NOT = {
					FROMFROM = {
						is_friend = ROOT
						NOT = { is_foe = ROOT }
					}
				}
			}
		}
	}
	release_vassal_interaction = {
		custom_tooltip = {
			text = pattern_friend_no_independence_custom_tooltip
			hidden_tooltip = {
				FROMFROM = {
					is_friend = ROOT
					NOT = { is_foe = ROOT }
					NOT = { in_faction = faction_independence }
					opinion = { who = FROM value = -30 }
					OR = {
						de_jure_liege_or_above = FROM
						culture_group = FROM
						AND = {
							culture = FROM
							religion = FROM
						}
					}
				}
			}
		}
	}
	imprison_character_interaction = {
		custom_tooltip = {
			text = pattern_friend_affected_negatively_custom_tooltip
			hidden_tooltip = {
				FROMFROM = {
					is_friend = ROOT
					NOT = { is_foe = ROOT }
				}
			}
		}
	}
	exile_imprisoned_interaction = {
		custom_tooltip = {
			text = pattern_friend_affected_negatively_custom_tooltip
			hidden_tooltip = {
				FROMFROM = {
					is_friend = ROOT
					NOT = { is_foe = ROOT }
				}	
			}
		}
	}
	execute_imprisoned_interaction = {
		custom_tooltip = {
			text = pattern_friend_affected_negatively_custom_tooltip
			hidden_tooltip = {
				FROMFROM = {
					is_friend = ROOT
					NOT = { is_foe = ROOT }
				}
			}
		}
	}
	ransom_character_interaction = {
		custom_tooltip = {
			text = pattern_friend_affected_negatively_custom_tooltip
			hidden_tooltip = {
				FROMFROM = {
					is_friend = ROOT
					NOT = { is_foe = ROOT }
				}
			}
		}
	}
	emf_prisoner_oubliette = {
		custom_tooltip = {
			text = pattern_friend_affected_negatively_custom_tooltip
			hidden_tooltip = {
				FROMFROM = {
					is_friend = ROOT
					NOT = { is_foe = ROOT }
				}
			}
		}
	}
	emf_prisoner_dungeon = {
		custom_tooltip = {
			text = pattern_friend_affected_negatively_custom_tooltip
			hidden_tooltip = {
				FROMFROM = {
					is_friend = ROOT
					NOT = { is_foe = ROOT }
					has_character_modifier = house_arrest
				}
			}
		}
	}
	emf_prisoner_castration = {
		custom_tooltip = {
			text = pattern_friend_affected_negatively_custom_tooltip
			hidden_tooltip = {
				FROMFROM = {
					is_friend = ROOT
					NOT = { is_foe = ROOT }
				}
			}
		}
	}
	emf_prisoner_blinding = {
		custom_tooltip = {
			text = pattern_friend_affected_negatively_custom_tooltip
			hidden_tooltip = {
				FROMFROM = {
					is_friend = ROOT
					NOT = { is_foe = ROOT }
				}
			}
		}
	}
	emf_prisoner_zun_judgement = {
		custom_tooltip = {
			text = pattern_friend_affected_negatively_custom_tooltip
			hidden_tooltip = {
				FROMFROM = {
					is_friend = ROOT
					NOT = { is_foe = ROOT }
				}
			}
		}
	}
	kharijite_public_execution = {
		custom_tooltip = {
			text = pattern_friend_affected_negatively_custom_tooltip
			hidden_tooltip = {
				FROMFROM = {
					is_friend = ROOT
					NOT = { is_foe = ROOT }
				}
			}
		}
	}
	
	# ROOT - Voter, FROM = Liege, FROMFROM = Vote Starter
	enforce_peace = {
		OR = {
			custom_tooltip = {
				text = pattern_friend_is_winning_custom_tooltip
				hidden_tooltip = {
					any_war = {
						any_attacker = {
							is_friend = ROOT
							NOT = { is_foe = ROOT }
						}
						defender = {
							is_liege_or_above = FROM
						}
						OR = {
							war_score = 5
							defender = {
								attacker = {
									relative_power_including_allies_attacker = {
										who = PREV # Defender
										power = 1.0
									}
								}
							}
						}
					}	
				}
			}
			
			custom_tooltip = {
				text = pattern_friend_ally_is_winning_custom_tooltip
				hidden_tooltip = {
					any_friend = {
						NOT = { is_foe = ROOT }
						any_allied_character = {
							NOT = { is_foe = ROOT }
							any_war = {
								attacker = {
									any_allied_character = {
										is_friend = ROOT
										NOT = { is_foe = ROOT }
										is_liege_or_above = FROM
									}
								}
								defender = {
									is_liege_or_above = FROM
								}
								OR = {
									war_score = 5
									defender = {
										attacker = {
											relative_power_including_allies_attacker = {
												who = PREV # Defender
												power = 1.0
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
	
	##### LAWS
	# If a friend is a religious head and the king is not, vote no on king investiture
	investiture_law_1 = {
		NOT = {
			FROMFROM = {
				is_friend = ROOT
				NOT = { is_foe = ROOT }
			}
		}
		OR = {
			religion_head = {
				is_friend = ROOT
				NOT = { is_foe = ROOT }
			}
			FROMFROM = {
				religion_head = {
					is_friend = ROOT
					NOT = { is_foe = ROOT }
				}
			}
		}
	}
	# If king is friend and religious head is not a friend, vote no on papal investiture
	investiture_law_0 = {
		FROMFROM = {
			is_friend = ROOT
			NOT = { is_foe = ROOT }
		}
		NOR = {
			religion_head = {
				is_friend = ROOT
				NOT = { is_foe = ROOT }
			}
			FROMFROM = {
				religion_head = {
					is_friend = ROOT
					NOT = { is_foe = ROOT }
				}
			}
		}
	}
	
	# Female could lose job
	status_of_women_0 = {
		OR = {
			custom_tooltip = {
				text = pattern_friend_lose_job_custom_tooltip
				hidden_tooltip = {
					any_friend = {
						is_female = yes
						liege = { character = FROM }
						OR = {
							AND = {
								FROM = {
									primary_title = {
										OR = {
											has_law = status_of_women_2
											has_law = status_of_women_3
											has_law = status_of_women_4
										}
									}
								}
								OR = {
									# Lose from 2
									has_job_title = job_chancellor
									has_job_title = job_treasurer
									# Lose from 3
									has_job_title = job_marshal
									has_minor_title = title_commander
								}
							}
							# Lose from 4
							AND = {
								NOR = {
									liege = {
										OR = {
											dynasty = FROM
											is_friend = FROM
											any_spouse = { character = FROM }
											any_consort = { character = FROM }
										}
									}
									is_landed = yes
									trait = nun
								}
								FROM = { primary_title = { has_law = status_of_women_4 } }
								OR = {
									has_job_title = job_spymaster
									has_job_title = job_chancellor
									has_job_title = job_treasurer
									has_job_title = job_marshal
									has_minor_title = title_commander
								}
							}
						}
					}
				}
			}
			
			custom_tooltip = {
				text = pattern_friend_female_lose_cognatic_custom_tooltip
				hidden_tooltip = {
					any_friend = {
						is_female = yes
						liege = { character = FROM }
						OR = {
							FROM = {
								emf_antifeminist_religion = yes
								succ_law_title = {
									has_law = cognatic_succession
								}
								primary_title = {
									OR = {
										has_law = status_of_women_3
										has_law = status_of_women_4
									}
								}
							}
							FROM = {
								OR = {
									emf_feminist_religion = no
									emf_antifeminist_religion = yes
								}
								succ_law_title = {
									has_law = true_cognatic_succession
									has_law = enatic_cognatic_succession
									has_law = enatic_succession
								}
								primary_title = {
									has_law = status_of_women_4
								}
							}
						}
						OR = {
							AND = {
								OR = {
									is_landed = yes
									from_ruler_dynasty = yes
								}
								FROM = {
									succ_law_title = {
										has_law = succ_feudal_elective
									}
								}
							}
							AND = {
								from_ruler_dynasty = yes
								FROM = {
									succ_law_title = {
										OR = {
											has_law = succ_hre_elective
											has_law = succ_byzantine_elective
										}
									}
								}
							}
							AND = {
								clan = yes
								FROM = {
									succ_law_title = {
										has_law = succ_nomad_succession
									}
								}
							}
							FROM = {
								succ_law_title = {
									has_law = succ_open_elective
								}
							}
							AND = {
								is_child_of = FROM
								FROM = {
									succ_law_title = {
										OR = {
											has_law = succ_gavelkind
											has_law = succ_elective_gavelkind
											has_law = succ_primogeniture
											has_law = succ_ultimogeniture
											has_law = succ_turkish_succession
										}
									}
								}
							}
							AND = {
								FROM = {
									succ_law_title = {
										has_law = succ_patrician_elective
									}
								}
								any_dynasty_member = {
									OR = {
										is_patrician = yes
										is_merchant_republic = yes
									}
								}
							}
							AND = {
								from_ruler_dynasty = yes
								FROM = {
									succ_law_title = {
										OR = {
											has_law = succ_elective_gavelkind
											has_law = succ_tanistry
											has_law = succ_seniority
											has_law = succ_eldership
#											has_law = succ_mirath
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
	status_of_women_1 = {
		OR = {
			custom_tooltip = {
				text = pattern_friend_lose_job_custom_tooltip
				hidden_tooltip = {
					any_friend = {
						is_female = yes
						liege = { character = FROM }
						OR = {
							AND = {
								FROM = {
									primary_title = {
										OR = {
											has_law = status_of_women_2
											has_law = status_of_women_3
											has_law = status_of_women_4
										}
									}
								}
								OR = {
									# Lose from 2
									has_job_title = job_chancellor
									has_job_title = job_treasurer
									# Lose from 3
									has_job_title = job_marshal
									has_minor_title = title_commander
								}
							}
							# Lose from 4
							AND = {
								NOR = {
									liege = {
										OR = {
											dynasty = FROM
											is_friend = FROM
											any_spouse = { character = FROM }
											any_consort = { character = FROM }
										}
									}
									is_landed = yes
									trait = nun
								}
								FROM = { primary_title = { has_law = status_of_women_4 } }
								OR = {
									has_job_title = job_spymaster
									has_job_title = job_chancellor
									has_job_title = job_treasurer
									has_job_title = job_marshal
									has_minor_title = title_commander
								}
							}
						}
					}
				}
			}
			
			custom_tooltip = {
				text = pattern_friend_female_lose_cognatic_custom_tooltip
				hidden_tooltip = {
					any_friend = {
						is_female = yes
						liege = { character = FROM }
						OR = {
							FROM = {
								emf_antifeminist_religion = yes
								succ_law_title = {
									has_law = cognatic_succession
								}
								primary_title = {
									OR = {
										has_law = status_of_women_3
										has_law = status_of_women_4
									}
								}
							}
							FROM = {
								OR = {
									emf_feminist_religion = no
									emf_antifeminist_religion = yes
								}
								succ_law_title = {
									has_law = true_cognatic_succession
									has_law = enatic_cognatic_succession
									has_law = enatic_succession
								}
								primary_title = {
									has_law = status_of_women_4
								}
							}
						}
						OR = {
							AND = {
								OR = {
									is_landed = yes
									from_ruler_dynasty = yes
								}
								FROM = {
									succ_law_title = {
										has_law = succ_feudal_elective
									}
								}
							}
							AND = {
								from_ruler_dynasty = yes
								FROM = {
									succ_law_title = {
										OR = {
											has_law = succ_hre_elective
											has_law = succ_byzantine_elective
										}
									}
								}
							}
							AND = {
								clan = yes
								FROM = {
									succ_law_title = {
										has_law = succ_nomad_succession
									}
								}
							}
							FROM = {
								succ_law_title = {
									has_law = succ_open_elective
								}
							}
							AND = {
								is_child_of = FROM
								FROM = {
									succ_law_title = {
										OR = {
											has_law = succ_gavelkind
											has_law = succ_elective_gavelkind
											has_law = succ_primogeniture
											has_law = succ_ultimogeniture
											has_law = succ_turkish_succession
										}
									}
								}
							}
							AND = {
								FROM = {
									succ_law_title = {
										has_law = succ_patrician_elective
									}
								}
								any_dynasty_member = {
									OR = {
										is_patrician = yes
										is_merchant_republic = yes
									}
								}
							}
							AND = {
								from_ruler_dynasty = yes
								FROM = {
									succ_law_title = {
										OR = {
											has_law = succ_elective_gavelkind
											has_law = succ_tanistry
											has_law = succ_seniority
											has_law = succ_eldership
#											has_law = succ_mirath
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
	status_of_women_2 = {
		OR = {
			custom_tooltip = {
				text = pattern_friend_lose_job_custom_tooltip
				hidden_tooltip = {
					any_friend = {
						is_female = yes
						liege = { character = FROM }
						OR = {
							AND = {
								FROM = {
									primary_title = {
										OR = {
											has_law = status_of_women_3
											has_law = status_of_women_4
										}
									}
								}
								OR = {
									# Lose from 3
									has_job_title = job_marshal
									has_minor_title = title_commander
								}
							}
							# Lose from 4
							AND = {
								NOR = {
									liege = {
										OR = {
											dynasty = FROM
											is_friend = FROM
											any_spouse = { character = FROM }
											any_consort = { character = FROM }
										}
									}
									is_landed = yes
									trait = nun
								}
								FROM = { primary_title = { has_law = status_of_women_4 } }
								OR = {
									has_job_title = job_spymaster
									has_job_title = job_chancellor
									has_job_title = job_treasurer
									has_job_title = job_marshal
									has_minor_title = title_commander
								}
							}
						}
					}
				}
			}
			
			custom_tooltip = {
				text = pattern_friend_female_lose_cognatic_custom_tooltip
				hidden_tooltip = {
					any_friend = {
						is_female = yes
						liege = { character = FROM }
						OR = {
							FROM = {
								emf_antifeminist_religion = yes
								succ_law_title = {
									has_law = cognatic_succession
								}
								primary_title = {
									OR = {
										has_law = status_of_women_3
										has_law = status_of_women_4
									}
								}
							}
							FROM = {
								OR = {
									emf_feminist_religion = no
									emf_antifeminist_religion = yes
								}
								succ_law_title = {
									has_law = true_cognatic_succession
									has_law = enatic_cognatic_succession
									has_law = enatic_succession
								}
								primary_title = {
									has_law = status_of_women_4
								}
							}
						}
						OR = {
							AND = {
								OR = {
									is_landed = yes
									from_ruler_dynasty = yes
								}
								FROM = {
									succ_law_title = {
										has_law = succ_feudal_elective
									}
								}
							}
							AND = {
								from_ruler_dynasty = yes
								FROM = {
									succ_law_title = {
										OR = {
											has_law = succ_hre_elective
											has_law = succ_byzantine_elective
										}
									}
								}
							}
							AND = {
								clan = yes
								FROM = {
									succ_law_title = {
										has_law = succ_nomad_succession
									}
								}
							}
							FROM = {
								succ_law_title = {
									has_law = succ_open_elective
								}
							}
							AND = {
								is_child_of = FROM
								FROM = {
									succ_law_title = {
										OR = {
											has_law = succ_gavelkind
											has_law = succ_elective_gavelkind
											has_law = succ_primogeniture
											has_law = succ_ultimogeniture
											has_law = succ_turkish_succession
										}
									}
								}
							}
							AND = {
								FROM = {
									succ_law_title = {
										has_law = succ_patrician_elective
									}
								}
								any_dynasty_member = {
									OR = {
										is_patrician = yes
										is_merchant_republic = yes
									}
								}
							}
							AND = {
								from_ruler_dynasty = yes
								FROM = {
									succ_law_title = {
										OR = {
											has_law = succ_elective_gavelkind
											has_law = succ_tanistry
											has_law = succ_seniority
											has_law = succ_eldership
#											has_law = succ_mirath
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
	status_of_women_3 = {
		OR = {
			custom_tooltip = {
				text = pattern_friend_lose_job_custom_tooltip
				hidden_tooltip = {
					any_friend = {
						is_female = yes
						liege = { character = FROM }
						OR = {
							# Lose from 4
							AND = {
								NOR = {
									liege = {
										OR = {
											dynasty = FROM
											is_friend = FROM
											any_spouse = { character = FROM }
											any_consort = { character = FROM }
										}
									}
									is_landed = yes
									trait = nun
								}
								FROM = { primary_title = { has_law = status_of_women_4 } }
								OR = {
									has_job_title = job_spymaster
									has_job_title = job_chancellor
									has_job_title = job_treasurer
									has_job_title = job_marshal
									has_minor_title = title_commander
								}
							}
						}
					}
				}
			}
			
			custom_tooltip = {
				text = pattern_friend_female_lose_cognatic_custom_tooltip
				hidden_tooltip = {
					any_friend = {
						is_female = yes
						liege = { character = FROM }
						OR = {
							FROM = {
								emf_antifeminist_religion = yes
								succ_law_title = {
									has_law = cognatic_succession
								}
								primary_title = {
									has_law = status_of_women_4
								}
							}
							FROM = {
								OR = {
									emf_feminist_religion = no
									emf_antifeminist_religion = yes
								}
								succ_law_title = {
									has_law = true_cognatic_succession
									has_law = enatic_cognatic_succession
									has_law = enatic_succession
								}
								primary_title = {
									has_law = status_of_women_4
								}
							}
						}
						OR = {
							AND = {
								OR = {
									is_landed = yes
									from_ruler_dynasty = yes
								}
								FROM = {
									succ_law_title = {
										has_law = succ_feudal_elective
									}
								}
							}
							AND = {
								from_ruler_dynasty = yes
								FROM = {
									succ_law_title = {
										OR = {
											has_law = succ_hre_elective
											has_law = succ_byzantine_elective
										}
									}
								}
							}
							AND = {
								clan = yes
								FROM = {
									succ_law_title = {
										has_law = succ_nomad_succession
									}
								}
							}
							FROM = {
								succ_law_title = {
									has_law = succ_open_elective
								}
							}
							AND = {
								is_child_of = FROM
								FROM = {
									succ_law_title = {
										OR = {
											has_law = succ_gavelkind
											has_law = succ_elective_gavelkind
											has_law = succ_primogeniture
											has_law = succ_ultimogeniture
											has_law = succ_turkish_succession
										}
									}
								}
							}
							AND = {
								FROM = {
									succ_law_title = {
										has_law = succ_patrician_elective
									}
								}
								any_dynasty_member = {
									OR = {
										is_patrician = yes
										is_merchant_republic = yes
									}
								}
							}
							AND = {
								from_ruler_dynasty = yes
								FROM = {
									succ_law_title = {
										OR = {
											has_law = succ_elective_gavelkind
											has_law = succ_tanistry
											has_law = succ_seniority
											has_law = succ_eldership
#											has_law = succ_mirath
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
	
	# Vote no on Out-of-Realm Inheritance if an out-of-realm friend is an heir to a title in the realm
	inheritance_1 = {
		custom_tooltip = {
			text = pattern_friend_lose_title_custom_tooltip
			hidden_tooltip = {
				NOT = { FROMFROM = { character = ROOT } }
				any_friend = {
					NOT = { is_foe = ROOT }
					NOT = { is_liege_or_above = FROMFROM }
					any_heir_title = {
						de_jure_vassal_or_below = FROMFROM
					}
				}
			}
		}
	}
	
	# King Internal Peace Logic works the same way as under Enforce Realm Peace interaction
	king_peace_1 = {
		NOT = { FROMFROM = { character = ROOT } }
		OR = {
			custom_tooltip = {
				text = pattern_friend_is_winning_custom_tooltip
				hidden_tooltip = {
					any_war = {
						any_attacker = {
							is_friend = ROOT
							NOT = { is_foe = ROOT }
						}
						defender = {
							is_liege_or_above = FROMFROM
						}
						OR = {
							war_score = 5
							defender = {
								attacker = {
									relative_power_including_allies_attacker = {
										who = PREV # Defender
										power = 1.0
									}
								}
							}
						}
					}
				}
			}
			custom_tooltip = {
				text = pattern_friend_ally_is_winning_custom_tooltip
				hidden_tooltip = {
					any_friend = {
						NOT = { is_foe = ROOT }
						any_allied_character = {
							NOT = { is_foe = ROOT }
							any_war = {
								attacker = {
									any_allied_character = {
										is_friend = ROOT
										NOT = { is_foe = ROOT }
										is_liege_or_above = FROM
									}
								}
								defender = {
									is_liege_or_above = FROMFROM
								}
								OR = {
									war_score = 5
									defender = {
										attacker = {
											relative_power_including_allies_attacker = {
												who = PREV # Defender
												power = 1.0
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
	
	# King Total Peace Logic works similar to how it does under Enforce Realm Peace interaction, but triggers are more finicky
	king_peace_2 = {
		FROMFROM = { primary_title = { has_law = king_peace_1 } }
		OR = {
			custom_tooltip = {
				text = pattern_friend_is_winning_custom_tooltip
				hidden_tooltip = {
					any_war = {
						any_attacker = {
							is_friend = ROOT
							NOT = { is_foe = ROOT }
						}
						defender = {
							de_jure_liege_or_above = FROMFROM
							primary_title = { is_crown_law_title = no }
						}
						OR = {
							war_score = 5
							defender = {
								attacker = {
									relative_power_including_allies_attacker = {
										who = PREV # Defender
										power = 1.0
									}
								}
							}
						}
					}
				}
			}
			custom_tooltip = {
				text = pattern_friend_ally_is_winning_custom_tooltip
				hidden_tooltip = {
					any_friend = {
						NOT = { is_foe = ROOT }
						any_allied_character = {
							NOT = { is_foe = ROOT }
							any_war = {
								attacker = {
									any_allied_character = {
										is_friend = ROOT
										NOT = { is_foe = ROOT }
										is_liege_or_above = FROM
									}
								}
								defender = {
									de_jure_liege_or_above = FROMFROM
									primary_title = { is_crown_law_title = no }
								}
								OR = {
									war_score = 5
									defender = {
										attacker = {
											relative_power_including_allies_attacker = {
												who = PREV # Defender
												power = 1.0
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
}
