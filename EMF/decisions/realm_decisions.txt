# -*- ck2.decisions -*-

decisions = {

	hold_a_epic_tournament  = {
		only_independent = yes
		is_high_prio = yes
		
		potential = {
			is_playable = yes
			independent = yes
			higher_real_tier_than = COUNT
			is_nomadic = no
			OR = {
				religion_group = christian
				religion_group = jewish_group
				religion_group = zoroastrian_group
			}
			NOT = {
				any_demesne_title = {
					tier = COUNT
					is_occupied = yes
				}
			}
			OR = {
				NOT = { has_character_flag = emf_tournament_cooldown }
				had_character_flag = { flag = emf_tournament_cooldown days = 3650 }
			}
			emf_hiprio_decision_basic_potential = yes
		}
		allow = {
			war = no
			prisoner = no
			in_command = no
			NOT = { is_inaccessible_trigger = yes }
			is_adult = yes
			prestige = 500
			custom_tooltip = {
				text = CAN_AFFORD_TOURNAMENT
				hidden_tooltip = {
					wealth = 200
					scaled_wealth = 0.5
				}
			}
			custom_tooltip = {
				text = is_not_busy_trigger_tooltip
				hidden_tooltip = { NOT = { has_character_flag = do_not_disturb } }
			}
		}
		effect = {
			set_character_flag = emf_tournament_cooldown
			scaled_wealth = { value = -0.5 min = -200 }
			prestige = 100
			long_character_event = { id = emf_tournament.100 tooltip = "tournament_invite" }
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				NOT = {
					OR = {
						wealth = 1000
						scaled_wealth = 3.0
					}
				}
			}
		}
	}
	
	buy_indulgence_for_sins = {
		only_playable = yes
		potential = {
			religion = catholic
			is_adult = yes
			NOT = { has_character_flag = ask_for_indulgence }
		}
		allow = {
			prisoner = no
			NOT = { trait = incapable }
			NOT = { is_inaccessible_trigger = yes }
			scaled_wealth = 1.0
			wealth = 25
			is_heretic = no
		}
		effect = {
			set_character_flag = ask_for_indulgence
			rightful_religious_head_scope = {
				character_event = { id = 39250 days = 5 random = 12 tooltip = "indulgence_ask" }
			}
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				OR = {
					NOT = { scaled_wealth = 10.0 }
					piety = 0
				}
			}
		}
	}

	issue_declaration_of_repentance = {
		only_playable = yes
		potential = {
			is_playable = yes
			religion = catholic
			is_adult = yes
			NOT = { has_character_flag = ask_for_repentance }
			rightful_religious_head_scope = {
				ROOT = {
					excommunicated_for = PREV
				}
			}
		}
		allow = {
			scaled_wealth = 2.0
			is_heretic = no
		}
		effect = {
			set_character_flag = ask_for_repentance
			rightful_religious_head_scope = {
				character_event = { id = 39252 days = 5 random = 12 tooltip = "repentance_ask" }
			}
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				NOT = {
					scaled_wealth = 10.0
				}
			}
		}
	}
	
	sadaqah_saddka  = {
		only_playable = yes
		potential = {
			is_playable = yes
			ai = no
			religion_group = muslim
			is_adult = yes
			demesne_size = 1
			NOT = { has_character_flag = voluntary_charity }
			rightful_religious_head_scope = {	
				NOT = {
					character = ROOT
				}
				NOT = {
					has_opinion_modifier = { who = ROOT modifier = opinion_sadaqah }
				}
			}
		}
		allow = {
			scaled_wealth = 1.0
			is_heretic = no
		}
		effect = {
			set_character_flag = voluntary_charity
			scaled_wealth = -0.25
			piety = 25
			rightful_religious_head_scope = {
				character_event = { id = 31000 days = 5 random = 12 tooltip = "sadaqah_voluntary_charity" }
			}
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				ai = yes
				OR = {
					NOT = { scaled_wealth = 10.0 }
					piety = 0
				}
			}
		}
	}

	hold_a_furusiyya  = {
		only_independent = yes
		is_high_prio = yes
		
		potential = {
			is_playable = yes
			independent = yes
			religion_group = muslim
			higher_real_tier_than = COUNT
			is_nomadic = no
			NOT = {
				any_demesne_title = {
					tier = COUNT
					is_occupied = yes
				}
			}
			OR = {
				NOT = { has_character_flag = emf_tournament_cooldown }
				had_character_flag = { flag = emf_tournament_cooldown days = 3650 }
			}
			emf_hiprio_decision_basic_potential = yes
		}
		allow = {
			war = no
			in_command = no
			prisoner = no
			NOT = { is_inaccessible_trigger = yes }
			is_adult = yes
			prestige = 500
			custom_tooltip = {
				text = CAN_AFFORD_TOURNAMENT
				hidden_tooltip = {
					wealth = 200
					scaled_wealth = 0.5
				}
			}
			custom_tooltip = {
				text = is_not_busy_trigger_tooltip
				hidden_tooltip = { NOT = { has_character_flag = do_not_disturb } }
			}
		}
		effect = {
			set_character_flag = emf_tournament_cooldown
			scaled_wealth = { value = -0.5 min = -200 }
			prestige = 100
			long_character_event = { id = emf_tournament.100 tooltip = "furusiyya_invite" }
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				NOT = {
					OR = {
						wealth = 1000
						scaled_wealth = 3.0
					}
				}
			}
		}
	}
	
	restore_roman_empire = {
		only_independent = yes
		is_high_prio = yes
		potential = {
			is_playable = yes
			emf_hiprio_decision_basic_potential = yes
			has_dlc = "Legacy of Rome"
			has_landed_title = e_byzantium
			religion_group = christian
			is_adult = yes
			prisoner = no
			NOT = { trait = incapable }
			NOT = { has_global_flag = rome_restored }
		}
		allow = {
			primary_title = {
				title = e_byzantium
			}
			prestige = 3000
			completely_controls = d_latium
			completely_controls = d_venice
			completely_controls = d_ferrara
			completely_controls = d_sicily
			completely_controls = d_genoa
			completely_controls = d_capua
			completely_controls = d_apulia
			completely_controls = d_thrace
			completely_controls = d_antioch
			completely_controls = d_jerusalem
			completely_controls = d_alexandria
			completely_controls = d_athens
			completely_controls = d_tunis
			completely_controls = d_croatia
		}
		effect = {
			set_global_flag = rome_restored
			set_character_flag = emf_context_restored_roman_empire
			narrative_event = { id = pb_various.2 tooltip = EVTTOOLTIPLoR.20 }
		}
		ai_will_do = {
			factor = 1
		}
	}
	
	mend_great_schism = {
		only_independent = yes
		is_high_prio = yes
		potential = {
			emf_hiprio_decision_basic_potential = yes
			has_dlc = "Legacy of Rome"
			is_playable = yes
			is_adult = yes
			prisoner = no
			independent = yes
			NOT = { trait = incapable }
			OR = {
				religion = orthodox
				religion = paulician
				religion = monothelite
				religion = iconoclast
			}
			OR = {
				has_landed_title = e_byzantium
				has_landed_title = e_roman_empire
			}
			is_heretic = no
			NOT = { has_global_flag = schism_mended }
			k_papal_state = {
				holder_scope = {
					is_heretic = no # If the Pope (and thus Catholicism) is heretical, mending the schism is no longer possible
				}
			}
		}
		allow = {
			piety = 2000
			religion_authority = 0.75 #Consistent with nerf to controlled holy sites bonus to religious authority
			completely_controls = c_byzantion
			b_hagiasophia = {
				custom_tooltip = { # Custom tooltip to shorten the in-game tooltip
					text = mend_the_schism_holder_religion
					hidden_tooltip = {
						holder_scope = {
							OR = {
								religion = orthodox
								religion = paulician
								religion = monothelite
								religion = iconoclast
							}
							is_heretic = no
						}
					}
				}
			}
			completely_controls = c_antiocheia
			b_antiocheia = {
				custom_tooltip = { # Custom tooltip to shorten the in-game tooltip
					text = mend_the_schism_holder_religion
					hidden_tooltip = {
						holder_scope = {
							OR = {
								religion = orthodox
								religion = paulician
								religion = monothelite
								religion = iconoclast
							}
							is_heretic = no
						}
					}
				}
			}
			completely_controls = c_jerusalem
			b_jerusalem = {
				custom_tooltip = { # Custom tooltip to shorten the in-game tooltip
					text = mend_the_schism_holder_religion
					hidden_tooltip = {
						holder_scope = {
							OR = {
								religion = orthodox
								religion = paulician
								religion = monothelite
								religion = iconoclast
							}
							is_heretic = no
						}
					}
				}
			}
			completely_controls = c_alexandria
			b_alexandria = {
				custom_tooltip = { # Custom tooltip to shorten the in-game tooltip
					text = mend_the_schism_holder_religion
					hidden_tooltip = {
						holder_scope = {
							OR = {
								religion = orthodox
								religion = paulician
								religion = monothelite
								religion = iconoclast
							}
							is_heretic = no
						}
					}
				}
			}
			completely_controls = c_roma
			b_roma = {
				custom_tooltip = { # Custom tooltip to shorten the in-game tooltip
					text = mend_the_schism_holder_religion
					hidden_tooltip = {
						holder_scope = {
							OR = {
								religion = orthodox
								religion = paulician
								religion = monothelite
								religion = iconoclast
							}
							is_heretic = no
						}
					}
				}
			}
		}
		effect = {
			set_character_flag = emf_context_mended_schism_orthodox
			set_character_flag = schism_mender
			narrative_event = { id = LoR.210 tooltip = EVTTOOLTIPLoR.210}
			set_global_flag = schism_mended
		}
		ai_will_do = {
			factor = 1
		}
	}
	
	claim_constantinople = {
		only_independent = yes
		is_high_prio = yes
		potential = {
			emf_hiprio_decision_basic_potential = yes
			is_playable = yes
			has_dlc = "Legacy of Rome"
			has_landed_title = e_byzantium
			NOT = { has_landed_title = c_byzantion }
			any_realm_lord = { 
				ai = yes
				has_landed_title = c_byzantion 
			}
		}
		allow = {
			NOT = { has_landed_title = c_byzantion }
			any_realm_lord = { 
				has_landed_title = c_byzantion 
			}
		}
		effect = {
			ROOT = {
				c_byzantion = {
					usurp_title_plus_barony_if_unlanded_and_vassals = PREV
				}
			}
		}
		ai_will_do = {
			factor = 1
		}
	}
	
	###
	# 'make_rome_capital' moved to emf_rome_capital_decision.txt (so EMF+SWMH can override it)
	###
		
	petition_doge_for_tp = {
		only_playable = yes
		is_high_prio = yes
		potential = {
			is_playable = yes
			emf_hiprio_decision_basic_potential = yes
			is_merchant_republic = no
			is_patrician = yes
			liege = { is_merchant_republic = yes }
			NOT = { has_character_flag = petition_doge_for_tp_taken }
			OR = {
				liege = {
					any_vassal = {
						is_patrician = yes
						num_of_trade_post_diff = {
							character = ROOT
							value = 10
						}
					}
				}
				AND = {
					NOT = { num_of_trade_posts = 1 }
					liege = {
						any_vassal = {
							is_patrician = yes
							num_of_trade_posts = 10
						}
					}
				}
			}
		}
		allow = {
			liege = {
				opinion = {
					who = ROOT
					value = 25
				}
			}
		}
		effect = {
			set_character_flag = petition_doge_for_tp_taken
			liege = {
				letter_event = { id = REP.500 days = 5 tooltip = EVTTOOLTIP_REP_500 }
			}
		}
		ai_will_do = {
			factor = 1
		}
	}
	
	usurp_tp = {
		only_playable = yes
		is_high_prio = yes
		potential = {
			is_playable = yes
			emf_hiprio_decision_basic_potential = yes
			is_merchant_republic = yes
			is_patrician = yes
			NOT = { has_character_flag = usurp_tp_taken }
			OR = {
				any_vassal = {
					is_patrician = yes
					num_of_trade_post_diff = {
						character = ROOT
						value = 10
					}
				}
				AND = {
					NOT = { num_of_trade_posts = 1 }
					any_vassal = {
						is_patrician = yes
						num_of_trade_posts = 10
					}
				}
			}
		}
		allow = {
			is_merchant_republic = yes
		}
		effect = {
			set_character_flag = usurp_tp_taken
			if = {
				limit = {
					num_of_trade_posts = 1
					any_vassal = {
						is_patrician = yes
						num_of_trade_post_diff = {
							character = ROOT
							value = 10
						}
					}
				}
				random_vassal = {
					limit = {
						is_patrician = yes
						num_of_trade_post_diff = {
							character = ROOT
							value = 10
						}
					}
					set_character_flag = target_patrician_doge
					letter_event = { id = REP.510 days = 5 tooltip = EVTTOOLTIP_REP_510 }
				}
			}
			if = {
				limit = {
					NOT = { num_of_trade_posts = 1 }
					any_vassal = {
						is_patrician = yes
						num_of_trade_posts = 10
					}
				}
				random_vassal = {
					limit = {
						is_patrician = yes
						num_of_trade_posts = 10
					}
					set_character_flag = target_patrician_doge
					letter_event = { id = REP.510 days = 5 tooltip = EVTTOOLTIP_REP_510 }
				}
			}
		}
		ai_will_do = {
			factor = 1
		}
	}
	
	organize_varangian_guard = {
		only_independent = yes
		is_high_prio = yes
		
		potential = {
			is_playable = yes
			independent = yes
			is_female = no
			prisoner = no
			is_adult = yes
			NOT = { trait = incapable }
			emf_hiprio_decision_basic_potential = yes
			OR = {
				has_landed_title = e_byzantium
				has_landed_title = e_roman_empire
			}
			has_global_flag = viking_age_started
			NOT = { has_global_flag = varangian_guard_founded }
			any_playable_ruler = {
				religion = norse_pagan
				capital_scope = {
					distance = {
						where = 496	# Constantinople
						value = 400	# Not too far away
					}
				}
			}
		}
		allow = {
			prestige = 300
			wealth = 300
		}
		effect = {
			set_global_flag = varangian_guard_founded
			set_character_flag = emf_context_founded_varangian_guard
			prestige = -300
			wealth = -300
			activate_title = { title = d_varangian_guard status = yes }
			hidden_tooltip = {
				narrative_event = { id = TOG.3100 }
				create_character = {
					random_traits = yes
					religion = norse_pagan
					culture = norse
					dynasty = NONE
					female = no
					age = 34
					trait = skilled_tactician
				}
				new_character = {
					d_varangian_guard = {
						grant_title = PREV
					}
					emf_new_character_effect = yes
					set_defacto_liege = ROOT
				}
			}
		}
		ai_will_do = {
			factor = 1
		}
	}
	
	become_saoshyant = {
		only_independent = yes
		is_high_prio = yes
		
		potential = {
			has_dlc = "The Old Gods"
			independent = yes
			OR = {
				religion = zoroastrian
				religion = mazdaki
				religion = zurvanist
			}
			NOT = { has_global_flag = saoshyant_appears }
			emf_hiprio_decision_basic_potential = yes
		}
		allow = {
			has_landed_title = e_persia
			custom_tooltip = {
				text = emf_ctt_controls_persia_and_mesopotamia
				hidden_tooltip = {
					NOT = {
						any_province = {
							region = emf_region_saoshyant
							owner_under_ROOT = no
						}
					}
				}
			}
			piety = 1500
		}
		effect = {
			set_global_flag = saoshyant_appears
			give_nickname = nick_the_saoshyant
			add_trait = saoshyant
			prestige = 500
			piety = 500
			hidden_tooltip = {
				any_child_even_if_dead = {
					character_event = { id = TOG.6001 }
				}
				narrative_event = { id = TOG.6000 }
			}
		}
		ai_will_do = {
			factor = 1
		}
	}
	
	# EMF: Iberian Christian kingdom creation decisions moved to realm_decisions_iberia.txt
	
	restore_priesthood = {
		only_independent = yes
		is_high_prio = yes
		
		potential = {
			has_dlc = "The Old Gods"
			is_playable = yes
			emf_hiprio_decision_basic_potential = yes
			religion = zoroastrian
			NOT = { has_global_flag = zoroastrian_priesthood_founded }
		}
		allow = {
			has_landed_title = e_persia
			piety = 300
		}
		effect = {
			set_global_flag = zoroastrian_priesthood_founded
			set_character_flag = emf_context_restored_zoro_priesthood
			piety = -300
			activate_title = { title = d_zoroastrian status = yes }
			hidden_tooltip = {
				create_random_priest = {
					random_traits = yes
					religion = zoroastrian
					culture = persian
					dynasty = random
					female = no
					age = 41
				}
				new_character = {
					d_zoroastrian = {
						grant_title = PREV
					}
					emf_new_character_effect = yes
					narrative_event = { id = TOG.6004 days = 2 }
				}
			}
			d_zoroastrian = {
				holder_scope = {
					e_persia = {
						holder_scope = {
							set_defacto_vassal = PREVPREV
						}
					}	
					emf_liege_change_effect = yes
				}
			}
		}
		ai_will_do = {
			factor = 1
		}
	}
	
	build_third_temple = {
		only_playable = yes
		is_high_prio = yes
		
		potential = {
			has_dlc = "Sons of Abraham"
			is_playable = yes
			emf_hiprio_decision_basic_potential = yes
			religion_group = jewish_group
			NOT = { has_global_flag = third_temple_built }
			NOT = { has_global_flag = building_third_temple }
		}
		allow = {
			completely_controls = c_jerusalem
			774 = {
				religion = ROOT
			}
			wealth = 1500
			piety = 1500
		}
		effect = {
			set_character_flag = emf_context_started_third_temple
			hidden_tooltip = {
				character_event = { id = SoA.100 }
				774 = {	province_event = { id = SoA.10199 days = 1460 random = 50 }	}
			}
			set_global_flag = building_third_temple
			wealth = -1500
			prestige = 500
			piety = 500
		}
		ai_will_do = {
			factor = 1
		}
	}
	
	restore_high_priesthood = {
		only_playable = yes
		is_high_prio = yes
		
		potential = {
			has_dlc = "Sons of Abraham"
			is_playable = yes
			emf_hiprio_decision_basic_potential = yes
			religion = jewish
			has_landed_title = k_israel
			has_global_flag = third_temple_built
			NOT = { has_global_flag = jewish_priesthood_founded }
		}
		allow = {
			completely_controls = c_jerusalem
			774 = {
				religion = jewish
			}
			piety = 1000
		}
		effect = {
			set_global_flag = jewish_priesthood_founded
			set_character_flag = emf_context_restored_jewish_priesthood
			activate_title = { title = d_jewish status = yes }
			hidden_tooltip = {
				create_random_priest = {
					random_traits = yes
					religion = ROOT
					culture = ROOT
					dynasty = random
					female = no
					age = 41
				}
				new_character = {
					d_jewish = {
						grant_title = PREV
					}
					emf_new_character_effect = yes
					narrative_event = { id = SoA.550 }
				}
			}
			d_jewish = {
				holder_scope = {
					k_israel = {
						holder_scope = {
							set_defacto_vassal = PREVPREV
						}
					}			
					emf_liege_change_effect = yes
				}
			}
		}
		ai_will_do = {
			factor = 1
		}
	}
	
	create_israel = {
		only_playable = yes
		is_high_prio = yes
		
		potential = {
			has_dlc = "Sons of Abraham"
			is_playable = yes
			emf_hiprio_decision_basic_potential = yes
			religion_group = jewish_group
			k_israel = {
				has_holder = no
			}
		}
		allow = {
			completely_controls = d_jerusalem
			completely_controls = d_ascalon
			completely_controls = d_galilee
			completely_controls = d_oultrejourdain
			774 = {
				religion = ROOT
			}
			piety = 500
			prestige = 500
		}
		effect = {
			narrative_event = { id = SoA.102 tooltip = EVTTOOLTIP_SoA_102 }
			prestige = 1000
		}
		ai_will_do = {
			factor = 1
		}
	}
	
	welcome_jews = {
		only_playable = yes
		
		potential = {
			#has_dlc = "Sons of Abraham"
			is_playable = yes
			NOR = {
				religion_group = jewish_group 
				has_character_modifier = expelled_jews_timer
			}
			has_character_modifier = expelled_jewish
		}
		allow = {
			has_character_modifier = expelled_jewish
		}
		effect = {
			set_character_flag = emf_context_welcomed_jews
			scaled_wealth = -2.5
			prestige = 50
			remove_character_modifier = expelled_jewish
			if = {
				limit = {
					NOT = { trait = zealous }
					NOT = { trait = sympathy_judaism }
				}
				random = {
					chance = 50
					add_trait = sympathy_judaism
				}
			}
			custom_tooltip = {
				text = jews_are_welcome
			}
			hidden_tooltip = {
				character_event = { id = SoA.106 }
			}
		}
		ai_will_do = {
			factor = 1
			
			modifier = {
				factor = 0.1 # Less likely to do it
			}
			modifier = {
				factor = 0
				trait = zealous
			}
		}
	}
	
	expel_jews = {
		only_independent = yes
		
		potential = {
			has_dlc = "Sons of Abraham"
			is_playable = yes
			OR = {
				AND = {
					independent = yes
					primary_title = { higher_tier_than = DUKE }
				}
				ai = no            # So that it shows on player's list anyway
			}
			OR = {
				religion_group = christian
				religion_group = muslim
				religion_group = zoroastrian_group
			}	
			NOR = {
				religion_group = jewish_group
				has_character_modifier = expelled_jewish
				is_nomadic = yes
				secret_religion = jewish
				secret_religion = samaritan
				secret_religion = karaite
			}
			age = 16
		}
		allow = {
			independent = yes
			primary_title = { higher_tier_than = DUKE }
			OR = {
				religion_group = christian
				religion_group = muslim
				religion_group = zoroastrian_group
			}
			NOT = { any_realm_province = { religion_group = jewish_group } }
			prisoner = no
			NOT = { trait = incapable }
		}
		effect = {
			set_character_flag = emf_context_expelled_jews
			prestige = -100
			scaled_wealth = 5
			banish_religion = jewish
			if = {
				limit = { trait = sympathy_judaism }
				remove_trait = sympathy_judaism
			}
			if = {
				limit = {
					NOT = { trait = arbitrary }
					OR = {
						has_character_modifier = small_loan
						has_character_modifier = medium_loan
						has_character_modifier = large_loan
						has_character_modifier = huge_loan
					}
				}
				add_trait = arbitrary
			}
			if = {
				limit = { has_character_modifier = small_loan }
				remove_character_modifier = small_loan
			}
			if = {
				limit = { has_character_modifier = medium_loan }
				remove_character_modifier = medium_loan
			}
			if = {
				limit = { has_character_modifier = large_loan }
				remove_character_modifier = large_loan
			}
			if = {
				limit = { has_character_modifier = huge_loan }
				remove_character_modifier = huge_loan
			}
			add_character_modifier = {
				name = expelled_jewish
				duration = -1
				inherit = yes
			}
			custom_tooltip = {
				text = jews_are_expelled
			}
			hidden_tooltip = {
				character_event = { id = SoA.105 }
				add_character_modifier = {
					name = expelled_jews_timer
					duration = 7300
					hidden = yes
				}
			}
			any_friend = {
				limit = { religion_group = jewish_group }
				remove_friend = ROOT
			}
		}
		ai_will_do = {
			factor = 1
			
			modifier = {
				factor = 0.001 # Less likely to do it
			}
			modifier = {
				factor = 0
				any_courtier = {
					religion_group = jewish_group
					reverse_opinion = { who = ROOT value = 20 }
				}
			}
			modifier = {
				factor = 0
				any_friend = {
					religion_group = jewish_group
				}
			}
			modifier = {
				factor = 0
				any_spouse = {
					religion_group = jewish_group
				}
			}
			modifier = {
				factor = 0
				any_child = {
					religion_group = jewish_group
				}
			}
			modifier = {
				factor = 0
				trait = kind
			}
			modifier = {
				factor = 0
				trait = just
				OR = {
					has_character_modifier = small_loan
					has_character_modifier = medium_loan
					has_character_modifier = large_loan
					has_character_modifier = huge_loan
				}
			}
			modifier = {
				factor = 1.2
				trait = zealous
				trait = arbitrary
			}
			modifier = {
				factor = 2
				OR = {
					has_character_modifier = small_loan
					has_character_modifier = medium_loan
					has_character_modifier = large_loan
					has_character_modifier = huge_loan
				}
				trait = greedy
			}
		}
	}
	
	# Decision 'become_samrat_chakravartin' moved to:
	# emf_indian_empire_decision.txt

	# Decision form_the_hre not used in favor of emf_create_hre in emf_hre_decisions.txt

	form_the_hre_early = {
		only_independent = yes
		is_high_prio = yes
		potential = {
			is_playable = yes
			independent = yes
			emf_hiprio_decision_basic_potential = yes
			NOT = { has_global_flag = charlemagne_hre }
			NOT = { has_global_flag = rome_restored }
			OR = {
				religion = catholic
				religion = fraticelli
			}
			NOT = { has_landed_title = e_byzantium }
		}
		allow = {
			is_adult = yes
			prisoner = no
			NOT = { trait = incapable }
			prestige = 1000
			realm_size = 220
			custom_tooltip = {
				text = form_the_hre_early_tooltip_1
				hidden_tooltip = {
					OR = {
						has_landed_title = k_italy
						has_landed_title = e_italy
					}
				}
			}
			custom_tooltip = {
				text = form_the_hre_early_tooltip_2
				hidden_tooltip = {
					any_demesne_title = {
						OR = {
							title = e_france
							title = e_germany
							title = e_britannia
							title = e_spain
							AND = {
								tier = KING
								NOT = {	title = k_italy	}
								OR = {
									empire = { title = e_france }
									empire = { title = e_germany }
									empire = { title = e_britannia }
									empire = { title = e_spain }
								}
							}
						}
					}
				}
			}
			custom_tooltip = {
				text = form_the_hre_early_tooltip_3
				hidden_tooltip = {
					OR = {
						has_landed_title = e_italy
						e_italy = {	has_holder = no	}
						e_italy = { holder_scope = { NOT = { religion_group = christian } } }
					}
					OR = {
						has_landed_title = e_germany
						e_germany = {	has_holder = no	}
						e_germany = { holder_scope = { NOT = { religion_group = christian } } }
					}
					OR = {
						has_landed_title = e_france
						e_france = { has_holder = no	}
						e_france = { holder_scope = { NOT = { religion_group = christian } } }
					}
					OR = {
						has_landed_title = e_spain
						e_spain = {	has_holder = no	}
						e_spain = { holder_scope = { NOT = { religion_group = christian } } }
					}
					OR = {
						has_landed_title = e_britannia
						e_britannia = {	has_holder = no	}
						e_britannia = { holder_scope = { NOT = { religion_group = christian } } }
					} 
				}
			}
			OR = {
				ai = yes
				AND = {
					religion_head = {
						opinion = { who = ROOT value = 25 }
					}
					scaled_wealth = 2
				}
			}
		}
		effect = {
			set_global_flag = charlemagne_hre
			set_character_flag = emf_context_hre_original_founder
			set_character_flag = emf_context_hre_founder
			activate_title = { title = e_hre status = yes }
			scaled_wealth = -2
			if = {
				limit = { has_nickname = no }
				give_nickname = nick_the_great
			}
			any_demesne_title = {
				limit = { tier = KING }
				de_jure_liege = e_hre
			}
			hidden_tooltip = {
				primary_title = {
					if = {
						limit = { tier = EMPEROR }
						any_direct_de_jure_vassal_title = {
							de_jure_liege = e_hre
						}
					}
				}
			}
			primary_title = {
				e_hre = {
					grant_title = ROOT
					copy_title_laws = PREV
					set_coa = PREV
				}
			}
			any_demesne_title = {
				limit = {
					tier = EMPEROR
					NOT = { title = e_hre }
				}
				emf_destroy_title_effect = yes
				hidden_tooltip = { activate_title = { title = THIS status = no } }
			}
			# Give lands to the Pope
			if = {
				limit = { NOT = { has_global_flag = SWMH } }
				if = {
					limit = {
						any_realm_title = {
							title = c_roma
							holder_scope = {
								OR = {
									ai = yes
									any_demesne_title = {
										tier = COUNT
										NOT = { title = c_roma }
									}
								}
							}
						}
					}
					c_roma = {
						ROOT = {
							religion_head = {
								grant_title = PREVPREV
							}
						}
					}
				}
				if = {
					limit = {
						any_realm_title = {
							title = c_ravenna
							holder_scope = {
								OR = {
									ai = yes
									any_demesne_title = {
										tier = COUNT
										NOT = { title = c_ravenna }
									}
								}
							}
						}
					}
					c_ravenna = {
						ROOT = {
							religion_head = {
								grant_title = PREVPREV
							}
						}
					}
				}
				if = {
					limit = {
						any_realm_title = {
							title = c_ferrara
							holder_scope = {
								OR = {
									ai = yes
									any_demesne_title = {
										tier = COUNT
										NOT = { title = c_ferrara }
									}
								}
							}
						}
					}
					c_ferrara = {
						ROOT = {
							religion_head = {
								grant_title = PREVPREV
							}
						}
					}
				}
				if = {
					limit = {
						any_realm_title = {
							title = c_urbino
							holder_scope = {
								OR = {
									ai = yes
									any_demesne_title = {
										tier = COUNT
										NOT = { title = c_urbino }
									}
								}
							}
						}
					}
					c_urbino = {
						ROOT = {
							religion_head = {
								grant_title = PREVPREV
							}
						}
					}
				}
				if = {
					limit = {
						any_realm_title = {
							title = c_spoleto
							holder_scope = {
								OR = {
									ai = yes
									any_demesne_title = {
										tier = COUNT
										NOT = { title = c_spoleto }
									}
								}
							}
						}
					}
					c_spoleto = {
						ROOT = {
							religion_head = {
								grant_title = PREVPREV
							}
						}
					}
				}
			}
			if = {
				limit = { has_global_flag = SWMH } # Shouldn't even be possible according to current way this decision is gated (charlemagne_hre)
				c_roma = {
					kingdom = {
						any_direct_de_jure_vassal_title = {
							any_direct_de_jure_vassal_title = {
								limit = {
									holder_scope = {
										OR = {
											character = ROOT
											is_liege_or_above = ROOT
										}
										OR = {
											ai = yes
											any_demesne_title = {
												tier = COUNT
												NOT = { title = PREVPREV }
											}
										}
									}
								}
								ROOT = {
									religion_head = {
										grant_title = PREVPREV
									}
								}
							}
						}
					}
				}
			}
			e_byzantium = {
				holder_scope = {
					opinion = {
						who = ROOT
						modifier = opinion_unhappy
						months = 1200
					}
					hidden_tooltip = {
						k_papal_state = {
							holder_scope = {
								reverse_opinion = {
									who = PREVPREV
									modifier = opinion_unhappy
									months = 1200
								}
							}
						}
					}
				}
			}
			if = {
				limit = {
					OR = {
						NOT = {	has_character_flag = is_charlemagne }
						has_character_flag = charlemagne_coronation
					}
				}
				hidden_tooltip = { narrative_event = { id = CM.510 } }        # Spread the news
			}
			if = {
				limit = {
					has_character_flag = is_charlemagne
					NOT = { has_character_flag = charlemagne_coronation }
				}
				hidden_tooltip = { narrative_event = { id = CM.1500 } }        # Charlemagne coronation
			}
			if = {
				limit = { ai = no }
				set_character_flag = achievement_holy_and_roman
			}
			chronicle = {
				entry = CHRONICLE_FOUNDED_HRE
				picture = GFX_evt_coronation
			}
		}
		revoke_allowed = {
			always = no
		}
		ai_will_do = {
			factor = 1
		}
	}
	
	# form_new_kingdom & form_new_empire replaced w/ emf_create_custom_kingdom & emf_create_custom_empire
	# See: emf_empire_decisions.txt

	# Hold Wargames - for nomads
	hold_nomad_wargames = {
		only_playable = yes
		potential = {
			is_playable = yes
			independent = yes
			is_nomadic = yes
			NOT = { has_character_modifier = holding_nomad_wargames }
			OR = {
				NOT = { has_character_flag = emf_tournament_cooldown }
				had_character_flag = { flag = emf_tournament_cooldown days = 3650 }
			}
		}
		allow = {
			is_adult = yes
			prisoner = no
			NOT = { trait = incapable }
			NOT = { is_inaccessible_trigger = yes }
			war = no
			custom_tooltip = {
				text = CAN_AFFORD_TOURNAMENT
				hidden_tooltip = {
					wealth = 50
					scaled_wealth = 0.5
				}
			}
			prestige = 100
			custom_tooltip = {
				text = is_not_busy_trigger_tooltip
				hidden_tooltip = { NOT = { has_character_flag = do_not_disturb } }
			}
			NOT = {
				any_demesne_title = {
					tier = COUNT
					is_occupied = yes
				}
			}
		}
		effect = {
			set_character_flag = emf_tournament_cooldown
			scaled_wealth = { value = -0.5 min = -50 }
			add_character_modifier = {
				name = holding_nomad_wargames
				duration = -1
			}
			hidden_tooltip = { long_character_event = { id = emf_tournament.100 } }
		}
		ai_will_do = {
			factor = 0.1
			modifier = {
				factor = 0
				NOT = {
					wealth = 200
				}
			}
			modifier = {
				factor = 2
				current_heir = {
					dynasty = ROOT
					combat_rating = 8
				}
			}
			modifier = {
				factor = 0.5
				NOT = { martial = 10 }
			}	
		}
	}
	
	convert_to_feudalism_indep  = {
		only_independent = yes
		is_high_prio = yes
		potential = {
			is_playable = yes
			emf_hiprio_decision_basic_potential = yes
			is_tribal = yes
			independent = yes
		}
		allow = {
			war = no
			primary_title = { has_law = tribal_organization_4 }
			capital_holding = {
				OR = {
					AND = {
						holding_type = tribal
						has_building = tb_hillfort_4
					}
					holding_type = castle
				}
			}
		}
		
		effect = {
			set_character_flag = emf_context_tribal_to_feudal
			if = {
				limit = { ai = no }
				set_character_flag = achievement_not_a_tribe
			}
			
			if = {
				limit = {
					NOT = { religion_group = muslim }
					NOT = { religion = bogomilist }
				}
				
				if = {
					limit = { ai = no }
					chronicle = {
						entry = CHRONICLE_ADOPTED_FEUDALISM
						picture = GFX_evt_castle_construction
					}
				}
				set_government_type = feudal_government
			}
		
			if = {
				limit = { religion = bogomilist }
				if = {
					limit = { ai = no }
					chronicle = {
						entry = CHRONICLE_ADOPTED_BOGOMILIST
						picture = GFX_evt_castle_construction
					}
				}
				set_government_type = bogomilist_government
			}
			
			if = {
				limit = {
					religion_group = muslim
				}
				
				if = {
					limit = { ai = no }
					chronicle = {
						entry = CHRONICLE_ADOPTED_IQTA
						picture = GFX_evt_castle_construction
					}
				}
				set_government_type = muslim_government
			}
			
			primary_title = {
				if = {
					limit = { is_law_potential = administration_0 }
					add_law = administration_0
				}
			}
			
			hidden_tooltip = {
				set_character_flag = emf_no_law_penalties
				
				any_demesne_title = {
					limit = { higher_tier_than = DUKE }
					
					if = {
						limit = { is_law_potential = crown_authority_0 }
						add_law = crown_authority_0
					}
					
					if = {
						limit = {
							is_law_potential = investiture_law_1
							is_law_allowed = investiture_law_1
							NAND = {
								is_law_potential = investiture_law_0
								is_law_allowed = investiture_law_0
							}
						}
						add_law = investiture_law_1
					}
					
					if = {
						limit = {
							is_law_potential = investiture_law_0
							is_law_allowed = investiture_law_0
						}
						add_law = investiture_law_0
					}
				}
				
				clr_character_flag = emf_no_law_penalties
			}
			
			hidden_tooltip = {
				any_demesne_title = {
					limit = {
						tier = BARON
						holding_type = tribal
						has_building = tb_hillfort_4
					}
					convert_to = CASTLE
					refill_holding_levy = yes
					set_title_flag = emf_refill_levy
				}
			}

			hidden_tooltip = {
				# Refill levies
				character_event = { id = emf_core.40 days = 3 }
			}
		}
		
		ai_will_do = {
			factor = 1
		}
	}
	
	convert_to_feudalism_vassal = {
		only_rulers = yes
		is_high_prio = yes
		potential = {
			is_ruler = yes
			emf_hiprio_decision_basic_potential = yes
			is_tribal = yes
			independent = no
		}
		allow = {
			war = no
			liege = {
				OR = {
					is_feudal = yes
					is_republic = yes
					AND = {
						is_theocracy = yes
						custom_tooltip = {
							text = TT_NOT_UNREFORMED_PAGAN
							hidden_tooltip = {
								OR = {
									NOT = { religion_group = pagan_group }
									is_reformed_religion = yes
								}
							}
						}
					}
				}
			}
			capital_holding = {
				OR = {
					AND = {
						holding_type = tribal
						has_building = tb_hillfort_4
					}
					holding_type = castle
				}
			}
		}
		
		effect = {
			set_character_flag = emf_context_tribal_to_feudal
			set_character_flag = emf_context_tribal_to_feudal_vassal
			if = {
				limit = { ai = no }
				set_character_flag = achievement_not_a_tribe
			}
			
			if = {
				limit = {
					NOT = { religion_group = muslim }
					NOT = { religion = bogomilist }
				}
				
				if = {
					limit = { ai = no }
					chronicle = {
						entry = CHRONICLE_ADOPTED_FEUDALISM
						picture = GFX_evt_castle_construction
					}
				}
				set_government_type = feudal_government
			}
			
			if = {
				limit = { religion = bogomilist }
				if = {
					limit = { ai = no }
					chronicle = {
						entry = CHRONICLE_ADOPTED_BOGOMILIST
						picture = GFX_evt_castle_construction
					}
				}
				set_government_type = bogomilist_government
			}
			
			if = {
				limit = {
					religion_group = muslim
				}
				
				if = {
					limit = { ai = no }
					chronicle = {
						entry = CHRONICLE_ADOPTED_IQTA
						picture = GFX_evt_castle_construction
					}
				}
				set_government_type = muslim_government
			}
			
			hidden_tooltip = {
				set_character_flag = emf_no_law_penalties
				
				any_demesne_title = {
					limit = { tier = KING }
					
					if = {
						limit = { is_law_potential = crown_authority_0 }
						add_law = crown_authority_0
					}
					
					if = {
						limit = {
							is_law_potential = investiture_law_1
							is_law_allowed = investiture_law_1
							NAND = {
								is_law_potential = investiture_law_0
								is_law_allowed = investiture_law_0
							}
						}
						add_law = investiture_law_1
					}
					
					if = {
						limit = {
							is_law_potential = investiture_law_0
							is_law_allowed = investiture_law_0
						}
						add_law = investiture_law_0
					}
				}
				
				clr_character_flag = emf_no_law_penalties
			}
			
			hidden_tooltip = {
				any_demesne_title = {
					limit = {
						tier = BARON
						holding_type = tribal
						has_building = tb_hillfort_4
					}
					convert_to = CASTLE
					refill_holding_levy = yes
					set_title_flag = emf_refill_levy
				}

				# Refill levies
				character_event = { id = emf_core.40 days = 3 }

# Event 55100 doesn't seem to exist, so...
#				
#				liege = {
#					character_event = { id = 55100 } # Notify Liege
#				}
			}
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.001
				liege = {
					OR = {
						NOT = { religion_group = ROOT }
						AND = {
							religion_group = pagan_group
							NOT = { religion = ROOT }
						}
					}
				}
			}
			modifier = {
				factor = 0.01
				liege = {
					NOT = { culture_group = ROOT }
				}
			}
			
			modifier = {
				factor = 0.01
				liege = {
					religion_group = ROOT
					NOT = { religion_group = pagan_group }
					NOT = { religion = ROOT }
				}
			}
			modifier = {
				factor = 0.1
				liege = {
					culture_group = ROOT
					NOT = { culture = ROOT }
				}
			}
		}
	}
	
	convert_to_republic_indep  = {
		only_independent = yes
		is_high_prio = yes
		potential = {
			is_playable = yes
			emf_hiprio_decision_basic_potential = yes
			is_tribal = yes
			independent = yes
			has_dlc = "The Republic"
		}
		allow = {
			war = no
			is_female = no
			higher_tier_than = COUNT
			custom_tooltip = {
				text = TT_NOT_UNREFORMED_PAGAN
				hidden_tooltip = {
					OR = {
						NOT = { religion_group = pagan_group }
						is_reformed_religion = yes
					}
				}
			}
			primary_title = { has_law = tribal_organization_4 }
			capital_scope = {
				port = yes
			}
			capital_holding = {
				OR = {
					AND = {
						holding_type = tribal
						has_building = tb_market_town_4
					}
					holding_type = city
				}
			}
		}
		
		effect = {
			hidden_tooltip = {
				create_family_palace = yes
				
				set_government_type = merchant_republic_government
				
				if = {
					limit = {
						NOT = {
							num_of_government_vassals = {
								government = merchant_republic_government
								value = 1
							}
						}
					}
					
					any_unique_dynasty_vassal = { # gives random vassals a family palace
						count = 4
						limit = {
							is_female = no
							OR = {
								is_republic = yes
								is_tribal = yes
							}
							is_patrician = no
							prisoner = no
							NOT = { trait = incapable }
							is_adult = yes
							NOT = { 
								dynasty = none 
							}
						}
						
						if = {
							limit = { is_tribal = yes }
							
							any_demesne_title = {
								limit = {
									tier = BARON
									holding_type = tribal
								}
								convert_to = CITY
								refill_holding_levy = yes
								set_title_flag = emf_refill_levy
							}

							character_event = { id = emf_core.40 days = 3 } # Refill levies
						}
						
						create_family_palace = yes
					}
				}
				
				any_demesne_title = {
					limit = {
						tier = BARON
						holding_type = tribal
						has_building = tb_market_town_4
					}
					convert_to = CITY
					refill_holding_levy = yes
					set_title_flag = emf_refill_levy
				}

				character_event = { id = emf_core.40 days = 3 } # Refill levies
			}
			
			set_character_flag = emf_context_tribal_to_republic
			if = {
				limit = { ai = no }
				set_character_flag = achievement_res_publica
			}
			
			if = {
				limit = {
					ai = no
				}
				chronicle = {
					entry = CHRONICLE_FOUNDED_MERCHANT_REPUBLIC
					picture = GFX_evt_busy_trading_dock_republic
				}
			}
			
			set_government_type = merchant_republic_government
			
			hidden_tooltip = {
				set_character_flag = emf_no_law_penalties
				
				any_demesne_title = {
					limit = { higher_tier_than = DUKE }
					
					if = {
						limit = { is_law_potential = crown_authority_0 }
						add_law = crown_authority_0
					}
					
					if = {
						limit = {
							is_law_potential = investiture_law_1
							is_law_allowed = investiture_law_1
							NAND = {
								is_law_potential = investiture_law_0
								is_law_allowed = investiture_law_0
							}
						}
						add_law = investiture_law_1
					}
					
					if = {
						limit = {
							is_law_potential = investiture_law_0
							is_law_allowed = investiture_law_0
						}
						add_law = investiture_law_0
					}
				}
				
				clr_character_flag = emf_no_law_penalties
			}
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
}


targetted_decisions = {
	embrace_mutazila = {
		only_playable = yes
		
		filter = self
		ai_target_filter = self
		
		potential = {
			has_dlc = "Sons of Abraham"
			is_playable = yes
			religion = sunni
			NOT = { 
				OR = {
					trait = incapable
					trait = mutazilite
					trait = ashari
				}
			}
			is_adult = yes
			prisoner = no
		}
		
		allow = {
			piety = 50
		}
		
		effect = {
			add_trait = mutazilite
			character_event = { id = SoA.600 tooltip = EVTTOOLTIP_SoA_600 }
		}
		
		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 1
			
			modifier = {
				factor = 0
				trait = zealous
			}
			modifier = {
				factor = 1.2
				trait = cynical
			}
			modifier = {
				factor = 1.2
				liege = { trait = mutazilite }
			}
			modifier = {
				factor = 0.005 # Slow it down
			}
		}
	}
	embrace_ashari = {
		only_playable = yes
		
		filter = self
		ai_target_filter = self
		
		potential = {	
			has_dlc = "Sons of Abraham"
			is_playable = yes
			religion = sunni
			NOT = { 
				OR = {
					trait = incapable
					trait = mutazilite
					trait = ashari
				}
			}
			is_adult = yes
			prisoner = no
		}
		
		allow = {
			piety = 50
		}
		
		effect = {
			add_trait = ashari
			character_event = { id = SoA.601 tooltip = EVTTOOLTIP_SoA_601 }
		}
		
		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 1
			
			modifier = {
				factor = 0
				trait = cynical
			}
			modifier = {
				factor = 1.2
				trait = zealous
			}
			modifier = {
				factor = 1.2
				liege = { trait = ashari }
			}
			modifier = {
				factor = 1.2
				decadence = 40
			}
			modifier = {
				factor = 1.2
				decadence = 60
			}
			modifier = {
				factor = 1.2
				decadence = 80
			}
			modifier = {
				factor = 0.005 # Slow it down
			}
		}
	}
}
