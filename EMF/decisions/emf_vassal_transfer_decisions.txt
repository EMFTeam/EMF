# -*- ck2.decisions -*-

targeted_decisions = {
	emf_transfer_de_jure_vassals = {
		ai = no
		filter = vassals

		from_potential = {
			higher_tier_than = COUNT
			war = no
			in_revolt = no
		}
		potential = {
			vassal_of = FROM
			higher_tier_than = BARON
			NOT = { any_demesne_title = { temporary = yes } }
			FROM = {
				any_vassal = {
					de_jure_liege = ROOT
					lower_tier_than = ROOT
					OR = {
						is_patrician = no
						is_merchant_republic = yes
					}
					war = no
					in_revolt = no
					NOT = { any_demesne_title = { temporary = yes } }
				}
			}
		}
		allow = {
			war = no
			in_revolt = no
		}
		effect = {
			liege = {
				show_scope_change = no
				any_vassal = {
					show_scope_change = no
					limit = {
						de_jure_liege = ROOT
						lower_tier_than = ROOT
						OR = {
							is_patrician = no
							is_merchant_republic = yes
						}
						war = no
						in_revolt = no
						NOT = { any_demesne_title = { temporary = yes } }
					}
					set_defacto_liege = ROOT
					emf_liege_change = yes
					ROOT = {
						show_scope_change = no
						opinion = { who = LIEGE modifier = opinion_vassal_transfer }
					}
				}
			}
		}
	}
}

decisions = {
	# TODO: add emf_transfer_all_de_jure_vassals, which will transfer all of your vassals under their most immediate de jure
	# liege in one click.

	emf_request_dejure_vassal_transfer = {
		only_playable = yes
		is_high_prio = yes

		potential = {
			independent = no
			war = no
			in_revolt = no
			NOT = { any_demesne_title = { temporary = yes } }
			liege = {
				NOT = { character = ROOT }
				war = no
				in_revolt = no
				any_vassal = {
					de_jure_liege = ROOT
					lower_tier_than = ROOT
					OR = {
						is_patrician = no
						is_merchant_republic = yes
					}
					war = no
					in_revolt = no
					NOT = { any_demesne_title = { temporary = yes } }
				}
			}
			OR = {
				emf_hiprio_decision_basic_potential = yes
				ai = yes
			}
		}
		allow = {
			custom_tooltip = {
				text = emf_ctt_liege_can_transfer_dj_vassal_to_me
			}
			custom_tooltip = {
				text = NOT_REQUEST_WITHIN_LAST_YEAR
				hidden_tooltip = {
					OR = {
						NOT = { has_flag = requested_vassal_transfer }
						had_flag = { flag = requested_vassal_transfer days = 365 }
					}
				}
			}
			liege = {
				opinion = { who = ROOT value = -25 }
			}
		}
		effect = {
			set_flag = requested_vassal_transfer
			liege = { character_event = { id = 63001 days = 4 tooltip = "EVTTOOLTIP63001" } }
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				NOR = {
					NOT = { has_flag = requested_vassal_transfer }
					had_flag = { flag = requested_vassal_transfer days = 1825 }
				}
			}
		}
	}
}
