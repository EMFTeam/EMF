targetted_decisions = {

	recruit_faction_member = {
		ai_target_filter = realm
		filter = realm
		
		from_potential = {
			is_playable = yes
			is_adult = yes
			independent = no
			prisoner = no
			pf_leader_trigger = yes
		}
		potential = {
			is_playable = yes
			is_adult = yes
			independent = no
			prisoner = no
			same_liege = FROM
			NOR = {
				character = FROM
				pf_leader_trigger = yes
				trait = incapable
				liege = { current_heir = { character = ROOT } }
				has_opinion_modifier = { who = liege modifier = opinion_coerced_into_leaving_faction }
			}
			OR = {
				FROM = { NOT = { leads_faction = faction_court } }
				NOR = {
					in_faction = faction_court
					has_character_flag = faction_court_supporter
				}
			}
			OR = {
				FROM = { NOT = { leads_faction = faction_prosperity } }
				NOR = {
					in_faction = faction_prosperity
					has_character_flag = faction_prosperity_supporter
				}
			}
			OR = {
				FROM = { NOT = { leads_faction = faction_glory } }
				NOR = {
					in_faction = faction_glory
					has_character_flag = faction_glory_supporter
				}
			}
			OR = {
				FROM = { NOT = { leads_faction = faction_tradition } }
				NOR = {
					in_faction = faction_tradition
					has_character_flag = faction_tradition_supporter
					trait = cynical
					trait = excommunicated
					NOT = { liege = { religion = ROOT } }
				}
			}
		}
		allow = {
			NOT = { is_rival = FROM }
			is_ill = no
			custom_tooltip = {
				text = IS_NOT_BUSY
				hidden_tooltip = {
					war = no
					in_command = no
					NOT = { trait = in_hiding }
					NOT = { has_character_flag = do_not_disturb }
				}
			}
			custom_tooltip = {
				text = NOT_RECENTLY_RECRUITED
				hidden_tooltip = {
					NOT = { has_character_modifier = recruit_faction_target_timer }
				}
			}
			custom_tooltip = {
				text = NOT_REBUFFED_RECRUIT
				hidden_tooltip = {
					FROM = {
						NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_rebuffed_recruitment } }
					}
				}
			}
			FROM = {
				is_ill = no
				custom_tooltip = {
					text = IS_NOT_BUSY
					hidden_tooltip = {
						war = no
						in_command = no
						NOT = { trait = in_hiding }
						NOT = { has_character_flag = do_not_disturb }
					}
				}
				custom_tooltip = {
					text = NOT_RECENTLY_RECRUIT
					hidden_tooltip = {
						NOT = { has_character_modifier = recruit_faction_timer }
					}
				}
			}
		}
		effect = {
			character_event = { id = PlusFaction.111 days = 15 tooltip = ATTEMPT_RECRUIT_FACTION }
			hidden_tooltip = {
				add_character_modifier = {
					name = recruit_faction_target_timer
					duration = 365
					hidden = yes
				}
				FROM = {
					character_event = { id = PlusFaction.110 }
					add_character_modifier = {
						name = recruit_faction_timer
						duration = 365
						hidden = yes
					}
				}
			}
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				always = yes
			}
			modifier = {
				factor = 0.5
				pf_member_trigger = yes
				FROM = {
					NOR = {
						trait = ambitious
						trait = brave
						trait = diligent
					}
				}
			}
			modifier = {
				factor = 0.1
				FROM = {
					OR = {
						trait = content
						trait = craven
						trait = humble
					}
				}
			}
			modifier = {
				factor = 10
				OR = {
					is_close_relative = FROM
					opinion = { who = FROM value = 50 }
				}
			}
			modifier = {
				factor = 0
				NOT = { opinion = { who = FROM value = 0 } }
			}
			modifier = {
				factor = 0
				NOT = { reverse_opinion = { who = FROM value = 0 } }
			}
		}
	}
	
	court_faction_member = {
		ai_target_filter = realm
		filter = realm
		
		from_potential = {
			is_playable = yes
			is_adult = yes
			independent = no
			prisoner = no
			pf_member_trigger = yes
		}
		potential = {
			ai = yes
			is_adult = yes
			is_playable = yes
			independent = no
			prisoner = no
			same_liege = FROM
			NOR = {
				character = FROM
				trait = incapable
			}
			OR = {
				AND = {
					in_faction = faction_court
					FROM = { in_faction = faction_court }
				}
				AND = {
					in_faction = faction_prosperity
					FROM = { in_faction = faction_prosperity }
				}
				AND = {
					in_faction = faction_glory
					FROM = { in_faction = faction_glory }
				}
				AND = {
					in_faction = faction_tradition
					FROM = { in_faction = faction_tradition }
				}
			}
		}
		allow = {
			NOT = { is_rival = FROM }
			is_ill = no
			custom_tooltip = {
				text = IS_NOT_BUSY
				hidden_tooltip = {
					war = no
					in_command = no
					NOT = { trait = in_hiding }
					NOT = { has_character_flag = do_not_disturb }
				}
			}
			custom_tooltip = {
				text = NOT_RECENTLY_COURTED
				hidden_tooltip = {
					NOT = { has_character_modifier = court_faction_target_timer }
				}
			}
			custom_tooltip = {
				text = NOT_BAD_COURT_RECENT
				hidden_tooltip = {
					opinion = { who = FROM value = -50 }
					NOT = { has_opinion_modifier = { who = ROOT modifier = unpleasant_meeting } }
				}
			}
			FROM = {
				is_ill = no
				custom_tooltip = {
					text = IS_NOT_BUSY
					hidden_tooltip = {
						war = no
						in_command = no
						NOT = { trait = in_hiding }
						NOT = { has_character_flag = do_not_disturb }
					}
				}
				custom_tooltip = {
					text = NOT_RECENTLY_COURT
					hidden_tooltip = {
						NOT = { has_character_modifier = court_faction_timer }
					}
				}
			}
		}
		effect = {
			FROM = { character_event = { id = PlusFaction.125 tooltip = ATTEMPT_COURT_FACTION } }
			hidden_tooltip = {
				add_character_modifier = {
					name = court_faction_target_timer
					duration = 365
					hidden = yes
				}
				FROM = {
					set_character_flag = do_not_disturb
					character_event = { id = PlusFaction.1100 days = 15 } #clear flag
					add_character_modifier = {
						name = court_faction_timer
						duration = 365
						hidden = yes
					}
				}
			}
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.05
				always = yes
			}
			modifier = {
				factor = 10
				FROM = { trait = gregarious }
			}
			modifier = {
				factor = 2
				FROM = {
					OR = {
						trait = ambitious
						trait = diligent
						diplomacy = 15
					}
				}
			}
			modifier = {
				factor = 2
				higher_tier_than = COUNT
			}
			modifier = {
				factor = 2
				higher_tier_than = DUKE
			}
			modifier = {
				factor = 0.5
				lower_tier_than = COUNT
			}
			modifier = {
				factor = 0.5
				FROM = { NOT = { diplomacy = 8 } }
			}
			modifier = {
				factor = 0.5
				NOT = { opinion = { who = FROM value = -25 } }
			}
			modifier = {
				factor = 0
				opinion = { who = FROM value = 50 }
			}
			modifier = {
				factor = 0
				pf_leader_trigger = yes
			}
			modifier = {
				factor = 0
				FROM = {
					OR = {
						trait = shy
						trait = paranoid
						trait = slothful
					}
				}
			}
		}
	}
}

decisions = {

	hold_court_faction_meeting = {
		is_high_prio = yes
		
		potential = {
			ai = no
			leads_faction = faction_court
			pf_war_trait_trigger = no
			any_faction_backer = { in_faction = faction_court }
			had_global_flag = { flag = HIP days = 730 }
			NOR = {
				has_character_flag = faction_meeting_called
				has_character_flag = faction_meeting_begun
				has_character_flag = faction_leadership_challenge
			}
		}
		allow = {
			custom_tooltip = {
				text = CAN_HOLD_FACTION_MEETING
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = faction_meeting }
						had_character_flag = { flag = faction_meeting days = 1095 }
						AND = {
							had_character_flag = { flag = faction_meeting days = 730 }
							liege = { has_character_flag = faction_court_angry }
						}
					}
				}
			}
		}
		effect = {
			custom_tooltip = { text = CUSTOMTOOLTIP51 }
			set_character_flag = faction_meeting_called
			clr_character_flag = faction_meeting_postponed
			hidden_tooltip = {
				set_variable = { which = "faction_votes" value = 0 }
				set_variable = { which = "faction_meeting_delay" value = 0 }
				any_faction_backer = {
					limit = { in_faction = faction_court }
					character_event = { id = PlusFaction.302 }
				}
				character_event = { id = PlusFaction.303 days = 15 } #meeting postponed
				character_event = { id = PlusFaction.304 days = 15 } #start the meeting
				character_event = { id = PlusFaction.350 days = 15 } #leadership challenged
			}
		}
		ai_will_do = {
			factor = 0
		}
	}
	
	hold_prosperity_faction_meeting = {
		is_high_prio = yes
		
		potential = {
			ai = no
			leads_faction = faction_prosperity
			pf_war_trait_trigger = no
			any_faction_backer = { in_faction = faction_prosperity }
			had_global_flag = { flag = HIP days = 730 }
			NOR = {
				has_character_flag = faction_meeting_called
				has_character_flag = faction_meeting_begun
				has_character_flag = faction_leadership_challenge
			}
		}
		allow = {
			custom_tooltip = {
				text = CAN_HOLD_FACTION_MEETING
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = faction_meeting }
						had_character_flag = { flag = faction_meeting days = 1095 }
						AND = {
							had_character_flag = { flag = faction_meeting days = 730 }
							liege = { has_character_flag = faction_prosperity_angry }
						}
					}
				}
			}
		}
		effect = {
			custom_tooltip = { text = CUSTOMTOOLTIP52 }
			set_character_flag = faction_meeting_called
			clr_character_flag = faction_meeting_postponed
			hidden_tooltip = {
				set_variable = { which = "faction_votes" value = 0 }
				set_variable = { which = "faction_meeting_delay" value = 0 }
				any_faction_backer = {
					limit = { in_faction = faction_prosperity }
					character_event = { id = PlusFaction.302 }
				}
				character_event = { id = PlusFaction.303 days = 15 } #meeting postponed
				character_event = { id = PlusFaction.304 days = 15 } #start the meeting
				character_event = { id = PlusFaction.350 days = 15 } #leadership challenged
			}
		}
		ai_will_do = {
			factor = 0
		}
	}
	
	hold_glory_faction_meeting = {
		is_high_prio = yes
		
		potential = {
			ai = no
			leads_faction = faction_glory
			pf_war_trait_trigger = no
			any_faction_backer = { in_faction = faction_glory }
			had_global_flag = { flag = HIP days = 730 }
			NOR = {
				has_character_flag = faction_meeting_called
				has_character_flag = faction_meeting_begun
				has_character_flag = faction_leadership_challenge
			}
		}
		allow = {
			custom_tooltip = {
				text = CAN_HOLD_FACTION_MEETING
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = faction_meeting }
						had_character_flag = { flag = faction_meeting days = 1095 }
						AND = {
							had_character_flag = { flag = faction_meeting days = 730 }
							liege = { has_character_flag = faction_glory_angry }
						}
					}
				}
			}
		}
		effect = {
			custom_tooltip = { text = CUSTOMTOOLTIP53 }
			set_character_flag = faction_meeting_called
			clr_character_flag = faction_meeting_postponed
			hidden_tooltip = {
				set_variable = { which = "faction_votes" value = 0 }
				set_variable = { which = "faction_meeting_delay" value = 0 }
				any_faction_backer = {
					limit = { in_faction = faction_glory }
					character_event = { id = PlusFaction.302 }
				}
				character_event = { id = PlusFaction.303 days = 15 } #meeting postponed
				character_event = { id = PlusFaction.304 days = 15 } #start the meeting
				character_event = { id = PlusFaction.350 days = 15 } #leadership challenged
			}
		}
		ai_will_do = {
			factor = 0
		}
	}

	hold_tradition_faction_meeting = {
		is_high_prio = yes
		
		potential = {
			ai = no
			leads_faction = faction_tradition
			pf_war_trait_trigger = no
			any_faction_backer = { in_faction = faction_tradition }
			had_global_flag = { flag = HIP days = 730 }
			NOR = {
				has_character_flag = faction_meeting_called
				has_character_flag = faction_meeting_begun
				has_character_flag = faction_leadership_challenge
			}
		}
		allow = {
			custom_tooltip = {
				text = CAN_HOLD_FACTION_MEETING
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = faction_meeting }
						had_character_flag = { flag = faction_meeting days = 1095 }
						AND = {
							had_character_flag = { flag = faction_meeting days = 730 }
							liege = { has_character_flag = faction_tradition_angry }
						}
					}
				}
			}
		}
		effect = {
			custom_tooltip = { text = CUSTOMTOOLTIP54 }
			set_character_flag = faction_meeting_called
			clr_character_flag = faction_meeting_postponed
			hidden_tooltip = {
				set_variable = { which = "faction_votes" value = 0 }
				set_variable = { which = "faction_meeting_delay" value = 0 }
				any_faction_backer = {
					limit = { in_faction = faction_tradition }
					character_event = { id = PlusFaction.302 }
				}
				character_event = { id = PlusFaction.303 days = 15 } #meeting postponed
				character_event = { id = PlusFaction.304 days = 15 } #start the meeting
				character_event = { id = PlusFaction.350 days = 15 } #leadership challenged
			}
		}
		ai_will_do = {
			factor = 0
		}
	}

	plus_faction_maintenance_ai = {
		potential = {
			independent = yes
			has_landed_title = e_hip
			OR = {
				NOT = { has_global_flag = pf_maintenance_pulse }
				had_global_flag = { flag = pf_maintenance_pulse days = 365 }
			}
		}
		allow = { }
		effect = {
			clr_global_flag = pf_maintenance_pulse
			set_global_flag = pf_maintenance_pulse
			
			# clean up flags (essentially all rulers in the game, ideally would
			# be amortized, but ideal is far from working ATM)
			any_title = {
				limit = {
					has_holder = yes
					is_primary_holder_title = yes
					nor = {
						rebel = yes
						clan = yes
						is_nomadic = yes
					}
				}
				holder_scope = {
					if = {
						limit = { war = no }
						clr_character_flag = faction_court_war
						clr_character_flag = faction_prosperity_war
						clr_character_flag = faction_glory_war
						clr_character_flag = faction_tradition_war
					}
					if = {
						limit = {
							pf_leader_trigger = no
							OR = {
								has_character_flag = faction_meeting
								has_character_flag = faction_meeting_called
								has_character_flag = faction_meeting_begun
								has_character_flag = faction_meeting_postponed
								has_character_flag = faction_leadership_challenge
							}
						}
						clr_character_flag = faction_meeting
						clr_character_flag = can_make_demand
						clr_character_flag = faction_meeting_called
						clr_character_flag = faction_meeting_begun
						clr_character_flag = faction_meeting_postponed
						clr_character_flag = faction_leadership_challenge
						clr_character_flag = faction_is_happy
						clr_character_flag = faction_is_content
						clr_character_flag = faction_is_unhappy
						clr_character_flag = faction_is_angry
						clr_character_flag = made_great_speech
						clr_character_flag = made_good_speech
						clr_character_flag = made_fair_speech
						clr_character_flag = made_poor_speech
						clr_character_flag = made_terrible_speech
						clr_character_flag = liege_opinion_increased
						clr_character_flag = liege_opinion_slightly_increased
						clr_character_flag = liege_opinion_slightly_decreased
						clr_character_flag = liege_opinion_decreased
						clr_character_flag = demand_money_liege
						clr_character_flag = demand_support_liege
						clr_character_flag = faction_demand_refused
					}
					if = {
						limit = {
							OR = {
								had_character_flag = { flag = faction_meeting_called days = 365 }
								had_character_flag = { flag = faction_meeting_begun days = 365 }
								had_character_flag = { flag = faction_leadership_challenge days = 365 }
							}
						}
						clr_character_flag = can_make_demand
						clr_character_flag = faction_meeting_called
						clr_character_flag = faction_meeting_begun
						clr_character_flag = faction_meeting_postponed
						clr_character_flag = faction_leadership_challenge
						clr_character_flag = faction_is_happy
						clr_character_flag = faction_is_content
						clr_character_flag = faction_is_unhappy
						clr_character_flag = faction_is_angry
						clr_character_flag = made_great_speech
						clr_character_flag = made_good_speech
						clr_character_flag = made_fair_speech
						clr_character_flag = made_poor_speech
						clr_character_flag = made_terrible_speech
						clr_character_flag = liege_opinion_increased
						clr_character_flag = liege_opinion_slightly_increased
						clr_character_flag = liege_opinion_slightly_decreased
						clr_character_flag = liege_opinion_decreased
						clr_character_flag = demand_money_liege
						clr_character_flag = demand_support_liege
						clr_character_flag = faction_demand_refused
					}
					if = {
						limit = { had_character_flag = { flag = former_faction_leader days = 7 } }
						clr_character_flag = former_faction_leader
					}
					if = {
						limit = { had_character_flag = { flag = faction_reboot days = 7 } }
						clr_character_flag = faction_reboot
					}
					any_demesne_title = {
						limit = { higher_tier_than = count }
						if = {
							limit = { has_law = succ_gavelkind }
							clr_title_flag = former_gavelkind
						}
						if = {
							limit = { has_law = succ_seniority }
							clr_title_flag = former_seniority
						}
						if = {
							limit = { has_law = succ_primogeniture }
							clr_title_flag = former_primogeniture
						}
						if = {
							limit = { has_law = succ_gavelkind }
							clr_title_flag = former_gavelkind
						}
						if = {
							limit = { has_law = succ_feudal_elective }
							clr_title_flag = former_feudal_elective
						}
						if = {
							limit = { has_law = succ_tanistry }
							clr_title_flag = former_tanistry
						}
						if = {
							limit = { has_law = succ_ultimogeniture }
							clr_title_flag = former_ultimogeniture
						}
						if = {
							limit = { has_law = cognatic_succession }
							clr_title_flag = former_cognatic_succession
						}
						if = {
							limit = { has_law = agnatic_succession }
							clr_title_flag = former_agnatic_succession
						}
						if = {
							limit = { has_law = true_cognatic_succession }
							clr_title_flag = former_true_cognatic_succession
						}
					}
				}
			}

			#faction system
			any_title = {
				limit = {
					has_holder = yes
					is_primary_holder_title = yes
					higher_tier_than = COUNT
					nor = {
						rebel = yes
						clan = yes
						is_nomadic = yes
					}
					holder_scope = {
						is_landed = yes
						is_nomadic = no
						any_vassal = { pf_member_trigger = yes }
					}
				}
				holder_scope = {
					add_character_modifier = {
						name = pf_maintenance_timer
						duration = 90 # NOTE: Removed once the MTTH maintenance event catches; safely rounding-up
						hidden = yes
					}
					# Let the MTTH event do the annual work, all nicely amortized over < 40 days
					# and execution-coincidental with all other MTTH event eval/exec for this liege.
					# ... Boom!
				}
			}
		}
		ai_will_do = {
			factor = 100
		}
	}
}

