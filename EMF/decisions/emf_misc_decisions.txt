# -*- ck2.decisions -*-



targetted_decisions = {
	emf_bring_child_home = {
		filter = dynasty
		ai_target_filter = self
		
		is_high_prio = yes
		
		from_potential = {
			is_playable = yes
			ai = no
		}
		potential = {
			is_child_of = FROM
			liege = { NOT = { character = FROM } }
			NOR = {
				prisoner = yes
				is_ruler = yes
				is_adult = yes
				is_married = yes
				any_child = { is_alive = yes }
			}
		}
		allow = {
			liege = {
				lower_real_tier_than = FROM
			}
		}
		effect = {
			move_character = FROM
		}
		revoke_allowed = {
			always = no
		}
		ai_will_do = {
			factor = 0
		}
	}
	
	
	ask_to_leave_court = {
		filter = court
		ai_target_filter = self
		
		from_potential = {
			ai = no
		}
		potential = {
			NOT = { character = FROM }
			host = { character = FROM }
			liege = { character = FROM }
 			NOR = {
 				is_ruler = yes
 				is_landed = yes
 				is_adult = no
 				has_job_title = yes
 				has_minor_title = title_regent
 				has_minor_title = title_appointed_regent
 				has_minor_title = title_commander
 				has_minor_title = title_court_physician
 				dynasty = FROM
 				is_married = FROM
 				is_consort = FROM
 				is_close_relative = FROM
 				has_character_flag = eternal_life_mystic
 				has_character_flag = immortal_rival
 				trait = horse
 				has_character_modifier = in_seclusion
 			}
		}
		allow = {
			FROM = {
				custom_tooltip = { text = NEEDS_10_PRESTIGE_COST hidden_tooltip = { prestige = 10 } }
				has_regent = no
				prisoner = no
			}
			ROOT = {
				prisoner = no
				custom_tooltip = {
					text = emf_ctt_is_not_guardian
					hidden_tooltip = {
						NOT = {
							any_ward = { is_alive = yes }
						}
					}
				}
			}
		}
		effect = {
			FROM = { prestige = -10 }
			if = {
				limit = { religion = FROM }
				if = {
					limit = {
						FROM = {
							any_realm_lord = {
								NOT = { character = FROM }
							}
						}
					}
					custom_tooltip = { text = emf_court_banishment_tt_samerel }
				}
				if = {
					limit = {
						NOT = {
							FROM = {
								any_realm_lord = {
									NOT = { character = FROM }
								}
							}
						}
					}
					custom_tooltip = { text = emf_court_banishment_tt_samerel_noplace }
				}
			}
			if = {
				limit = {
					NOT = { religion = FROM }
				}
				custom_tooltip = { text = emf_court_banishment_tt_difrel }
			}
			opinion = {
				modifier = opinion_banished_from_court
				who = FROM
				months = 60
			}
			hidden_tooltip = {
				if = { # Same religion as liege
					limit = { religion = FROM }
					FROM = {
						# Go to dynasty members in realm first
						random_playable_ruler = {
							limit = {
								NOT = { character = FROM }
								same_realm = FROM
								NOT = { dynasty = none }
								dynasty = ROOT
								their_opinion = { who = ROOT value = 10 }
							}
							ROOT = { move_character = PREV }
							break = yes
						}
						# If no dynasty match, pick a random playable in realm
						random_playable_ruler = {
							limit = {
								NOT = { character = FROM }
								same_realm = FROM
								religion = ROOT
								their_opinion = { who = ROOT value = 10 }
							}
							ROOT = { move_character = PREV }
							break = yes
						}
						# If no dynasty match, pick a random playable in realm
						random_playable_ruler = {
							limit = {
								NOT = { character = FROM }
								same_realm = FROM
								their_opinion = { who = ROOT value = 10 }
							}
							ROOT = { move_character = PREV }
							break = yes
						}
						random_playable_ruler = {
							limit = {
								NOT = { character = FROM }
								same_realm = FROM
							}
							ROOT = { move_character = PREV }
							break = yes
						}
						ROOT = { banish = yes } # If all else fails, just leave
						break = yes
					}
				}
				# If different religion, go to realm with same faith if possible
				random_playable_ruler = {
					limit = {
						NOT = { character = FROM }
						religion = ROOT
						their_opinion = { who = ROOT value = 10 }
					}
					ROOT = { move_character = PREV }
					break = yes
				}
				random_playable_ruler = {
					limit = {
						NOT = { character = FROM }
						religion = ROOT
					}
					ROOT = { move_character = PREV }
					break = yes
				}
				banish = yes # Otherwise, just get the heck out
			}
		}
		revoke_allowed = {
			always = no
		}
		ai_will_do = {
			factor = 0
		}
	}
}
