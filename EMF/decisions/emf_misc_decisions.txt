# -*- ck2.decisions -*-



targetted_decisions = {
	emf_bring_child_home = {
		only_playable = yes
		is_high_prio = yes
		
		filter = dynasty
		ai_target_filter = self
		
		from_potential = {
			is_playable = yes
			ai = no
		}
		potential = {
			is_child_of = FROM
			liege = { NOT = { character = FROM } }
			NOT = {
				prisoner = yes
				is_ruler = yes
				is_adult = yes
				is_married = yes
			}
		}
		allow = {
			liege = {
				OR = {
					ai = yes
					lower_tier_than = FROM
				}
			}
		}
		effect = {
			move_character = FROM
		}
		revoke_allowed = {
			always = no
		}
		ai_will_do = {
			factor = 0
		}
	}
	
	emf_court_banishment = {
		only_playable = yes
		filter = court
		ai_target_filter = self
		
		from_potential = {
			is_playable = yes
			ai = no
		}
		potential = {
			NOT = { character = FROM }
			host = { character = FROM }
			liege = { character = FROM }
			prisoner = no
		}
		allow = {
			FROM = {
				prestige = 50
				has_regent = no
				prisoner = no
			}
			ROOT = {
				prisoner = no
				is_voter = no
				custom_tooltip = {
					text = emf_ctt_is_not_guardian
					hidden_tooltip = {
						NOT = {
							any_ward = { always = yes }
						}
					}
				}
				is_adult = yes
			}
		}
		effect = {
			FROM = { prestige = -5 }
			if = {
				limit = { religion = FROM }
				if = {
					limit = {
						FROM = {
							any_realm_lord = {
								NOT = { character = FROM }
							}
						}
					}
					custom_tooltip = { text = emf_court_banishment_tt_samerel }
				}
				if = {
					limit = {
						NOT = {
							FROM = {
								any_realm_lord = {
									NOT = { character = FROM }
								}
							}
						}
					}
					custom_tooltip = { text = emf_court_banishment_tt_samerel_noplace }
				}
			}
			if = {
				limit = {
					NOT = { religion = FROM }
				}
				custom_tooltip = { text = emf_court_banishment_tt_difrel }
			}
			opinion = {
				modifier = opinion_banished_from_court
				who = FROM
				months = 60
			}
			hidden_tooltip = {
				if = { # Same religion as liege
					limit = { religion = FROM }
					FROM = {
						# Go to dynasty members in realm first
						random_playable_ruler = {
							limit = {
								NOT = { character = FROM }
								same_realm = FROM
								NOT = { dynasty = none }
								dynasty = ROOT
								their_opinion = { who = ROOT value = 10 }
							}
							ROOT = { move_character = PREV }
							break = yes
						}
						# If no dynasty match, pick a random playable in realm
						random_playable_ruler = {
							limit = {
								NOT = { character = FROM }
								same_realm = FROM
								religion = ROOT
								their_opinion = { who = ROOT value = 10 }
							}
							ROOT = { move_character = PREV }
							break = yes
						}
						# If no dynasty match, pick a random playable in realm
						random_playable_ruler = {
							limit = {
								NOT = { character = FROM }
								same_realm = FROM
								their_opinion = { who = ROOT value = 10 }
							}
							ROOT = { move_character = PREV }
							break = yes
						}
						random_playable_ruler = {
							limit = {
								NOT = { character = FROM }
								same_realm = FROM
							}
							ROOT = { move_character = PREV }
							break = yes
						}
						ROOT = { banish = yes } # If all else fails, just leave
						break = yes
					}
				}
				# If different religion, go to realm with same faith if possible
				random_playable_ruler = {
					limit = {
						NOT = { character = FROM }
						religion = ROOT
						their_opinion = { who = ROOT value = 10 }
					}
					ROOT = { move_character = PREV }
					break = yes
				}
				random_playable_ruler = {
					limit = {
						NOT = { character = FROM }
						religion = ROOT
					}
					ROOT = { move_character = PREV }
					break = yes
				}
				banish = yes # Otherwise, just get the heck out
			}
		}
		revoke_allowed = {
			always = no
		}
		ai_will_do = {
			factor = 0
		}
	}
}
