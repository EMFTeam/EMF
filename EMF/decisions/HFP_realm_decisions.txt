# -*- ck2.decisions -*-

decisions = {
	# restore_byzantine_empire removed in favor of preexisting restoration decision in emf_formation_decisions.txt
	
	# TODO: add similar logic to emf_cb_on_success_posttitle for FROM
	ai_claim_county_if_baron = {
		is_high_prio = yes
		only_playable = yes
		ai_check_interval = 24

		potential = {
			higher_tier_than = COUNT
			war = no
			is_landed = yes
			is_patrician = no
			num_of_count_titles < 1
			any_realm_title = {
				tier = COUNT
				owner = { ai = yes }
			}
			ai = yes
		}
		effect = {
			random_realm_title = {
				limit = {
					tier = COUNT
					owner = { ai = yes }
				}
				preferred_limit = {
					location = { is_capital = no }
				}
				usurp_title_plus_barony_if_unlanded = { target = ROOT type = revoke }
			}
		}
		ai_will_do = {
			factor = 1
		}
	}
	
	form_lcr = {
		is_high_prio = yes
		only_playable = yes
		ai_check_interval = 60

		potential = {
			OR = {		###Must be Slavic of Lech, Czech or Rus lineage
				culture = russian
				culture = polish
				culture = bohemian
				culture = volhynian
				culture = ilmenian
				culture = severian
				culture = pommeranian
				culture = moravian # SWMH
			}
			any_demesne_title = {
				OR = {
					tier = KING
					tier = EMPEROR
				}
			}
			e_lechczechrus = {
				is_titular = yes
			}
			e_lechczechrus = {
				has_holder = no
			}
			is_alternate_start = no
		}

		allow = {
			is_adult = yes
			prestige = 5000
			war = no
			NOT = { trait = incapable }
			AND = {		#Control Czech, Poland & Rus
				completely_controls = k_bohemia
				completely_controls = k_poland
				completely_controls = k_galicia-volhynia
				completely_controls = k_ruthenia
				completely_controls = k_chernigov
				completely_controls = k_vladimir
				completely_controls = k_rus
			}
			is_vice_royalty = no
		}

		effect = {
			custom_tooltip = {
				text = form_lcr_tt
				grant_title_no_opinion = e_lechczechrus 
			}
			
			if = {
				limit = {
					is_female = yes
					has_dlc = "Holy Fury"
				}
				create_bloodline = {
					type = lcr_female
				}
				new_bloodline = {
					set_description = "lcr_female_desc"
				}
			}
			if = {
				limit = {
					is_female = no
					has_dlc = "Holy Fury"
				}
				create_bloodline = {
					type = lcr_male
				}
				new_bloodline = {
					set_description = "lcr_male_desc"
				}
			}

			hidden_tooltip = {
			
				if = {
					limit = {
						ai = no
					}
					set_character_flag = achievement_lcr
				}

				primary_title = {
					e_lechczechrus = {
						copy_title_laws = PREV
						copy_title_history = PREV
					}
				}

				any_demesne_title = {
					limit = {
						tier = EMPEROR
						NOT = { title = e_lechczechrus }
					}
					destroy_landed_title = THIS
				}

				capital = PREV

				###Slavic kingdoms go to LCR
				k_bohemia = { de_jure_liege = e_lechczechrus }
				k_poland = { de_jure_liege = e_lechczechrus }
				k_galicia-volhynia = { de_jure_liege = e_lechczechrus }
				k_ruthenia = { de_jure_liege = e_lechczechrus }
				k_chernigov = { de_jure_liege = e_lechczechrus }
				k_vladimir = { de_jure_liege = e_lechczechrus }
				k_rus = { de_jure_liege = e_lechczechrus }
				
				###If you also completely control Pomerania, it's added to LCR as well
				if = {
					limit = {
						completely_controls = k_pomerania 
					}
					k_pomerania = { de_jure_liege = e_lechczechrus }
				}

				ROOT = {
					narrative_event = { id = HFP.99999 }
				}
				any_playable_ruler = {
					narrative_event = { id = HFP.99999 }
				}
			}
		}
	}

	### POPE RELATED EVENTS ### 
	recreate_the_papal_guards = {
		is_high_prio = yes
		only_playable = yes
		ai_check_interval = 120

		potential = {
			has_landed_title = k_papal_state
			NOT = { is_title_active = d_papal_guards }
		}
		allow = {
			num_of_count_titles > 0
		}
		effect = {
			create_random_soldier = {
				random_traits = yes
				dynasty = random
				attributes = { martial = 9 }
			}
			new_character = {
				add_trait = zealous
				random = { chance = 50 add_trait = brave }
				random = { chance = 50 add_trait = ambitious }
				random_list = {
					40 = { add_trait = patient }
					40 = { add_trait = wroth }
					20 = {}
				}
				clear_education_trait = yes
				random_list = {
					10 = { add_trait = tough_soldier }
					30 = { add_trait = skilled_tactician }
					20 = { add_trait = brilliant_strategist }
				}
				if = {
					limit = {
						trait = brilliant_strategist
						leader_traits == 0
					}
					random_list = {
						50 = { add_trait = holy_warrior }
						10 = { add_trait = organizer }
						10 = { add_trait = siege_leader }
						10 = { add_trait = cavalry_leader }
						10 = { add_trait = inspiring_leader }
						10 = { add_trait = flanker }
					}
				}
				emf_new_character_noble = yes
				activate_title = { title = d_papal_guards status = yes }
				grant_title_no_opinion = d_papal_guards
				emf_create_courtiers = yes
				set_defacto_liege = ROOT
			}
		}
	}
}
