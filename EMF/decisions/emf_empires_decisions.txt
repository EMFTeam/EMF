decisions = {
	emf_create_hre = {
		is_high_prio = yes

		potential = {
			emf_hiprio_decision_basic_potential_trigger = yes
			has_global_flag = charlemagne_hre
			independent = yes
			tier = king
			is_feudal = yes
			OR = {
				religion = catholic
				AND = {
					religion = fraticelli
					is_heretic = no
				}
			}
			e_hre = {
				has_holder = no
			}
			e_hre_french = {
				has_holder = no
			}
			OR = {
				has_landed_title = k_germany
				has_landed_title = k_bavaria
				has_landed_title = k_italy
				has_landed_title = k_lotharingia
			}
		}
		allow = {
			has_landed_title = k_germany
			has_landed_title = k_lotharingia
			has_landed_title = k_italy
			realm_size = 180
			prestige = 1000
			war = no
			has_regent = no
		}
		revoke_allowed = {
			always = no
		}
		effect = {
			clr_global_flag = emf_hre_formed
			set_global_flag = emf_hre_formed
			set_character_flag = emf_achievement_hre_founder
			prestige = 1000

			if = {
				limit = { has_nickname = no }
				random_list = {
					60 = { give_nickname = nick_the_great }
					20 = { give_nickname = nick_the_restorer }
					20 = { give_nickname = nick_the_lawgiver }
				}
			}

			set_character_flag = emf_no_law_penalties
			primary_title = {
				e_hre = {
					grant_title = ROOT
					copy_title_laws = PREV
					copy_title_history = PREV
					tooltip = { succession = feudal_elective }
					hidden_tooltip = { add_law = succ_feudal_elective }
				}
			}
			clr_character_flag = emf_no_law_penalties

			# Destroy kingdoms that are no longer needed.
			any_demesne_title = {
				limit = {
					tier = KING
					OR = {
						title = k_lotharingia
						title = k_bohemia
						de_jure_liege = e_hre
					}
				}
				destroy_landed_title = THIS
			}

			hidden_tooltip = { recalc_succession = yes }

			# Map-specific de jure adjustments post-formation
			hidden_tooltip = { character_event = { id = emf_core.30 } }

			hidden_tooltip = { # TODO: Custom tooltip.
				if = {
					limit = { ai = no }
					add_character_modifier = {
						name = emf_cb_mod_dejure_kingdom_claim
						duration = 5475
					}
				}
				if = {
					limit = { ai = yes }
					add_character_modifier = {
						name = emf_cb_mod_dejure_kingdom_claim
						duration = 10950
						inherit = yes
					}
				}
			}
		}
		ai_will_do = {
			factor = 1
		}
	}

	emf_create_french_hre = {
		is_high_prio = yes

		potential = {
			emf_hiprio_decision_basic_potential_trigger = yes
			has_global_flag = charlemagne_hre
			independent = yes
			tier = king
			is_feudal = yes
			OR = {
				religion = catholic
				AND = {
					religion = fraticelli
					is_heretic = no
				}
			}
			e_hre = {
				has_holder = no
			}
			e_hre_french = {
				has_holder = no
			}
			e_france = {
				has_holder = no
			}
			OR = {
				has_landed_title = k_france
				has_landed_title = k_aquitaine
				has_landed_title = k_burgundy
				has_landed_title = k_lotharingia
				has_landed_title = k_italy
			}
		}
		allow = {
			has_landed_title = k_france
			has_landed_title = k_aquitaine
			has_landed_title = k_burgundy
			has_landed_title = k_italy
			realm_size = 180
			prestige = 1000
			war = no
			has_regent = no
		}
		revoke_allowed = {
			always = no
		}
		effect = {
			clr_global_flag = emf_hre_formed
			set_global_flag = emf_hre_formed
			set_character_flag = emf_achievement_hre_founder
			prestige = 1000

			if = {
				limit = { has_nickname = no }
				random_list = {
					60 = { give_nickname = nick_the_great }
					10 = { give_nickname = nick_the_restorer }
					20 = { give_nickname = nick_the_lawgiver }
					# TODO: the protector, the imperial/holy shield, the lacrosse player, the dude of dudes.
				}
			}

			if = {
				limit = { NOT = { is_title_active = e_hre_french } }
				activate_title = { title = e_hre_french status = yes }
			}

			set_character_flag = emf_no_law_penalties
			primary_title = {
				e_hre_french = {
					grant_title = ROOT
					copy_title_laws = PREV
					copy_title_history = PREV
					tooltip = { succession = feudal_elective }
					hidden_tooltip = { add_law = succ_feudal_elective }
				}
			}
			clr_character_flag = emf_no_law_penalties

			# Destroy kingdoms that are no longer needed.
			any_demesne_title = {
				limit = {
					tier = KING
					OR = {
						title = k_lotharingia
						de_jure_liege = e_france
					}
				}
				destroy_landed_title = THIS
			}

			hidden_tooltip = { recalc_succession = yes }

			# Map-specific de jure adjustments post-formation
			hidden_tooltip = { character_event = { id = emf_core.31 } }

			hidden_tooltip = { # TODO: Custom tooltip.
				if = {
					limit = { ai = no }
					add_character_modifier = {
						name = emf_cb_mod_dejure_kingdom_claim
						duration = 5475
					}
				}
				if = {
					limit = { ai = yes }
					add_character_modifier = {
						name = emf_cb_mod_dejure_kingdom_claim
						duration = 10950
						inherit = yes
					}
				}
			}
		}
		ai_will_do = {
			factor = 1
		}
	}


	emf_restore_byzantium = {
		is_high_prio = yes

		potential = {
			independent = yes
			e_byzantium = { has_holder = no }
			e_roman_empire = { has_holder = no }
			c_byzantion = { owner_under_ROOT = yes }
			higher_tier_than = COUNT
			NOT = { any_demesne_title = { tier = EMPEROR is_titular = no } }
			is_feudal = yes
			religion_group = christian
			k_byzantium = { de_jure_liege = e_byzantium }
			war = no
			emf_hiprio_decision_basic_potential_trigger = yes
		}
		allow = {
			has_regent = no
			prestige = 1000
			realm_size = 50
			k_byzantium = { emf_ROOT_completely_controls_counties_trigger = yes }
			custom_tooltip = {
				text = emf_empires_ctt_completely_controls_constantinople_besides_hagiasophia
				hidden_tooltip = {
					c_byzantion = {
						NOT = {
							any_direct_de_jure_vassal_title = {
								has_holder = yes
								owner_under_ROOT = no
								NOT = { title = b_hagiasophia }
							}
						}
					}
				}
			}
			custom_tooltip = {
				text = emf_empires_ctt_hagiasophia_under_ROOT_or_held_by_patriarch_if_orthodox
				hidden_tooltip = {
					b_hagiasophia = {
						OR = {
							owner_under_ROOT = yes
							AND = {
								ROOT = { religion = orthodox }
								owner = { has_landed_title = k_orthodox }
							}
						}
					}
				}
			}
			emf_empires_byz_valid_culture_religion_trigger = yes
		}
		revoke_allowed = {
			always = no
		}
		effect = {
			clr_global_flag = emf_byz_restored
			set_global_flag = emf_byz_restored
			set_character_flag = emf_achievement_byz_restored

			if = {
				limit = { has_nickname = no }
				random_list = {
					60 = { give_nickname = nick_the_restorer }
					20 = { give_nickname = nick_the_great }
					20 = { }
				}
			}

			if = {
				limit = { NOT = { is_title_active = e_byzantium } }
				activate_title = { title = e_byzantium status = yes }
			}

			set_character_flag = emf_no_law_penalties
			primary_title = {
				e_byzantium = {
					grant_title = ROOT
					copy_title_laws = PREV
					if = {
						limit = { PREV = { NOT = { has_law = administration_2 } } }
						add_law = administration_2
					}
					if = {
						limit = {
							PREV = {
								NOR = {
									has_law = crown_authority_2
									has_law = crown_authority_3
									has_law = crown_authority_4
								}
							}
						}
						add_law = crown_authority_2
						if = {
							limit = {
								has_dlc = "Zeus"
								PREV = { NOT = { has_law = ze_revokation_2 } }
							}
							add_law = ze_revokation_2
						}
						if = {
							limit = {
								NOT = { has_dlc = "Zeus" }
								PREV = { NOT = { has_law = revokation_2 } }
							}
							add_law = revokation_2
						}
					}
					# We don't use add_law so that it doesn't consume the lifetime cooldown upon
					# succession law changes, should a player NOT want to be semi-irreversibly forced
					# into primogeniture. Hence, the recalc_succession afterward.
					if = {
						limit = { PREV = { NOT = { has_law = succ_primogeniture } } }
						succession = primogeniture
					}
				}
			}
			clr_character_flag = emf_no_law_penalties
			
			hidden_tooltip = {
				e_byzantium = { make_primary_title = yes }
			}
			
			# Destroy any other empires held (only titular are allowed by this decision's `potential`)
			any_demesne_title = {
				limit = {
					tier = EMPEROR
					NOT = { title = e_byzantium }
				}
				destroy_landed_title = THIS
			}
			
			# Destroy any imperial kingdoms which may have formed (or started with, in the case of the "Empires"
			# of Trebizond and Nikaea) in the interim.
			any_demesne_title = {
				limit = {
					tier = KING
					de_jure_liege = e_byzantium
				}
				destroy_landed_title = THIS
			}
			
			# Destroy held titular, landed kingdoms
			any_demesne_title = {
				limit = {
					tier = KING
					is_titular = yes
					is_landless_type_title = no
				}
				destroy_landed_title = THIS
			}
			
			hidden_tooltip = { recalc_succession = yes }
			
			# Should the empire disintegrate again, we want the timer to start over for how long the
			# emf_reclaim_byz_capital CB can be used before expiring.
			clr_global_flag = emf_reclaim_byz_capital_success
			
			# Potentially give Hagia Sophia to our religious head if appropriate and if it's not theirs already,
			# and vassalize the religious head title
			
			trigger_switch = {
				on_trigger = religion
				orthodox =    { k_orthodox =    { owner = { save_event_target_as = emf_relhead } } }
				paulician =   { d_paulician =   { owner = { save_event_target_as = emf_relhead } } }
				monothelite = { d_monothelite = { owner = { save_event_target_as = emf_relhead } } }
				iconoclast =  { d_iconoclast =  { owner = { save_event_target_as = emf_relhead } } }
				miaphysite =  { d_miaphysite =  { owner = { save_event_target_as = emf_relhead } } }
				monophysite = { d_monophysite = { owner = { save_event_target_as = emf_relhead } } }
				nestorian =   { d_nestorian =   { owner = { save_event_target_as = emf_relhead } } }
			}
			
			b_hagiasophia = { holder_scope = { save_event_target_as = emf_temple_owner } }
			
			if = {
				limit = {
					# The religious head is indeed valid, and no player is liege to them
					event_target:emf_relhead = {
						NOT = { any_liege = { ai = no } }
					}
				}
				if = {
					limit = {
						event_target:emf_temple_owner = {
							OR = {
								under_ROOT = yes
								ai = yes
							}
							NOT = { character = event_target:emf_relhead }
						}
					}
					b_hagiasophia = {
						grant_title_no_opinion = event_target:emf_relhead
						hidden_tooltip = { remove_claim = event_target:emf_temple_owner }
					}
				}
				event_target:emf_relhead = {
					set_defacto_liege = ROOT
					pf_liege_change_effect = yes
				}
			}
			
			# Varangian Guard vassalization, if they have indeed been formed
			d_varangian_guard = {
				if = {
					limit = {
						is_title_active = THIS
						holder_scope = {
							liege = { ai = yes }
						}
					}
					holder_scope = {
						set_defacto_liege = ROOT
						pf_liege_change_effect = yes
					}
				}
			}

			# TODO: Do similar to the de jure kingdom claim as below with temporarily free access to
			# king-tier emf_subjugation.

			hidden_tooltip = { # TODO: Custom tooltip.
				if = {
					limit = { ai = no }
					add_character_modifier = {
						name = emf_cb_mod_dejure_kingdom_claim
						duration = 5475
					}
				}
				if = {
					limit = { ai = yes }
					add_character_modifier = {
						name = emf_cb_mod_dejure_kingdom_claim
						duration = 10950
						inherit = yes
					}
				}
			}
		}
		ai_will_do = {
			factor = 1
		}
	}
}
